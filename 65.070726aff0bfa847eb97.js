(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/layers/features/controllers/OnDemandController":2768,"esri/views/2d/layers/features/controllers/EditsQueue":2772,"esri/views/2d/layers/features/support/DataTile":2773,"esri/views/2d/layers/features/support/DataTileFeaturesIndex":2774,"esri/core/SetPool":2775,"esri/views/2d/layers/features/support/TileUpdateQueue":2776})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{2768:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(5),r(9),r(10),r(161),r(6),r(14),r(3),r(106),r(4),r(16),r(208),r(2),r(37),r(38),r(306),r(1569),r(90),r(1984),r(2772),r(2773),r(2774),r(1715),r(2776),r(505)],void 0===(n=function(e,t,r,i,_,g,h,u,l,n,s,v,b,o,a,d,y,T,m,c,I,f,p,x,S,w,F,E){Object.defineProperty(t,"__esModule",{value:!0});var Q,C=s.getLogger("esri.views.2d.layers.features.controllers.OnDemandController"),q=n("esri-featurelayer-webgl"),j=n("esri-mobile"),O={maxDrillLevel:q&&"object"==typeof q&&null!=q.maxDrillLevel?q.maxDrillLevel:j?1:4,maxRecordCountFactor:q&&"object"==typeof q&&null!=q.maxRecordCountFactor?q.maxRecordCountFactor:j?1:3,enablePBFQuery:!q||"object"!=typeof q||null==q.enablePBFQuery||q.enablePBFQuery},P=new Set,N=[],A=(z.prototype.destroy=function(){this.client.close(),this.client=null},z.prototype.executeQuery=function(r,i){return h(this,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return[4,this.client.invoke("queryFeatures",r.toJSON(),i)];case 1:return t=e.sent(),[2,m.convertFromFeatureSet(t,this.objectIdField)]}})})},z),B=(M.prototype.destroy=function(){},M.prototype.executeQuery=function(t,r){return h(this,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,c.executeQueryPBF(this.source,t,{type:"optimized"},r)];case 1:return[2,e.sent().data]}})})},M),G=(R.prototype.destroy=function(){},R.prototype.executeQuery=function(r,i){return h(this,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return[4,c.executeQuery(this.source,r,i)];case 1:return t=e.sent().data,[2,m.convertFromFeatureSet(t,this.objectIdField)]}})})},R),D=(Q=d.declared(f.default),r(k,Q),k.prototype.initialize=function(){var i=this,e=this._createFeatureStore();e.onFeatureAdd=this.onFeatureAdd.bind(this),e.onFeatureRemove=this.onFeatureRemove.bind(this),this._set("featureStore",e),this._dataTileIndex.featureStore=this.featureStore,this._dataTileIndex.forEach(function(e){return e.done=!1}),this._fetchQueue=new E({concurrency:10,strategy:"center-first",tileInfoView:this.tileStore.tileScheme,process:function(e,t){return i._fetchTile(e,i.queryInfo,t)}}),this._patchQueue=new E({concurrency:10,strategy:"center-first",tileInfoView:this.tileStore.tileScheme,process:function(e,t){return i._fetchTile(e.dataTile,e.queryInfo,t)}}),this._updateQueue=new F.default({tileInfoView:this.tileStore.tileScheme,process:function(e,t,r){return i._updateTile(e,t,r)}});var t=this.service,r=t.capabilities,n=t.source,s=t.objectIdField;Array.isArray(n)?this.sourceAdapter=new A(n,s):O.enablePBFQuery&&r.query.supportsFormatPBF?this.sourceAdapter=new B(n):this.sourceAdapter=new G(n,s),this.handles.add([this.watch("updating",function(e){return!e&&i.onIdle()})]),this.featureStore.events.on("valueRangesChanged",function(e){i.remoteClient.invoke("emitEvent",{name:"valueRangesChanged",event:{valueRanges:e.valueRanges}})})},k.prototype.destroy=function(){this._fetchQueue.clear(),this._patchQueue.clear(),this._updateQueue.clear(),this._editsQueue.destroy(),this.queryEngine.destroy(),this.sourceAdapter.destroy()},Object.defineProperty(k.prototype,"queryEngine",{get:function(){return this._createQueryEngine(this.featureStore)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"updating",{get:function(){return!this.viewState||this._fetchQueue.updating||this._patchQueue.updating||this._updateQueue.updating||this._editsQueue.updating},enumerable:!0,configurable:!0}),k.prototype.update=function(a,l){return h(this,void 0,void 0,function(){var t,r,i,n,s,o,u=this;return g(this,function(e){switch(e.label){case 0:return this.validateConfig(a),t=JSON.stringify(this.config.filters),r=this.renderer.getAttributeHash(),i=a.availableFields.filter(function(e){return-1===u.availableFields.indexOf(e)}),n=this.config.definitionExpression,this._set("config",a),n!==this.config.definitionExpression&&this._set("queryEngine",this._createQueryEngine(this.featureStore)),[4,this.updatePixelBuffer()];case 1:return e.sent(),s=t!==JSON.stringify(a.filters),o=r!==this.renderer.getAttributeHash(),l?o?[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]:[3,3]:[3,6];case 2:e.sent(),e.label=3;case 3:return[4,this.attributeStore.updateFilters(this)];case 4:return e.sent(),[4,this.featureStore.update(s,a)];case 5:return e.sent(),this.refresh(),[2];case 6:return i.length?[4,this._handleAttributeChange(i)]:[3,8];case 7:e.sent(),e.label=8;case 8:return"heatmap"===this.renderer.type?[2]:o?[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]:[3,10];case 9:e.sent(),this.featureStore.forEach(function(e){return u.attributeStore.setAttributeData(e.localId,e,u.geometryInfo,u.viewParams)}),e.label=10;case 10:return[4,this.attributeStore.updateFilters(this)];case 11:return e.sent(),[4,this.featureStore.update(s,a)];case 12:return e.sent(),[4,this.attributeStore.sendUpdates()];case 13:return e.sent(),[2]}})})},k.prototype.invalidate=function(){return h(this,void 0,void 0,function(){var t,r,i;return g(this,function(e){for(t=0,r=this.tileStore.tiles;t<r.length;t++)i=r[t],this._updateQueue.push(i.id,Date.now());return[2]})})},k.prototype.onIdle=function(){this.featureStore.sweepClusters()},k.prototype.onEdits=function(e){var t=this;return this._fetchQueue.pause(),this._fetchQueue.reset(),this._editsQueue.push(e).then(function(){t._editsQueue.updating||t._fetchQueue.resume()})},k.prototype.queryFeatures=function(e){return this.queryEngine.executeQuery(e)},k.prototype.queryFeatureCount=function(e){return this.queryEngine.executeQueryForCount(e)},k.prototype.queryObjectIds=function(e){return this.queryEngine.executeQueryForIds(e)},k.prototype.queryExtent=function(e){return this.queryEngine.executeQueryForExtent(e)},k.prototype.queryStatistics=function(e){return h(this,void 0,void 0,function(){var f,p,y,t=this;return g(this,function(e){switch(e.label){case 0:return y=p=f=0,[4,b.all(this.tileStore.tiles.map(function(c){return h(t,void 0,void 0,function(){var t,r,i,n,s,o,u,a,l,h,d;return g(this,function(e){switch(e.label){case 0:return t=this.queryInfo,r=t.returnCentroid,i=t.returnGeometry,n=this._pixelBuffer,s={pixelBuffer:n,returnGeometry:i,returnCentroid:r,returnOutline:this.returnOutline},o=v(),[4,this.featureStore.executeTileQuery(c,this.spatialReference,s)];case 1:for(u=e.sent().features,a=v(),y+=a-o,f+=u.length,l=0,h=u;l<h.length;l++)(d=h[l]).geometry&&(T.isPolygon(d.geometry)?p+=d.geometry.rings.reduce(function(e,t){return e+t.length},0):T.isPolyline(d.geometry)&&(p+=d.geometry.paths.reduce(function(e,t){return e+t.length},0)));return[2]}})})}))];case 1:return e.sent(),[2,_({},this.featureStore.storeStatistics,{displayedFeatureCount:f,displayedVertexCount:p,displayPreProcessTime:y})]}})})},k.prototype.refresh=function(){return h(this,void 0,void 0,function(){var t=this;return g(this,function(e){switch(e.label){case 0:return this._queryInfoHash=Math.random().toString(),this._dataTileIndex.clear(),this._fetchQueue.pause(),this._updateQueue.pause(),this._editsQueue.clear(),this._fetchQueue.clear(),this._updateQueue.clear(),this.featureStore.startMarkingUsedFeatures(),this._manageTiles(this.tileStore.tiles),this._fetchQueue.resume(),[4,o.whenFalseOnce(this._fetchQueue,"updating")];case 1:return e.sent(),this.featureStore.sweep(),this.featureStore.forEach(function(e){return t.attributeStore.setAttributeData(e.localId,e,t.geometryInfo,t.viewParams)}),this.attributeStore.sendUpdates(),this._updateQueue.resume(),[2]}})})},k.prototype.setViewState=function(e){var t=this,r=this.viewState&&this.viewState.scale;this.inherited(arguments),this._fetchQueue.state=e,this._updateQueue.state=e,r!==this.viewState.scale&&this.attributeStore.hasScaleExpr&&(this.featureStore.forEach(function(e){return t.attributeStore.setAttributeData(e.localId,e,t.geometryInfo,t.viewParams)}),this.attributeStore.sendUpdates())},k.prototype.getAggregate=function(e){return this.featureStore.getAggregate(e)},k.prototype.getAggregateValueRanges=function(){return this.featureStore.getAggregateValueRanges()},k.prototype.onTileUpdate=function(e){this._manageTiles(e.added,e.removed),this.featureStore.onTileUpdate(e)},k.prototype.onFeatureAdd=function(e){if(this._featuresInFlight.has(e.objectId)){var t=this._featuresInFlight.get(e.objectId).attributes;e.attributes=_({},t,e.attributes),this._featuresInFlight.delete(e.objectId)}e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},k.prototype._handleAttributeChange=function(t){return h(this,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this._fetchChangedFields(t)];case 1:return e.sent(),[2]}})})},k.prototype._fetchChangedTileFields=function(r,i){return h(this,void 0,void 0,function(){var t;return g(this,function(e){return(t=this._dataTileIndex.get(r.id))?[2,this._fetchChangedTileFieldsDrill(t,i)]:[2]})})},k.prototype._fetchChangedTileFieldsDrill=function(c,f,p){return void 0===p&&(p=0),h(this,void 0,void 0,function(){var t,r,i,n,s,o,u,a,l,h,d=this;return g(this,function(e){switch(e.label){case 0:return t=_({},this.queryInfo,{returnGeometry:!1,returnCentroid:!1,outFields:f.concat([this.service.objectIdField])}),c.returnExceeded=c.returnExceeded||O.maxDrillLevel<=p,r=c.key,i={key:r,dataTile:c,queryInfo:t},[4,this._patchQueue.push(i)];case 1:return(n=e.sent()).exceededTransferLimit&&p<O.maxDrillLevel?(s=c.tile.createChildTiles(),o=s.map(function(e){var t=new x.default;return t.tile=e,t.displayTile=c.displayTile,t}),[4,b.all(o.map(function(e){return d._fetchChangedTileFieldsDrill(e,f,p+1)}))]):[3,3];case 2:return e.sent(),[2];case 3:for(u=0,a=n.features;u<a.length;u++)l=a[u],this.featureStore.has(l.objectId)?(h=this.featureStore.getFeature(l.objectId)).attributes=_({},h.attributes,l.attributes):this._featuresInFlight.set(l.objectId,l);return[2]}})})},k.prototype._fetchChangedTileFieldsPaged=function(c,f,p){return void 0===p&&(p=0),h(this,void 0,void 0,function(){var t,r,i,n,s,o,u,a,l,h,d;return g(this,function(e){switch(e.label){case 0:return t=this.service.capabilities.query.supportsMaxRecordCountFactor,r=this.service.tileMaxRecordCount,i=r*(t?1:O.maxRecordCountFactor),n=_({},this.queryInfo,{returnGeometry:!1,returnCentroid:!1,outFields:f.concat([this.service.objectIdField]),resultOffset:p*i,num:i}),c.returnExceeded=!0,s=c.key,o={key:s,dataTile:c,queryInfo:n},[4,this._patchQueue.push(o)];case 1:for(u=e.sent(),a=0,l=u.features;a<l.length;a++)h=l[a],this.featureStore.has(h.objectId)?(d=this.featureStore.getFeature(h.objectId)).attributes=_({},d.attributes,h.attributes):this._featuresInFlight.set(h.objectId,h);return u.exceededTransferLimit?[2,this._fetchChangedTileFieldsPaged(c,f,p+1)]:[2]}})})},k.prototype._fetchChangedFields=function(n){return h(this,void 0,void 0,function(){var t,r,i=this;return g(this,function(e){switch(e.label){case 0:return t=this.tileStore.tiles,r=t.map(function(e){return i._fetchChangedTileFields(e,n)}),[4,b.all(r)];case 1:return e.sent(),[2]}})})},k.prototype._manageTiles=function(e,t){void 0===t&&(t=null);for(var i=this._dataTileIndex,r=this._fetchQueue,n=this._updateQueue,s="esriGeometryPoint"===this.service.geometryType,o=this,u=0,a=e;u<a.length;u++)!function(t){var r=i.get(t.id);r?(r.displayTile=t,s?i.forEach(function(e){w.isChildOf(e,r)&&(e.displayTile=t)}):r.done=!1):((r=new x.default).tile=t.clone(),r.displayTile=t,i.add(r)),o._processDataTile(r)}(d=a[u]);if(t)for(var l=0,h=t;l<h.length;l++){var d=h[l];P.add(d),n.abort(d.id)}i.forEach(function(e){P.has(e.displayTile)&&N.push(e)});for(var c=0,f=N;c<f.length;c++){var p=f[c];r.abort(p.id),i.delete(p)}N.length=0,P.clear()},k.prototype._processDataTile=function(t){var r=this,e=t.displayTile,i=t.key,n=this._dataTileIndex,s=this._fetchQueue,o=i.id,u=this._queryInfoHash,a=i.level-e.key.level>=O.maxDrillLevel;if(n.add(t),t.done||s.has(o)){if(t.queryInfoHash!==u||t.returnExceeded!==a)if(t.done)t.done=!1;else{if(!s.isOngoing(o))return t.queryInfoHash=u,void(t.returnExceeded=a);s.abort(o)}}else t.queryInfoHash=u,t.returnExceeded=a;t.done?this._invalidateTile(t.displayTile):s.has(o)||s.push(t).then(function(e){return r._handleResponse(t,e)}).catch(function(e){b.isAbortError(e)||C.error(new l("featurelayer-controller:tile-error","Encountered an error when handling tile response",e)),t.done=!0,r._invalidateTile(t.displayTile)})},k.prototype._handleResponse=function(e,t){if(e.done=!0,m.hydrateOptimizedFeatureSet(t),t.exceededTransferLimit)if(e.returnExceeded)this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);else{for(var r=e.tile.createChildTiles(),i=0,n=r;i<n.length;i++){var s=n[i],o=new x.default;o.tile=s,o.displayTile=e.displayTile,this._processDataTile(o)}u.release(r)}else this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);this._invalidateTile(e.tile)},k.prototype._deleteChildrenDataTiles=function(t){this._dataTileIndex.forEach(function(e){w.isChildOf(e,t)&&N.push(e)});for(var e=0,r=N;e<r.length;e++){var i=r[e];this._fetchQueue.abort(i.id),this._dataTileIndex.delete(i)}N.length=0},k.prototype._fetchTile=function(c,f,p){return h(this,void 0,void 0,function(){var t,r,i,n,s,o,u,a,l,h,d;return g(this,function(e){switch(e.label){case 0:return t=new y({xmin:c.bounds[0],ymin:c.bounds[1],xmax:c.bounds[2],ymax:c.bounds[3],spatialReference:this.spatialReference}),r=this.service.geometryType,i="esriGeometryPoint"===r?c.tile:c.displayTile,n=i.extent,s=i.resolution,o=c.returnExceeded,u=this._createQuery(t,n,s,f,O.maxRecordCountFactor,o),[4,this.sourceAdapter.executeQuery(u,p)];case 1:if(a=e.sent(),"esriGeometryPolygon"===r)for(l=0,h=a.features;l<h.length;l++)(d=h[l]).geometry=m.removeCollinearVectices(d.geometry,d.geometry,r,!1,!1);return[2,a]}})})},k.prototype._invalidateTile=function(e){for(var t=this._pixelBuffer,r=this._updateQueue,i=0,n=this.tileStore.intersections(e,t);i<n.length;i++){var s=n[i].tile;r.push(s.id,s.updateTimestamp)}},k.prototype._updateTile=function(p,y,_){return h(this,void 0,void 0,function(){var t,r,i,n,s,o,u,a,l,h,d,c,f=this;return g(this,function(e){switch(e.label){case 0:return t=this.tileStore.get(p),r=this.queryInfo,i=r.returnCentroid,n=r.returnGeometry,s=this._pixelBuffer,o={pixelBuffer:s,returnGeometry:n,returnCentroid:i,returnOutline:this.returnOutline},[4,this.featureStore.executeTileQuery(t,this.spatialReference,o)];case 1:return u=e.sent(),a=u.features,l=u.objectIds,[4,this.attributeStore.sendUpdates()];case 2:return e.sent(),h={geometryType:this.service.geometryType,features:a,fields:this.service.fields,objectIdFieldName:this.service.objectIdField,transform:t.transform},d=[],c=!0,this._dataTileIndex.forEach(function(e){t.id!==e.id&&w.isChildOf(e,t)&&c&&!e.done&&(c=!1)}),c&&t&&t.objectIds.forEach(function(e){if(!l.has(e)){var t=f.attributeStore.getLocalId(e);d.push(t)}}),l.forEach(function(e){t.objectIds.add(e)}),t.updateTimestamp=y,[2,this.processor.onTileData(t,{clear:!0,addOrUpdate:h.features,remove:d,transformParams:I.Utils.getTransformParams(h)},_).catch(function(e){b.isAbortError(e)||C.error("update-tile",e)})]}})})},k.prototype._processEdits=function(i,a,l){return h(this,void 0,void 0,function(){var n,t,r,s,o,u=this;return g(this,function(e){switch(e.label){case 0:return n=this._createTempQueryEngine(),t=this._createObjectIdsQuery(i),i.length?[4,this.sourceAdapter.executeQuery(t)]:[3,2];case 1:r=e.sent(),m.hydrateOptimizedFeatureSet(r),this._dataTileIndex.addOrUpdateFeatures(r.features),n.featureStore.addMany(r.features),e.label=2;case 2:return s=a.concat(i).map(function(e){return u.attributeStore.getLocalId(e)}),this._dataTileIndex.deleteFeaturesById(a),this.attributeStore.sendUpdates(),o=_({},this.queryInfo,{pixelBuffer:this._pixelBuffer,returnOutline:this.returnOutline}),this.tileStore.tiles.map(function(i){return h(u,void 0,void 0,function(){var t,r;return g(this,function(e){switch(e.label){case 0:return[4,n.featureStore.executeTileQuery(i,this.spatialReference,o)];case 1:return t=e.sent().features,r={transform:i.transform,hasZ:!1,hasM:!1},[2,this.processor.onTileData(i,{addOrUpdate:t,remove:s,transformParams:r},l).catch(function(e){b.isAbortError(e)||C.error("update-tile",e)})]}})})}),n.destroy(),[2]}})})},k.prototype._createObjectIdsQuery=function(e){var t=this._createDefaultQuery(this.queryInfo);return t.objectIds=e,t},i([d.property()],k.prototype,"_fetchQueue",void 0),i([d.property()],k.prototype,"_patchQueue",void 0),i([d.property()],k.prototype,"_updateQueue",void 0),i([d.property()],k.prototype,"_editsQueue",void 0),i([d.property({readOnly:!0})],k.prototype,"featureStore",void 0),i([d.property()],k.prototype,"sourceAdapter",void 0),i([d.property({readOnly:!0,dependsOn:["featureStore","service"]})],k.prototype,"queryEngine",null),i([d.property({dependsOn:["viewState","_fetchQueue.updating","_updateQueue.updating","_patchQueue.updating","_editsQueue.updating"]})],k.prototype,"updating",null),i([d.subclass("esri.views.2d.layers.features.controllers.OnDemandController")],k));function k(){var e=null!==Q&&Q.apply(this,arguments)||this;return e.type="on-demand",e._queryInfoHash=null,e._dataTileIndex=new S.default,e._editsQueue=new p.EditsQueue({processEdits:e._processEdits.bind(e)}),e._featuresInFlight=new Map,e}function R(e,t){this.source=e,this.objectIdField=t}function M(e){this.source=e}function z(e,t){this.objectIdField=t,this.client=a.openWithPorts(e)}t.default=D}.apply(null,i))||(e.exports=n)},2772:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(9),r(10),r(1),r(13),r(4),r(2),r(47)],void 0===(n=function(e,t,r,S,n,i,s,o,u){Object.defineProperty(t,"__esModule",{value:!0});var a,l=(a=u.declared(s),i(h,a),h.prototype.destroy=function(){this.clear()},Object.defineProperty(h.prototype,"updating",{get:function(){return!this.destroyed&&(0<this._queue.length||null!=this._onGoingRequest)},enumerable:!0,configurable:!0}),h.prototype.clear=function(){if(this.destroyed)throw new Error("instance is already destroyed");for(var e=this._queue.pop();e;)e.resolver.reject(o.createAbortError()),e=this._queue.pop();this._queue.length=0,this._abortController.abort(),this._abortController=o.createAbortController()},h.prototype.push=function(i){return n(this,void 0,void 0,function(){var t,r=this;return S(this,function(e){if(this.destroyed)throw new Error("instance is already destroyed");return t=o.createResolver(),this._queue.push({event:i,resolver:t}),this.notifyChange("updating"),Promise.resolve().then(function(){r._processNext()}),[2,t.promise]})})},h.prototype._processNext=function(){return n(this,void 0,void 0,function(){var t,r,i,n,s,o,u,a,l,h,d,c,f,p,y,_,g,v,b,T,m,I,x=this;return S(this,function(e){switch(e.label){case 0:if(this._onGoingRequest)return[2];for(t=[],r=new Set,i=new Set,n=new Set,s=this._queue.shift();s;){for(o=s.event,u=o.addedFeatures,a=o.deletedFeatures,l=o.updatedFeatures,h=s.resolver,t.push(h),d=0,c=u;d<c.length;d++)f=c[d],T=f.objectId,f.error||(r.add(T),i.add(T),n.delete(T));for(p=0,y=l;p<y.length;p++)_=y[p],T=_.objectId,_.error||(i.add(T),n.delete(T));for(g=0,v=a;g<v.length;g++)b=v[g],T=b.objectId,b.error||(r.has(T)?r.delete(T):n.add(T),i.delete(T));s=this._queue.shift()}return i.size||n.size?(m=[],I=[],i.size&&i.forEach(function(e){m.push(e)}),n.size&&n.forEach(function(e){I.push(e)}),this._onGoingRequest=Promise.resolve().then(function(){return x.processEdits(m,I,{signal:x._abortController.signal})}).catch(function(){}),this.notifyChange("updating"),[4,this._onGoingRequest]):(this.notifyChange("updating"),t.forEach(function(e){return e()}),[2]);case 1:return e.sent(),this._onGoingRequest=null,this.notifyChange("updating"),t.forEach(function(e){return e()}),0<this._queue.length&&this._processNext(),[2]}})})},r([u.property({constructOnly:!0})],h.prototype,"processEdits",void 0),r([u.property({readOnly:!0})],h.prototype,"updating",null),r([u.subclass("esri.views.2d.layers.features.controllers.EditsQueue")],h));function h(e){var t=a.call(this,e)||this;return t._queue=[],t._onGoingRequest=null,t._abortController=o.createAbortController(),t}t.EditsQueue=l}.apply(null,i))||(e.exports=n)},2773:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(Object.defineProperty(i.prototype,"key",{get:function(){return this.tile.key},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this.tile.id},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bounds",{get:function(){return this.tile.bounds},enumerable:!0,configurable:!0}),i);function i(){this.displayTile=null,this.tile=null,this.done=!1,this.queryInfoHash=null,this.returnExceeded=!1}t.default=r}.apply(null,i))||(e.exports=n)},2774:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2775),r(1722),r(1715)],void 0===(n=function(e,t,h,a,n){Object.defineProperty(t,"__esModule",{value:!0});var d=[],c=new Set,r=(i.prototype.destroy=function(){this.clear()},i.prototype.add=function(e){var r=this;if(!this.has(e.id)){var i=e;this._tileById.set(i.id,i),this._tilesToFeatures.set(i,h.default.acquire()),this._tilesToFeatures.forEach(function(t,e){i!==e&&(n.isParentOf(i,e)?t.forEach(function(e){r._link(i,e)}):n.isChildOf(i,e)&&r.featureStore.forEachInBounds(i.bounds,function(e){t.has(e.objectId)&&r._link(i,e.objectId)}))})}},i.prototype.clear=function(){this._tilesToFeatures.forEach(function(e){return h.default.release(e)}),this._tilesToFeatures.clear(),this._featureToTiles.forEach(function(e){return h.default.release(e)}),this._featureToTiles.clear(),this._tileById.clear()},i.prototype.delete=function(e){var r=this,i=this.get(e.id);d.length=0,this._tilesToFeatures.get(i).forEach(function(e){var t=r._featureToTiles.get(e);t.has(i)&&1===t.size?d.push(e):r._unlink(i,e)});for(var t=0,n=d;t<n.length;t++){var s=n[t];this._unlink(i,s)}this.featureStore.removeManyById(d),this._tilesToFeatures.delete(i),this._tileById.delete(i.id),d.length=0},i.prototype.forEach=function(e,t){return this._tileById.forEach(e,t)},i.prototype.get=function(e){return this._tileById.get(e)},i.prototype.has=function(e){return this._tileById.has(e)},i.prototype.setTileFeatures=function(e,t){var r=this,i=this.get(e.id);this._tilesToFeatures.has(i)||(this._tileById.set(i.id,i),this._tilesToFeatures.set(i,h.default.acquire()));for(var n=0,s=t;n<s.length;n++){var o=s[n];c.add(o.objectId)}d.length=0,this._tilesToFeatures.get(i).forEach(function(e){if(!c.has(e)){var t=r._featureToTiles.get(e);t.has(i)&&1===t.size?d.push(e):r._unlink(i,e)}});for(var u=0,a=d;u<a.length;u++){var l=a[u];this._unlink(i,l)}this.featureStore.removeManyById(d),this.featureStore.addMany(t),c.forEach(function(e){r._link(i,e)}),c.clear(),d.length=0},i.prototype.addOrUpdateFeatures=function(e){for(var r=this,i=new Set,n=new a.default({geometryType:this.featureStore.geometryType,hasM:this.featureStore.hasM,hasZ:this.featureStore.hasZ}),t=0,s=this.deleteFeaturesById(e.map(function(e){return e.objectId}));t<s.length;t++){var o=s[t];i.add(o)}n.addMany(e),this._tileById.forEach(function(t){n.forEachInBounds(t.bounds,function(e){r._link(t,e.objectId),i.add(t)})}),this.featureStore.addMany(e);var u=[];return i.forEach(function(e){return u.push(e)}),u},i.prototype.deleteFeaturesById=function(e){for(var r=this,i=new Set,n=this,t=0,s=e;t<s.length;t++)!function(t){var e=n._featureToTiles.get(t);e&&(e.forEach(function(e){i.add(e),r._tilesToFeatures.get(e).delete(t)}),h.default.release(e),n._featureToTiles.delete(t))}(s[t]);this.featureStore.removeManyById(e);var o=[];return i.forEach(function(e){return o.push(e)}),o},i.prototype._link=function(e,t){this._featureToTiles.get(t)||this._featureToTiles.set(t,h.default.acquire()),this._featureToTiles.get(t).add(e),this._tilesToFeatures.get(e).add(t)},i.prototype._unlink=function(e,t){this._featureToTiles.get(t).delete(e),this._tilesToFeatures.get(e).delete(t),0===this._featureToTiles.get(t).size&&(h.default.release(this._featureToTiles.get(t)),this._featureToTiles.delete(t))},i);function i(){this._tileById=new Map,this._tilesToFeatures=new Map,this._featureToTiles=new Map}t.default=r}.apply(null,i))||(e.exports=n)},2775:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(i.prototype.acquire=function(){if(0===this._pool.length)return new Set;var e=this._pool.pop();return this._set.delete(e),e},i.prototype.release=function(e){e&&!this._set.has(e)&&(e.clear(),this._pool.length<5e4&&(this._pool.push(e),this._set.add(e)))},i.acquire=function(){return n.acquire()},i.release=function(e){return n.release(e)},i);function i(){this._pool=[],this._set=new Set}var n=new(t.default=r)}.apply(null,i))||(e.exports=n)},2776:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(9),r(10),r(13),r(4),r(50),r(2),r(48),r(339)],void 0===(n=function(e,t,r,i,u,n,s,o,a,l,h,d){Object.defineProperty(t,"__esModule",{value:!0});var c,f=[0,0],p=(c=l.declared(s),r(y,c),Object.defineProperty(y.prototype,"length",{get:function(){return this._queue.size},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"updating",{get:function(){return 0<this._queue.size||null!=this._onGoingTile},enumerable:!0,configurable:!0}),y.prototype.abort=function(e){this._onGoingTile&&this._onGoingTile.tileId===e&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._queue.delete(e),this._scheduleNext(),this.notifyChange("updating")},y.prototype.clear=function(){this._queue.clear(),this._onGoingTile&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._cancelNext(),this.notifyChange("updating")},y.prototype.has=function(e){return this._queue.has(e)},y.prototype.isOngoing=function(e){return this._onGoingTile&&this._onGoingTile.tileId===e},y.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},y.prototype.push=function(e,t){if(!this._queue.has(e)){var r=o.createAbortController();this._queue.set(e,{tileId:e,key:d.TileKey.pool.acquire(e),timestamp:t||this._timestamp,abortController:r}),this._scheduleNext(),this.notifyChange("updating")}},y.prototype.refresh=function(){this._timestamp=Date.now(),this.reset()},y.prototype.reset=function(){var e=this._onGoingTile;if(e){var t=e.tileId;this.push(t,this._timestamp)}this.notifyChange("updating")},y.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext()),this.notifyChange("updating")},y.prototype._finalize=function(){this._onGoingTile=null,this.notifyChange("updating"),this._scheduleNext()},y.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},y.prototype._scheduleNext=function(){this._isPaused||this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingTile||(this._scheduledNextHandle=a.schedule(this._next))},y.prototype._next=function(){return n(this,void 0,void 0,function(){var r,i,n,s,o;return u(this,function(e){switch(e.label){case 0:if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingTile)return this._scheduledNextHandle=null,[2];if(this._scheduledNextHandle=null,r=this._peek(),i=r.abortController.signal,n=r.tileId,s=r.key,d.TileKey.pool.release(s),this._queue.delete(n),this._onGoingTile=r,o=this.process(n,this._timestamp,{signal:i}),this.notifyChange("updating"),!(t=o)||"function"!=typeof t.then)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,o];case 2:case 3:return e.sent(),[3,4];case 4:return this._finalize(),[2]}var t})})},y.prototype._peek=function(){var i=this;if(!this.state)throw new Error("state not set");var n=this.tileInfoView,s=this.state.center,o=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,a=null;return this._queue.forEach(function(e){n.getTileCoords(f,e.key);var t=i._timestamp-e.timestamp;if(isNaN(t))(r=h.vec2.distance(f,s))<u&&(u=r,a=e);else if(t===o){var r;(r=h.vec2.distance(f,s))<u&&(u=r,a=e)}else o<t&&(o=t,u=Number.POSITIVE_INFINITY,a=e)}),a},i([l.property({readOnly:!0})],y.prototype,"length",null),i([l.property({constructOnly:!0})],y.prototype,"process",void 0),i([l.property()],y.prototype,"state",void 0),i([l.property({constructOnly:!0})],y.prototype,"tileInfoView",void 0),i([l.property({readOnly:!0})],y.prototype,"updating",null),i([l.subclass("esri.views.2d.layers.features.support.TileUpdateQueue")],y));function y(e){var t=c.call(this,e)||this;return t._queue=new Map,t._isPaused=!1,t._scheduledNextHandle=null,t._timestamp=Date.now(),t.tileInfoView=null,t._next=t._next.bind(t),t._finalize=t._finalize.bind(t),t}t.default=p}.apply(null,i))||(e.exports=n)}}]);