(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/layers/VectorTileLayerView2D":1618,"esri/views/layers/support/ClipArea":1627,"esri/views/layers/LayerView":1635,"esri/views/2d/layers/LayerView2D":1636,"esri/views/layers/support/ClipRect":1637,"esri/views/layers/support/Geometry":1638,"esri/views/layers/support/Path":1639,"esri/views/2d/engine/vectorTiles/VectorTile":1915,"esri/views/2d/engine/vectorTiles/RectangleBinPack":1916,"esri/views/2d/engine/vectorTiles/TileHandler":2568,"esri/views/2d/engine/vectorTiles/RenderBucket":2569,"esri/views/2d/engine/vectorTiles/GlyphMosaic":2570,"esri/views/2d/engine/vectorTiles/GlyphSource":2571,"esri/views/2d/engine/vectorTiles/SpriteMosaic":2572,"esri/views/2d/engine/vectorTiles/VectorTileContainer":2573,"esri/views/2d/engine/vectorTiles/FadeRecorder":2574,"esri/views/2d/tiling/TileInfoViewPOT":2575})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{1618:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(9),r(10),r(89),r(6),r(23),r(3),r(4),r(2),r(2568),r(2573),r(1636),r(2575),r(505),r(506),r(1635)],void 0===(n=function(e,t,r,i,l,n,u,a,s,o,h,c,p,d,f,y,g,v,_){var b,m=o.getLogger("esri.views.2d.layers.VectorTileLayerView2D");return b=c.declared(f.LayerView2D(_)),r(x,b),x.prototype.initialize=function(){var e=this,t=this.layer.tileInfo;(t&&t.spatialReference).equals(this.view.spatialReference)?(this._tileInfoView=new y(this.layer.tileInfo,this.layer.fullExtent),this.container=new d.VectorTileContainer(this._tileInfoView,this.clips),this._tileHandler=new p.TileHandler(this.layer,window.devicePixelRatio||1,!0,this.container,null),this.handles.add([this.watch("layer.currentStyleInfo",function(){return e._start()}),this.clips.on("change",function(){return e.container.setClips(e.clips)})])):this.addResolvingPromise(h.reject(new a("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))},x.prototype.destroy=function(){this._stop(),this.container.dispose(),this._tileHandler&&(this._tileHandler.destroy(),this._tileHandler=null)},x.prototype.hitTest=function(s,o){return n(this,void 0,void 0,function(){var t,r,i,n,a;return l(this,function(e){switch(e.label){case 0:return this.suspended||!this._tileHandlerPromise?[2,null]:[4,this._tileHandlerPromise];case 1:return e.sent(),[4,this.container.hitTest(s,o)];case 2:return(t=e.sent())&&0!==t.length?(r=t[0],i=this._tileHandler.getStyleRepository().layers,r>=i.length?[2,null]:(n=i[r],(a=new u({attributes:{layerId:r,layerName:n.id}})).layer=this.layer,a.sourceLayer=this.layer,[2,a])):[2,null]}})})},x.prototype.update=function(i){var n=this;this.notifyChange("updating");var e=this._tileHandlerPromise;e&&e.then(function(){if(i.pixelRatio!==n._tileHandler.devicePixelRatio)return n._start(),void(n._tileHandler.devicePixelRatio=i.pixelRatio);n._invalidateStyle?(n._issueStyleInvalidation(),n._invalidateStyle=!1):(n._fetchQueue.pause(),n._parseQueue.pause(),n._fetchQueue.state=i.state,n._parseQueue.state=i.state,n._tileStrategy.update(i),n._parseQueue.resume(),n._fetchQueue.resume());for(var e=0,t=n.container.children;e<t.length;e++){var r=t[e];n._tileHandler.updateTile(r,i)}})},x.prototype.attach=function(){var e=this;this._start(),this._handles.add(this.layer.on("paint-change",function(){return e.container.requestRender()})),this._handles.add(this.layer.on("layout-change",function(){e._invalidateStyle=!0,e.requestUpdate()}))},x.prototype.detach=function(){this._stop(),this._handles.removeAll()},x.prototype.moveStart=function(){this.requestUpdate()},x.prototype.viewChange=function(){this.requestUpdate()},x.prototype.moveEnd=function(){this.requestUpdate()},x.prototype.canResume=function(){var e=this.inherited(arguments),t=this.layer;if(e&&t.currentStyleInfo){var r=this.view.scale,i=t.currentStyleInfo;if(i&&i.layerDefinition){var n=i.layerDefinition;n.minScale&&n.minScale<r&&(e=!1),n.maxScale&&n.maxScale>r&&(e=!1)}}return e},x.prototype.isUpdating=function(){return!this._isTileHandlerPromiseFulfilled||this._fetchQueue.updating||this._parseQueue.updating},x.prototype.acquireTile=function(e){var t=this,r=this.container.createTile(e);return this._tileHandlerPromise.then(function(){t.notifyChange("updating"),t._fetchQueue.push(r.key).then(function(e){return t._parseQueue.push(e)}).then(function(e){r.once("attach",function(){return t.requestUpdate()}),t.container.setTileData(r,e),t.container.addChild(r),t.notifyChange("updating")}).catch(function(e){t.notifyChange("updating"),h.isAbortError(e)||m.error(e),r.destroy()})}),r},x.prototype.releaseTile=function(e){var t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this._tileHandler.abortTileUpdate(t),this.container.removeChild(e),this.requestUpdate(),this.notifyChange("updating")},x.prototype._start=function(){var r=this;if(this._stop(),this.layer.currentStyleInfo&&this.attached){var e=new AbortController,t=this._tileHandler.start({signal:e.signal}).then(function(){r._tileStrategy=new v({cachePolicy:"keep",coveragePolicy:"smallest",acquireTile:function(e){return r.acquireTile(e)},releaseTile:function(e){return r.releaseTile(e)},tileInfoView:r._tileInfoView,cacheSize:40,buffer:0}),r._fetchQueue=new g({tileInfoView:r._tileInfoView,process:function(e,t){return r._getTileData(e,t)},concurrency:15}),r._parseQueue=new g({tileInfoView:r._tileInfoView,process:function(e,t){return r._parseTileData(e,t)},concurrency:8}),r.requestUpdate(),r._isTileHandlerPromiseFulfilled=!0});this._tileHandler.spriteMosaic.then(function(e){r.container.setStyleResources(e,r._tileHandler.glyphMosaic,r.layer.styleRepository),r.requestUpdate()}),this._tileHandlerAbortController=e,this._tileHandlerPromise=t}},x.prototype._stop=function(){if(this._tileHandlerAbortController){var e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerPromiseFulfilled=!1,this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null),this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this.container.removeAllChildren()}},x.prototype._getTileData=function(r,i){return n(this,void 0,void 0,function(){var t;return l(this,function(e){switch(e.label){case 0:return[4,this._tileHandler.fetchTileData(r,i)];case 1:return t=e.sent(),this.notifyChange("updating"),[2,{key:r,data:t}]}})})},x.prototype._parseTileData=function(t,r){return n(this,void 0,void 0,function(){return l(this,function(e){return[2,this._tileHandler.parseTileData(t,this.updateParameters.state.rotation,r)]})})},x.prototype._issueStyleInvalidation=function(){var t=this;this.notifyChange("updating"),this._tileHandlerPromise=this._tileHandler.updateStyle().then(function(){t._tileHandler.spriteMosaic.then(function(e){return t.container.setStyleResources(e,t._tileHandler.glyphMosaic,t.layer.styleRepository)}),t._fetchQueue.pause(),t._parseQueue.pause(),t._fetchQueue.clear(),t._parseQueue.clear(),t._parseQueue.resume(),t._fetchQueue.resume(),t.notifyChange("updating"),t.requestUpdate()})},i([c.property({dependsOn:["view.scale","layer.currentStyleInfo"]})],x.prototype,"suspended",void 0),i([c.subclass("esri.views.2d.layers.VectorTileLayerView2D")],x);function x(){var e=null!==b&&b.apply(this,arguments)||this;return e._handles=new s,e._fetchQueue=null,e._parseQueue=null,e._isTileHandlerPromiseFulfilled=!1,e._invalidateStyle=!1,e}}.apply(null,i))||(e.exports=n)},1627:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(7),r(2)],void 0===(n=function(e,t,r,i,n,a){return o=a.declared(n.JSONSupport),i(s,o),r([a.subclass("esri.views.layers.support.ClipArea")],s);function s(){return null!==o&&o.apply(this,arguments)||this}var o}.apply(null,i))||(e.exports=n)},1635:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(13),r(54),r(206),r(121),r(3),r(119),r(2)],void 0===(n=function(e,t,r,i,n,a,s,o,l,u,h){return p=h.declared(s.HandleOwnerMixin(o.IdentifiableMixin(u.EsriPromiseMixin(a.EventedMixin(n))))),r(c,p),c.prototype.initialize=function(){var i=this;this.addResolvingPromise(this.layer),this.when().catch(function(e){if("layerview:create-error"!==e.name){var t=i.layer&&i.layer.id||"no id",r=i.layer&&i.layer.title||"no title";throw l.getLogger(i.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+r+"', id: '"+t+"')",e),e}})},c.prototype.destroy=function(){this.layer=this.parent=null},Object.defineProperty(c.prototype,"fullOpacity",{get:function(){function e(e){return null==e?1:e}return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"updating",{get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),c.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},c.prototype.isUpdating=function(){return!1},i([h.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],c.prototype,"fullOpacity",null),i([h.property()],c.prototype,"layer",void 0),i([h.property()],c.prototype,"parent",void 0),i([h.property({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended"]})],c.prototype,"suspended",null),i([h.property({type:Boolean,dependsOn:["updatingHandles.updating"],readOnly:!0})],c.prototype,"updating",null),i([h.property({dependsOn:["layer.visible"]})],c.prototype,"visible",null),i([h.subclass("esri.views.layers.LayerView")],c);function c(e){var t=p.call(this,e)||this;return t.layer=null,t.parent=null,t}var p}.apply(null,i))||(e.exports=n)},1636:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(18),r(123),r(16),r(2),r(1627),r(1637),r(1638),r(1639)],void 0===(n=function(e,t,i,n,r,a,s,o,l,u,h,c){Object.defineProperty(t,"__esModule",{value:!0});var p=r.ofType({key:"type",base:l,typeMap:{rect:u,path:c,geometry:h}});t.LayerView2D=function(e){return r=o.declared(e),i(t,r),t.prototype.initialize=function(){var t=this;function e(){return t.notifyChange("rendering")}this.when(function(){t.requestUpdate()},function(){}),this.handles.add([s.init(this,"suspended",function(e){t.container&&(t.container.visible=!e),t.view&&!e&&t.updateRequested&&t.view.requestLayerViewUpdate(t)},!0),s.init(this,["fullOpacity","container"],function(){t.container&&(t.container.opacity=t.fullOpacity)},!0),s.on(this,"container","post-render",e),s.on(this,"container","will-render",e)])},t.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach()),this.handles.remove("initialize"),this.updateRequested=!1,this.layer=null,this.view=null},Object.defineProperty(t.prototype,"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0}),t.prototype.isVisibleAtScale=function(e){var t=!0,r=this.layer,i=r.minScale,n=r.maxScale;if(null!=i&&null!=n){var a=!i,s=!n;!a&&e<=i&&(a=!0),!s&&n<=e&&(s=!0),t=a&&s}return t},t.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))},t.prototype.processUpdate=function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1},t.prototype.isUpdating=function(){return!1},t.prototype.isRendering=function(){return!1},t.prototype.canResume=function(){var e=this.inherited(arguments);return e=e&&this.isVisibleAtScale(this.view.scale)},n([o.property({type:p,set:function(e){var t=a.referenceSetter(e,this._get("clips"),p);this._set("clips",t)}})],t.prototype,"clips",void 0),n([o.property()],t.prototype,"moving",void 0),n([o.property({dependsOn:["attached","suspended","moving"]})],t.prototype,"rendering",null),n([o.property()],t.prototype,"attached",void 0),n([o.property()],t.prototype,"container",void 0),n([o.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),n([o.property({readOnly:!0})],t.prototype,"updateParameters",void 0),n([o.property()],t.prototype,"updateRequested",void 0),n([o.property({dependsOn:["updateRequested","attached","suspended"]})],t.prototype,"updating",null),n([o.property()],t.prototype,"view",void 0),n([o.subclass("esri.views.2d.layers.LayerView2D")],t);function t(){var e=null!==r&&r.apply(this,arguments)||this;return e.clips=new p,e.moving=!1,e.attached=!1,e.lastUpdateId=-1,e.updateRequested=!1,e}var r}}.apply(null,i))||(e.exports=n)},1637:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(2),r(1627)],void 0===(n=function(e,t,r,i,n,a){return o=n.declared(a),i(s,o),(l=s).prototype.clone=function(){return new l({left:this.left,right:this.right,top:this.top,bottom:this.bottom})},Object.defineProperty(s.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),r([n.property({type:[Number,String],json:{write:!0}})],s.prototype,"left",void 0),r([n.property({type:[Number,String],json:{write:!0}})],s.prototype,"right",void 0),r([n.property({type:[Number,String],json:{write:!0}})],s.prototype,"top",void 0),r([n.property({type:[Number,String],json:{write:!0}})],s.prototype,"bottom",void 0),r([n.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],s.prototype,"version",null),l=r([n.subclass("esri.views.layers.support.ClipRect")],s);function s(){var e=null!==o&&o.apply(this,arguments)||this;return e.type="rect",e.left=null,e.right=null,e.top=null,e.bottom=null,e}var o,l}.apply(null,i))||(e.exports=n)},1638:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(28),r(2),r(81),r(38),r(1627)],void 0===(n=function(e,t,r,i,n,a,s,o,l){var u,h,c={base:s,key:"type",typeMap:{extent:n.Extent,polygon:n.Polygon}};return u=a.declared(l),i(p,u),h=p,Object.defineProperty(p.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),p.prototype.clone=function(){return new h({geometry:this.geometry.clone()})},r([a.property({types:c,json:{read:o.fromJSON,write:!0}})],p.prototype,"geometry",void 0),r([a.property({readOnly:!0,dependsOn:["geometry"]})],p.prototype,"version",null),h=r([a.subclass("esri.views.layers.support.Geometry")],p);function p(){var e=null!==u&&u.apply(this,arguments)||this;return e.type="geometry",e.geometry=null,e}}.apply(null,i))||(e.exports=n)},1639:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(2),r(1627)],void 0===(n=function(e,t,r,i,n,a){return o=n.declared(a),i(s,o),Object.defineProperty(s.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),r([n.property({type:[[[Number]]],json:{write:!0}})],s.prototype,"path",void 0),r([n.property({readOnly:!0,dependsOn:["path"]})],s.prototype,"version",null),r([n.subclass("esri.views.layers.support.Path")],s);function s(){var e=null!==o&&o.apply(this,arguments)||this;return e.type="path",e.path=[],e}var o}.apply(null,i))||(e.exports=n)},1915:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(106),r(20),r(2569),r(229)],void 0===(n=function(e,t,r,i,x,w,n){Object.defineProperty(t,"__esModule",{value:!0});var a,s=(x.enums.Usage,a=n.TiledDisplayObject,r(o,a),Object.defineProperty(o.prototype,"hasSymbolBuckets",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isHoldingForFade",{get:function(){return null!==this._symbolFadeHold},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isSymbolFadeDone",{get:function(){return!this._symbolFadeHold||this._symbolFadeHold<i()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"wasRequested",{get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status},enumerable:!0,configurable:!0}),o.prototype.setData=function(e,t,r){this._vectorTileData=e,this.client=t,this.refKeys=r,this._memoryUsed=l,this.ready(),this._setData=!0},o.prototype.updateSymbolData=function(e){e&&(this._symbolUpdateData=e,this.requestRender())},o.prototype.updateTileData=function(e){this._vectorTileData=e,this.stage.requestRender(),this._memoryUsed=l},o.prototype.clearSymbolFadeHold=function(){this._symbolFadeHold=null},o.prototype.setSymbolHoldDuration=function(e){this._symbolFadeHold=i()+e},o.prototype.hasData=function(){return 0<Object.keys(this.layerData).length},o.prototype.dispose=function(){this._deleteBufferMemory(),this.destroy(),this._memoryUsed=l},o.prototype.release=function(){return 0==--this._referenced&&(this.dispose(),this.attached=!1,!(this.stage=null))},o.prototype.reference=function(){++this._referenced},Object.defineProperty(o.prototype,"referenced",{get:function(){return this._referenced},enumerable:!0,configurable:!0}),o.prototype.getMemoryUsage=function(){var r=this;return this._memoryUsed===l&&(this._memoryUsed=u.reduce(function(e,t){return r[t]?e+r[t].size:e},0),this.texture&&(this._memoryUsed+=this.texture.descriptor.width*this.texture.descriptor.height*4),this._vectorTileData&&this._vectorTileData.bufferData&&(this._memoryUsed+=this._vectorTileData.bufferData.reduce(function(e,t){return e+t.byteLength},this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength))),this._memoryUsed/(this._referenced||1)},o.prototype.commitChanges=function(){if(this._vectorTileData||this._symbolUpdateData)return this._vectorTileData?(this._deleteBufferMemory(),this._createRenderBuckets(),this._createBufferObjects(),void(this._vectorTileData=null)):void(this._symbolUpdateData&&(this._updateSymbolData(this._symbolUpdateData),this._symbolUpdateData=null))},o.prototype._deleteBufferMemory=function(){for(var e=0,t=["fillVertexArrayObject","fillDDVertexArrayObject","outlineVertexArrayObject","lineVertexArrayObject","lineDDVertexArrayObject","iconVertexArrayObject","iconDDVertexArrayObject","textVertexArrayObject","textDDVertexArrayObject","circleVertexArrayObject","fillVertexBuffer","fillDDVertexBuffer","fillIndexBuffer","outlineVertexBuffer","outlineDDVertexBuffer","outlineIndexBuffer","lineVertexBuffer","lineDDVertexBuffer","lineIndexBuffer","iconVertexBuffer","iconDDVertexBuffer","iconIndexBuffer","textVertexBuffer","textDDVertexBuffer","textIndexBuffer","circleVertexBuffer","circleIndexBuffer","texture"];e<t.length;e++){var r=t[e];this[r]&&(this[r].dispose(),this[r]=null)}this.layerData={},this.triangleCount=0},o.prototype._createRenderBuckets=function(){for(var e=new Uint32Array(this._vectorTileData.bucketDataInfo),t=e.length,r=0;r<t;){var i=e[r];switch(e[r+1]){case 0:(new w.BackgroundRenderBucket).layerID=i,r+=2;break;case 1:var n=new w.FillRenderBucket;n.layerID=i,n.triangleElementStart=e[r+2],n.triangleElementCount=e[r+3],n.outlineElementStart=e[r+4],n.outlineElementCount=e[r+5],0===n.triangleElementCount&&0===n.outlineElementCount||(this.layerData[i]=n),r+=6;break;case 2:var a=new w.LineRenderBucket;a.layerID=i,a.triangleElementStart=e[r+2],a.triangleElementCount=e[r+3],0<a.triangleElementCount&&(this.layerData[i]=a),r+=4;break;case 3:var s=new w.SymbolRenderBucket;s.layerID=i,s.isSDF=0!==e[r+2];var o=r+3,l=e[o];o++;for(var u=0;u<l;u++){var h=e[o],c=e[o+1],p=e[o+2];s.iconPerPageElementsMap.set(h,[c,p]),o+=3}var d=o,f=e[d];for(d++,u=0;u<f;u++)h=e[d],c=e[d+1],p=e[d+2],s.glyphPerPageElementsMap.set(h,[c,p]),d+=3;(0<s.iconPerPageElementsMap.size||0<s.glyphPerPageElementsMap.size)&&(this.layerData[i]=s),r+=5+3*l+3*f;break;case 4:var y=new w.CircleRenderBucket;y.layerID=i,y.triangleElementStart=e[r+2],y.triangleElementCount=e[r+3],0<y.triangleElementCount&&(this.layerData[i]=y),r+=4;break;default:console.error("Bad bucket type!"),r+=2}}},o.prototype.attach=function(){return this._setData},o.prototype.attachWithContext=function(e){this.stage={context:e},this.attached=this.attach()},o.prototype.detach=function(){this.isReady&&this.client&&this.client.invoke("destructTileData",this.id),this.dispose(),a.prototype.detach.call(this)},o.prototype._updateSymbolData=function(e){if(!e||!e.bucketDataInfo)return!0;var t=new Uint32Array(e.bucketDataInfo),r=t.length;if(0===r)return!0;if(!this.isReady)return this.requestRender(),!1;for(var i=this.stage.context,n=new Uint32Array(e.bufferDataInfo),a=n.length,s=0,o=0;o<a;o+=2,s++)switch(n[o]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null),this.iconVertexBuffer=x.BufferObject.createVertex(i,35044,e.bufferData[s]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null),this.iconDDVertexBuffer=x.BufferObject.createVertex(i,35044,e.bufferData[s]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null),this.iconIndexBuffer=x.BufferObject.createIndex(i,35044,e.bufferData[s]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null),this.textVertexBuffer=x.BufferObject.createVertex(i,35044,e.bufferData[s]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null),this.textDDVertexBuffer=x.BufferObject.createVertex(i,35044,e.bufferData[s]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=x.BufferObject.createIndex(i,35044,e.bufferData[s])}var l={};for(var u in this.layerData)3!==this.layerData[u].type&&(l[u]=this.layerData[u]);this.layerData=l;for(var h,c=this.styleLayers.layers,p=0;p<r;){u=t[p],(h=new w.SymbolRenderBucket).layerID=u,h.isSDF=0!==t[p+2],c.length>h.layerID&&c[h.layerID].type===h.type&&(l[h.layerID]=h);var d=p+3,f=t[d];d++;for(var y=0;y<f;y++){var g=t[d],v=t[d+1],_=t[d+2];h.iconPerPageElementsMap.set(g,[v,_]),d+=3}var b=d,m=t[b];for(b++,y=0;y<m;y++)g=t[b],v=t[b+1],_=t[b+2],h.glyphPerPageElementsMap.set(g,[v,_]),b+=3;p+=5+3*f+3*m}return this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null),this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null),this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null),this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null),!0},o._createBufferToObject=function(){var e=[];return e[1]={create:x.BufferObject.createVertex,var:"fillVertexBuffer"},e[2]={create:x.BufferObject.createVertex,var:"fillDDVertexBuffer"},e[3]={create:x.BufferObject.createIndex,var:"fillIndexBuffer"},e[4]={create:x.BufferObject.createVertex,var:"outlineVertexBuffer"},e[5]={create:x.BufferObject.createVertex,var:"outlineDDVertexBuffer"},e[6]={create:x.BufferObject.createIndex,var:"outlineIndexBuffer"},e[7]={create:x.BufferObject.createVertex,var:"lineVertexBuffer"},e[8]={create:x.BufferObject.createVertex,var:"lineDDVertexBuffer"},e[9]={create:x.BufferObject.createIndex,var:"lineIndexBuffer"},e[10]={create:x.BufferObject.createVertex,var:"iconVertexBuffer"},e[11]={create:x.BufferObject.createVertex,var:"iconDDVertexBuffer"},e[12]={create:x.BufferObject.createIndex,var:"iconIndexBuffer"},e[13]={create:x.BufferObject.createVertex,var:"textVertexBuffer"},e[14]={create:x.BufferObject.createVertex,var:"textDDVertexBuffer"},e[15]={create:x.BufferObject.createIndex,var:"textIndexBuffer"},e[16]={create:x.BufferObject.createVertex,var:"circleVertexBuffer"},e[17]={create:x.BufferObject.createIndex,var:"circleIndexBuffer"},e},o.prototype._createBufferObjects=function(){for(var e=this.stage.context,t=new Uint32Array(this._vectorTileData.bufferDataInfo),r=t.length,i=0;i<r;i+=2){var n=i/2;if(!(t[i+1]<=0||0===this._vectorTileData.bufferData[n].byteLength)){var a=t[i],s=o.bufferToObject[a];s?this[s.var]?this[s.var].setData(this._vectorTileData.bufferData[n]):this[s.var]=s.create(e,35044,this._vectorTileData.bufferData[n]):console.error("Bad buffer type "+a)}}},o.bufferToObject=o._createBufferToObject(),o);function o(e,t,r,i){var n=a.call(this,e,r,i,[4096,4096])||this;return n._referenced=0,n._symbolFadeHold=null,n._vectorTileData=null,n._setData=!1,n._symbolUpdateData=null,n._memoryUsed=l,n.rotation=0,n.layerData={},n.status="loading",n._referenced=1,n.styleLayers=t,n.id=e.id,n}t.VectorTile=s;var l=-1,u=["fillVertexBuffer","fillDDVertexBuffer","fillIndexBuffer","outlineVertexBuffer","outlineDDVertexBuffer","outlineIndexBuffer","lineVertexBuffer","lineDDVertexBuffer","lineIndexBuffer","iconVertexBuffer","iconDDVertexBuffer","iconIndexBuffer","textVertexBuffer","textDDVertexBuffer","textIndexBuffer","circleVertexBuffer","circleIndexBuffer"]}.apply(null,i))||(e.exports=n)},1916:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(108)],void 0===(n=function(e,t,s){return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),r.prototype.allocate=function(e,t){if(e>this._width||t>this._height)return new s.default;for(var r=null,i=-1,n=0;n<this._free.length;++n){var a=this._free[n];e<=a.width&&t<=a.height&&(null===r||a.y<=r.y&&a.x<=r.x)&&(r=a,i=n)}return null===r?new s.default:(this._free.splice(i,1),r.width<r.height?(r.width>e&&this._free.push(new s.default(r.x+e,r.y,r.width-e,t)),r.height>t&&this._free.push(new s.default(r.x,r.y+t,r.width,r.height-t))):(r.width>e&&this._free.push(new s.default(r.x+e,r.y,r.width-e,r.height)),r.height>t&&this._free.push(new s.default(r.x,r.y+t,e,r.height-t))),new s.default(r.x,r.y,e,t))},r.prototype.release=function(e){for(var t=0;t<this._free.length;++t){var r=this._free[t];if(r.y===e.y&&r.height===e.height&&r.x+r.width===e.x)r.width+=e.width;else if(r.x===e.x&&r.width===e.width&&r.y+r.height===e.y)r.height+=e.height;else if(e.y===r.y&&e.height===r.height&&e.x+e.width===r.x)r.x=e.x,r.width+=e.width;else{if(e.x!==r.x||e.width!==r.width||e.y+e.height!==r.y)continue;r.y=e.y,r.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)},r;function r(e,t){this._width=0,this._height=0,this._free=[],this._width=e,this._height=t,this._free.push(new s.default(0,0,e,t))}}.apply(null,i))||(e.exports=n)},2568:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(9),r(10),r(29),r(14),r(516),r(12),r(325),r(4),r(304),r(208),r(80),r(1915),r(312),r(2570),r(2571),r(2572),r(544),r(102),r.dj.m(e)],void 0===(n=function(l,e,p,d,n,u,f,t,c,y,g,h,v,_,b,m,x,w,D,a,T,P){Object.defineProperty(e,"__esModule",{value:!0});var s=new t(10),o=new Map,r=(i.prototype.destroy=function(){this._updateToAbortController&&this._updateToAbortController.forEach(function(e){return e.abort()}),this._ongoingTileRequests&&this.abortAll(),this._connection&&(this._connection.close(),this._connection=null),this._vectorTileLayer=null,this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null)},Object.defineProperty(i.prototype,"spriteMosaic",{get:function(){var e=this;return this._spriteSourcePromise.then(function(){return e._spriteMosaic})},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"glyphMosaic",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0}),i.prototype.start=function(o){return n(this,void 0,void 0,function(){var t,r,i,n,a,s=this;return d(this,function(e){for(i in t=this._vectorTileLayer.sourceNameToSource,r=[],t)r.push(this._fetchTileMap(t[i],o));return this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,o),this._spriteSourcePromise.then(function(e){s._spriteMosaic=new D(1024,1024,250),s._spriteMosaic.setSpriteSource(e),f("stable-symbol-rendering")&&s._spriteMosaic.preloadSpriteItems()}),n=this._vectorTileLayer.styleRepository,a=new w(n.glyphs),this._glyphMosaic=new x(1024,1024,a),this._broadcastPromise=v.open(h.getAbsMid("../vectorTiles/WorkerTileHandler",l,P),{client:this,scheduler:o.scheduler,signal:o.signal}).then(function(e){return s._connection=e,g.all(s._connection.broadcast("setLayers",n.styleJSON,p({},o)))}),[2,g.all(r)]})})},i.prototype.updateStyle=function(){return n(this,void 0,void 0,function(){var r,i=this;return d(this,function(e){switch(e.label){case 0:return[4,this._broadcastPromise];case 1:return e.sent(),this._updateToAbortController.forEach(function(e){return e.abort()}),this._updateToAbortController.clear(),r=this._vectorTileLayer.styleRepository,this._broadcastPromise=g.create(function(e,t){g.all(i._connection.broadcast("updateStyle",r.styleJSON)).then(e,t)}),[2,this._broadcastPromise]}})})},i.prototype.abortTileUpdate=function(e){this._updateToAbortController.has(e)&&(this._updateToAbortController.get(e).abort(),this._updateToAbortController.delete(e))},i.prototype.updateTile=function(s,o){return n(this,void 0,void 0,function(){var t,r,i,n,a=this;return d(this,function(e){switch(e.label){case 0:return this.allowUpdates&&s.isReady?[4,this._broadcastPromise]:[2];case 1:return e.sent(),t=Math.round(m.degToByte(o.state.rotation)),s.rotation===t?[2,null]:(i=s.key,this._updateToAbortController.has(i.id)&&((r=this._updateToAbortController.get(i.id)).abort(),this._updateToAbortController.delete(i.id)),r=g.createAbortController(),s.rotation=t,n=s.client.invoke("updateSymbols",{key:s.id,rotation:t},{signal:r.signal}).then(function(e){a._updateToAbortController.delete(i.id),s.isReady&&s.updateSymbolData(e)}).catch(function(e){g.isAbortError(e)||a._updateToAbortController.delete(i.id)}),this._updateToAbortController.set(s.id,r),[2,n])}})})},i.prototype.updateTileData=function(e){for(var t,r=e.tileId,i=this._container.children,n=0;n<i.length;n++)if((t=i[n]).id===r){t.updateTileData(e.tileData);break}},i.prototype.getVectorTile=function(l,u,h){return n(this,void 0,void 0,function(){var t,r,i,n,a,s,o;return d(this,function(e){switch(e.label){case 0:return t=new T(l,u,h,0),c.isSome(this._memCache)&&(r=this._memCache.get(t.id))?(r.reference(),[2,r]):[4,this._getVectorTileData(t,null)];case 1:return i=e.sent(),c.isSome(this._memCache)&&(n=this._memCache.get(t.id))?(n.reference(),[2,n]):(a=this._vectorTileLayer.tileInfo,s=a.getTileBounds(_.create(),t),o=new b.VectorTile(t,this._vectorTileLayer.styleRepository,s,[512,512]),i&&i.tileData?(o.setData(i.tileData,i.client),c.isSome(this._memCache)&&(o.reference(),this._memCache.put(o.key.id,o,o.getMemoryUsage()*o.referenced,y.MIN_PRIORITY))):o.setData(null,null),[2,o])}})})},i.prototype.releaseVectorTile=function(e){c.isNone(this._memCache)||e.release()||this._memCache.updateSize(e.key.id,e,e.getMemoryUsage()*e.referenced)},i.prototype.fetchTileData=function(a,s){return n(this,void 0,void 0,function(){var t,r,i,n;return d(this,function(e){switch(e.label){case 0:return[4,this._getRefKeys(a,s)];case 1:for(n in t=e.sent(),r=this._vectorTileLayer.sourceNameToSource,i=[],r)i.push(n);return[2,this._getSourcesData(i,t,s)]}})})},i.prototype.parseTileData=function(u,h,c){return n(this,void 0,void 0,function(){var t,r,i,n,a,s,o,l;return d(this,function(e){switch(e.label){case 0:return(t=u&&u.data)?(r=t.sourceName2DataAndRefKey,i=t.transferList,0===Object.keys(r).length?[2,null]:[4,this._broadcastPromise]):[2,null];case 1:return e.sent(),n=Math.round(m.degToByte(h)),[4,(a=this._connection.getAvailableClient()).invoke("createTileAndParse",{key:u.key.id,rotation:n,cacheTile:this.allowUpdates,sourceName2DataAndRefKey:r},p({},c,{transferList:i})).catch(function(){return a.invoke("destructTileData",u.key.id),null})];case 2:if(s=e.sent(),f("esri-vector-tiles-debug")){for(l in o={},r)o[l]=r[l].refKey;return[2,{tileData:s,client:a,refKeys:o}]}return[2,{tileData:s,client:a}]}})})},Object.defineProperty(i.prototype,"updating",{get:function(){return 0<this._ongoingTileRequests.size},enumerable:!0,configurable:!0}),i.prototype.abortAll=function(){this._ongoingRequestToController.forEach(function(e){return e.abort()}),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()},i.prototype.getSprites=function(t){return n(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,this._spriteSourcePromise];case 1:return e.sent(),[2,this._spriteMosaic.getSpriteItems(t)]}})})},i.prototype.getGlyphs=function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)},i.prototype.getStyleRepository=function(){return this._vectorTileLayer.styleRepository},i.prototype._getTilePayload=function(a,s,o){return n(this,void 0,void 0,function(){var t,r,i,n;return d(this,function(e){switch(e.label){case 0:return t=T.pool.acquire(a.id),r=this._vectorTileLayer.sourceNameToSource,i=r[s],n=i.getSourceTileUrl(t.level,t.row,t.col),T.pool.release(t),[4,u(n,p({responseType:"array-buffer"},o))];case 1:return[2,{protobuff:e.sent().data,sourceName:s}]}})})},i.prototype._fetchTileMap=function(t,e){if(t.capabilities.operations.supportsTileMap&&t.tileIndex)return g.resolve();if(!t.tileMapURL)return g.resolve();var r=s.get(t.tileMapURL);if(r)return t.tileIndex=r,g.resolve();if(o.has(t.tileMapURL))return o.get(t.tileMapURL).then(function(e){t.tileIndex=new a(e.data)});var i=u(t.tileMapURL,e);return i.then(function(e){t.tileIndex=new a(e.data),o.delete(t.tileMapURL),s.put(t.tileMapURL,t.tileIndex)}),o.set(t.tileMapURL,i),i},i.prototype._getRefKeys=function(s,o){return n(this,void 0,void 0,function(){var t,r,i,n,a;return d(this,function(e){for(i in t=this._vectorTileLayer.sourceNameToSource,r=new Array,t)n=t[i],a=n.getRefKey(s,o),r.push(a);return[2,g.eachAlways(r)]})})},i.prototype._getSourcesData=function(l,u,h){return n(this,void 0,void 0,function(){var t,r,i,n,a,s,o;return d(this,function(e){switch(e.label){case 0:for(t=[],s=0;s<u.length;s++)null==u[s].value||null==l[s]?t.push(null):(r=this._getTilePayload(u[s].value,l[s],h),t.push(r));return[4,g.eachAlways(t)];case 1:for(i=e.sent(),n={},a=[],s=0;s<i.length;s++)i[s].value&&i[s].value&&i[s].value.protobuff&&0<i[s].value.protobuff.byteLength&&(o=u[s].value.id,n[i[s].value.sourceName]={refKey:o,protobuff:i[s].value.protobuff},a.push(i[s].value.protobuff));return[2,{sourceName2DataAndRefKey:n,transferList:a}]}})})},i.prototype._getVectorTileData=function(o,l){return n(this,void 0,void 0,function(){var t,r,i,n,a,s=this;return d(this,function(e){return t=o.id,this._ongoingTileRequests.has(t)?[2,this._ongoingTileRequests.get(t)]:(r=new AbortController,i={signal:r.signal},n=l&&l.signal,a=this._getParsedVectorTileData(o,i).then(function(e){return s._ongoingTileRequests.delete(t),s._ongoingRequestToController.delete(t),e}).catch(function(){return s._ongoingTileRequests.delete(t),s._ongoingRequestToController.delete(t),null}),this._ongoingTileRequests.set(t,a),this._ongoingRequestToController.set(t,r),n&&g.onAbort(n,function(){r.abort(),s._ongoingTileRequests.delete(t),s._ongoingRequestToController.delete(t)}),[2,a])})})},i.prototype._getParsedVectorTileData=function(r,i){return n(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,this.fetchTileData(r,i)];case 1:return t=e.sent(),[2,this.parseTileData({key:r,data:t},0,i)]}})})},i);function i(e,t,r,i,n){this._vectorTileLayer=e,this.devicePixelRatio=t,this.allowUpdates=r,this._container=i,this._memCache=n,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._updateToAbortController=new Map,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map}e.TileHandler=r}.apply(null,i))||(e.exports=n)},2569:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});function i(e){this.type=e}t.RenderBucket=i;var n,a=(r(s,n=i),s.prototype.hasData=function(){return 0<this.triangleElementCount},s.prototype.triangleCount=function(){return this.triangleElementCount/3},s);function s(){var e=n.call(this,2)||this;return e.triangleElementStart=0,e.triangleElementCount=0,e}t.LineRenderBucket=a;var o,l=(r(u,o=i),u.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount},u.prototype.triangleCount=function(){return(this.triangleElementCount+this.outlineElementCount)/3},u);function u(){var e=o.call(this,1)||this;return e.triangleElementStart=0,e.triangleElementCount=0,e.outlineElementStart=0,e.outlineElementCount=0,e}t.FillRenderBucket=l;var h,c=(r(p,h=i),p.prototype.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size},p.prototype.triangleCount=function(){var t=0;return this.iconPerPageElementsMap.forEach(function(e){t+=e[1]}),this.glyphPerPageElementsMap.forEach(function(e){t+=e[1]}),t/3},p);function p(){var e=h.call(this,3)||this;return e.iconPerPageElementsMap=new Map,e.glyphPerPageElementsMap=new Map,e.isSDF=!1,e}t.SymbolRenderBucket=c;var d,f=(r(y,d=i),y.prototype.hasData=function(){return 0<this.triangleElementCount},y.prototype.triangleCount=function(){return this.triangleElementCount/3},y);function y(){var e=d.call(this,4)||this;return e.triangleElementStart=0,e.triangleElementCount=0,e}t.CircleRenderBucket=f;var g,v=(r(_,g=i),_.prototype.hasData=function(){return!0},_.prototype.triangleCount=function(){return 2},_);function _(){return g.call(this,0)||this}t.BackgroundRenderBucket=v}.apply(null,i))||(e.exports=n)},2570:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(14),r(4),r(20),r(1916),r(108)],void 0===(n=function(e,t,O,a,s,M,k){var j;return s.enums.PixelFormat,s.enums.PixelType,r.prototype.getGlyphItems=function(B,R){for(var S=this,I=[],V=this._glyphSource,C=new Set,e=0,t=R;e<t.length;e++){var r=t[e],i=Math.floor(r*(1/256));C.add(i)}var n=[];return C.forEach(function(e){if(e<=256){var t=B+e;if(S._rangePromises.has(t))n.push(S._rangePromises.get(t));else{var r=V.getRange(B,e).then(function(){S._rangePromises.delete(t)},function(){S._rangePromises.delete(t)});S._rangePromises.set(t,r),n.push(r)}}}),a.all(n).then(function(){var e,t=S._glyphIndex[B];if(t||(t={},S._glyphIndex[B]=t),O("stable-symbol-rendering")){j.clear();for(var r=0,i=R;r<i.length;r++){var n=i[r];j.add(n)}var a=[];C.forEach(function(e){a.push(e)}),a.sort(),e=[];for(var s=0,o=a;s<o.length;s++)for(var l=o[s],u=0;u<256;++u)e.push(256*l+u)}else e=R;for(var h=0,c=e;h<c.length;h++){var p=t[n=c[h]];if(p)O("stable-symbol-rendering")&&!j.has(n)||(I[n]={sdf:!0,rect:p.rect,metrics:p.metrics,page:p.page});else{var d=V.getGlyph(B,n);if(d&&d.metrics){var f=d.metrics,y=void 0;if(0===f.width)y=new k.default(0,0,0,0);else{var g=f.width+6,v=f.height+6,_=g%4?4-g%4:4,b=v%4?4-v%4:4;1===_&&(_=5),1===b&&(b=5),(y=S._binPack.allocate(g+_,v+b)).isEmpty&&(S._dirties[S._currentPage]||(S._glyphData[S._currentPage]=null),S._currentPage=S._glyphData.length,S._glyphData.push(new Uint8Array(S.width*S.height)),S._dirties.push(!0),S._textures.push(void 0),S._binPack=new M(S.width-4,S.height-4),y=S._binPack.allocate(g+_,v+b));var m=S._glyphData[S._currentPage],x=d.bitmap,w=void 0,D=void 0;if(x)for(var T=0;T<v;T++){w=g*T,D=S.width*(y.y+T+1)+y.x;for(var P=0;P<g;P++)m[D+P+1]=x[w+P]}}t[n]={rect:y,metrics:f,tileIDs:null,page:S._currentPage},O("stable-symbol-rendering")&&!j.has(n)||(I[n]={sdf:!0,rect:y,metrics:f,page:S._currentPage}),S._dirties[S._currentPage]=!0}}}return I})},r.prototype.removeGlyphs=function(e){for(var t in this._glyphIndex){var r=this._glyphIndex[t];if(r){var i=void 0;for(var n in r)if((i=r[n]).tileIDs.delete(e),0===i.tileIDs.size){for(var a=this._glyphData[i.page],s=i.rect,o=void 0,l=void 0,u=0;u<s.height;u++)for(o=this.width*(s.y+u)+s.x,l=0;l<s.width;l++)a[o+l]=0;delete r[n],this._dirties[i.page]=!0}}}},r.prototype.bind=function(e,t,r,i){void 0===i&&(i=0),this._textures[r]||(this._textures[r]=new s.Texture(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var n=this._textures[r];n.setSamplingMode(t),this._dirties[r]&&n.setData(this._glyphData[r]),e.bindTexture(n,i),this._dirties[r]=!1},r.prototype.dispose=function(){this._binPack=null;for(var e=0,t=this._textures;e<t.length;e++){var r=t[e];r&&r.dispose()}this._textures.length=0},r;function r(e,t,r){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,!j&&O("stable-symbol-rendering")&&(j=new Set),this.width=e,this.height=t,this._glyphSource=r,this._binPack=new M(e-4,t-4),this._glyphData.push(new Uint8Array(e*t)),this._dirties.push(!0),this._textures.push(void 0)}}.apply(null,i))||(e.exports=n)},2571:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(29),r(14),r(489),r(4)],void 0===(n=function(e,t,s,o,l,u){var h=(n.prototype.getMetrics=function(e){return this._metrics[e]},n.prototype.getBitmap=function(e){return this._bitmaps[e]},n),r=(i.prototype.getRange=function(e){return this._ranges[e]},i.prototype.addRange=function(e,t){this._ranges[e]=t},i);function i(){this._ranges=[]}function n(e){if(this._metrics=[],this._bitmaps=[],e)for(;e.next();)switch(e.tag()){case 1:for(var t=e.getMessage();t.next();)switch(t.tag()){case 3:for(var r=t.getMessage(),i=void 0,n=void 0,a=void 0,s=void 0,o=void 0,l=void 0,u=void 0;r.next();)switch(r.tag()){case 1:i=r.getUInt32();break;case 2:n=r.getBytes();break;case 3:a=r.getUInt32();break;case 4:s=r.getUInt32();break;case 5:o=r.getSInt32();break;case 6:l=r.getSInt32();break;case 7:u=r.getUInt32();break;default:r.skip()}r.release(),i&&(this._metrics[i]={width:a,height:s,left:o,top:l,advance:u},this._bitmaps[i]=n);break;default:t.skip()}t.release();break;default:e.skip()}}return a.prototype.getRange=function(e,t){var r=this._getFontStack(e);if(o("stable-symbol-rendering")&&0<t)return r.addRange(t,new h),u.resolve();if(r.getRange(t))return u.resolve();var i=256*t,n=255+i,a=this._baseURL.replace("{fontstack}",e).replace("{range}",i+"-"+n);return s(a,{responseType:"array-buffer"}).then(function(e){r.addRange(t,new h(new l(new Uint8Array(e.data),new DataView(e.data))))}).catch(function(){r.addRange(t,new h)})},a.prototype.getGlyph=function(e,t){var r=this._getFontStack(e);if(r){var i=Math.floor(t/256);if(!(256<i)){var n=r.getRange(i);if(n)return{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}}}},a.prototype._getFontStack=function(e){var t=this._glyphInfo[e];return t=t||(this._glyphInfo[e]=new r)},a;function a(e){this._glyphInfo={},this._baseURL=e}}.apply(null,i))||(e.exports=n)},2572:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(20),r(1916),r(108)],void 0===(n=function(e,t,a,o,l){return a.enums.PixelFormat,a.enums.PixelType,u.prototype.getWidth=function(e){return e>=this._size.length?-1:this._size[e][0]},u.prototype.getHeight=function(e){return e>=this._size.length?-1:this._size[e][1]},u.prototype.setSpriteSource=function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new o(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),r=Math.floor(this._pageHeight),i=new Uint32Array(t*r);this._mosaicsData[0]=i,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e},u.prototype.getSpriteItem=function(e,t){void 0===t&&(t=!1);var r=this._mosaicRects[e];if(r)return r;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;var i=this._sprites.getSpriteInfo(e);if(!i||!i.width||!i.height||i.width<0||i.height<0)return null;var n=i.width,a=i.height,s=this._allocateImage(n,a),o=s[0],l=s[1],u=s[2];return o.width<=0?null:(this._copy(o,i,l,u,t),r={rect:o,width:n,height:a,sdf:i.sdf,simplePattern:!1,pixelRatio:i.pixelRatio,page:l},this._mosaicRects[e]=r)},u.prototype.preloadSpriteItems=function(){for(var e=0,t=this._sprites.spriteNames;e<t.length;e++){var r=t[e];this.getSpriteItem(r,!0)}},u.prototype.getSpriteItems=function(e){for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];t[n]=this.getSpriteItem(n)}return t},u.prototype.getMosaicItemPosition=function(e,t){var r=this.getSpriteItem(e,t),i=r&&r.rect;if(!i)return null;i.width=r.width,i.height=r.height;var n=r.width,a=r.height;return{size:[r.width,r.height],tl:[(i.x+2)/this._size[r.page][0],(i.y+2)/this._size[r.page][1]],br:[(i.x+2+n)/this._size[r.page][0],(i.y+2+a)/this._size[r.page][1]],page:r.page}},u.prototype.bind=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0),this._textures[r]||(this._textures[r]=new a.Texture(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[r][0],height:this._size[r][1]},new Uint8Array(this._mosaicsData[r].buffer)));var n=this._textures[r];n.setSamplingMode(t),this._dirties[r]&&n.setData(new Uint8Array(this._mosaicsData[r].buffer)),e.bindTexture(n,i),this._dirties[r]=!1},u._copyBits=function(e,t,r,i,n,a,s,o,l,u,h){var c=i*t+r,p=o*a+s;if(h){p-=a;for(var d=-1;d<=u;c=((++d+u)%u+i)*t+r,p+=a)for(var f=-1;f<=l;f++)n[p+f]=e[c+(f+l)%l]}else for(d=0;d<u;d++){for(f=0;f<l;f++)n[p+f]=e[c+f];c+=t,p+=a}},u.prototype._copy=function(e,t,r,i,n,a){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(r>=this._mosaicsData.length)){var s=new Uint32Array(a?a.buffer:this._sprites.image.buffer),o=this._mosaicsData[r];o&&s||console.error("Source or target images are uninitialized!");var l=a?t.width:this._sprites.width;u._copyBits(s,l,t.x,t.y,o,i[0],e.x+2,e.y+2,t.width,t.height,n),this._dirties[r]=!0}},u.prototype._allocateImage=function(e,t){e+=2,t+=2;var r=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<r){var i=new l.default(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[i,this._mosaicsData.length-1,[e,t]]}var n=e%4?4-e%4:4,a=t%4?4-t%4:4;1===n&&(n=5),1===a&&(a=5);var s=this._binPack.allocate(e+n,t+a);return s.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new o(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[s,this._currentPage,[this._pageWidth,this._pageHeight]]},u.prototype.dispose=function(){this._binPack=null,this._mosaicRects={};for(var e=0,t=this._textures;e<t.length;e++){var r=t[e];r&&r.dispose()}this._textures.length=0},u;function u(e,t,r){void 0===r&&(r=0),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(e<=0||t<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=t,0<r&&(this._maxItemSize=r),this._binPack=new o(e-4,t-4)}}.apply(null,i))||(e.exports=n)},2573:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(5),r(9),r(10),r(63),r(12),r(4),r(80),r(20),r(90),r(1915),r(2574),r(26),r(27),r(229),r(322),r(102)],void 0===(n=function(e,t,r,i,a,s,u,I,o,V,n,l,h,c,p,d,C,O,M){Object.defineProperty(t,"__esModule",{value:!0});var f,y=(n.enums.BlendFactor,n.enums.CompareFunction,n.enums.StencilOperation,f=l.TileContainer,r(g,f),g.prototype.destroy=function(){this.removeAllChildren(),this.children.forEach(function(e){return e.destroy()})},g.prototype.dispose=function(){this._spriteMosaic&&this._spriteMosaic.dispose(),this._glyphMosaic&&this._glyphMosaic.dispose(),f.prototype.dispose.call(this)},g.prototype.setStyleResources=function(e,t,r){this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=r},g.prototype.hitTest=function(i,n){return s(this,void 0,void 0,function(){var t,r;return a(this,function(e){return t=[i,n],r=o.createResolver(),this._pointToCallbacks.set(t,r),this.requestRender(),[2,r.promise]})})},g.prototype.setTileData=function(e,t){var r=this.stage;return r.dataUploadCounter<p.MAX_GPU_UPLOADS_PER_FRAME&&t?(e.setData(t.tileData,t.client,t.refKeys),void r.dataUploadCounter++):t?void this._parsedDataQueue.set(e,t):void e.setData(null,null)},g.prototype.createRenderParams=function(e){return i({},f.prototype.createRenderParams.call(this,e),{renderPass:null,styleLayer:null,styleLayerId:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,fadeRecorder:this._fadeRecorder,hasClipping:!!this._clippingInfos})},g.prototype.doRender=function(e){!this.visible||e.drawPhase!==d.WGLDrawPhase.MAP&&e.drawPhase!==d.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||f.prototype.doRender.call(this,e)},g.prototype.createTile=function(e){var t=this._tileInfoView.getTileBounds(V.create(),e),r=new h.VectorTile(e,this._styleRepository,t,[512,512]);return r.rotation=this.stage.state.rotation,r},g.prototype.destroyTile=function(e){e.destroy()},g.prototype.removeChild=function(e){return this._parsedDataQueue.has(e)&&this._parsedDataQueue.delete(e),f.prototype.removeChild.call(this,e)},g.prototype.renderChildren=function(e){if(e.drawPhase!==d.WGLDrawPhase.DEBUG){var t=this.stage;if(0<this._parsedDataQueue.size&&t.dataUploadCounter<p.MAX_GPU_UPLOADS_PER_FRAME)for(var r=u.pairsOfMap(this._parsedDataQueue),i=0;i<r.length&&t.dataUploadCounter<p.MAX_GPU_UPLOADS_PER_FRAME;i++){var n=r[i][0],a=r[i][1];n.setData(a.tileData,a.client,a.refKeys),this._parsedDataQueue.delete(n),t.dataUploadCounter++}if(this._fadeRecorder.recordLevel(e.displayLevel),this._doRender(e),(0<this._parsedDataQueue.size||this._fadeRecorder.needsRedraw())&&this.requestRender(),0<this._pointToCallbacks.size){var s=e.context,o=s.getBoundFramebufferObject();e.drawPhase=d.WGLDrawPhase.HITTEST;var l=e.painter.effects.hittest;l.bind(e),this._doRender(e),l.draw(e,this._pointToCallbacks,6),s.bindFramebuffer(o)}}else f.prototype.renderChildren.call(this,e)},g.prototype.removeAllChildren=function(){this._parsedDataQueue.clear();for(var e=0;e<this.children.length;e++)this.children[e].dispose();f.prototype.removeAllChildren.call(this)},g.prototype._doRender=function(e){var t=e.context,r=this._styleRepository,i=r.layers;0<r.backgroundBucketIds.length&&(e.renderPass="background",this._renderBackgroundLayers(e,r.backgroundBucketIds)),f.prototype.renderChildren.call(this,e);for(var n=this.children.filter(function(e){return e.visible}),a=0,s=n;a<s.length;a++){var o=s[a];o.triangleCount=0,o.commitChanges()}t.setStencilWriteMask(0),t.setColorMask(!0,!0,!0,!0),t.setStencilOp(7680,7680,7681),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setDepthTestEnabled(!0),t.setDepthWriteEnabled(!0),t.setDepthFunction(515),t.setClearDepth(1),t.clear(t.gl.DEPTH_BUFFER_BIT),e.renderPass="opaque";for(var l=i.length-1;0<=l;l--)this._renderStyleLayer(l,e,n);for(t.setDepthWriteEnabled(!1),t.setBlendingEnabled(!0),t.setBlendFunctionSeparate(1,771,1,771),e.renderPass="translucent",l=0;l<i.length;l++)this._renderStyleLayer(l,e,n);for(t.setDepthTestEnabled(!1),e.renderPass="symbol",l=0;l<i.length;l++)this._renderStyleLayer(l,e,n);t.bindVAO(),t.setStencilTestEnabled(!0)},g.prototype._renderStyleLayer=function(e,t,r){var i=t.painter,n=t.renderPass,a=this._styleRepository.layers[e];if(void 0!==a){var s;switch(a.type){case 0:return;case 1:if("opaque"!==n&&"translucent"!==t.renderPass)return;s="vtlFill";break;case 2:if("translucent"!==n)return;s="vtlLine";break;case 4:if("symbol"!==n)return;s="vtlCircle";break;case 3:if("symbol"!==n)return;s="vtlSymbol"}var o=t.displayLevel;if(!(0===r.length||void 0!==a.minzoom&&a.minzoom>=o+1e-6||void 0!==a.maxzoom&&a.maxzoom<o-1e-6)){t.styleLayerId=e,t.styleLayer=a;for(var l=0,u=r;l<u.length;l++)if(u[l].layerData[e]){i.renderObjects(t,r,s);break}}}},g.prototype._renderBackgroundLayers=function(e,t){var r=this._tileInfoView.getTileCoverage(e.state,0,"smallest"),i=r.spans,n=r.lodInfo,a=n.level,s=this._styleRepository,o=e.context,l=e.displayLevel,u=e.painter,h=e.state,c=V.create(),p=[];if(this._renderPasses){var d=this._renderPasses[0];I.isSome(this._clippingInfos)&&(d.brushes[0].prepareState(e,this._clippingInfos[0]),d.brushes[0].drawMany(e,this._clippingInfos))}for(var f,y=this._backgroundTiles,g=0,v=0,_=i;v<_.length;v++)for(var b=_[v],m=b.row,x=b.colFrom,w=b.colTo,D=x;D<=w;D++){if(g<y.length)(f=y[g]).key.set(a,m,n.normalizeCol(D),n.getWorldForColumn(D)),this._tileInfoView.getTileBounds(c,f.key,!1),f.bounds=c,f.coords[0]=c[0],f.coords[1]=c[3];else{var T=new M(a,m,n.normalizeCol(D),n.getWorldForColumn(D));f=new C.TiledDisplayObject(T,this._tileInfoView.getTileBounds(V.create(),T),[512,512],[4096,4096]),y.push(f)}f.setTransform(h,this._tileInfoView.getTileResolution(f.key)),p.push(f),g++}o.setStencilWriteMask(0),o.setColorMask(!0,!0,!0,!0),o.setStencilOp(7680,7680,7681),o.setStencilFunction(514,0,255),o.setStencilTestEnabled(!0);for(var P=0,B=t;P<B.length;P++){var R=B[P],S=s.layers[R];!S||void 0!==S.minzoom&&S.minzoom>=l+1e-6||void 0!==S.maxzoom&&S.maxzoom<l-1e-6||(e.styleLayerId=R,e.styleLayer=S,u.renderObjects(e,p,"vtlBackground"))}O.pool.release(r)},g);function g(e,t){var r=f.call(this,e,t)||this;return r._backgroundTiles=[],r._fadeRecorder=new c.FadeRecorder(400),r._pointToCallbacks=new Map,r._parsedDataQueue=new Map,r}t.VectorTileContainer=y}.apply(null,i))||(e.exports=n)},2574:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(106)],void 0===(n=function(e,t,h){Object.defineProperty(t,"__esModule",{value:!0});function r(e,t,r,i){this.fadeSpeed=e,this.minfadeLevel=t,this.maxfadeLevel=r,this.fadeChange=i}t.FadeProperties=r;var i=(n.prototype.recordLevel=function(e){var t=h(),r=this._levelSnapshots;0===r.length&&(r.push({level:e,now:0}),r.push({level:e,now:0})),2!==r.length&&r[0].level===e||r.push({level:e,now:t})},n.prototype.needsRedraw=function(){if(0===this._levelSnapshots.length)return!1;for(var e=this._duration,t=this._levelSnapshots,r=t.length,i=t[r-1],n=-1;n+1<r&&t[n+1].now+e<i.now;)n++;for(n<0&&(n=0);n<r;n++)if(t[n].level!==i.level)return!0;return!1},n.prototype.getFadeValues=function(){for(var e=this._duration,t=h(),r=this._levelSnapshots;3<r.length&&r[1].now+e<t;)r.shift();r[1].now+e<t&&(r[0].level=r[1].level);var i=r[0].level,n=r[r.length-1],a=n.level,s=Math.min(i,a),o=Math.max(i,a),l=(n.level-r[1].level)/((n.now-r[1].now)/e),u=(t-n.now)/e*l;return this._ignoreSpeed?{fadeSpeed:0,minfadeLevel:s,maxfadeLevel:o,fadeChange:0}:{fadeSpeed:l,minfadeLevel:s,maxfadeLevel:o,fadeChange:u}},n);function n(e,t){void 0===e&&(e=300),void 0===t&&(t=!1),this._levelSnapshots=[],this._duration=e,this._ignoreSpeed=t}t.FadeRecorder=i}.apply(null,i))||(e.exports=n)},2575:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(0),r(92),r(495),r(102)],void 0===(n=function(e,t,r,i,a,n,s){return r(o,l=n),o.prototype.getTileParentId=function(e){var t=s.pool.acquire(e),r=0===t.level?null:s.getId(t.level-1,t.row>>1,t.col>>1,t.world);return s.pool.release(t),r},o.prototype.getTileCoverage=function(e,t,r){var i=l.prototype.getTileCoverage.call(this,e,t,r);if(!i)return i;var n=1<<i.lodInfo.level;return i.spans=i.spans.filter(function(e){return 0<=e.row&&e.row<n}),i},o.prototype.scaleToLevel=function(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];var t=this._fullCacheLodInfos;if(e>t[0].scale)return t[0].level;for(var r=void 0,i=void 0,n=0;n<t.length-1;n++)if(e>(i=t[n+1]).scale)return(r=t[n]).level+(r.scale-e)/(r.scale-i.scale);return t[t.length-1].level},o.prototype._initializeFullCacheLODs=function(e){var t;if(0===e[0].level)t=e.map(function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}});else{var r=this.tileInfo.size[0],i=this.tileInfo.spatialReference;t=a.create({size:r,spatialReference:i}).lods.map(function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}})}for(var n=0;n<t.length;n++)this._levelByScale[t[n].scale]=t[n].level;this._fullCacheLodInfos=t},o;function o(){var e=null!==l&&l.apply(this,arguments)||this;return e._fullCacheLodInfos=null,e._levelByScale={},e}var l}.apply(null,i))||(e.exports=n)}}]);