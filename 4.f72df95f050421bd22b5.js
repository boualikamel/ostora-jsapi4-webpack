(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/graphics/data/utils":1674,"esri/layers/graphics/data/attributeSupport":1695,"esri/layers/graphics/data/FeatureStore":1722,"esri/layers/graphics/data/QueryEngine":1723,"esri/layers/graphics/centroid":1725,"esri/layers/graphics/data/spatialQuerySupport":1726,"esri/layers/graphics/data/timeSupport":1762,"esri/core/sql/WhereClauseCache":1813,"esri/layers/graphics/contains":1814,"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":1815,"esri/layers/graphics/data/executeTileQuery":1909,"esri/layers/graphics/data/BoundsStore":2449,"esri/layers/graphics/data/QueryEngineResult":2454,"esri/layers/graphics/data/AttributesBuilder":2455,"esri/layers/support/PromiseQueue":2456})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1674:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(10),r(17),r(12),r(4),r(69),r(320),r(38),r(485),r(55),r(1725),r(306),r(302),r(1649),r(1726)],void 0===(n=function(e,c,h,d,t,f,p,y,m,g,v,_,i,I,n,b,S){function s(e,t,r,i,n){void 0===i&&(i=e.hasZ),void 0===n&&(n=e.hasM);var s=e.hasZ&&i,o=e.hasM&&n;if(r){var a=I.quantizeOptimizedGeometry(E,t,e.hasZ,e.hasM,"esriGeometryPoint",r,i,n);return I.convertToPoint(a,s,o)}return I.convertToPoint(t,s,o)}function l(a,u,l){return d(this,void 0,void 0,function(){var t,r,i,n,s,o;return h(this,function(e){switch(e.label){case 0:return a?(t=a.where,a.where=t=t&&t.trim(),(!t||/^1 *= *1$/.test(t)||u&&u===t)&&(a.where=null),a.geometry?[4,function(c){return d(this,void 0,void 0,function(){var t,r,i,n,s,o,a,u,l;return h(this,function(e){switch(e.label){case 0:return t=c.geometry,r=c.distance,i=c.units,null==r?[2,p.resolve(t)]:(n=t.spatialReference,s=i&&x.fromJSON(i)||y.getUnitString(n),n&&(_.isGeographic(n)||_.isWebMercator(n))?(a=t,[3,3]):[3,1]);case 1:return[4,b.checkProjectionSupport(n,_.WGS84).then(function(){return b.project(t,_.WGS84)})];case 2:a=e.sent(),e.label=3;case 3:return o=a,[4,S.getGeodesicBufferOperator()];case 4:return u=e.sent(),[2,(l=u(o,r,s))?l.toJSON():null]}})})}(a)]:[2,a]):[2,null];case 1:return r=e.sent(),a.distance=0,a.units=null,"esriSpatialRelEnvelopeIntersects"===a.spatialRel&&(i=a.geometry.spatialReference,(r=m.getGeometryExtent(r)).spatialReference=i),a.geometry=r,[4,b.checkProjectionSupport(r.spatialReference,l)];case 2:return e.sent(),[4,v.normalizeCentralMeridian(g.fromJSON(r))];case 3:if(n=e.sent()[0],f.isNone(n))throw c.QUERY_ENGINE_EMPTY_RESULT;return s=n.toJSON(),[4,b.project(s,s.spatialReference,l)];case 4:if(!(o=e.sent()))throw c.QUERY_ENGINE_EMPTY_RESULT;return o.spatialReference=l,a.geometry=o,[2,a]}})})}Object.defineProperty(c,"__esModule",{value:!0});var x=new t.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});c.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var F=new n.default,T=new n.default,E=new n.default,R={esriGeometryPoint:I.convertToPoint,esriGeometryPolyline:I.convertToPolyline,esriGeometryPolygon:I.convertToPolygon,esriGeometryMultipoint:I.convertToMultipoint};c.transformCentroid=s,c.getCentroid=function(e,t,r){return"esriGeometryPolygon"===e.geometryType&&t&&(t.centroid||t.geometry)?(t.centroid||(t.centroid=i.getCentroidOptimizedGeometry(new n.default,t.geometry,e.hasZ,e.hasM)),s(e,t.centroid,r)):null},c.getGeometry=function(e,t,r,i,n,s){void 0===n&&(n=e.hasZ),void 0===s&&(s=e.hasM);var o=e.hasZ&&n,a=e.hasM&&s,u=t?"coords"in t?t:t.geometry:null;if(!u)return null;if(r){var l=I.generalizeOptimizedGeometry(T,u,e.hasZ,e.hasM,e.geometryType,r,n,s);return i&&(l=I.quantizeOptimizedGeometry(E,l,o,a,e.geometryType,i)),R[e.geometryType](l,o,a)}if(i){l=I.quantizeOptimizedGeometry(E,u,e.hasZ,e.hasM,e.geometryType,i,n,s);return R[e.geometryType](l,o,a)}return I.removeZMValues(F,u,e.hasZ,e.hasM,n,s),R[e.geometryType](F,o,a)},c.normalizeQuery=function(o,a,u){return d(this,void 0,void 0,function(){var t,r,i,n,s;return h(this,function(e){if(t=o.outFields,r=o.orderByFields,i=o.groupByFieldsForStatistics,n=o.outStatistics,t)for(s=0;s<t.length;s++)t[s]=t[s].trim();if(r)for(s=0;s<r.length;s++)r[s]=r[s].trim();if(i)for(s=0;s<i.length;s++)i[s]=i[s].trim();if(n)for(s=0;s<n.length;s++)n[s].onStatisticField&&(n[s].onStatisticField=n[s].onStatisticField.trim());return o.geometry&&!o.outSR&&(o.outSR=o.geometry.spatialReference),[2,l(o,a,u)]})})},c.normalizeFilter=function(t,r,i){return d(this,void 0,void 0,function(){return h(this,function(e){return[2,l(t,r,i)]})})},c.normalizeQueryLike=l,c.cleanFromGeometryEngine=function(e){return e&&r in e?JSON.parse(JSON.stringify(e,o)):e};var r="_geVersion",o=function(e,t){return e!==r?t:void 0}}.apply(null,i))||(e.exports=n)},1695:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(6),r(63),r(1813)],void 0===(n=function(e,t,r,h,i,n){function d(e,t){return e?o.get(e,t):null}function f(e,t,r,i){void 0===i&&(i=!0);for(var n=[],s=0,o=t;s<o.length;s++){var a=o[s];if("*"!==a&&!e.has(a))if(i){var u=p(a);try{var l=d(u,e);if(!l)throw new h(y,"invalid SQL expression",{where:u});if(!l.isStandardized)throw new h(y,"expression is not standard",{clause:l});f(e,l.fieldNames,"expression contains missing fields")}catch(e){var c=e&&e.details;if(c&&(c.clause||c.where))throw e;c&&c.missingFields?n.push.apply(n,c.missingFields):n.push(a)}}else n.push(a)}if(n.length)throw new h(y,r,{missingFields:n})}function p(e){return e.split(s)[0]}Object.defineProperty(t,"__esModule",{value:!0});var o=new n.WhereClauseCache(50,500),y="feature-store:unsupported-query",s=" as ",a=i.createSetFromValues(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);t.validateWhere=function(e,t){if(!t)return!0;var r=o.get(t,e);if(!r)throw new h(y,"invalid SQL expression",{where:t});if(!r.isStandardized)throw new h(y,"where clause is not standard",{where:t});return f(e,r.fieldNames,"where clause contains missing fields"),!0},t.validateHaving=function(s,e,r){if(!e)return!0;var t=o.get(e,s);if(!t)throw new h(y,"invalid SQL expression",{having:e});if(!t.isAggregate)throw new h(y,"having does not contain a valid aggregate function",{having:e});var i=t.fieldNames;if(f(s,i,"having contains missing fields"),!t.getExpressions().every(function(e){var i=e.aggregateType,t=e.field,n=s.has(t)&&s.get(t).name;return r.some(function(e){var t=e.onStatisticField,r=e.statisticType;return(s.has(t)&&s.get(t).name)===n&&r.toLowerCase().trim()===i})}))throw new h(y,"expressions in having should also exist in outStatistics",{having:e});return!0},t.getWhereClause=d,t.validateFields=f,t.getExpressionFromFieldName=p,t.getAliasFromFieldName=function(e){return e.split(s)[1]},t.hasInvalidFieldType=function(e,t){var r=t.get(e);return!!r&&!a.has(r.type)}}.apply(null,i))||(e.exports=n)},1722:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(10),r(1),r(0),r(6),r(54),r(3),r(12),r(492),r(80),r(55),r(306),r(2449),r(1909),r(1815)],void 0===(n=function(e,t,v,r,i,n,s,o,a,u,l,_,I,c,h,b,d){Object.defineProperty(t,"__esModule",{value:!0});var f=a.getLogger("esri.layers.graphics.data.FeatureStore"),p=(Object.defineProperty(y.prototype,"geometryType",{get:function(){return this.geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"hasM",{get:function(){return this.geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"hasZ",{get:function(){return this.geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"fullBounds",{get:function(){var r=this;if(!this.numFeatures)return null;var i=_.create(_.NEGATIVE_INFINITY);return this._featuresById.forEach(function(e){var t=r._boundsStore.get(e.objectId);t&&(i[0]=Math.min(t[0],i[0]),i[1]=Math.min(t[1],i[1]),i[2]=Math.max(t[2],i[2]),i[3]=Math.max(t[3],i[3]))}),i},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"storeStatistics",{get:function(){var t=0;return this._featuresById.forEach(function(e){e.geometry&&e.geometry.coords&&(t+=e.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:t/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}},enumerable:!0,configurable:!0}),y.prototype.add=function(e){this._add(e),this._emitChanged()},y.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._add(i)}this._emitChanged()},y.prototype.clear=function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()},y.prototype.removeById=function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null},y.prototype.removeManyById=function(e){this._boundsStore.invalidateIndex();for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this._featuresById.get(i);n&&this._remove(n)}this._emitChanged()},y.prototype.forEachBounds=function(e,t,r){for(var i=0,n=e;i<n.length;i++){var s=n[i],o=this._boundsStore.get(s.objectId);o&&t(l.fromRect(r,o))}},y.prototype.getFeature=function(e){return this._featuresById.get(e)},y.prototype.has=function(e){return this._featuresById.has(e)},y.prototype.forEach=function(t){this._featuresById.forEach(function(e){return t(e)})},y.prototype.forEachInBounds=function(e,t){var r=this;this._boundsStore.forEachInBounds(e,function(e){t(r._featuresById.get(e))})},y.prototype.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()},y.prototype.sweep=function(){var r=this,i=!1;this._featuresById.forEach(function(e,t){r._markedIds.has(t)||(i=!0,r._remove(e))}),this._markedIds.clear(),i&&this._emitChanged()},y.prototype.executeTileQuery=function(y,m,g){return r(this,void 0,void 0,function(){var t,r,i,n,s,o,a,u,l,c,h,d,f,p;return v(this,function(e){return t=g.returnGeometry,r=g.returnCentroid,i=g.returnOutline,n=g.pixelBuffer,s=new Set,o=[],a=n*y.resolution,u=_.pad(y.bounds,a,_.create()),b.createTileFeatures(o,s,this.geometryInfo,this,u,t,r,i,{originPosition:"upperLeft",scale:[y.resolution,y.resolution],translate:[y.bounds[0],y.bounds[3]]}),("esriGeometryPoint"===this.geometryType||r)&&(l=I.getInfo(m))&&(c=l.valid,h=c[0],d=c[1],u[0]<h&&(f=_.fromValues(d-a,u[1],d,u[3]),b.createTileFeatures(o,s,this.geometryInfo,this,f,t,r,i,{originPosition:"upperLeft",scale:[y.resolution,y.resolution],translate:[d,y.bounds[3]]})),u[2]>d&&(p=_.fromValues(h,u[1],h+a,u[3]),b.createTileFeatures(o,s,this.geometryInfo,this,p,t,r,i,{originPosition:"upperLeft",scale:[y.resolution,y.resolution],translate:[h-d+y.bounds[0],y.bounds[3]]}))),o.sort(function(e,t){return e.localId-t.localId}),[2,{features:o,objectIds:s}]})})},y.prototype._emitChanged=function(){this.events.emit("changed",void 0)},y.prototype._add=function(e){if(e){var t=e.objectId;if(null==t)return void f.error(new s("featurestore:invalid-feature","feature id is missing",{feature:e}));var r,i=this._featuresById.get(t);if(this._markedIds.add(t),i?(e.localId=i.localId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):u.isSome(this.onFeatureAdd)&&this.onFeatureAdd(e),!e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=c.getBoundsOptimizedGeometry(r||_.create(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(t,r),this._featuresById.set(t,e)}},y.prototype._remove=function(e){return u.isSome(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e},y);function y(e){this.geometryInfo=e,this._boundsStore=new h.BoundsStore,this._featuresById=new Map,this._markedIds=new Set,this.events=new o,this.featureAdapter=d.optimizedFeatureQueryEngineAdapter}t.default=p}.apply(null,i))||(e.exports=n)},1723:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(9),r(10),r(6),r(63),r(8),r(3),r(325),r(4),r(69),r(492),r(80),r(490),r(38),r(55),r(1695),r(1649),r(1724),r(2454),r(1726),r(1762),r(1674),r(488),r(2456)],void 0===(n=function(e,t,d,E,R,f,i,c,r,n,s,h,p,o,a,u,w,y,m,l,N,G,g,v,_,I){Object.defineProperty(t,"__esModule",{value:!0});function b(e,t,r,i,n){void 0===t&&(t=null),this.attributes=e,this.geometry=r,this.centroid=i,this.filterFlags=n,this.groupId=-1,this.localId=t}var S=r.getLogger("esri.layers.graphics.data.QueryEngine");t.Feature=b;var x=new Set,F=new n.MemCacheStorage(2e6),T=0,M=(Q.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()},Object.defineProperty(Q.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"fullExtent",{get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:v.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"timeExtent",{get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=g.getTimeExtent(this.timeInfo,this.featureStore)),this._timeExtent):null},enumerable:!0,configurable:!0}),Q.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null},Q.prototype.executeQuery=function(n,e){return void 0===n&&(n={}),R(this,void 0,void 0,function(){var t,r,i;return E(this,function(e){switch(e.label){case 0:t=c.clone(n),e.label=1;case 1:return e.trys.push([1,14,,15]),[4,this._schedule()];case 2:return e.sent(),[4,v.normalizeQuery(t,this.definitionExpression,this.spatialReference)];case 3:return t=e.sent(),[4,this._reschedule()];case 4:return e.sent(),[4,this._checkQuerySupport(t)];case 5:return t=e.sent(),[4,this._reschedule()];case 6:return e.sent(),[4,this._executeGeometryQuery(t)];case 7:return r=e.sent(),[4,this._reschedule()];case 8:return e.sent(),[4,r.executeObjectIdsQuery(t)];case 9:return r=e.sent(),[4,this._reschedule()];case 10:return e.sent(),[4,r.executeTimeQuery(t)];case 11:return r=e.sent(),[4,this._reschedule()];case 12:return e.sent(),[4,r.executeAttributesQuery(t)];case 13:return r=e.sent(),[3,15];case 14:if((i=e.sent())!==v.QUERY_ENGINE_EMPTY_RESULT)throw i;return r=new N.default([],null,this),[3,15];case 15:return[2,r.createQueryResponse(t)]}})})},Q.prototype.executeQueryForCount=function(n,e){return void 0===n&&(n={}),R(this,void 0,void 0,function(){var t,r,i;return E(this,function(e){switch(e.label){case 0:(t=c.clone(n)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,e.label=1;case 1:return e.trys.push([1,14,,15]),[4,this._schedule()];case 2:return e.sent(),[4,v.normalizeQuery(t,this.definitionExpression,this.spatialReference)];case 3:return t=e.sent(),[4,this._reschedule()];case 4:return e.sent(),[4,this._checkQuerySupport(t)];case 5:return t=e.sent(),[4,this._reschedule()];case 6:return e.sent(),[4,this._executeGeometryQuery(t)];case 7:return r=e.sent(),[4,this._reschedule()];case 8:return e.sent(),[4,r.executeObjectIdsQuery(t)];case 9:return r=e.sent(),[4,this._reschedule()];case 10:return e.sent(),[4,r.executeTimeQuery(t)];case 11:return r=e.sent(),[4,this._reschedule()];case 12:return e.sent(),[4,r.executeAttributesQuery(t)];case 13:return[2,(r=e.sent()).size];case 14:if((i=e.sent())!==v.QUERY_ENGINE_EMPTY_RESULT)throw i;return[2,0];case 15:return[2]}})})},Q.prototype.executeQueryForExtent=function(l,e){return void 0===l&&(l={}),R(this,void 0,void 0,function(){var t,r,i,n,s,o,a,u;return E(this,function(e){switch(e.label){case 0:t=c.clone(l),i=t.outSR,e.label=1;case 1:return e.trys.push([1,14,,15]),[4,this._schedule()];case 2:return e.sent(),[4,v.normalizeQuery(t,this.definitionExpression,this.spatialReference)];case 3:return t=e.sent(),[4,this._reschedule()];case 4:return e.sent(),[4,this._checkQuerySupport(t)];case 5:return(t=e.sent()).returnGeometry=!0,t.returnCentroid=!1,t.outSR=null,[4,this._reschedule()];case 6:return e.sent(),[4,this._executeGeometryQuery(t)];case 7:return r=e.sent(),[4,this._reschedule()];case 8:return e.sent(),[4,r.executeObjectIdsQuery(t)];case 9:return r=e.sent(),[4,this._reschedule()];case 10:return e.sent(),[4,r.executeTimeQuery(t)];case 11:return r=e.sent(),[4,this._reschedule()];case 12:return e.sent(),[4,r.executeAttributesQuery(t)];case 13:return r=e.sent(),(n=r.size)?(p.set(C,p.NEGATIVE_INFINITY),this.featureStore.forEachBounds(r.items,function(e){return p.expand(C,e)},P),s={xmin:C[0],ymin:C[1],xmax:C[3],ymax:C[4],spatialReference:v.cleanFromGeometryEngine(this.spatialReference)},this.hasZ&&isFinite(C[2])&&isFinite(C[5])&&(s.zmin=C[2],s.zmax=C[5]),(o=m.project(s,r.spatialReference,i)).spatialReference=v.cleanFromGeometryEngine(i||this.spatialReference),o.xmax-o.xmin==0&&(a=h.getMetersPerUnitForSR(o.spatialReference),o.xmin-=a,o.xmax+=a),o.ymax-o.ymin==0&&(a=h.getMetersPerUnitForSR(o.spatialReference),o.ymin-=a,o.ymax+=a),this.hasZ&&null!=o.zmin&&null!=o.zmax&&o.zmax-o.zmin==0&&(a=h.getMetersPerUnitForSR(o.spatialReference),o.zmin-=a,o.zmax+=a),[2,{count:n,extent:o}]):[2,{count:n,extent:null}];case 14:if((u=e.sent())===v.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw u;case 15:return[2]}})})},Q.prototype.executeQueryForIds=function(t,r){return void 0===t&&(t={}),R(this,void 0,void 0,function(){return E(this,function(e){return[2,this.executeQueryForIdSet(t,r).then(function(e){return i.valuesOfSet(e)})]})})},Q.prototype.executeQueryForIdSet=function(l,e){return void 0===l&&(l={}),R(this,void 0,void 0,function(){var t,r,i,n,s,o,a,u;return E(this,function(e){switch(e.label){case 0:(t=c.clone(l)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,e.label=1;case 1:return e.trys.push([1,13,,14]),[4,this._schedule()];case 2:return e.sent(),[4,v.normalizeQuery(t,this.definitionExpression,this.spatialReference)];case 3:return t=e.sent(),[4,this._reschedule()];case 4:return e.sent(),[4,this._executeGeometryQuery(t)];case 5:return r=e.sent(),[4,this._reschedule()];case 6:return e.sent(),[4,r.executeObjectIdsQuery(t)];case 7:return r=e.sent(),[4,this._reschedule()];case 8:return e.sent(),[4,r.executeTimeQuery(t)];case 9:return r=e.sent(),[4,this._reschedule()];case 10:return e.sent(),[4,r.executeAttributesQuery(t)];case 11:return r=e.sent(),[4,this._reschedule()];case 12:for(e.sent(),i=r.items,n=new Set,s=0,o=i;s<o.length;s++)a=o[s],n.add(r.featureAdapter.getObjectId(a));return[2,n];case 13:if((u=e.sent())===v.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw u;case 14:return[2]}})})},Q.prototype.executeQueryForLatestObservations=function(e,t){var r=this;return this.timeInfo?this.executeQuery(e,t).then(function(e){return r._filterLatest(e,r.timeInfo)}):void S.error(new f("invalid-query","Unable to make time-based query as the underlying service does include TimeInfo"))},Q.prototype._schedule=function(t){return R(this,void 0,void 0,function(){return E(this,function(e){return this._frameQueue?[2,this._frameQueue.push(t).then(function(e){return e})]:[2,t]})})},Q.prototype._reschedule=function(t){return R(this,void 0,void 0,function(){return E(this,function(e){return this._frameQueue?[2,this._frameQueue.unshift(t).then(function(e){return e})]:[2,t]})})},Q.prototype._update=function(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null},Q.prototype._filterLatest=function(e,t){for(var r=t.trackIdField,i=t.startTimeField,n=t.endTimeField||i,s=new Map,o=[],a=0,u=e.features;a<u.length;a++){var l=u[a],c=l.attributes[r],h=l.attributes[n];(!s.has(c)||s.get(c).attributes[n]<h)&&s.set(c,l)}return s.forEach(function(e){return o.push(e)}),d({},e,{features:o})},Q.prototype._getAll=function(){if(!this._allItems){var t=[];this.featureStore.forEach(function(e){return t.push(e)}),this._allItems=new N.default(t,null,this)}return this._allItems},Q.prototype._executeGeometryQuery=function(T){return R(this,void 0,void 0,function(){var t,i,r,n,s,o,a,u,l,c,h,d,f,p,y,m,g,v,_,I,b,S,x,F=this;return E(this,function(e){switch(e.label){case 0:if(t=T.geometry,i=T.outSR,r=T.spatialRel,n=w.isValid(i)&&!w.equals(this.spatialReference,i),(s=this.cacheSpatialQueries?n?JSON.stringify({geometry:t,spatialRelationship:r,outSpatialReference:i}):JSON.stringify({geometry:t,spatialRelationship:r}):null)&&void 0!==(o=this._geometryQueryCache.get(s)))return[2,o];if(a=function(r){return R(F,void 0,void 0,function(){var t;return E(this,function(e){switch(e.label){case 0:return n&&(T.returnGeometry||T.returnCentroid)?[4,r.project(i)]:[3,2];case 1:return t=e.sent(),s&&this._geometryQueryCache.put(s,t,t.size||1),[2,t];case 2:return s&&this._geometryQueryCache.put(s,r,r.size||1),[2,r]}})})},!t)return[2,a(this._getAll())];if(u=this.featureAdapter,"esriSpatialRelDisjoint"!==r)return[3,5];if(!(l=this._searchFeatures(this._getQueryBBoxes(t))).length)return[2,a(this._getAll())];for(d=new Set,f=0,p=l;f<p.length;f++)y=p[f],d.add(u.getObjectId(y));return[4,this._reschedule(d)];case 1:return d=e.sent(),m=0,c=new Array(d.size),this.featureStore.forEach(function(e){return c[m++]=e}),h=d,[4,this._reschedule()];case 2:return e.sent(),[4,G.getSpatialQueryOperator(r,t,this)];case 3:return g=e.sent(),v=function(e){return!h.has(u.getObjectId(e))||g(u.getGeometry(e))},_=N.default.bind,[4,this._runSpatialFilter(c,v)];case 4:return b=new(_.apply(N.default,[void 0,e.sent(),t,this])),[2,a(b)];case 5:return(I=this._searchFeatures(this._getQueryBBoxes(t))).length?this._canExecuteSoloPass(t,T)?[2,a(new N.default(I,t,this))]:[4,G.getSpatialQueryOperator(r,t,this)]:(b=new N.default([],t,this),s&&this._geometryQueryCache.put(s,b,b.size||1),[2,b]);case 6:return S=e.sent(),[4,this._runSpatialFilter(I,function(e){return S(u.getGeometry(e))})];case 7:return x=e.sent(),[2,a(new N.default(x,t,this))]}})})},Q.prototype._runSpatialFilter=function(s,o){return R(this,void 0,void 0,function(){var r,i,n,t=this;return E(this,function(e){return o?this._budget?(r=0,i=new Array,n=function(){return R(t,void 0,void 0,function(){var t;return E(this,function(e){switch(e.label){case 0:return r<s.length?(t=s[r],o(t)&&i.push(t),this._budget.done?[4,this._reschedule()]:[3,2]):[3,3];case 1:return e.sent(),[2,n()];case 2:return++r,[3,0];case 3:return[2]}})})},[2,this._reschedule().then(function(){return n()}).then(function(){return i})]):[2,s.filter(function(e){return o(e)})]:[2,s]})})},Q.prototype._canExecuteSoloPass=function(e,t){var r=this.geometryType,i=t.spatialRel;return G.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===i||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===i||"esriSpatialRelContains"===i||"esriSpatialRelWithin"===i))},Q.prototype._getQueryBBoxes=function(e){if(G.canQueryWithRBush(e)){if(u.isExtent(e))return[o.fromValues(e.xmin,e.ymin,e.xmax,e.ymax)];if(u.isPolygon(e))return e.rings.map(function(e){return o.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))})}return[a.getBoundsXY(o.create(),e)]},Q.prototype._searchFeatures=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.featureStore.forEachInBounds(i,function(e){x.add(e)})}var n=new Array(x.size),s=0;return x.forEach(function(e){return n[s++]=e}),x.clear(),n},Q.prototype._checkQuerySupport=function(t){return R(this,void 0,void 0,function(){return E(this,function(e){if(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text)throw new f("feature-store:unsupported-query","Unsupported query options",{query:t});return[2,s.all([this._checkAttributesQuerySupport(t),this._checkStatisticsQuerySupport(t),G.checkSpatialQuerySupport(t,this.geometryType,this.spatialReference),m.checkProjectionSupport(this.spatialReference,t.outSR)]).then(function(){return t})]})})},Q.prototype._checkAttributesQuerySupport=function(e){var t=e.outFields,r=e.orderByFields,i=e.returnDistinctValues;if(r&&0<r.length){var n=r.map(function(e){return-1<e.indexOf(" ASC")?e.split(" ASC")[0]:-1<e.indexOf(" DESC")?e.split(" DESC")[0]:e});y.validateFields(this.fieldsIndex,n,"orderByFields contains missing fields")}if(t&&0<t.length)y.validateFields(this.fieldsIndex,t,"outFields contains missing fields");else if(i)throw new f("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:e});y.validateWhere(this.fieldsIndex,e.where)},Q.prototype._checkStatisticsQuerySupport=function(d){return R(this,void 0,void 0,function(){var t,r,i,n,s,o,a,u,l,c,h;return E(this,function(e){if(t=d.outStatistics,r=d.groupByFieldsForStatistics,i=d.having,n=r&&r.length,s=t&&t.length,i){if(!n||!s)throw new f("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:d});y.validateHaving(this.fieldsIndex,i,t)}if(s){if(t.some(function(e){return"exceedslimit"===e.statisticType}))return[2];for(o=t.map(function(e){return e.onStatisticField}),y.validateFields(this.fieldsIndex,o,"onStatisticFields contains missing fields"),n&&y.validateFields(this.fieldsIndex,r,"groupByFieldsForStatistics contains missing fields"),a=0,u=t;a<u.length;a++)if(l=u[a],c=l.onStatisticField,h=l.statisticType,(!n||"count"!==h)&&c&&y.hasInvalidFieldType(c,this.fieldsIndex))throw new f("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:l,query:d})}return[2]})})},Q);function Q(e){var t=this;this.capabilities={query:l.queryCapabilities},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.cacheSpatialQueries=e.cacheSpatialQueries||!1,this.featureStore=e.featureStore,this._changeHandle=this.featureStore.events.on("changed",function(){return t.clearCache()}),this.timeInfo=e.timeInfo,this.cacheSpatialQueries&&(this._geometryQueryCache=new n.MemCache(T+++"$$",F)),this.fieldsIndex=new _(e.fields),e.scheduler&&e.task&&(this._frameQueue=new I.PromiseQueue,this._frameTask=e.scheduler.registerTask(e.task,function(e){return t._update(e)},function(){return 0<t._frameQueue.length}))}t.default=M;var P=p.create(),C=p.create()}.apply(null,i))||(e.exports=n)},1725:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function Q(e,t){return e?t?4:3:t?3:2}function g(e,t,r,i,n,s){for(var o=Q(n,s),a=r,u=r+o,l=0,c=0,h=0,d=0,f=0,p=0,y=i-1;p<y;p++,a+=o,u+=o){var m=t[a],g=t[a+1],v=t[a+2],_=t[u],I=t[u+1],b=t[u+2],S=m*I-_*g;d+=S,l+=(m+_)*S,c+=(g+I)*S,n&&(h+=(v+b)*(S=m*b-_*v),f+=S),m<e[0]&&(e[0]=m),m>e[1]&&(e[1]=m),g<e[2]&&(e[2]=g),g>e[3]&&(e[3]=g),n&&(v<e[4]&&(e[4]=v),v>e[5]&&(e[5]=v))}if(0<d&&(d*=-1),0<f&&(f*=-1),!d)return null;var x=[l,c,.5*d];return n&&(x[3]=h,x[4]=.5*f),x}function v(e,t,r,i,n){for(var s=Q(i,n),o=t,a=t+s,u=0,l=0,c=0,h=0,d=0,f=r-1;d<f;d++,o+=s,a+=s){var p=e[o],y=e[o+1],m=e[o+2],g=e[a],v=e[a+1],_=e[a+2],I=i?(void 0,N=g-p,G=v-y,M=_-m,Math.sqrt(N*N+G*G+M*M)):(void 0,R=g-p,w=v-y,Math.sqrt(R*R+w*w));if(I)if(u+=I,i){l+=I*(b=[(F=p)+.5*(g-F),(T=y)+.5*(v-T),(E=m)+.5*(_-E)])[0],c+=I*b[1],h+=I*b[2]}else{var b;l+=I*(b=[(S=p)+.5*(g-S),(x=y)+.5*(v-x)])[0],c+=I*b[1]}}var S,x,F,T,E,R,w,N,G,M;return 0<u?i?[l/u,c/u,h/u]:[l/u,c/u]:0<r?i?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getCentroidOptimizedGeometry=function(e,t,i,r){if(!t||!t.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);for(var n=e.coords,s=[],o=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],a=t.lengths,u=t.coords,l=Q(i,r),c=0,h=0,d=a;h<d.length;h++){var f=d[h],p=g(o,u,c,f,i,r);p&&s.push(p),c+=f*l}if(s.sort(function(e,t){var r=e[2]-t[2];return 0===r&&i&&(r=e[4]-t[4]),r}),s.length){var y=6*s[0][2];n[0]=s[0][0]/y,n[1]=s[0][1]/y,i&&(y=6*s[0][4],n[2]=0!==y?s[0][3]/y:0),(n[0]<o[0]||n[0]>o[1]||n[1]<o[2]||n[1]>o[3]||i&&(n[2]<o[4]||n[2]>o[5]))&&(n.length=0)}if(!n.length){var m=t.lengths[0]?v(u,0,a[0],i,r):null;if(!m)return null;n[0]=m[0],n[1]=m[1],i&&2<m.length&&(n[2]=m[2])}return e},t.lineCentroid=v}.apply(null,i))||(e.exports=n)},1726:function(e,t,n){var r,i;r=[n.dj.c(e.i),t,n(9),n(10),n(6),n(4),n(162),n(318),n(38),n(55),n(1814),n(306),n(302),n(1649),n(1674)],void 0===(i=function(e,t,r,i,l,a,u,c,h,d,f,p,y,m,g){function v(){return a.create(function(t){return n.e(2).then(function(){var e=[n(1571)];t.apply(null,e)}.bind(this)).catch(n.oe)})}Object.defineProperty(t,"__esModule",{value:!0});var _="feature-store:unsupported-query",I={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},b={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};t.importGeometryEngine=v,t.getGeodesicBufferOperator=function(){return v().then(function(e){return e.geodesicBuffer})},t.getSpatialQueryOperator=function(r,i,n){if(h.isPolygon(i)&&"esriGeometryPoint"===n.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r)){var t=p.convertFromPolygon(new y.default,i,!1,!1);return a.resolve(function(e){return f.polygonContainsPoint(t,!1,!1,e)})}if(h.isPolygon(i)&&"esriGeometryMultipoint"===n.geometryType){var s=p.convertFromPolygon(new y.default,i,!1,!1);if("esriSpatialRelContains"===r)return a.resolve(function(e){return f.polygonContainsMultipoint(s,!1,!1,e,n.hasZ,n.hasM)})}if(h.isExtent(i)&&"esriGeometryPoint"===n.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))return a.resolve(function(e){return u.extentContainsPoint(i,g.getGeometry(n,e))});if(h.isExtent(i)&&"esriGeometryMultipoint"===n.geometryType&&"esriSpatialRelContains"===r)return a.resolve(function(e){return u.extentContainsMultipoint(i,g.getGeometry(n,e))});if(h.isExtent(i)&&"esriSpatialRelIntersects"===r){var o=c.getExtentIntersector(n.geometryType);return a.resolve(function(e){return o(i,g.getGeometry(n,e))})}return v().then(function(e){var t=e[I[r]].bind(null,i);return function(e){return t(g.getGeometry(n,e))}})},t.checkSpatialQuerySupport=function(o,a,u){return i(this,void 0,void 0,function(){var n,s;return r(this,function(e){if(n=o.spatialRel,!(s=o.geometry))return[2];if(t=n,!0!==b.spatialRelationship[t])throw new l(_,"Unsupported query spatial relationship",{query:o});var t,r,i;if(!d.isValid(s.spatialReference)||!d.isValid(u))return[2];if(r=s,!0!==b.queryGeometry[h.getJsonType(r)])throw new l(_,"Unsupported query geometry type",{query:o});if(i=a,!0!==b.layerGeometry[i])throw new l(_,"Unsupported layer geometry type",{query:o});return o.outSR?[2,m.checkProjectionSupport(o.geometry&&o.geometry.spatialReference,o.outSR)]:[2]})})},t.canQueryWithRBush=function(e){if(h.isExtent(e))return!0;if(h.isPolygon(e)){for(var t=0,r=e.rings;t<r.length;t++){var i=r[t];if(5!==i.length)return!1;if(i[0][0]!==i[1][0]||i[0][0]!==i[4][0]||i[2][0]!==i[3][0]||i[0][1]!==i[3][1]||i[0][1]!==i[4][1]||i[1][1]!==i[2][1])return!1}return!0}return!1}}.apply(null,r))||(e.exports=i)},1762:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getTimeExtent=function(e,t){if(!e)return null;var i=t.featureAdapter,n=e.startTimeField,s=e.endTimeField,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(n&&s)t.forEach(function(e){var t=i.getAttribute(e,n),r=i.getAttribute(e,s);null==t||isNaN(t)||(o=Math.min(o,t)),null==r||isNaN(r)||(a=Math.max(a,r))});else{var r=n||s;t.forEach(function(e){var t=i.getAttribute(e,r);null==t||isNaN(t)||(o=Math.min(o,t),a=Math.max(a,t))})}return{start:o,end:a}},t.getTimeOperator=function(e,t,r){if(!t||!e)return null;var i=e.startTimeField,n=e.endTimeField;if(!i&&!n)return null;var s,o,a,u,l=t.start,c=t.end;return null==l&&null==c?null:i&&n?function(s,o,a,u,l){if(null==u||null==l||u!==l)return null!=u&&null!=l?function(e){return t=u,r=l,i=s.getAttribute(e,o),n=s.getAttribute(e,a),!(r<i||n<t);var t,r,i,n}:null!=u?function(e){return!(s.getAttribute(e,a)<u)}:null!=l?function(e){return!(s.getAttribute(e,o)>l)}:void 0;var t=u;return function(e){return t>=s.getAttribute(e,o)&&t<=s.getAttribute(e,a)}}(r,i,n,l,c):(s=r,o=i||n,u=c,null!=(a=l)&&null!=u&&a===u?function(e){return s.getAttribute(e,o)===a}:null!=a&&null!=u?function(e){return s.getAttribute(e,o)>=a&&s.getAttribute(e,o)<=u}:null!=a?function(e){return s.getAttribute(e,o)>=a}:null!=u?function(e){return s.getAttribute(e,o)<=u}:void 0)}}.apply(null,i))||(e.exports=n)},1813:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(516),r(1570)],void 0===(n=function(e,t,r,s){Object.defineProperty(t,"__esModule",{value:!0});var i=(n.prototype.get=function(e,t){var r=t.uid+":"+e,i=this._cache.get(r);if(i)return i;if(void 0!==this._invalidCache.get(r))return null;try{var n=s.WhereClause.create(e,t);return this._cache.put(r,n),n}catch(e){return this._invalidCache.put(r,null),null}},n);function n(e,t){this._cache=new r(e),this._invalidCache=new r(t)}t.WhereClauseCache=i}.apply(null,i))||(e.exports=n)},1814:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function d(e,t){return e?t?4:3:t?3:2}function h(e,t,r,i,n){if(!e)return!1;for(var s=d(t,r),o=e.coords,a=!1,u=0,l=0,c=e.lengths;l<c.length;l++){var h=c[l];a=f(a,o,s,u,h,i,n),u+=h*s}return a}function f(e,t,r,i,n,s,o){for(var a=e,u=i,l=i,c=i+n*r;l<c;l+=r){(u=l+r)===c&&(u=i);var h=t[l],d=t[l+1],f=t[u],p=t[u+1];(d<o&&o<=p||p<o&&o<=d)&&h+(o-d)/(p-d)*(f-h)<s&&(a=!a)}return a}Object.defineProperty(t,"__esModule",{value:!0}),t.polygonContainsPoint=function(e,t,r,i){return h(e,t,r,i.coords[0],i.coords[1])},t.polygonContainsMultipoint=function(e,t,r,i,n,s){var o=d(n,s),a=i.coords,u=i.lengths;if(!u)return!1;for(var l=0,c=0;l<u.length;l++,c+=o)if(!h(e,t,r,a[c],a[c+1]))return!1;return!0},t.polygonContainsCoords=h}.apply(null,i))||(e.exports=n)},1815:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1725),r(487),r(302)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.optimizedFeatureQueryEngineAdapter={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new i.default(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=r.getCentroidOptimizedGeometry(new n.default,e.geometry,t.hasZ,t.hasM)),e.centroid}},t.default=t.optimizedFeatureQueryEngineAdapter}.apply(null,i))||(e.exports=n)},1909:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(9),r(10),r(80),r(306),r(302),r(1723),r(1674)],void 0===(n=function(e,t,r,i,n,o,E,s,f,p){function y(e,t,r,i,n,s){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;var o=t.coords,a=t.lengths;if(!a.length)return e.coords[0]=E.quantizeX(s,o[0]),e.coords[1]=E.quantizeY(s,o[1]),e.coords.length=r,e;for(var u,l,c,h,d=0,f=0,p=f,y=0,m=a;y<m.length;y++){var g=m[y];if(!(g<i)){f=p,c=u=E.quantizeX(s,o[d]),h=l=E.quantizeY(s,o[d+1]),e.coords[f]=c,e.coords[f+1]=h,d+=r;var v=(c=E.quantizeX(s,o[d]))-u,_=(h=E.quantizeY(s,o[d+1]))-l,I=_/v;f+=2,e.coords[f]=v,e.coords[f+1]=_,u=c,l=h,d+=r;for(var b=2;b<g;b++){if(c=E.quantizeX(s,o[d]),h=E.quantizeY(s,o[d+1]),c!==u||h!==l){var S=c-u,x=h-l,F=x/S;(I===F||!isFinite(I)&&!isFinite(F))&&(n||(0<=_&&0<=x||_<=0&&x<=0)&&(0<=v&&0<=S||v<=0&&S<=0))?(v+=S,_+=x):(v=S,_=x,f+=2),e.coords[f]=v,e.coords[f+1]=_,I=F,u=c,l=h}d+=r}var T=(f+2-p)/2;i<=T&&(e.lengths.push(T),p=f+2)}}return e.coords.length>p&&(e.coords.length=p),e.coords.length?e:null}Object.defineProperty(t,"__esModule",{value:!0});var m=new s.default,g={esriGeometryPoint:E.convertToPoint,esriGeometryPolyline:E.convertToPolyline,esriGeometryPolygon:E.convertToPolygon,esriGeometryMultipoint:E.convertToMultipoint};t.executeTileQueryForIds=function(t,e,r){var i=r.pixelBuffer*e.resolution,n=o.pad(e.bounds,i,o.create()),s=[];return t.featureStore.forEachInBounds(n,function(e){return s.push(t.featureAdapter.getObjectId(e))}),s},t.createTileFeatures=function(t,r,i,e,n,s,o,a,u){var l=g[i.geometryType],c=v[i.geometryType],h="esriGeometryPolygon"===i.geometryType&&!a,d=i.hasZ?i.hasM?4:3:i.hasM?3:2;o&&!s?e.forEachInBounds(n,function(e){return function(e,t,r,i,n){if(!t.has(r.objectId)){var s=p.getCentroid(i,r,n),o=r.attributes;s&&(t.add(r.objectId),e.push(new f.Feature(o,r.localId,null,s)))}}(t,r,e,i,u)}):s&&!o?e.forEachInBounds(n,function(e){return function(e,t,r,i,n,s,o,a){if(!t.has(r.objectId)){var u=r.attributes,l=i(y(m,r.geometry,n,s,a,o),!1,!1);l&&(t.add(r.objectId),e.push(new f.Feature(u,r.localId,l,null)))}}(t,r,e,l,d,c,u,h)}):e.forEachInBounds(n,function(e){return function(e,t,r,i,n,s,o,a,u){if(!t.has(r.objectId)){var l=p.getCentroid(i,r,n),c=r.attributes,h=s(y(m,r.geometry,o,a,u,n),!1,!1);h&&l&&(t.add(r.objectId),e.push(new f.Feature(c,r.localId,h,l)))}}(t,r,e,i,u,l,d,c,h)})};var v={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0};t.quantizeOptimizedGeometryForDisplay=y}.apply(null,i))||(e.exports=n)},2449:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(14),r(1683),r(47)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var a={minX:0,minY:0,maxX:0,maxY:0},n=(s.prototype.clear=function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()},s.prototype.delete=function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))},s.prototype.forEachInBounds=function(e,t){this._loadIndex();for(var r=0,i=(s=this._index,o=e,a.minX=o[0],a.minY=o[1],a.maxX=o[2],a.maxY=o[3],s.search(a));r<i.length;r++){var n=i[r];t(this._idByBounds.get(n))}var s,o},s.prototype.get=function(e){return this._boundsById.get(e)},s.prototype.has=function(e){return this._boundsById.has(e)},s.prototype.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)},s.prototype.set=function(e,t){if(!this._indexInvalid){var r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||this._boundsToLoad.push(t))},s);function s(){var t=this;this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=i(9,r("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(t._indexInvalid){var r=new Array(t._idByBounds.size),i=0;t._idByBounds.forEach(function(e,t){r[i++]=t}),t._indexInvalid=!1,t._index.clear(),t._index.load(r)}else t._boundsToLoad.length&&(t._index.load(t._boundsToLoad.filter(function(e){return t._idByBounds.has(e)})),t._boundsToLoad.length=0)}}t.BoundsStore=n}.apply(null,i))||(e.exports=n)},2454:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(9),r(10),r(63),r(12),r(4),r(327),r(55),r(306),r(2455),r(1695),r(1649),r(1762),r(1674)],void 0===(n=function(e,t,r,n,i,s,o,u,Q,a,l,C,c,h,d,P){Object.defineProperty(t,"__esModule",{value:!0});var f=(Object.defineProperty(p.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),p.prototype.createQueryResponse=function(e){var t;return t=e.outStatistics?e.outStatistics.some(function(e){return"exceedslimit"===e.statisticType})?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(a.isValid(e.outSR)&&!a.equals(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=P.cleanFromGeometryEngine(r({spatialReference:e.outSR},h.project(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=P.cleanFromGeometryEngine(r({spatialReference:e.outSR},this.queryGeometry))),t},p.prototype.executeAttributesQuery=function(e){var t=c.getWhereClause(e.where,this.fieldsIndex);if(!t)return u.resolve(this);if(t.isStandardized){for(var r=0,i=[],n=0,s=this.items;n<s.length;n++){var o=s[n];t.testFeature(o,this.featureAdapter)&&(i[r++]=o)}var a=new p(i,this.queryGeometry,this);return a.definitionExpression=e.where,u.resolve(a)}return u.reject(new TypeError("Where clause is not standardized"))},p.prototype.executeObjectIdsQuery=function(e){if(!e.objectIds||!e.objectIds.length)return u.resolve(this);var t=s.createSetFromValues(e.objectIds),r=this.featureAdapter.getObjectId;return u.resolve(new p(this.items.filter(function(e){return t.has(r(e))}),this.queryGeometry,this))},p.prototype.executeTimeQuery=function(e){var t=d.getTimeOperator(this.timeInfo,e.timeExtent,this.featureAdapter);if(!o.isSome(t))return u.resolve(this);var r=this.items.filter(t);return u.resolve(new p(r,this.queryGeometry,this))},p.prototype.project=function(t){return i(this,void 0,void 0,function(){var r,i=this;return n(this,function(e){switch(e.label){case 0:return!t||a.equals(this.spatialReference,t)?[2,this]:(r=this.featureAdapter,[4,h.projectMany(this.items.map(function(e){return P.getGeometry(i,r.getGeometry(e))}),this.spatialReference,t)]);case 1:return[2,new p(e.sent().map(function(e,t){return r.cloneWithGeometry(i.items[t],l.convertFromGeometry(e,i.hasZ,i.hasM))}),this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:t,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}})})},p.prototype._createFeatureQueryResponse=function(e){var t=this,r=this.items,i=this,n=i.geometryType,s=i.hasM,o=i.hasZ,a=i.objectIdField,u=i.spatialReference,l=e.outFields,c=e.outSR,h=e.quantizationParameters,d=e.resultRecordCount,f=e.resultOffset,p=e.returnZ,y=e.returnM,m=!1;if(null!=d&&null!=f){var g=f+d;m=r.length>g,r=r.slice(f,Math.min(r.length,g))}return{exceededTransferLimit:m,features:this._createFeatures(e,r),fields:l&&l.map(function(e){return t.fieldsIndex.get(e)}),geometryType:n,hasM:s&&y,hasZ:o&&p,objectIdFieldName:a,spatialReference:P.cleanFromGeometryEngine(c||u),transform:h&&Q.toQuantizationTransform(h)||null}},p.prototype._createFeatures=function(e,t){var o=new C.default(e,this.featureAdapter,this.fieldsIndex),r=this.hasM,i=this.hasZ,n=e.orderByFields,s=e.quantizationParameters,a=e.returnGeometry,u=e.returnCentroid,l=e.maxAllowableOffset,c=e.returnZ,h=void 0!==c&&c,d=e.returnM,f=i&&h,p=r&&void 0!==d&&d,y=[],m=0;if(t.length&&n&&n.length){var g=n[0].split(" "),v=g[0],_=this.fieldsIndex.get(v),I="DESC"===g[1];t.sort(function(e,t){var r=o.getFieldValue(e,v,_),i=o.getFieldValue(t,v,_);if("number"==typeof r&&"number"==typeof i)return I?i-r:r-i;if("string"==typeof r&&"string"==typeof i){var n=r.toUpperCase(),s=i.toUpperCase();return(I?s<n:n<s)?-1:(I?n<s:s<n)?1:0}})}if(a||u){var b=Q.toQuantizationTransform(s);if(a&&!u)for(var S=0,x=t;S<x.length;S++){var F=x[S];y[m++]={attributes:o.getAttributes(F),geometry:P.getGeometry(this,this.featureAdapter.getGeometry(F),l,b,f,p)}}else if(!a&&u)for(var T=0,E=t;T<E.length;T++)F=E[T],y[m++]={attributes:o.getAttributes(F),centroid:P.transformCentroid(this,this.featureAdapter.getCentroid(F,this),b)};else for(var R=0,w=t;R<w.length;R++)F=w[R],y[m++]={attributes:o.getAttributes(F),centroid:P.transformCentroid(this,this.featureAdapter.getCentroid(F,this),b),geometry:P.getGeometry(this,this.featureAdapter.getGeometry(F),l,b,f,p)}}else for(var N=0,G=t;N<G.length;N++){F=G[N];var M=o.getAttributes(F);M&&(y[m++]={attributes:M})}return y},p.prototype._createExceedsLimitQueryResponse=function(e){for(var t=!1,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,s=0,o=e.outStatistics;s<o.length;s++){var a=o[s];if("exceedslimit"===a.statisticType){r=null!=a.maxPointCount?a.maxPointCount:Number.POSITIVE_INFINITY,i=null!=a.maxRecordCount?a.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=a.maxVertexCount?a.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>i)t=!0;else{var u=this.hasZ?this.hasM?4:3:this.hasM?3:2,l=this.featureAdapter;t=n<this.items.reduce(function(e,t){var r=l.getGeometry(t);return e+(r&&r.coords.length||0)},0)/u}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}},p.prototype._createStatisticsQueryResponse=function(e){for(var t=new C.default(e,this.featureAdapter,this.fieldsIndex),r=e.outStatistics,i=[],n=[],s=e.groupByFieldsForStatistics,o=e.having,a=s&&s.length,u=a&&s[0],l=this.fieldsIndex.get(u),c=!l,h={},d={},f={},p={attributes:{}},y=0,m=r;y<m.length;y++){var g=m[y],v=g.outStatisticFieldName,_=g.statisticType,I="exceedslimit"!==_?g.onStatisticField:void 0,b=this.fieldsIndex.get(I),S=a&&(I===u||c)&&"count"===_;if(a){h[I]||(h[I]=this._calculateUniqueValues(t,u,l));var x=h[I];for(var F in x){var T=x[F],E=T.count,R=T.data,w=T.items;if(!o||t.validateItems(w,o)){var N=d[R]||{attributes:{}},G=null;G=S?E:(M=this._calculateStatistics(w,t,I,b))[Q="var"===_?"variance":_],N.attributes[v]=G,d[N.attributes[c?"EXPR_1":u]=R]=N}}}else{f[I]||(f[I]=this._calculateStatistics(this.items,t,I,b));var M=f[I],Q="var"===_?"variance":_;p.attributes[v]=M[Q]}n.push({name:v,alias:v,type:"esriFieldTypeDouble"})}if(a)for(var P in d)i.push(d[P]);else i.push(p);return{fields:n,features:i}},p.prototype._calculateStatistics=function(e,t,r,i){for(var n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,o=null,a=null,u=null,l=null,c=[],h=0,d=0;d<e.length;d++){var f=e[d];"string"==typeof(g=t.getFieldValue(f,r,i))?h++:null==g||isNaN(g)||(o+=g,n=Math.min(n,g),s=Math.max(s,g),c.push(g),h++)}if(h){a=o/h;for(var p=0,y=0,m=c;y<m.length;y++){var g=m[y];p+=Math.pow(g-a,2)}l=1<h?p/(h-1):0,u=Math.sqrt(l)}else s=n=null;return{avg:a,count:h,max:s,min:n,stddev:u,sum:o,variance:l}},p.prototype._calculateUniqueValues=function(e,t,r){for(var i={},n=0,s=this.items;n<s.length;n++){var o=s[n],a=e.getFieldValue(o,t,r);(null==a||"string"==typeof a&&""===a.trim())&&(a=null),null==i[a]?i[a]={count:1,data:a,items:[o]}:(i[a].count++,i[a].items.push(o))}return i},p);function p(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter}t.default=f}.apply(null,i))||(e.exports=n)},2455:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(12),r(1695)],void 0===(n=function(e,t,l,d){Object.defineProperty(t,"__esModule",{value:!0});var r=(i.prototype.getAttributes=function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)},i.prototype.getFieldValue=function(e,t,r){var i=r?r.name:t,n=null;return this._fieldDataCache.has(i)?n=this._fieldDataCache.get(i).clause:r||(n=d.getWhereClause(t,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:n})),r?this.featureAdapter.getAttribute(e,i):n.calculateValue(e,this.featureAdapter)},i.prototype.validateItem=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:d.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)},i.prototype.validateItems=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:d.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)},i.prototype._processAttributesForOutFields=function(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);for(var r={},i=0,n=t;i<n.length;i++){var s=n[i],o=this._fieldDataCache.get(s),a=o.alias,u=o.clause;r[a]=u?u.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,a)}return r},i.prototype._processAttributesForDistinctValues=function(e){if(l.isNone(e)||!this.returnDistinctValues)return e;var t=this.outFields,r=[];if(t)for(var i=0,n=t;i<n.length;i++){var s=n[i],o=this._fieldDataCache.get(s).alias;r.push(e[o])}else for(var o in e)r.push(e[o]);var a=(t||["*"]).join(",")+"="+r.join(","),u=this._returnDistinctMap.get(a)||0;return this._returnDistinctMap.set(a,++u),1<u?null:e},i);function i(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=t;var i=e.outFields;if(i&&-1===i.indexOf("*"))for(var n=0,s=0,o=this.outFields=i;s<o.length;s++){var a=o[s],u=d.getExpressionFromFieldName(a),l=this.fieldsIndex.get(u),c=l?null:d.getWhereClause(u,r),h=l?l.name:d.getAliasFromFieldName(a)||"FIELD_EXP_"+n++;this._fieldDataCache.set(a,{alias:h,clause:c})}}t.default=r}.apply(null,i))||(e.exports=n)},2456:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4)],void 0===(n=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=(i.prototype.push=function(r){var i=this;return n.create(function(e,t){i._deferreds.push({resolve:e,reject:t}),i._values.push(r)})},i.prototype.unshift=function(r){var i=this;return n.create(function(e,t){i._deferreds.unshift({resolve:e,reject:t}),i._values.unshift(r)})},Object.defineProperty(i.prototype,"length",{get:function(){return this._deferreds.length},enumerable:!0,configurable:!0}),i.prototype.process=function(){return 0!==this.length&&(this._deferreds.shift().resolve(this._values.shift()),!0)},i.prototype.cancelAll=function(){for(var e=n.createAbortError(),t=0,r=this._deferreds;t<r.length;t++)r[t].reject(e);this._deferreds.length=0,this._values.length=0},i);function i(){this._deferreds=[],this._values=[]}t.PromiseQueue=r}.apply(null,i))||(e.exports=n)}}]);