(function(){(this||window).webpackJsonp.registerAbsMids({"esri/core/MapPool":1795,"esri/views/2d/layers/features/processors/BaseProcessor":1863,"esri/views/2d/layers/features/processors/SymbolProcessor":2783,"esri/layers/support/labelFormatUtils":2784})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{1795:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(76)],void 0===(i=function(e,t,r){var n=(o.prototype.acquire=function(){return this._pool.acquire()},o.prototype.release=function(e){this._pool.release(e)},o.acquire=function(){return i.acquire()},o.release=function(e){return i.release(e)},o),i=new n(100);function o(e,t){void 0===e&&(e=50),void 0===t&&(t=50),this._pool=new r(Map,!1,function(e){return e.clear()},t,e)}return n}.apply(null,n))||(e.exports=i)},1863:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(0),r(9),r(10),r(206),r(2)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l,u=(l=s.declared(a.HandleOwner),r(c,l),c.prototype.initialize=function(){},c.prototype.destroy=function(){},Object.defineProperty(c.prototype,"supportsTileUpdates",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"spatialReference",{get:function(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null},enumerable:!0,configurable:!0}),n([s.property({readOnly:!0})],c.prototype,"supportsTileUpdates",null),n([s.property({constructOnly:!0})],c.prototype,"remoteClient",void 0),n([s.property({constructOnly:!0})],c.prototype,"service",void 0),n([s.property({dependsOn:["tileStore.tileScheme.spatialReference"]})],c.prototype,"spatialReference",null),n([s.property({constructOnly:!0})],c.prototype,"tileInfo",void 0),n([s.property({constructOnly:!0})],c.prototype,"tileStore",void 0),n([s.subclass("esri.views.2d.layers.features.processors.BaseProcessor")],c));function c(){return null!==l&&l.apply(this,arguments)||this}t.default=u}.apply(null,n))||(e.exports=i)},2783:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(0),r(5),r(9),r(10),r(6),r(14),r(3),r(1795),r(12),r(4),r(2),r(31),r(228),r(2784),r(157),r(90),r(230),r(550),r(347),r(1863)],void 0===(i=function(e,t,r,n,R,j,o,p,f,i,N,D,d,a,J,s,l,u,U,c,h,y,g){function k(e,t,r){r.has(e)||r.set(e,new Set);for(var n=r.get(e),i=t.length,o=0;o<i;o++){var a=t.charCodeAt(o);n.add(a)}}Object.defineProperty(t,"__esModule",{value:!0});var v,V=i.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor"),m=(v=a.declared(g.default),r(b,v),b.prototype.initialize=function(){this._factory=this._createFactory()},b.prototype.destroy=function(){this._visualSetPromises.clear(),this._symbolToMosaicItemMap.clear(),this.notifyChange("updating")},Object.defineProperty(b.prototype,"supportsTileUpdates",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"labelingInfo",{get:function(){return!this.config||D.isNone(this.config.labelingInfo)?null:this.config.labelingInfo.map(function(e){return s.fromJSON(e)})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"labelClassInfos",{get:function(){var e=this;return this.labelingInfo?d.all(this.labelingInfo.map(function(r,n){return o(e,void 0,void 0,function(){var t;return j(this,function(e){switch(e.label){case 0:return t={index:n,minScale:r.minScale,maxScale:r.maxScale},[4,l.createLabelFunction(r,this.service.fields,this.spatialReference)];case 1:return[2,(t.builder=e.sent(),t.symbol=r.symbol,t)]}})})})):d.resolve()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"hydrate",{get:function(){return c.createHydrateFactory(this.service.geometryType)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"renderer",{get:function(){return this.config?u.fromJSON(this.config.renderer):(f("esri-2d-debug")&&console.debug("Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"updating",{get:function(){return 0<this._visualSetPromises.size},enumerable:!0,configurable:!0}),b.prototype.update=function(r){return o(this,void 0,void 0,function(){var t;return j(this,function(e){return t=this._getMeshHash(),this._set("config",r),t!==this._getMeshHash()?this._factory=this._createFactory():this._factory.update(this.labelingInfo,this.renderer,this.tileStore.tileScheme.tileInfo),[2]})})},b.prototype.onTileData=function(n,e,t){var r,i=this,o=e.addOrUpdate,a=e.remove,s=e.clear;r=o&&o.length?this._processFeatures(n,o,e.transformParams):d.resolve();var l=t.signal,u=r.then(function(e){var t=e&&e.message||null,r=e&&e.transferList||null;return i.remoteClient.invoke("tileRenderer.onTileData",{tileKey:n.id,data:{addOrUpdate:t,remove:a,clear:s}},{transferList:r,signal:l})}).catch(function(e){return i._handleError(n,e,t)});return this._visualSetPromises.set(n,u),d.always(u,function(){return i._cleanPromise(n)}),this.notifyChange("updating"),u},b.prototype.onTileError=function(e,t,r){var n=this,i=r.signal,o=this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},{signal:i});return this._visualSetPromises.set(e,o),d.always(o,function(){return n._cleanPromise(e)}),this.notifyChange("updating"),o},b.prototype._getMeshHash=function(){var e=y.getVVFlags("visualVariables"in this.renderer&&this.renderer.visualVariables||[]);return this.renderer.getMeshHash()+"."+e},b.prototype._createFactory=function(){var r=this,e=this.service,t=e.geometryType,n=e.objectIdField,i={geometryType:t,fields:e.fields,spatialReference:J.fromJSON(this.spatialReference)},o=new U.WGLTemplateStore(function(e,t){return r.remoteClient.invoke("tileRenderer.getMaterialItems",e,t)},!1),a=this.tileStore.tileScheme.tileInfo;return this._matcher=U.createMatcher(this.renderer,o,i),new U.WGLMeshFactory(t,n,this.renderer,o,this.labelingInfo,a)},b.prototype._cleanPromise=function(e){this._visualSetPromises.delete(e),this.notifyChange("updating")},b.prototype._processFeatures=function(r,t,n){var i=this;if(!t||!t.length)return d.resolve(null);var o=this._factory,a={viewingMode:"",scale:r.scale};return this._matcher.then(function(e){return o.analyze(t,!1,e,n,a)}).then(function(t){return i._getLabelMosaicItems(r,t,n).then(function(e){return i._writeFeatures(r,t,n,e,o)})})},b.prototype._writeFeatures=function(e,t,r,n,i){for(var o=i.createMeshData(t.length),a={viewingMode:"",scale:e.scale},s=this._symbolToMosaicItemMap,l=0,u=t;l<u.length;l++){var c=u[l];try{i.write(o,c,r,a,e.level,n,s)}catch(e){f("esri-2d-debug")&&V.error(new p("mapview-mesh-factory","Failed to write feature",{feature:c}))}}return this._encodeDisplayData(o)},b.prototype._encodeDisplayData=function(e){var t={},r=new Array;return e.encode(t,r),{message:t,transferList:r}},b.prototype._handleError=function(e,t,r){var n=r.signal;if(!d.isAbortError(t))return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t.message},{signal:n})},b.prototype._getLabelMosaicItems=function(r,n,i){return o(this,void 0,void 0,function(){var t,l,u,c,o,a;return j(this,function(e){switch(e.label){case 0:return t=N.acquire(),[4,this._createLabelFeatures(r.scale,n,t,i)];case 1:return l=e.sent(),u=this._symbolToMosaicItemMap,c=N.acquire(),o=[],a=0,t.forEach(function(e,t){if(u.has(t.id)){var r=u.get(t.id).glyphMosaicItems,n=[];e.forEach(function(e){(r&&r.length<e||!r[e])&&(n[e]=e)}),0<n.length&&(c.set(a,t),o.push({symbol:t.toJSON(),id:a,glyphIds:n}),a++)}else{c.set(a,t);var i=[];e.forEach(function(e){return i.push(e)}),o.push({symbol:t.toJSON(),id:a,glyphIds:i}),a++}}),0<o.length?[2,this.remoteClient.invoke("tileRenderer.getMaterialItems",o).then(function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t],i=c.get(n.id);if(i)if(h.isTextSymbol(i))if(u.has(i.id)){var o=u.get(i.id).glyphMosaicItems,a=n.mosaicItem.glyphMosaicItems;if(a)for(var s=0;s<a.length;s++)null!=a[s]&&(o[s]=a[s])}else u.set(i.id,n.mosaicItem);else u.set(i.id,n.mosaicItem)}return N.release(c),l})]:(N.release(t),[2,d.resolve(l)])}})})},b.prototype._getLabelClassInfosForScale=function(n){return o(this,void 0,void 0,function(){return j(this,function(e){switch(e.label){case 0:return[4,this.labelClassInfos];case 1:return[2,e.sent().filter(function(e){var t=e.minScale,r=e.maxScale;return(!t||n<=t||0===t)&&(!r||r<=n||0===r)})]}})})},b.prototype._createLabelFeatures=function(x,L,C,E){return o(this,void 0,void 0,function(){var t,r,n,i,o,a,s,l,u,c,p,f,d,h,y,g,v,m,b,_,w,I,S,O,M,P,F,T;return j(this,function(e){switch(e.label){case 0:return this.labelingInfo&&L&&0!==L.length?[4,this._getLabelClassInfosForScale(x)]:[2,null];case 1:if(0===(t=e.sent()).length)return[2,null];for(r=N.acquire(),n=new U.CollisionGrid(U.definitions.COLLISION_EARLY_REJECT_BUCKET_SIZE),i=0,o=L;i<o.length;i++)if(a=o[i],s=this.service.geometryType,u=l=0,"esriGeometryPoint"!==s&&"esriGeometryPolygon"!==s||(u="esriGeometryPoint"===s?(c=a.geometry,l=c.x,c.y):(l=a.centroid.x,a.centroid.y),!n.checkOverlap(l,u))){for(p=a.localId,f=new Array,d=0;d<t.length;d++){if(h=t[d],y=h.index,g=h.builder,v=h.symbol,!E)return V.error("mapview-labeling","Tried to evaluate geometry expression but no transformation found"),[2,void 0];b=E.transform,_=E.hasZ,w=E.hasM,I=this.hydrate(a.geometry,b,_,w),S=R({},a,{geometry:I}),I.spatialReference=J.fromJSON(this.spatialReference),m=S,O=g.evaluate(m),D.isNone(O)||""===O||(U.definitions.DEBUG_LABELS&&(M="-"+p,O=O.substring(0,O.length-M.length)+M),P=U.bidiText(O),F=P[0],T=P[1],k(v,F,C),f.push({text:F,rtl:T,id:y}))}r.set(p,f)}return[2,r]}})})},n([a.property({readOnly:!0})],b.prototype,"supportsTileUpdates",null),n([a.property()],b.prototype,"config",void 0),n([a.property({dependsOn:["config"]})],b.prototype,"labelingInfo",null),n([a.property({dependsOn:["labelingInfo","service","spatialReference"]})],b.prototype,"labelClassInfos",null),n([a.property({dependsOn:["service"]})],b.prototype,"hydrate",null),n([a.property({dependsOn:["config"],readOnly:!0})],b.prototype,"renderer",null),n([a.property({readOnly:!0})],b.prototype,"updating",null),n([a.subclass("esri.views.2d.layers.features.processors.SymbolProcessor")],b));function b(){var e=null!==v&&v.apply(this,arguments)||this;return e._symbolToMosaicItemMap=new Map,e._visualSetPromises=new Map,e.type="symbol",e}t.default=m}.apply(null,n))||(e.exports=i)},2784:function(e,t,O){var r,n;r=[O.dj.c(e.i),t,O(0),O(1),O(9),O(10),O(6),O(3),O(4),O(133),O(226),O(488),O(57),O(82)],void 0===(n=function(e,t,r,n,f,d,h,i,y,g,v,m,b,_){function w(e,t,r,n){var i=b.getField(n,e);if(!i)return t;if(null==r[i.name])return"";var o=i.domain;if(o)if("codedValue"===o.type||"coded-value"===o.type)for(var a=r[i.name],s=0,l=o.codedValues;s<l.length;s++){var u=l[s];if(u.code===a)return u.name}else if("range"===o.type){var c=+r[i.name],p="range"in o?o.range[0]:o.minValue,f="range"in o?o.range[1]:o.maxValue;if(p<=c&&c<=f)return o.name}var d=r[i.name];return"date"===i.type||"esriFieldTypeDate"===i.type?d=g.formatDate(d,g.convertDateFormatToIntlOptions("short-date")):b.isNumericField(i)&&(d=v.formatNumber(+d)),d||""}Object.defineProperty(t,"__esModule",{value:!0});var I=i.getLogger("esri.layers.support.labelFormatUtils"),S={type:"simple",evaluate:function(){return null}};t.createLabelFunction=function(u,c,p){return d(this,void 0,void 0,function(){var t,r,n,i,o,a,s,l;return f(this,function(e){switch(e.label){case 0:return u&&u.symbol?(t=u.where,r=u.getLabelExpression(),t?[4,function(){return d(this,void 0,void 0,function(){return f(this,function(e){return[2,y.create(function(t){O.e(0).then(function(){var e=[O(1570)];t.apply(null,e)}.bind(this)).catch(O.oe)})]})})}()]:[3,2]):[2,S];case 1:return i=e.sent(),[3,3];case 2:i=null,e.label=3;case 3:return n=i,"arcade"!==r.type?[3,5]:[4,_.createLabelExpression(r.expression,p,c)];case 4:return a=e.sent(),o={type:"arcade",evaluate:function(e){try{var t=a.evaluate({$feature:a.repurposeFeature(e)});if(null!=t)return t.toString()}catch(t){return I.error(new h("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:e,expression:r})),null}return null}},[3,6];case 5:o={type:"simple",evaluate:function(e){var t=e&&e.attributes;return t?r.expression.replace(/{[^}]*}/g,function(e){return w(e.slice(1,-1),e,t,c)}):null}},e.label=6;case 6:if(t){try{s=n.WhereClause.create(t,new m(c))}catch(e){return[2,S]}l=o.evaluate,o.evaluate=function(e){return s.testFeature(e)?l(e):null}}return[2,o]}})})},t.formatField=w}.apply(null,r))||(e.exports=n)}}]);