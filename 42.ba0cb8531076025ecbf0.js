(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/engine/vectorTiles/WorkerTileHandler":1601,"esri/views/2d/engine/vectorTiles/Bucket":1716,"esri/views/2d/engine/vectorTiles/BackgroundBucket":1897,"esri/views/2d/engine/vectorTiles/CircleBucket":1898,"esri/views/2d/engine/vectorTiles/FillBucket":1899,"esri/views/2d/engine/vectorTiles/MemoryBuffer":1900,"esri/views/2d/engine/vectorTiles/LineBucket":1901,"esri/views/2d/engine/vectorTiles/Placement":1902,"esri/views/2d/engine/vectorTiles/SymbolBucket":1903,"esri/views/2d/tiling/enums":1904,"esri/views/2d/engine/vectorTiles/WorkerTile":2425,"esri/views/2d/engine/vectorTiles/IndexMemoryBuffer":2426,"esri/views/2d/engine/vectorTiles/Conflict":2427,"esri/views/2d/engine/vectorTiles/TileParser":2428,"esri/views/2d/engine/vectorTiles/Feature":2429,"esri/views/2d/engine/vectorTiles/SourceLayerData":2430,"esri/views/2d/engine/vectorTiles/VertexMemoryBuffer":2431})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{1601:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(4),r(2425),r(546)],void 0===(i=function(e,t,s,f,n){return r.prototype.reset=function(){this._spriteInfo={},this._glyphInfo={};var e=this._tiles;return e.forEach(function(e){return e.setObsolete()}),e.clear(),s.resolve()},r.prototype.getLayers=function(){return this._layers},r.prototype.setLayers=function(e){var t=new n(e);return this._layers=t.layers,s.resolve({data:""})},r.prototype.createTileAndParse=function(e,t){for(var r=this,n=e.key,i=new f,o={},a=0,s=Object.keys(e.sourceName2DataAndRefKey);a<s.length;a++){var l=s[a],u=e.sourceName2DataAndRefKey[l];o[l]=u.refKey}return i.initialize(n,o,this,e.rotation),i.setDataAndParse(e.sourceName2DataAndRefKey,t).then(function(e){return r._tiles.set(n,i),e}).catch(function(e){throw i.setObsolete(),i.release(),e})},r.prototype.updateSymbols=function(e,t){var r=this._tiles.get(e.key);return r?r.updateSymbols(e.rotation,t):s.reject()},r.prototype.updateStyle=function(e,r){var t=new n(e);return this._layers=t.layers,this._tiles.forEach(function(t){t.reparse(r).then(function(e){r.client.invoke("updateTileData",{tileId:t.tileKey,tileData:e.result})})}),s.resolve({data:""})},r.prototype.destructTileData=function(e){return this._tiles.has(e)&&(this._tiles.get(e).release(),this._tiles.delete(e)),s.resolve()},r.prototype.fetchSprites=function(e,t,r){var n=[],i=this._spriteInfo;return e.forEach(function(e){void 0===i[e]&&n.push(e)}),0===n.length?s.resolve():t.invoke("getSprites",n,{signal:r&&r.signal}).then(function(e){for(var t in e){var r=e[t];i[t]=r}})},r.prototype.getSpriteItems=function(){return this._spriteInfo},r.prototype.fetchGlyphs=function(e,t,r,n,i){var o=[],a=this._glyphInfo[t];return a?r.forEach(function(e){a[e]||o.push(e)}):(a=this._glyphInfo[t]=[],r.forEach(function(e){return o.push(e)})),0===o.length?s.resolve():n.invoke("getGlyphs",{tileID:e,font:t,codePoints:o},i).then(function(e){for(var t=0;t<e.length;t++)e[t]&&(a[t]=e[t])})},r.prototype.getGlyphItems=function(e){return this._glyphInfo[e]},r;function r(){this._tiles=new Map,this._spriteInfo={},this._glyphInfo={}}}.apply(null,n))||(e.exports=i)},1716:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return r.prototype.pushFeature=function(e){this._filter.filter(e)&&this._features.push(e)},r.prototype.hasFeatures=function(){return 0<this._features.length},r;function r(e,t){this.layerExtent=4096,this._features=[],this.layer=e,this.zoom=t,this._filter=e.getFeatureFilter()}}.apply(null,n))||(e.exports=i)},1897:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(1716)],void 0===(i=function(e,t,r,n){return r(i,o=n),i.prototype.processFeatures=function(){},i.prototype.assignBufferInfo=function(){},i;function i(e,t){return o.call(this,e,t)||this}var o}.apply(null,n))||(e.exports=i)},1898:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(1716)],void 0===(i=function(e,t,r,n){return r(i,o=n),Object.defineProperty(i.prototype,"circleIndexStart",{get:function(){return this._circleIndexStart},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"circleIndexCount",{get:function(){return this._circleIndexCount},enumerable:!0,configurable:!0}),i.prototype.assignBufferInfo=function(e){var t=e;t._circleIndexStart=this._circleIndexStart,t._circleIndexCount=this._circleIndexCount},i.prototype.processFeatures=function(e){var t=this._circleVertexBuffer,r=this._circleIndexBuffer;this._circleIndexStart=r.index,this._circleIndexCount=0;var n=this.layer,i=this.zoom;e&&e.setExtent(this.layerExtent);for(var o=1,a=[1,1,1,1],s=1,l=0,u=1,f=[1,1,1,1],c=1,h=0,x=this._features;h<x.length;h++){var d=x[h],p=d.getGeometry(e);if(p){n.hasDataDrivenRadius&&(o=n.getPaintValue("circle-radius",i,d)),n.hasDataDrivenColor&&(a=n.getPaintValue("circle-color",i,d)),n.hasDataDrivenOpacity&&(s=n.getPaintValue("circle-opacity",i,d)),n.hasDataDrivenStrokeWidth&&(u=n.getPaintValue("circle-stroke-width",i,d)),n.hasDataDrivenStrokeColor&&(f=n.getPaintValue("circle-stroke-color",i,d)),n.hasDataDrivenStrokeOpacity&&(c=n.getPaintValue("circle-stroke-opacity",i,d)),n.hasDataDrivenBlur&&(l=n.getPaintValue("circle-blur",i,d));for(var y=0,_=p;y<_.length;y++){var v=_[y];if(v)for(var g=0,m=v;g<m.length;g++){var I=m[g],V=t.index;t.add(I.x,I.y,0,0,o,a,s,l,u,f,c),t.add(I.x,I.y,0,1,o,a,s,l,u,f,c),t.add(I.x,I.y,1,0,o,a,s,l,u,f,c),t.add(I.x,I.y,1,1,o,a,s,l,u,f,c),r.add(V+0,V+1,V+2),r.add(V+1,V+2,V+3),this._circleIndexCount+=6}}}}},i;function i(e,t,r,n){var i=o.call(this,e,t)||this;return i._circleVertexBuffer=r,i._circleIndexBuffer=n,i}var o}.apply(null,n))||(e.exports=i)},1899:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(161),r(345),r(1716),r(315)],void 0===(i=function(e,t,r,m,I,n,D){return r(u,s=n),Object.defineProperty(u.prototype,"fillIndexStart",{get:function(){return this._fillIndexStart},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"fillIndexCount",{get:function(){return this._fillIndexCount},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"outlineIndexStart",{get:function(){return this._outlineIndexStart},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"outlineIndexCount",{get:function(){return this._outlineIndexCount},enumerable:!0,configurable:!0}),u.prototype.assignBufferInfo=function(e){var t=e;t._fillIndexStart=this._fillIndexStart,t._fillIndexCount=this._fillIndexCount,e.layer.getPaintProperty("fill-outline-color")?(t._outlineIndexStart=this._outlineIndexStart,t._outlineIndexCount=this._outlineIndexCount):(t._outlineIndexStart=0,t._outlineIndexCount=0)},u.prototype.processFeatures=function(e){this._fillIndexStart=this._fillIndexBuffer.index,this._fillIndexCount=0,this._outlineIndexStart=this._outlineIndexBuffer.index,this._outlineIndexCount=0;var t=this.layer,r=this.zoom,n=t.hasDataDrivenFill,i=t.hasDataDrivenOutline;e&&e.setExtent(this.layerExtent);var o=t.getPaintValue("fill-pattern",r),a=t.getPaintValue("fill-antialias",r)&&void 0===o,s=[1,1,1,1],l=[1,1,1,1],u=1;if(t.outlineUsesFillColor){if(a&&!t.hasDataDrivenOpacity){var f=t.getPaintValue("fill-opacity",r),c=t.getPaintValue("fill-opacity",r+1);f<1&&c<1&&(a=!1)}if(a&&!t.hasDataDrivenColor){var h=t.getPaintValue("fill-color",r),x=t.getPaintValue("fill-color",r+1);h[3]<1&&x[3]<1&&(a=!1)}}for(var d=0,p=this._features;d<p.length;d++){var y=p[d];!o&&t.hasDataDrivenColor&&(s=t.getPaintValue("fill-color",r,y)),t.hasDataDrivenOpacity&&(u=t.getPaintValue("fill-opacity",r,y)),!o&&t.hasDataDrivenOutlineColor&&(l=t.getPaintValue("fill-outline-color",r,y));var _=void 0;n&&(_={color:s,opacity:u});var v=void 0;i&&(v={color:t.outlineUsesFillColor?s:l,opacity:u});var g=y.getGeometry(e);this._processFeature(g,a,t.outlineUsesFillColor,_,v)}},u.prototype._processFeature=function(e,t,r,n,i){if(e){var o,a=e.length;if(t&&(!r||!i||i.color[3]*i.opacity==1))for(var s=0;s<a;s++)this._processOutline(e[s],i);for(s=0;s<a;s++){var l=u._area(e[s]);128<l?(void 0!==o&&this._processFill(e,o,n),o=[s]):l<-128&&void 0!==o&&o.push(s)}void 0!==o&&this._processFill(e,o,n)}},u.prototype._processOutline=function(e,t){var r,n,i,o=this._outlineVertexBuffer,a=this._outlineIndexBuffer,s=a.index,l=new D.Point(0,0),u=new D.Point(0,0),f=new D.Point(0,0),c=-1,h=-1,x=-1,d=-1,p=-1,y=!1,_=e.length;if(!(_<2)){for(var v=e[0],g=e[_-1];_&&g.isEqual(v);)g=e[--_-1];if(!(_-0<2)){for(var m=0;m<_;++m){0===m?(r=e[_-1],n=e[0],i=e[1],l.assignSub(n,r),l.normalize(),l.rightPerpendicular()):(r=n,n=i,i=m!==_-1?e[m+1]:e[0],l.assign(u));var I=this._isClipEdge(r,n);-1===d&&(y=I),u.assignSub(i,n),u.normalize(),u.rightPerpendicular();var V=l.x*u.y-l.y*u.x;f.assignAdd(l,u),f.normalize();var B=-f.x*-l.x+-f.y*-l.y,b=Math.abs(0!=B?1/B:1);8<b&&(b=8),0<=V?(x=o.add(n.x,n.y,l.x,l.y,0,1,t),-1===d&&(d=x),0<=c&&0<=h&&0<=x&&!I&&a.add(c,h,x),h=o.add(n.x,n.y,b*-f.x,b*-f.y,0,-1,t),-1===p&&(p=h),0<=c&&0<=h&&0<=x&&!I&&a.add(c,h,x),c=h,h=x,x=o.add(n.x,n.y,f.x,f.y,0,1,t),0<=c&&0<=h&&0<=x&&!I&&a.add(c,h,x),h=o.add(n.x,n.y,u.x,u.y,0,1,t),0<=c&&0<=h&&0<=x&&!I&&a.add(c,h,x)):(x=o.add(n.x,n.y,b*f.x,b*f.y,0,1,t),-1===d&&(d=x),0<=c&&0<=h&&0<=x&&!I&&a.add(c,h,x),h=o.add(n.x,n.y,-l.x,-l.y,0,-1,t),-1===p&&(p=h),0<=c&&0<=h&&0<=x&&!I&&a.add(c,h,x),c=h,h=x,x=o.add(n.x,n.y,-f.x,-f.y,0,-1,t),0<=c&&0<=h&&0<=x&&!I&&a.add(c,h,x),0<=(c=o.add(n.x,n.y,-u.x,-u.y,0,-1,t))&&0<=h&&0<=x&&!I&&a.add(c,h,x))}0<=c&&0<=h&&0<=d&&!y&&a.add(c,h,d),0<=c&&0<=d&&0<=p&&!y&&a.add(c,p,d),this._outlineIndexCount+=3*(a.index-s)}}},u.prototype._processFill=function(e,t,r){var n;1<t.length&&(n=[]);for(var i=0,o=0,a=t;o<a.length;o++){var s=a[o];0!==i&&n.push(i),i+=e[s].length}for(var l=2*i,u=m.acquire(),f=0,c=t;f<c.length;f++)for(var h=e[s=c[f]],x=h.length,d=0;d<x;++d)u.push(h[d].x),u.push(h[d].y);var p=I(u,n,2),y=p.length;if(0<y){for(var _=this._fillVertexBuffer.index,v=0;v<l;)this._fillVertexBuffer.add(u[v++],u[v++],r);for(var g=0;g<y;)this._fillIndexBuffer.add(_+p[g++],_+p[g++],_+p[g++]);this._fillIndexCount+=y}m.release(u)},u.prototype._isClipEdge=function(e,t){return e.x===t.x?e.x<=-64||4160<=e.x:e.y===t.y&&(e.y<=-64||4160<=e.y)},u._area=function(e){for(var t=0,r=e.length-1,n=0;n<r;n++)t+=(e[n].x-e[n+1].x)*(e[n].y+e[n+1].y);return.5*(t+(e[r].x-e[0].x)*(e[r].y+e[0].y))},u;function u(e,t,r,n,i,o){var a=s.call(this,e,t)||this;if(e.hasDataDrivenFill!==r.isDataDriven())throw new Error("incompatible fill buffer");if(e.hasDataDrivenOutline!==i.isDataDriven())throw new Error("incompatible outline buffer");return a._fillVertexBuffer=r,a._fillIndexBuffer=n,a._outlineVertexBuffer=i,a._outlineIndexBuffer=o,a}var s}.apply(null,n))||(e.exports=i)},1900:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return Object.defineProperty(r.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"index",{get:function(){return 4*this._array.length/this._stride},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"itemSize",{get:function(){return this._stride},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sizeInBytes",{get:function(){return 4*this._array.length},enumerable:!0,configurable:!0}),r.prototype.reset=function(){this.array.length=0},r.prototype.toBuffer=function(){return new Uint32Array(this._array).buffer},r.i1616to32=function(e,t){return 65535&e|t<<16},r.i8888to32=function(e,t,r,n){return 255&e|(255&t)<<8|(255&r)<<16|n<<24},r.i8816to32=function(e,t,r){return 255&e|(255&t)<<8|r<<16},r;function r(e){this._array=[],e<=0&&console.error("strideInBytes must be positive!"),this._stride=e}}.apply(null,n))||(e.exports=i)},1901:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(14),r(96),r(1716),r(525),r(348),r(84)],void 0===(i=function(e,t,r,l,b,n,x,D,d){var u=0,f=0,c=0;l("esri-tiles-performance")&&setInterval(function(){console.log("New (VTL)","feat="+c,"secs="+u,"tris="+f,"tris/sec="+Math.round(f/u))},1e4);var h;return r(i,h=n),Object.defineProperty(i.prototype,"lineIndexStart",{get:function(){return this._lineIndexStart},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lineIndexCount",{get:function(){return this._lineIndexCount},enumerable:!0,configurable:!0}),i.prototype.assignBufferInfo=function(e){var t=e;t._lineIndexStart=this._lineIndexStart,t._lineIndexCount=this._lineIndexCount},i.prototype.processFeatures=function(e){this._lineIndexStart=this.tessellationProperties._lineIndexBuffer.index,this._lineIndexCount=0;var t=this.layer,r=this.zoom,n=t.hasDataDrivenLine;e&&e.setExtent(this.layerExtent);for(var i=[1,1,1,1],o=1,a=1,s=0,l=this._features;s<l.length;s++){var u=l[s],f=new x.LineLayout(t,r,u);!this.tessellationProperties._hasPattern&&t.hasDataDrivenColor&&(i=t.getPaintValue("line-color",r,u)),t.hasDataDrivenOpacity&&(o=t.getPaintValue("line-opacity",r,u)),t.hasDataDrivenWidth&&(a=t.getPaintValue("line-width",r,u));var c=void 0;if(!n||!((c={color:i,opacity:o,size:Math.max(Math.min(a,256),0)}).size<=0||c.opacity<=0||c.color[3]<=0)){this.tessellationProperties._capType=f.cap,this.tessellationProperties._joinType=f.join,this.tessellationProperties._miterLimitCosine=d.getLimitCosine(f.miterLimit),this.tessellationProperties._roundLimitCosine=d.getLimitCosine(f.roundLimit);var h=u.getGeometry(e);this._processFeature(h,c)}}D.cleanup()},i.prototype._processFeature=function(e,t){if(e)for(var r=e.length,n=0;n<r;n++)this._processGeometry(e[n],t)},i.prototype._processGeometry=function(e,t){var r;if(l("esri-tiles-performance")&&(r=performance.now()),!(e.length<2)){for(var n,i,o=e[0],a=1;a<e.length;)(n=e[a].x-o.x)*n+(i=e[a].y-o.y)*i<1e-6?e.splice(a,1):(o=e[a],++a);if(!(e.length<2)){var s=this.tessellationProperties._lineIndexBuffer.index;this._tessellationOptions.trackDistance=this.tessellationProperties._hasPattern,this._tessellationOptions.initialDistance=0,this._tessellationOptions.thin=this._isThinLine,this._tessellationOptions.wrapDistance=65535,this._tessellationOptions.outerBisectorAutoSplitThreshold=1/3.8,this._tessellationOptions.enableOuterBisectorSplit=this.tessellationProperties._hasPattern,this._tessellationOptions.innerBisectorAutoSplitThreshold=1/3.8,this._tessellationOptions.enableInnerBisectorSplit=this.tessellationProperties._hasPattern,this.tessellationProperties._ddValues=t,D.tessellate(e,this._tessellationOptions,this._tessellationCallbacks),this._lineIndexCount+=3*(this.tessellationProperties._lineIndexBuffer.index-s),l("esri-tiles-performance")&&(u+=(performance.now()-r)/1e3,f+=this.tessellationProperties._lineIndexBuffer.index-s,c++)}}},i;function i(e,t,r,n){var i,B,o,a,s=h.call(this,e,t)||this;if(s._tessellationOptions={},s.tessellationProperties={_lineVertexBuffer:null,_lineIndexBuffer:null,_hasPattern:null,_ddValues:null,_capType:null,_joinType:null,_miterLimitCosine:null,_roundLimitCosine:null},e.hasDataDrivenLine!==r.isDataDriven())throw new Error("incompatible line buffer");return s.tessellationProperties._lineVertexBuffer=r,s.tessellationProperties._lineIndexBuffer=n,s.tessellationProperties._hasPattern=e.getPaintValue("line-pattern",s.zoom)||0<e.getPaintValue("line-dasharray",s.zoom).length,s._isThinLine=e.isThinLine,s._isThinLine?s._tessellationCallbacks={vertex:(a=s.tessellationProperties,function(e){e.entry0=a._lineVertexBuffer.index,a._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance,a._ddValues),e.entry2=a._lineVertexBuffer.index,a._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance,a._ddValues),e.exit0=a._lineVertexBuffer.index,a._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance,a._ddValues),e.exit2=a._lineVertexBuffer.index,a._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance,a._ddValues)}),bridge:(o=s.tessellationProperties,function(e){o._lineIndexBuffer.add(e.leftExit0,e.rightEntry0,e.leftExit2),o._lineIndexBuffer.add(e.rightEntry0,e.rightEntry2,e.leftExit2)})}:s._tessellationCallbacks={vertex:(B=s.tessellationProperties,function(e){var t,r=B._joinType===b.JoinType.MITER?B._miterLimitCosine:B._roundLimitCosine,n=e.isCap&&B._capType!==b.CapType.BUTT,i=!1;if(.97<e.cosine?(e.exit0=e.entry0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance,B._ddValues),e.exit2=e.entry2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance,B._ddValues)):e.cosine<1-.97?(e.entry0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance,B._ddValues),e.entry2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance,B._ddValues),e.exit0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance,B._ddValues),e.exit2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance,B._ddValues)):e.canSplit?(D.splitVertex(),0<e.sign?(e.splitInner?(e.exit0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.leftInner.x,e.leftInner.y,0,-1,e.distance,B._ddValues),e.entry0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.rightInner.x,e.rightInner.y,0,-1,e.distance,B._ddValues)):(e.exit0=e.entry0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance,B._ddValues)),e.cosine<r?(i=!e.isCap,e.entry2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance,B._ddValues),e.exit2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance,B._ddValues)):e.splitOuter?(i=i||e.gapOuter,e.entry2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.leftOuter.x,-e.leftOuter.y,0,1,e.distance,B._ddValues),e.exit2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.rightOuter.x,-e.rightOuter.y,0,1,e.distance,B._ddValues)):(e.entry2=e.exit2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance,B._ddValues))):(e.splitInner?(e.exit2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.leftInner.x,-e.leftInner.y,0,1,e.distance,B._ddValues),e.entry2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.rightInner.x,-e.rightInner.y,0,1,e.distance,B._ddValues)):(e.exit2=e.entry2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance,B._ddValues)),e.cosine<r?(i=!e.isCap,e.entry0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance,B._ddValues),e.exit0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance,B._ddValues)):e.splitOuter?(i=i||e.gapOuter,e.entry0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.leftOuter.x,e.leftOuter.y,0,-1,e.distance,B._ddValues),e.exit0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.rightOuter.x,e.rightOuter.y,0,-1,e.distance,B._ddValues)):(e.exit0=e.entry0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance,B._ddValues)))):0<e.sign?(e.exit0=e.entry0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance,B._ddValues),e.cosine<r?(i=!e.isCap,e.entry2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance,B._ddValues),e.exit2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance,B._ddValues)):(e.entry2=e.exit2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance,B._ddValues))):(e.exit2=e.entry2=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance,B._ddValues),e.cosine<r?(i=!e.isCap,e.entry0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance,B._ddValues),e.exit0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance,B._ddValues)):(e.exit0=e.entry0=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance,B._ddValues))),e.canSplit&&(e.splitInner||e.splitOuter)||i||n?(t=e.entry1=e.exit1=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,0,0,0,0,e.distance,B._ddValues)):t=e.entry1=e.exit1=null,i&&B._joinType!==b.JoinType.ROUND)B._lineIndexBuffer.add(t,0<e.sign?e.exit2:e.entry0,0<e.sign?e.entry2:e.exit0);else if(n&&B._capType===b.CapType.ROUND||i&&B._joinType===b.JoinType.ROUND){var o,a=void 0,s=void 0,l=void 0,u=void 0,f=void 0,c=void 0;e.isCap?(c=(o=Math.PI)/(f=Math.ceil(o/.8)),e.isFirstVertex?(a=e.prevNormal.x,s=e.prevNormal.y,l=e.entry0,u=e.entry2):e.isLastVertex&&(a=-e.nextNormal.x,s=-e.nextNormal.y,l=e.exit2,u=e.exit0)):(c=(o=2*Math.acos(e.cosine))/(f=Math.ceil(o/.8)),a=0<e.sign?-e.prevNormal.x:e.nextNormal.x,s=0<e.sign?-e.prevNormal.y:e.nextNormal.y,l=0<e.sign?e.entry2:e.exit0,u=0<e.sign?e.exit2:e.entry0);var h=Math.cos(c),x=Math.sin(c),d=x*a+h*s;a=h*a-x*s,s=d;for(var p=void 0,y=void 0,_=0;_<f;++_){if(p=y,_<f-1)if(e.isCap){var v=e.isFirstVertex?-1:1;y=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,a,s,v,0,e.distance,B._ddValues)}else y=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,a,s,0,e.sign,e.distance,B._ddValues);B._lineIndexBuffer.add(0===_?l:p,t,_===f-1?u:y);var g=x*a+h*s;a=h*a-x*s,s=g}}else if(n&&B._capType===b.CapType.SQUARE){var m=e.isFirstVertex?1:-1,I=void 0,V=void 0;B._hasPattern?(I=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.prevNormal.x-m*e.inbound.x,e.prevNormal.y-m*e.inbound.y,-m,-1,e.distance,B._ddValues),V=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.prevNormal.x-m*e.inbound.x,-e.prevNormal.y-m*e.inbound.y,-m,1,e.distance,B._ddValues)):(I=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,e.prevNormal.x-m*e.inbound.x,e.prevNormal.y-m*e.inbound.y,0,-1,e.distance,B._ddValues),V=B._lineVertexBuffer.index,B._lineVertexBuffer.add(e.currentVertex.x,e.currentVertex.y,-e.prevNormal.x-m*e.inbound.x,-e.prevNormal.y-m*e.inbound.y,0,1,e.distance,B._ddValues)),0<m?(B._lineIndexBuffer.add(t,e.entry2,V),B._lineIndexBuffer.add(t,V,I),B._lineIndexBuffer.add(t,I,e.entry0)):(B._lineIndexBuffer.add(t,V,e.exit2),B._lineIndexBuffer.add(t,I,V),B._lineIndexBuffer.add(t,e.exit0,I))}}),bridge:(i=s.tessellationProperties,function(e){i._lineIndexBuffer.add(e.leftExit0,e.rightEntry0,null!=e.leftExit1?e.leftExit1:e.leftExit2),i._lineIndexBuffer.add(e.rightEntry0,null!=e.rightEntry1?e.rightEntry1:e.rightEntry2,null!=e.leftExit1?e.leftExit1:e.leftExit2),null!=e.leftExit1&&null!=e.rightEntry1?(i._lineIndexBuffer.add(e.leftExit1,e.rightEntry1,e.leftExit2),i._lineIndexBuffer.add(e.rightEntry1,e.rightEntry2,e.leftExit2)):null!=e.leftExit1?i._lineIndexBuffer.add(e.leftExit1,e.rightEntry2,e.leftExit2):null!=e.rightEntry1&&i._lineIndexBuffer.add(e.rightEntry1,e.rightEntry2,e.leftExit2)})},s}}.apply(null,n))||(e.exports=i)},1902:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2427),r(312),r(315)],void 0===(i=function(e,t,re,ne,ie){Object.defineProperty(t,"__esModule",{value:!0});function r(e,t,r,n,i){void 0===r&&(r=0),void 0===n&&(n=-1),void 0===i&&(i=le),this.x=e,this.y=t,this.angle=r,this.segment=n,this.minzoom=i}t.Anchor=r;var oe=function(e,t,r,n,i,o,a){void 0===i&&(i=!1),void 0===o&&(o=le),void 0===a&&(a=ne.C_INFINITY),this.anchor=e,this.labelAngle=t,this.glyphAngle=r,this.page=n,this.upsideDown=i,this.minzoom=o,this.maxzoom=a},ae=function(e,t,r,n,i,o,a,s,l,u){this.tl=e,this.tr=t,this.bl=r,this.br=n,this.mosaicRect=i,this.labelAngle=o,this.anchor=a,this.minzoom=s,this.maxzoom=l,this.page=u};t.PlacedSymbol=ae;var se=function(e,t){this.footprint=e,this.shapes=t};t.Placement=se;var le=.5,n=(i.prototype.reset=function(){this._conflictEngine.reset()},i.prototype.setAngle=function(e){this.mapAngle=e},i.prototype.getIconPlacement=function(e,t,r,n,i){var o=r.width/r.pixelRatio,a=r.height/r.pixelRatio,s=i.offset[0]-o/2,l=i.offset[1]-a/2,u=s+o,f=l+a,c=r.rect,h=2/r.pixelRatio,x=s-h,d=l-h,p=x+c.width/r.pixelRatio,y=d+c.height/r.pixelRatio,_=new ie.Point(x,d),v=new ie.Point(p,y),g=new ie.Point(x,y),m=new ie.Point(p,d),I=i.rotate*ne.C_DEG_TO_RAD,V=1===i.rotationAlignment;if(0<=e.segment&&!V&&(I+=e.angle),0!==I){var B=Math.cos(I),b=Math.sin(I);_.rotate(B,b),v.rotate(B,b),g.rotate(B,b),m.rotate(B,b)}var D=8*i.padding,w=new ie.Point(e.x,e.y),P=new re.Footprint(this.mapAngle,D,V);P.addBox(w,new re.Box(s,l,u,f),n,I,t,le,ne.C_INFINITY);var T=new ae(_,m,g,v,c,0,w,le,ne.C_INFINITY,0),E=new se(P,[T]),M=le;return i.allowOverlap||(M=this._conflictEngine.getMinZoom(E.footprint,M)),P.minzoom=M,E},i.prototype.getTextPlacement=function(e,t,r,n,i,o,a){for(var s,l=new ie.Point(e.x,e.y),u=a.rotate*ne.C_DEG_TO_RAD,f=0===a.rotationAlignment,c=a.keepUpright,h=le,x=!f,d=x?0:e.angle,p=0<=e.segment&&f,y=8*a.padding,_=new re.Footprint(this.mapAngle,y,x),v=[],g=!p,m=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY,V=m,B=I,b=p?c:f&&c,D=0,w=n;D<w.length;D++){var P=w[D],T=P.glyphMosaicItem;if(T&&!T.rect.isEmpty){var E=T.rect,M=T.metrics,z=T.page;g&&(s&&s!==P.y&&(_.addBox(l,new re.Box(m,V,I,B),i,u,t,le,ne.C_INFINITY),V=m=Number.POSITIVE_INFINITY,B=I=Number.NEGATIVE_INFINITY),s=P.y);var C=[];if(p){var N=.5*T.metrics.width,S=(r.x+P.x+M.left-4+N)*i;if(h=this._placeGlyph(e,h,S,o,e.segment,1,z,C),c&&(h=this._placeGlyph(e,h,S,o,e.segment,-1,z,C)),2<=h)break}else C.push(new oe(l,d,d,z)),f&&c&&C.push(new oe(l,d+ne.C_PI,d+ne.C_PI,z,!0));for(var k=P.x+r.x+M.left,A=P.y+r.y-M.top,L=k+M.width,O=A+M.height,F=new ie.Point(k-4,A-4),j=new ie.Point(F.x+E.width,F.y+E.height),R=new ie.Point(F.x,j.y),G=new ie.Point(j.x,F.y),U=0,Y=C;U<Y.length;U++){var K=Y[U],Z=F.clone(),H=R.clone(),q=G.clone(),W=j.clone(),J=A,X=O,Q=K.glyphAngle+u;if(0!==Q){var $=Math.cos(Q),ee=Math.sin(Q);Z.rotate($,ee),W.rotate($,ee),H.rotate($,ee),q.rotate($,ee)}v.push(new ae(Z,q,H,W,E,K.labelAngle,K.anchor,K.minzoom,K.maxzoom,K.page)),b&&!this._legible(K.labelAngle)||(g?(k<m&&(m=k),J<V&&(V=J),I<L&&(I=L),B<X&&(B=X)):K.minzoom<2&&_.addBox(K.anchor,new re.Box(k,J,L,X),i,Q,t,K.minzoom,K.maxzoom))}}}if(2<=h)return null;g&&_.addBox(l,new re.Box(m,V,I,B),i,u,t,le,ne.C_INFINITY);var te=new se(_,v);return a.allowOverlap||(h=this._conflictEngine.getMinZoom(te.footprint,h)),_.minzoom=h,te},i.prototype.add=function(e){this._conflictEngine.add(e.footprint)},i.prototype._legible=function(e){var t=ne.radToByte(e);return t<65||193<=t},i.prototype._placeGlyph=function(e,t,r,n,i,o,a,s){var l=o,u=l<0?ne.positiveMod(e.angle+ne.C_PI,ne.C_2PI):e.angle,f=this._legible(u),c=0;r<0&&(l*=-1,r*=-1,c=ne.C_PI),0<l&&++i;var h=new ie.Point(e.x,e.y),x=n[i],d=ne.C_INFINITY;if(n.length<=i)return d;for(;;){var p=x.x-h.x,y=x.y-h.y,_=Math.sqrt(p*p+y*y),v=Math.max(r/_,t),g=p/_,m=y/_,I=ne.positiveMod(Math.atan2(m,g)+c,ne.C_2PI);if(s.push(new oe(h,u,I,a,f,v,d)),v<=t)return v;h=x.clone();do{if(i+=l,n.length<=i||i<0)return v;x=n[i]}while(h.isEqual(x));var V=x.x-h.x,B=x.y-h.y,b=Math.sqrt(V*V+B*B);V*=_/b,B*=_/b,h.x-=V,h.y-=B,d=v}},i);function i(){this.mapAngle=0,this._conflictEngine=new re.ConflictEngine}t.PlacementEngine=n}.apply(null,n))||(e.exports=i)},1903:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(551),r(1716),r(312),r(1902),r(525),r(315),r(346)],void 0===(i=function(e,t,r,n,i,W,J,X,b,Q){function $(e,t){return e.iconMosaicItem&&t.iconMosaicItem?e.iconMosaicItem.page===t.iconMosaicItem.page?0:e.iconMosaicItem.page<t.iconMosaicItem.page?-1:1:e.iconMosaicItem&&!t.iconMosaicItem?1:!e.iconMosaicItem&&t.iconMosaicItem?-1:0}return r(ee,u=i),Object.defineProperty(ee.prototype,"markerPageMap",{get:function(){return this._markerMap},enumerable:!0,configurable:!0}),Object.defineProperty(ee.prototype,"glyphsPageMap",{get:function(){return this._glyphMap},enumerable:!0,configurable:!0}),Object.defineProperty(ee.prototype,"sdfMarker",{get:function(){return this._sdfMarkers},enumerable:!0,configurable:!0}),ee.prototype.copy=function(e,t,r,n,i){var o=new ee(this.layer,this.zoom,e,t,r,n,i,this._workerTileHandler);return o.layerIndex=this.layerIndex,o.layerExtent=this.layerExtent,o._iconIndexStart=t.index,o._textIndexStart=n.index,o._iconIndexCount=0,o._textIndexCount=0,o._symbolInstances=this._symbolInstances,o._workerTileHandler=this._workerTileHandler,o._fontArray=this._fontArray,o._textLayout=this._textLayout,o._iconLayout=this._iconLayout,o._isLinePlacement=this._isLinePlacement,o._avoidEdges=this._avoidEdges,o},ee.prototype.getResources=function(e,t,r){var n=this.layer,i=this.zoom,o=n.hasDataDrivenIcon,a=n.hasDataDrivenText;e&&e.setExtent(this.layerExtent);for(var s=n.getLayoutProperty("icon-image"),l=n.getLayoutProperty("text-field"),u=n.getLayoutValue("text-font",i),f=n.getLayoutValue("text-transform",i),c=[],h=[1,1,1,1],x=1,d=1,p=[1,1,1,1],y=1,_=1,v=0,g=this._features;v<g.length;v++){var m=g[v],I=m.getGeometry(e);if(I&&0!==I.length){var V=void 0;s&&(V=n.getLayoutValue("icon-image",i,m),s.isDataDriven||(V=this._replaceKeys(V,m.values)),V&&t.add(V));var B=void 0,b=!1;if(l&&(B=n.getLayoutValue("text-field",i,m),l.isDataDriven||(B=this._replaceKeys(B,m.values)),B=B.replace(/\\n/g,"\n"))){switch(f){case 2:B=B.toLowerCase();break;case 1:B=B.toUpperCase()}var D;if(ee._bidiEngine.hasBidiChar(B))D="rtl"===ee._bidiEngine.checkContextual(B)?"IDNNN":"ICNNN",B=ee._bidiEngine.bidiTransform(B,D,"VLYSN"),b=!0;var w=B.length;if(0<w)for(var P=0,T=u;P<T.length;P++){var E=T[P],M=r[E];M=M||(r[E]=new Set);for(var z=0;z<w;z++){var C=B.charCodeAt(z);M.add(C)}}}if(V||B){var N=n.getLayoutValue("icon-size",i,m),S=n.getLayoutValue("text-size",i,m);n.hasDataDrivenIconColor&&(h=n.getPaintValue("icon-color",i,m)),n.hasDataDrivenIconOpacity&&(x=n.getPaintValue("icon-opacity",i,m)),n.hasDataDrivenIconSize&&(d=N),n.hasDataDrivenTextColor&&(p=n.getPaintValue("text-color",i,m)),n.hasDataDrivenTextOpacity&&(y=n.getPaintValue("text-opacity",i,m)),n.hasDataDrivenTextSize&&(_=S);var k={sprite:V,label:B,rtl:b,type:m.type,geometry:I,iconSize:N,iconRotate:n.getLayoutValue("icon-rotate",i,m),ddIconValues:o?{color:h,opacity:x,size:d}:null,textSize:S,textRotate:n.getLayoutValue("text-rotate",i,m),ddTextValues:a?{color:p,opacity:y,size:_}:null};c.push(k)}}}this._symbolFeatures=c},ee.prototype.processFeatures=function(e){e&&e.setExtent(this.layerExtent);var t,r,n,i,o,a=this.layer,s=this.zoom,l=this._isLinePlacement=1===a.getLayoutValue("symbol-placement",s),u=8*a.getLayoutValue("symbol-spacing",s),f=a.getLayoutProperty("icon-image"),c=a.getLayoutProperty("text-field"),h=this._workerTileHandler;if(f&&(this._iconLayout=new X.IconLayout(a,s,l),t=h.getSpriteItems(),r=this._getTranslate(!0)),c){var x=this._textLayout=new X.TextLayout(a,s,l);this._fontArray=x.fontArray;var d=.5;switch(x.anchor){case 5:case 1:case 7:d=0;break;case 6:case 2:case 8:d=1}var p=.5;switch(x.anchor){case 5:case 3:case 6:p=0;break;case 7:case 4:case 8:p=1}var y=.5;switch(x.justify){case 0:y=0;break;case 2:y=1}var _=24*x.letterSpacing,v=l?0:24*x.maxWidth,g=24*x.lineHeight,m=[24*x.offset[0],24*x.offset[1]];n=this._fontArray.map(function(e){return h.getGlyphItems(e)}),i=new Q.TextShaping(n,v,g,_,m,d,p,y),o=this._getTranslate(!1)}this._iconIndexStart=this._iconIndexBuffer.index,this._textIndexStart=this._textIndexBuffer.index,this._iconIndexCount=0,this._textIndexCount=0,this._markerMap.clear(),this._glyphMap.clear();var I=[];this._symbolInstances=I;var V=this._textLayout,B=1;V&&V.size&&(B=V.size/24);for(var b=V?V.maxAngle*W.C_DEG_TO_RAD:0,D=V?8*V.size:0,w=0,P=this._symbolFeatures;w<P.length;w++){var T=P[w],E=void 0;T.sprite&&(E=t[T.sprite])&&E.sdf&&(this._sdfMarkers=!0);var M=void 0,z=T.label,C=0;if(z&&(M=i.getShaping(z,T.rtl))&&0<M.length){for(var N=1e30,S=-1e30,k=0,A=M;k<A.length;k++){var L=A[k];N=Math.min(N,L.x),S=Math.max(S,L.x)}C=(S-N+48)*B*8}for(var O=0,F=T.geometry;O<F.length;O++){var j=F[O],R=void 0;if(l){if(M&&0<M.length&&V&&V.size){var G=8*V.size*(2+Math.min(2,4*Math.abs(V.offset[1])));ee._smoothVertices(j,G)}R=ee._findAnchors(j,u,C)}else R=3===T.type?ee._findCentroid(j):[new J.Anchor(j[0].x,j[0].y)];for(var U=0,Y=R;U<Y.length;U++){var K=Y[U];K.x<0||4096<K.x||K.y<0||4096<K.y||l&&0<C&&0===V.rotationAlignment&&!ee._honorsTextMaxAngle(j,K,C,b,D)||I.push({shaping:M,line:j,iconMosaicItem:E,anchor:K,iconSize:T.iconSize,iconRotate:T.iconRotate,ddIconValues:T.ddIconValues,textSize:T.textSize,textRotate:T.textRotate,ddTextValues:T.ddTextValues})}}}I.sort($);for(var Z=0,H=I;Z<H.length;Z++){var q=H[Z];this._processFeature(q,r,o)}this._addPlacedGlyphs()},ee.prototype.updateSymbols=function(){this._iconIndexStart=this._iconIndexBuffer.index,this._textIndexStart=this._textIndexBuffer.index,this._iconIndexCount=0,this._textIndexCount=0,this._markerMap.clear(),this._glyphMap.clear();var e,t,r=this.layer;r.getLayoutProperty("icon-image")&&(e=this._getTranslate(!0)),r.getLayoutProperty("text-field")&&(t=this._getTranslate(!1));for(var n=0,i=this._symbolInstances;n<i.length;n++){var o=i[n];this._processFeature(o,e,t)}this._addPlacedGlyphs()},ee.prototype.assignBufferInfo=function(){},ee.prototype._getTranslate=function(e){var t=this.layer.getPaintValue(e?"icon-translate":"text-translate",this.zoom);if(0!==t[0]||0!==t[1]){var r=this._placementEngine.mapAngle;if(0===r||0!==this.layer.getPaintValue(e?"icon-translate-anchor":"text-translate-anchor",this.zoom))return[8*t[0],8*t[1]];var n=Math.sin(r),i=Math.cos(r);return[8*(t[0]*i-t[1]*n),8*(t[0]*n+t[1]*i)]}},ee.prototype._replaceKeys=function(e,r){return e.replace(/{([^{}]+)}/g,function(e,t){return t in r?r[t]:""})},ee.prototype._processFeature=function(e,t,r){var n=e.line,i=e.iconMosaicItem,o=e.shaping,a=e.anchor,s=this._iconLayout,l=s&&!!i,u=!0,f=1;l&&(s.size=e.iconSize,s.rotate=e.iconRotate,f=8*s.size,u=s.optional||!i);var c=this._textLayout,h=c&&o&&0<o.length,x=1,d=x,p=!0;h&&(c.size=e.textSize,c.rotate=e.textRotate,d=8*(x=c.size/24),p=c.optional||!o||0===o.length);var y,_,v=new b.Point(0,-17);if(l&&(y=this._placementEngine.getIconPlacement(a,t,i,f,s),a.minzoom>y.footprint.minzoom&&(y.footprint.minzoom=a.minzoom),y.footprint.minzoom===W.C_INFINITY&&(y=null)),(y||u)&&(h&&(_=this._placementEngine.getTextPlacement(a,r,v,o,d,n,c))&&(a.minzoom>_.footprint.minzoom&&(_.footprint.minzoom=a.minzoom),_.footprint.minzoom===W.C_INFINITY&&(_=null)),_||p)){if(y&&_||(p||u?p||_?u||y||(_=null):y=null:_=y=null),y&&_&&!p&&!u){var g=Math.max(y.footprint.minzoom,_.footprint.minzoom);y.footprint.minzoom=g,_.footprint.minzoom=g}_&&(c.ignorePlacement||this._placementEngine.add(_),this._storePlacedGlyphs(_.shapes,_.footprint.minzoom,this.zoom,e.ddTextValues)),y&&(s.ignorePlacement||this._placementEngine.add(y),this._addPlacedIcons(y.shapes,y.footprint.minzoom,this.zoom,i.page,e.ddIconValues))}},ee.prototype._addPlacedIcons=function(e,t,r,n,i){for(var o=Math.max(r+W.log2(t),0),a=this._iconVertexBuffer,s=this._iconIndexBuffer,l=0,u=e;l<u.length;l++){var f=u[l],c=Math.max(r+W.log2(f.minzoom),o),h=Math.min(r+W.log2(f.maxzoom),25);if(!(h<=c)){var x=f.tl,d=f.tr,p=f.bl,y=f.br,_=f.mosaicRect,v=f.labelAngle,g=f.anchor,m=a.index,I=_.x,V=_.y,B=I+_.width,b=V+_.height;a.add(g.x,g.y,x.x,x.y,I,V,v,c,h,o,i),a.add(g.x,g.y,d.x,d.y,B,V,v,c,h,o,i),a.add(g.x,g.y,p.x,p.y,I,b,v,c,h,o,i),a.add(g.x,g.y,y.x,y.y,B,b,v,c,h,o,i),s.add(m+0,m+1,m+2),s.add(m+1,m+2,m+3),this._markerMap.has(n)?this._markerMap.get(n)[1]+=6:this._markerMap.set(n,[this._iconIndexStart+this._iconIndexCount,6]),this._iconIndexCount+=2}}},ee.prototype._addPlacedGlyphs=function(){var a=this,s=this._textVertexBuffer,l=this._textIndexBuffer;this._glyphBufferDataStorage.forEach(function(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r],o=s.index;s.add(i.glyphAnchor[0],i.glyphAnchor[1],i.tl[0],i.tl[1],i.xmin,i.ymin,i.labelAngle,i.minLod,i.maxLod,i.placementLod,i.ddValues),s.add(i.glyphAnchor[0],i.glyphAnchor[1],i.tr[0],i.tr[1],i.xmax,i.ymin,i.labelAngle,i.minLod,i.maxLod,i.placementLod,i.ddValues),s.add(i.glyphAnchor[0],i.glyphAnchor[1],i.bl[0],i.bl[1],i.xmin,i.ymax,i.labelAngle,i.minLod,i.maxLod,i.placementLod,i.ddValues),s.add(i.glyphAnchor[0],i.glyphAnchor[1],i.br[0],i.br[1],i.xmax,i.ymax,i.labelAngle,i.minLod,i.maxLod,i.placementLod,i.ddValues),l.add(o+0,o+1,o+2),l.add(o+1,o+2,o+3),a._glyphMap.has(t)?a._glyphMap.get(t)[1]+=6:a._glyphMap.set(t,[a._textIndexStart+a._textIndexCount,6]),a._textIndexCount+=2}}),this._glyphBufferDataStorage.clear()},ee.prototype._storePlacedGlyphs=function(e,t,r,n){for(var i=Math.max(r+W.log2(t),0),o=0,a=e;o<a.length;o++){var s=a[o],l=Math.max(r+W.log2(s.minzoom),i),u=Math.min(r+W.log2(s.maxzoom),25);if(!(u<=l)){var f=s.tl,c=s.tr,h=s.bl,x=s.br,d=s.labelAngle,p=s.anchor,y=s.mosaicRect;this._glyphBufferDataStorage.has(s.page)||this._glyphBufferDataStorage.set(s.page,[]),this._glyphBufferDataStorage.get(s.page).push({glyphAnchor:[p.x,p.y],tl:[f.x,f.y],tr:[c.x,c.y],bl:[h.x,h.y],br:[x.x,x.y],xmin:y.x,ymin:y.y,xmax:y.x+y.width,ymax:y.y+y.height,labelAngle:d,minLod:l,maxLod:u,placementLod:i,ddValues:n})}}},ee._findAnchors=function(e,t,r){t+=r;for(var n=0,i=e.length-1,o=0;o<i;o++)n+=b.Point.distance(e[o],e[o+1]);var a=r||t;if(n<=(a*=.5))return[];var s=a/n,l=0,u=-(t=n/Math.max(Math.round(n/t),1))/2,f=[],c=e.length-1;for(o=0;o<c;o++){for(var h=e[o],x=e[o+1],d=x.x-h.x,p=x.y-h.y,y=Math.sqrt(d*d+p*p),_=void 0;u+t<l+y;){var v=((u+=t)-l)/y,g=W.interpolate(h.x,x.x,v),m=W.interpolate(h.y,x.y,v);void 0===_&&(_=Math.atan2(p,d)),f.push(new J.Anchor(g,m,_,o,s))}l+=y}return f},ee._deviation=function(e,t,r){var n=(t.x-e.x)*(r.x-t.x)+(t.y-e.y)*(r.y-t.y),i=(t.x-e.x)*(r.y-t.y)-(t.y-e.y)*(r.x-t.x);return Math.atan2(i,n)},ee._honorsTextMaxAngle=function(e,t,r,n,i){for(var o=0,a=r/2,s=new b.Point(t.x,t.y),l=t.segment+1;-a<o;){if(--l<0)return!1;o-=b.Point.distance(e[l],s),s=e[l]}o+=b.Point.distance(e[l],e[l+1]);for(var u=[],f=0,c=e.length;o<a;){var h=e[l],x=l,d=void 0;do{if(++x===c)return!1;d=e[x]}while(d.isEqual(h));var p=x,y=void 0;do{if(++p===c)return!1;y=e[p]}while(y.isEqual(d));var _=this._deviation(h,d,y);for(u.push({deviation:_,distToAnchor:o}),f+=_;o-u[0].distToAnchor>i;)f-=u.shift().deviation;if(Math.abs(f)>n)return!1;o+=b.Point.distance(d,y),l=x}return!0},ee._smoothVertices=function(e,t){if(!(t<=0)){var r=e.length;if(!(r<3)){var n=[],i=0;n.push(0);for(var o=1;o<r;o++)i+=b.Point.distance(e[o],e[o-1]),n.push(i);t=Math.min(t,.2*i);var a=[];a.push(e[0].x),a.push(e[0].y);var s=e[r-1].x,l=e[r-1].y,u=b.Point.sub(e[0],e[1]);for(u.normalize(),e[0].x+=t*u.x,e[0].y+=t*u.y,u.assignSub(e[r-1],e[r-2]),u.normalize(),e[r-1].x+=t*u.x,e[r-1].y+=t*u.y,o=1;o<r;o++)n[o]+=t;n[r-1]+=t;var f=.5*t;for(o=1;o<r-1;o++){for(var c=0,h=0,x=0,d=o-1;0<=d&&!(n[d+1]<n[o]-f);d--){var p=f+n[d+1]-n[o],y=n[d+1]-n[d],_=n[o]-n[d]<f?1:p/y;if(Math.abs(_)<1e-6)break;var v=_*p-.5*(B=_*_)*y,g=_*y/t,m=e[d+1],I=e[d].x-m.x,V=e[d].y-m.y;c+=g/v*(m.x*_*p+.5*B*(p*I-y*m.x)-B*_*y*I/3),h+=g/v*(m.y*_*p+.5*B*(p*V-y*m.y)-B*_*y*V/3),x+=g}for(d=o+1;d<r&&!(n[d-1]>n[o]+f)&&(p=f-n[d-1]+n[o],y=n[d]-n[d-1],_=n[d]-n[o]<f?1:p/y,!(Math.abs(_)<1e-6));d++){var B;v=_*p-.5*(B=_*_)*y,g=_*y/t,m=e[d-1],I=e[d].x-m.x,V=e[d].y-m.y,c+=g/v*(m.x*_*p+.5*B*(p*I-y*m.x)-B*_*y*I/3),h+=g/v*(m.y*_*p+.5*B*(p*V-y*m.y)-B*_*y*V/3),x+=g}a.push(c/x),a.push(h/x)}for(a.push(s),a.push(l),d=o=0;o<r;o++)e[o].x=a[d++],e[o].y=a[d++]}}},ee._findCentroid=function(e){var t=e.length-1,r=0,n=0,i=0,o=e[0].x,a=e[0].y;4096<o&&(o=4096),o<0&&(o=0),4096<a&&(a=4096),a<0&&(a=0);for(var s=1;s<t;s++){var l=e[s].x,u=e[s].y,f=e[s+1].x,c=e[s+1].y;4096<l&&(l=4096),l<0&&(l=0),4096<u&&(u=4096),u<0&&(u=0),4096<f&&(f=4096),f<0&&(f=0),4096<c&&(c=4096),c<0&&(c=0);var h=(l-o)*(c-a)-(f-o)*(u-a);r+=h*(o+l+f),n+=h*(a+u+c),i+=h}return r/=3*i,n/=3*i,isNaN(r)||isNaN(n)?[]:[new J.Anchor(r,n)]},ee._bidiEngine=new n,ee;function ee(e,t,r,n,i,o,a,s){var l=u.call(this,e,t)||this;if(l._markerMap=new Map,l._glyphMap=new Map,l._glyphBufferDataStorage=new Map,l._sdfMarkers=!1,e.hasDataDrivenIcon!==r.isDataDriven())throw new Error("incompatible icon buffer");if(e.hasDataDrivenText!==i.isDataDriven())throw new Error("incompatible text buffer");return l._iconVertexBuffer=r,l._iconIndexBuffer=n,l._textVertexBuffer=i,l._textIndexBuffer=o,l._placementEngine=a,l._workerTileHandler=s,l}var u}.apply(null,n))||(e.exports=i)},1904:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.TileStatus||(t.TileStatus={}))[r.INITIALIZED=0]="INITIALIZED",r[r.NO_DATA=1]="NO_DATA",r[r.READY=2]="READY",r[r.MODIFIED=3]="MODIFIED",r[r.INVALID=4]="INVALID"}.apply(null,n))||(e.exports=i)},2425:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(9),r(10),r(12),r(4),r(1897),r(1898),r(1899),r(312),r(2426),r(1901),r(1902),r(1903),r(2428),r(2431),r(1904)],void 0===(i=function(e,t,n,i,z,C,T,E,M,N,r,S,o,k,a,s,A){return l.prototype.initialize=function(e,t,r,n){void 0===n&&(n=0),this.tileKey=e,this.refKeys=t,this._workerTileHandler=r,this.rotation=n,this.placementEngine.setAngle(N.C_DEG_TO_RAD*n)},l.prototype.release=function(){this.tileKey="",this.refKeys=null,this.status=A.TileStatus.INITIALIZED,this.rotation=0,this.resetData(),this._workerTileHandler=null},l.prototype.resetData=function(){this.fillVertexBuffer.reset(),this.fillDDVertexBuffer.reset(),this.fillIndexBuffer.reset(),this.outlineVertexBuffer.reset(),this.outlineDDVertexBuffer.reset(),this.outlineIndexBuffer.reset(),this.lineVertexBuffer.reset(),this.lineDDVertexBuffer.reset(),this.lineIndexBuffer.reset(),this.iconVertexBuffer.reset(),this.iconDDVertexBuffer.reset(),this.iconIndexBuffer.reset(),this.textVertexBuffer.reset(),this.textDDVertexBuffer.reset(),this.textIndexBuffer.reset(),this.circleVertexBuffer.reset(),this.circleIndexBuffer.reset(),this.placementEngine.reset(),this._symbolBuckets.length=0},l.prototype.reparse=function(e){return this.resetData(),this.setDataAndParse(this._data,e)},l.prototype.setDataAndParse=function(e,t){var P=this,r=t&&t.signal;if(z.isSome(r)){var n=function(){r.removeEventListener("abort",n),P.status=A.TileStatus.INVALID};r.addEventListener("abort",n)}return this._data=e,this._parse(e,t).then(function(e){P.status=A.TileStatus.READY;for(var t=[1,P.fillVertexBuffer.sizeInBytes,2,P.fillDDVertexBuffer.sizeInBytes,3,P.fillIndexBuffer.sizeInBytes,4,P.outlineVertexBuffer.sizeInBytes,5,P.outlineDDVertexBuffer.sizeInBytes,6,P.outlineIndexBuffer.sizeInBytes,7,P.lineVertexBuffer.sizeInBytes,8,P.lineDDVertexBuffer.sizeInBytes,9,P.lineIndexBuffer.sizeInBytes,10,P.iconVertexBuffer.sizeInBytes,11,P.iconDDVertexBuffer.sizeInBytes,12,P.iconIndexBuffer.sizeInBytes,13,P.textVertexBuffer.sizeInBytes,14,P.textDDVertexBuffer.sizeInBytes,15,P.textIndexBuffer.sizeInBytes,16,P.circleVertexBuffer.sizeInBytes,17,P.circleIndexBuffer.sizeInBytes],r=new Uint32Array(t),n=[],i=e.length,o=0;o<i;o++){var a=e[o];if(a instanceof M)n.push(a.layerIndex),n.push(1),n.push(a.fillIndexStart),n.push(a.fillIndexCount),n.push(a.outlineIndexStart),n.push(a.outlineIndexCount);else if(a instanceof S)n.push(a.layerIndex),n.push(2),n.push(a.lineIndexStart),n.push(a.lineIndexCount);else if(a instanceof k){n.push(a.layerIndex),n.push(3),n.push(a.sdfMarker?1:0);var s=a.markerPageMap;n.push(s.size),s.forEach(function(e,t){n.push(t),n.push(e[0]),n.push(e[1])});var l=a.glyphsPageMap;n.push(l.size),l.forEach(function(e,t){n.push(t),n.push(e[0]),n.push(e[1])})}else a instanceof E?(n.push(a.layerIndex),n.push(4),n.push(a.circleIndexStart),n.push(a.circleIndexCount)):a instanceof T&&(n.push(a.layerIndex),n.push(0))}var u=new Uint32Array(n),f=P.fillVertexBuffer.toBuffer(),c=P.fillDDVertexBuffer.toBuffer(),h=P.fillIndexBuffer.toBuffer(),x=P.outlineVertexBuffer.toBuffer(),d=P.outlineDDVertexBuffer.toBuffer(),p=P.outlineIndexBuffer.toBuffer(),y=P.lineVertexBuffer.toBuffer(),_=P.lineDDVertexBuffer.toBuffer(),v=P.lineIndexBuffer.toBuffer(),g=P.iconVertexBuffer.toBuffer(),m=P.iconDDVertexBuffer.toBuffer(),I=P.iconIndexBuffer.toBuffer(),V=P.textVertexBuffer.toBuffer(),B=P.textDDVertexBuffer.toBuffer(),b=P.textIndexBuffer.toBuffer(),D=P.circleVertexBuffer.toBuffer(),w=P.circleIndexBuffer.toBuffer();return{result:{bufferDataInfo:r.buffer,bucketDataInfo:u.buffer,bufferData:[f,c,h,x,d,p,y,_,v,g,m,I,V,B,b,D,w]},transferList:[f,c,h,x,d,p,y,_,v,g,m,I,V,B,b,D,w,r.buffer,u.buffer]}})},l.prototype.addBucket=function(e){this._symbolBuckets.push(e)},l.prototype.updateSymbols=function(e,t){var r=this,n=this._symbolBuckets;if(!n||0===n.length)return C.resolve();var i=t&&t.signal;if(z.isSome(i)){var o=function(){i.removeEventListener("abort",o),r.status=A.TileStatus.INVALID};i.addEventListener("abort",o)}this.rotation=e;var a=this.placementEngine;a.reset(),a.setAngle(e/256*360*N.C_DEG_TO_RAD);var s=this.iconVertexBuffer;s.reset();var l=this.iconDDVertexBuffer;l.reset();var u=this.iconIndexBuffer;u.reset();var f=this.textVertexBuffer;f.reset();var c=this.textDDVertexBuffer;c.reset();var h=this.textIndexBuffer;h.reset();for(var x=[],d=0;d<n.length;d++){var p=n[d];if(p&&p.layer){var y=p.layer,_=p.copy(y.hasDataDrivenIcon?l:s,u,y.hasDataDrivenText?c:f,h,a);_&&(x.push(_),_.updateSymbols())}}if(this.status===A.TileStatus.INVALID||this.status===A.TileStatus.INITIALIZED||0===s.sizeInBytes&&0===l.sizeInBytes&&0===u.sizeInBytes&&0===f.sizeInBytes&&0===c.sizeInBytes&&0===h.sizeInBytes)return C.reject();var v=[10,s.sizeInBytes,11,l.sizeInBytes,12,u.sizeInBytes,13,f.sizeInBytes,14,c.sizeInBytes,15,h.sizeInBytes],g=new Uint32Array(v),m=[];for(d=0;d<x.length;d++){var I=x[d];m.push(I.layerIndex),m.push(3),m.push(I.sdfMarker?1:0);var V=I.markerPageMap;m.push(V.size),V.forEach(function(e,t){m.push(t),m.push(e[0]),m.push(e[1])});var B=I.glyphsPageMap;m.push(B.size),B.forEach(function(e,t){m.push(t),m.push(e[0]),m.push(e[1])})}var b=new Uint32Array(m),D=s.toBuffer(),w=l.toBuffer(),P=u.toBuffer(),T=f.toBuffer(),E=c.toBuffer(),M=h.toBuffer();return C.resolve({result:{bufferDataInfo:g.buffer,bucketDataInfo:b.buffer,bufferData:[D,w,P,T,E,M]},transferList:[D,w,P,T,E,M,g.buffer,b.buffer]})},l.prototype.setObsolete=function(){this.status=A.TileStatus.INVALID},l.prototype.getLayers=function(){return this._workerTileHandler.getLayers()},l.prototype.getWorkerTileHandler=function(){return this._workerTileHandler},l.prototype._parse=function(t,r){return i(this,void 0,void 0,function(){return n(this,function(e){return 0===Object.keys(t).length?[2,[]]:(this.status=A.TileStatus.MODIFIED,[2,new a(t,this,r.client).parse(r)])})})},l;function l(){this.rotation=0,this.status=A.TileStatus.INITIALIZED,this._symbolBuckets=[],this.placementEngine=new o.PlacementEngine,this.fillVertexBuffer=new s.FillVertexBuffer(!1),this.fillDDVertexBuffer=new s.FillVertexBuffer(!0),this.fillIndexBuffer=new r.TriangleIndexBuffer,this.outlineVertexBuffer=new s.OutlineVertexBuffer(!1),this.outlineDDVertexBuffer=new s.OutlineVertexBuffer(!0),this.outlineIndexBuffer=new r.TriangleIndexBuffer,this.lineVertexBuffer=new s.LineVertexBuffer(!1),this.lineDDVertexBuffer=new s.LineVertexBuffer(!0),this.lineIndexBuffer=new r.TriangleIndexBuffer,this.iconVertexBuffer=new s.SymbolVertexBuffer(!1),this.iconDDVertexBuffer=new s.SymbolVertexBuffer(!0),this.iconIndexBuffer=new r.TriangleIndexBuffer,this.textVertexBuffer=new s.SymbolVertexBuffer(!1),this.textDDVertexBuffer=new s.SymbolVertexBuffer(!0),this.textIndexBuffer=new r.TriangleIndexBuffer,this.circleVertexBuffer=new s.CircleVertexBuffer,this.circleIndexBuffer=new r.TriangleIndexBuffer}}.apply(null,n))||(e.exports=i)},2426:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(1900)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i,o=(r(a,i=n),a.prototype.add=function(e,t,r){var n=this.array;n.push(e),n.push(t),n.push(r)},a);function a(){return i.call(this,12)||this}t.TriangleIndexBuffer=o;var s,l=(r(u,s=n),u.prototype.add=function(e){this.array.push(e)},u);function u(){return s.call(this,4)||this}t.PointElementMemoryBuffer=l}.apply(null,n))||(e.exports=i)},2427:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(33),r(312),r(315)],void 0===(i=function(e,t,r,v,g){Object.defineProperty(t,"__esModule",{value:!0});var n=(i.prototype.clone=function(){return new i(this.left,this.top,this.right,this.bottom)},i.prototype.move=function(e,t){this.left+=e,this.top+=t,this.right+=e,this.bottom+=t},i.prototype.rotate=function(e,t){var r=this.left,n=this.right,i=this.top,o=this.bottom,a=r*e-i*t,s=r*t+i*e,l=n*e-i*t,u=n*t+i*e,f=r*e-o*t,c=r*t+o*e,h=n*e-o*t,x=n*t+o*e;this.left=Math.min(a,l,f,h),this.top=Math.min(s,u,c,x),this.right=Math.max(a,l,f,h),this.bottom=Math.max(s,u,c,x)},i.overlaps=function(e,t){return e.right>t.left&&e.left<t.right&&e.bottom>t.top&&e.top<t.bottom},i);function i(e,t,r,n){this.left=e,this.top=t,this.right=r,this.bottom=n}t.Box=n;var m=(o.prototype.left=function(){return this.corners[0].x},o.prototype.right=function(){return this.corners[2].x},o.prototype.top=function(){return this.corners[1].y},o.prototype.bottom=function(){return this.corners[3].y},o);function o(e,t,r,n){this.anchor=e,this.corners=t,this.minzoom=r,this.maxzoom=n}t.Obstacle=m;var a=(s.prototype.addBox=function(e,t,r,n,i,o,a){var s=t.left*r-this.padding,l=t.top*r-this.padding,u=t.right*r+this.padding,f=t.bottom*r+this.padding,c=[new g.Point(s,l),new g.Point(u,l),new g.Point(u,f),new g.Point(s,f)];if(0!==this.mapAngle){var h=Math.cos(this.mapAngle),x=Math.sin(this.mapAngle);(e=e.clone()).rotate(h,x)}if(this.isScreenAligned||(n+=this.mapAngle),0!==n){h=Math.cos(n),x=Math.sin(n),c[0].rotate(h,x),c[1].rotate(h,x),c[2].rotate(h,x),c[3].rotate(h,x);for(var d=0,p=1;p<4;p++)c[p].x<c[d].x?d=p:c[p].x===c[d].x&&c[p].y<c[d].y&&(d=p);if(d){var y=[];for(p=0;p<4;p++)y.push(c[(p+d)%4]);c=y}}if(i)for(var _=0,v=c;_<v.length;_++)v[_].move(i[0],i[1]);this.obstacles.push(new m(e,c,o,a))},s);function s(e,t,r){this.obstacles=[],this.mapAngle=e,this.padding=t,this.isScreenAligned=r,this.minzoom=l}t.Footprint=a;var l=.5,u=(I.prototype.reset=function(){this._grid=[]},I.prototype.add=function(e){for(var t=this._grid,r=0,n=e.obstacles;r<n.length;r++)for(var i=n[r],o=i.anchor,a=I._gridClamp(Math.min(i.left()+o.x,o.x)),s=I._gridClamp(Math.max(i.right()+o.x,o.x)),l=I._gridClamp(Math.min(i.top()+o.y,o.y)),u=I._gridClamp(Math.max(i.bottom()+o.y,o.y)),f=l;f<=u;f++)for(var c=a;c<=s;c++){var h=t[16*f+c];(h=h||(t[16*f+c]=[])).push(i)}},I.prototype.getMinZoom=function(e,t){if(0===e.obstacles.length)return v.C_INFINITY;for(var r=t,n=this._grid,i=0,o=e.obstacles;i<o.length;i++)for(var a=o[i],s=a.anchor,l=I._gridClamp(Math.min(a.left()+s.x,s.x)),u=I._gridClamp(Math.max(a.right()+s.x,s.x)),f=I._gridClamp(Math.min(a.top()+s.y,s.y)),c=I._gridClamp(Math.max(a.bottom()+s.y,s.y)),h=f;h<=c;h++)for(var x=l;x<=u;x++){var d=n[16*h+x];if(d)for(var p=0,y=d;p<y.length;p++){var _=y[p];if(!(a.minzoom>=_.maxzoom||_.minzoom>=a.maxzoom)&&2<=(r=I._calcPlacementZoom(a,_,r)))return v.C_INFINITY}}return r<2?r:v.C_INFINITY},I._gridClamp=function(e){return r.clamp(e>>9,-7,8)},I._calcPlacementZoom=function(e,t,r){var n=t.anchor.x-e.anchor.x;if(0==n&&(e.right()<t.left()||t.right()<e.left()))return r;var i=t.anchor.y-e.anchor.y;if(0==i&&(e.bottom()<t.top()||t.bottom()<e.top()))return r;var o=v.C_INFINITY;if(0!=n){var a=(0<n?e.right()-t.left():e.left()-t.right())/n;a<o&&(o=a);var s=0<n?I._calcExtZoomX(e,t,a):I._calcExtZoomX(t,e,a);s<o&&(o=s)}if(0!=i){var l=(0<i?e.bottom()-t.top():e.top()-t.bottom())/i;l<o&&(o=l);var u=0<i?I._calcExtZoomY(e,t,l):I._calcExtZoomY(t,e,l);u<o&&(o=u)}return o<e.minzoom||o<t.minzoom?r:((o=Math.min(o,e.maxzoom,t.maxzoom))<r&&(o=r),o)},I._calcExtZoomX=function(e,t,r){var n,i,o,a;if(e.anchor.y+e.corners[2].y/r<t.anchor.y+t.corners[0].y/r){var s=e.corners[2].x-e.corners[3].x,l=e.corners[2].y-e.corners[3].y,u=t.corners[1].x-t.corners[0].x;a=0<=s*(t.corners[1].y-t.corners[0].y)-l*u?e.anchor.y+e.corners[3].y/r<t.anchor.y+t.corners[0].y/r?(n=e.corners[3],i=t.corners[0],o=t.corners[1],1):(n=t.corners[0],i=e.corners[3],o=e.corners[2],-1):e.anchor.y+e.corners[2].y/r>t.anchor.y+t.corners[1].y/r?(n=e.corners[2],i=t.corners[0],o=t.corners[1],1):(n=t.corners[1],i=e.corners[3],o=e.corners[2],-1)}else s=e.corners[2].x-e.corners[1].x,l=e.corners[2].y-e.corners[1].y,u=t.corners[3].x-t.corners[0].x,a=s*(t.corners[3].y-t.corners[0].y)-l*u<0?e.anchor.y+e.corners[1].y/r>t.anchor.y+t.corners[0].y/r?(n=e.corners[1],i=t.corners[0],o=t.corners[3],1):(n=t.corners[0],i=e.corners[1],o=e.corners[2],-1):e.anchor.y+e.corners[2].y/r<t.anchor.y+t.corners[3].y/r?(n=e.corners[2],i=t.corners[0],o=t.corners[3],1):(n=t.corners[3],i=e.corners[1],o=e.corners[2],-1);var f=o.x-i.x,c=o.y-i.y;return a*((n.y-i.y)*f-(n.x-i.x)*c)/((e.anchor.x-t.anchor.x)*c-(e.anchor.y-t.anchor.y)*f)},I._calcExtZoomY=function(e,t,r){var n,i,o,a;if(e.anchor.x+e.corners[3].x/r<t.anchor.x+t.corners[1].x/r){var s=e.corners[3].x-e.corners[2].x,l=e.corners[3].y-e.corners[2].y,u=t.corners[0].x-t.corners[1].x;a=s*(t.corners[0].y-t.corners[1].y)-l*u<0?e.anchor.x+e.corners[2].x/r<t.anchor.x+t.corners[1].x/r?(n=e.corners[2],i=t.corners[1],o=t.corners[0],1):(n=t.corners[1],i=e.corners[2],o=e.corners[3],-1):e.anchor.x+e.corners[3].x/r>t.anchor.x+t.corners[0].x/r?(n=e.corners[3],i=t.corners[1],o=t.corners[0],1):(n=t.corners[0],i=e.corners[2],o=e.corners[3],-1)}else s=e.corners[3].x-e.corners[0].x,l=e.corners[3].y-e.corners[0].y,u=t.corners[2].x-t.corners[1].x,a=0<s*(t.corners[2].y-t.corners[1].y)-l*u?e.anchor.x+e.corners[0].x/r>t.anchor.x+t.corners[1].x/r?(n=e.corners[0],i=t.corners[1],o=t.corners[2],1):(n=t.corners[1],i=e.corners[0],o=e.corners[3],-1):e.anchor.x+e.corners[3].x/r<t.anchor.x+t.corners[2].x/r?(n=e.corners[3],i=t.corners[1],o=t.corners[2],1):(n=t.corners[2],i=e.corners[0],o=e.corners[3],-1);var f=o.x-i.x,c=o.y-i.y;return a*((n.y-i.y)*f-(n.x-i.x)*c)/((e.anchor.x-t.anchor.x)*c-(e.anchor.y-t.anchor.y)*f)},I);function I(){this._grid=[]}t.ConflictEngine=u}.apply(null,n))||(e.exports=i)},2428:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(9),r(10),r(489),r(4),r(1897),r(1898),r(2429),r(1899),r(1901),r(2430),r(1903),r(238),r(1904)],void 0===(i=function(e,t,ne,r,y,ie,n,i,oe,o,a,u,s,_,ae){return l.prototype.parse=function(re){return r(this,void 0,void 0,function(){var t,r,n,i,o,f,a,s,l,u,c,h,x,d,p,y,_,v,g,m,I,V,B,b,D,w,P,T,E,M,z,C,N,S,k,A,L,O,F,j,R,G,U,Y,K,Z,H,q,W,J,X,Q,$,ee,te;return ne(this,function(e){for(t=re&&re.signal,r=this._parseTileData(this._pbfTiles),n=this._layers,i=this._level,f=[],a=this._tileClippers,s={},l={},u=n.length-1;0<=u;u--)(o=n[u]).minzoom&&i<o.minzoom||o.maxzoom&&i>=o.maxzoom||o.layout&&o.layout.visibility&&"none"===o.layout.visibility||0!==o.type&&r[o.source]&&a[o.source]&&(P=r[o.source],c=a[o.source],U=o.sourceLayer,(T=P[U])&&((l[o.source]||(l[o.source]=new Set)).add(o.sourceLayer),(W=this._createBucket(o))&&(W.layerIndex=u,W.layerExtent=T.extent,W.tileClipper=c,((E=(E=s[o.source])||(s[o.source]={}))[U]||(E[U]=[])).push(W))));for(h=10*this._level,x=10*(this._level+1),d=[],p=[],y=[],_=[],v=new Set,g={},m=[],I=[],V=function(t){l[t].forEach(function(e){m.push(e),I.push(t)})},B=0,b=Object.keys(l);B<b.length;B++)R=b[B],V(R);for(D=0;D<m.length&&(R=I[D],w=m[D],r[R]&&s[R])&&(P=r[R],T=P[w],E=s[R],(Y=E[w])&&0!==Y.length);D++){if(ie.isAborted(t))return[2,void 0];for(M=T.getData();M.next(2);){if(z=M.getMessage(),C=new oe(z,T),z.release(),N=C.values){if((S=N._minzoom)&&x<=S)continue;if((k=N._maxzoom)&&k<=h)continue}for(A=0,L=Y;A<L.length;A++)(W=L[A]).pushFeature(C)}}for(O=this._tile,F=0,j=Object.keys(s);F<j.length;F++)for(U in R=j[F],G=s[R])for(Y=G[U],K=0,Z=Y;K<Z.length;K++)(W=Z[K]).hasFeatures()&&(3===W.layer.type?(d.push(W),O.addBucket(W)):W.layer.refLayerId?y.push(W):(p.push(W),_[W.layer.id]=W));for(H=0,q=d;H<q.length;H++)(W=q[H]).getResources(W.tileClipper,v,g);if(this._tile.status===ae.TileStatus.INVALID)return[2,ie.resolve([])];for(ee in J=[],X=this._tile.getWorkerTileHandler(),0<v.size&&(Q=X.fetchSprites(v,this._client,re),J.push(Q)),g)0<(te=g[ee]).size&&($=X.fetchGlyphs(this._tile.tileKey,ee,te,this._client,re),J.push($));return[2,ie.all(J).then(function(){for(var e=0,t=p;e<t.length;e++){var r=t[e];r.processFeatures(r.tileClipper),f.push(r)}for(var n=0,i=y;n<i.length;n++){var o=i[n],a=_[o.layer.refLayerId];a&&(a.assignBufferInfo(o),f.push(o))}for(var s=0,l=d;s<l.length;s++){var u=l[s];u.processFeatures(u.tileClipper),f.push(u)}return f.sort(function(e,t){return e.layerIndex-t.layerIndex}),f})]})})},l.prototype._parseTileData=function(e){for(var t={},r=0,n=Object.keys(e);r<n.length;r++){for(var i=n[r],o=e[i],a={};o.next();)switch(o.tag()){case 3:var s=o.getMessage(),l=new u(s);s.release(),a[l.name]=l;break;default:o.skip()}t[i]=a}return t},l.prototype._createBucket=function(e){switch(e.type){case 0:return this._createBackgroundBucket(e);case 1:return this._createFillBucket(e);case 2:return this._createLineBucket(e);case 4:return this._createCircleBucket(e);case 3:return this._createSymbolBucket(e)}},l.prototype._createBackgroundBucket=function(e){return new n(e,this._level)},l.prototype._createFillBucket=function(e){var t=this._tile;return new o(e,this._level,e.hasDataDrivenFill?t.fillDDVertexBuffer:t.fillVertexBuffer,t.fillIndexBuffer,e.hasDataDrivenOutline?t.outlineDDVertexBuffer:t.outlineVertexBuffer,t.outlineIndexBuffer)},l.prototype._createLineBucket=function(e){var t=this._tile;return new a(e,this._level,e.hasDataDrivenLine?t.lineDDVertexBuffer:t.lineVertexBuffer,t.lineIndexBuffer)},l.prototype._createCircleBucket=function(e){var t=this._tile;return new i(e,this._level,t.circleVertexBuffer,t.circleIndexBuffer)},l.prototype._createSymbolBucket=function(e){var t=this._tile;return new s(e,this._level,e.hasDataDrivenIcon?t.iconDDVertexBuffer:t.iconVertexBuffer,t.iconIndexBuffer,e.hasDataDrivenText?t.textDDVertexBuffer:t.textVertexBuffer,t.textIndexBuffer,t.placementEngine,t.getWorkerTileHandler())},l;function l(e,t,r){this._pbfTiles={},this._tileClippers={},this._client=r,this._tile=t,this._layers=t.getLayers();var n=t.tileKey.split("/").map(parseFloat),i=n[0],o=n[1],a=n[2];this._level=i;for(var s=Math.max(8,Math.round(1*this._level)-8),l=0,u=Object.keys(e);l<u.length;l++){var f=u[l],c=e[f];if(this._pbfTiles[f]=new y(new Uint8Array(c.protobuff),new DataView(c.protobuff)),c.refKey){var h=i-c.refKey.split("/").map(parseFloat)[0];if(0<h){var x=(1<<h)-1,d=o&x,p=a&x;this._tileClippers[f]=new _.TileClipper(h,d,p,8,s)}}this._tileClippers[f]||(this._tileClippers[f]=new _.SimpleBuilder)}}}.apply(null,n))||(e.exports=i)},2429:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(315)],void 0===(i=function(e,t,f){return r.prototype.getGeometry=function(e){if(void 0!==this._geometry)return this._geometry;if(!this._pbfGeometry)return null;var t,r,n,i=this._pbfGeometry;this._pbfGeometry=null,e?e.reset(this.type):t=[];for(var o=1,a=0,s=0,l=0;!i.empty();){if(0===a){var u=i.getUInt32();o=7&u,a=u>>3}switch(a--,o){case 1:s+=i.getSInt32(),l+=i.getSInt32(),e?e.moveTo(s,l):(r&&t.push(r),(r=[]).push(new f.Point(s,l)));break;case 2:s+=i.getSInt32(),l+=i.getSInt32(),e?e.lineTo(s,l):r.push(new f.Point(s,l));break;case 7:e?e.close():r&&!r[0].equals(s,l)&&r.push(r[0].clone());break;default:throw i.release(),new Error("Invalid path operation")}}return n=e?e.result():(r&&t.push(r),t),i.release(),this._geometry=n},r;function r(e,t){this.values={};for(var r=t.keys,n=t.values;e.next();)switch(e.tag()){case 1:this.id=e.getUInt64();break;case 2:for(var i=e.getMessage(),o=this.values;!i.empty();){var a=i.getUInt32(),s=i.getUInt32();o[r[a]]=n[s]}i.release();break;case 3:this.type=e.getUInt32();break;case 4:this._pbfGeometry=e.getMessage();break;default:e.skip()}}}.apply(null,n))||(e.exports=i)},2430:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return r.prototype.getData=function(){return this._pbfLayer},r._parseValue=function(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getInt64();case 5:return e.getUInt64();case 6:return e.getSInt64();case 7:return e.getBool();default:e.skip()}return null},r;function r(e){for(this.extent=4096,this.keys=[],this.values=[],this._pbfLayer=e.clone();e.next();)switch(e.tag()){case 1:this.name=e.getString();break;case 3:this.keys.push(e.getString());break;case 4:this.values.push(e.processMessage(r._parseValue));break;case 5:this.extent=e.getUInt32();break;default:e.skip()}}}.apply(null,n))||(e.exports=i)},2431:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(312),r(1900)],void 0===(i=function(e,t,r,p,y){Object.defineProperty(t,"__esModule",{value:!0});var n,_=new Float32Array(1),v=new Uint32Array(_.buffer),i=(r(o,n=y),o.prototype.isDataDriven=function(){return this._isDataDriven},o.prototype.add=function(e,t,r,n,i,o,a,s){var l=this.array,u=y.i1616to32(e,t);if(l.push(u),u=y.i8888to32(Math.round(31*r),Math.round(31*n),Math.round(31*i),Math.round(31*o)),l.push(u),u=y.i1616to32(a,0),l.push(u),this._isDataDriven){if(!s)throw new Error("Expecting data driven values.");var f=s.color,c=f[3]*s.opacity*255;l.push(y.i8888to32(f[0]*c,f[1]*c,f[2]*c,c)),_[0]=s.size,l.push(v[0])}},o);function o(e){var t=n.call(this,e?20:12)||this;return t._isDataDriven=e,t}t.LineVertexBuffer=i;var a,s=(r(l,a=y),l.prototype.isDataDriven=function(){return this._isDataDriven},l.prototype.add=function(e,t,r){var n=this.array;if(n.push(y.i1616to32(e,t)),this._isDataDriven){if(!r)throw new Error("Expecting data driven values.");var i=r.color,o=i[3]*r.opacity*255;n.push(y.i8888to32(i[0]*o,i[1]*o,i[2]*o,o))}},l);function l(e){var t=a.call(this,e?8:4)||this;return t._isDataDriven=e,t}t.FillVertexBuffer=s;var u,f=(r(c,u=y),c.prototype.isDataDriven=function(){return this._isDataDriven},c.prototype.add=function(e,t,r,n,i,o,a){var s=this.array,l=this.index,u=y.i1616to32(e,t);if(s.push(u),u=y.i8888to32(Math.round(15*r),Math.round(15*n),i,o),s.push(u),this._isDataDriven){if(!a)throw new Error("Expecting data driven values.");var f=a.color,c=f[3]*a.opacity*255;s.push(y.i8888to32(f[0]*c,f[1]*c,f[2]*c,c))}return l},c);function c(e){var t=u.call(this,e?12:8)||this;return t._isDataDriven=e,t}t.OutlineVertexBuffer=f;var h,x=(r(d,h=y),d.prototype.isDataDriven=function(){return this._isDataDriven},d.prototype.add=function(e,t,r,n,i,o,a,s,l,u,f){var c=this.array,h=y.i1616to32(e,t);if(c.push(h),h=y.i1616to32(Math.round(8*r),Math.round(8*n)),c.push(h),h=y.i8888to32(i/4,o/4,0,0),c.push(h),h=y.i8888to32(Math.ceil(10*u),p.radToByte(a),10*s,Math.min(10*l,255)),c.push(h),this._isDataDriven){if(!f)throw new Error("Expecting data driven values.");var x=f.color,d=x[3]*f.opacity*255;c.push(y.i8888to32(x[0]*d,x[1]*d,x[2]*d,d)),_[0]=f.size,c.push(v[0])}},d);function d(e){var t=h.call(this,e?24:16)||this;return t._isDataDriven=e,t}t.SymbolVertexBuffer=x;var g,m=(r(I,g=y),I.prototype.add=function(e,t,r,n,i,o,a,s,l,u,f){var c=this.array,h=y.i1616to32(2*e+r,2*t+n);c.push(h);var x=o[3]*a*255;h=y.i8888to32(o[0]*x,o[1]*x,o[2]*x,x),c.push(h);var d=u[3]*f*255;h=y.i8888to32(u[0]*d,u[1]*d,u[2]*d,d),c.push(h),h=y.i8888to32(Math.min(32*s,255),Math.min(4*l,255),Math.min(i,255),0),c.push(h)},I);function I(){return g.call(this,16)||this}t.CircleVertexBuffer=m}.apply(null,n))||(e.exports=i)}}]);