(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/draw/support/drawUtils":1667,"esri/views/draw/support/GraphicMover":1746,"esri/views/draw/support/input/GraphicMoverEvents":1747,"esri/views/draw/support/Reshape":2762})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[73,78],{1667:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(80),i(490),i(305)],void 0===(n=function(e,t,K,N,Q){function b(e,t,i,r){if(null==r||e.hasZ||(r=void 0),"point"===e.type)return e.x+=t,e.y+=i,e.hasZ&&null!=r&&(e.z+=r),e;if("multipoint"===e.type){for(var n=e.points,o=0;o<n.length;o++)n[o]=c(n[o],t,i,r);return e}if("extent"===e.type)return e.xmin+=t,e.xmax+=t,e.ymin+=i,e.ymax+=i,null!=r&&(e.zmin+=r,e.zmax+=r),e;for(var a=Q.geometryToCoordinates(e),s="polyline"===e.type?e.paths:e.rings,h=0;h<a.length;h++){var p=a[h];for(o=0;o<p.length;o++)p[o]=c(p[o],t,i,r)}return"paths"in e?e.paths=s:e.rings=s,e}function c(e,t,i,r){return X(e,e[0]+t,e[1]+i,null!=e[2]&&null!=r?e[2]+r:void 0)}function X(e,t,i,r){var n=[t,i];return 2<e.length&&n.push(null!=r?r:e[2]),3<e.length&&n.push(e[3]),n}Object.defineProperty(t,"__esModule",{value:!0}),t.move=b,t.cloneMove=function(e,t,i,r,n){var o=e.clone(),a=r.resolution;if("point"===o.type){if(n)b(o,t*a,-i*a);else{var s=r.state.transform,h=r.state.inverseTransform,p=s[0]*o.x+s[2]*o.y+s[4],c=s[1]*o.x+s[3]*o.y+s[5];o.x=h[0]*(p+t)+h[2]*(c+i)+h[4],o.y=h[1]*(p+t)+h[3]*(c+i)+h[5]}return o}if("multipoint"===o.type){if(n)b(o,t*a,-i*a);else for(var l=o.points,v=(s=r.state.transform,h=r.state.inverseTransform,0);v<l.length;v++){var d=l[v],y=s[0]*d[0]+s[2]*d[1]+s[4],u=s[1]*d[0]+s[3]*d[1]+s[5];p=h[0]*(y+t)+h[2]*(u+i)+h[4],c=h[1]*(y+t)+h[3]*(u+i)+h[5];l[v]=X(d,p,c,void 0)}return o}if("extent"===o.type){if(n)b(o,t*a,-i*a);else{s=r.state.transform,h=r.state.inverseTransform;var f=s[0]*o.xmin+s[2]*o.ymin+s[4],g=s[1]*o.xmin+s[3]*o.ymin+s[5],m=s[0]*o.xmax+s[2]*o.ymax+s[4],_=s[1]*o.xmax+s[3]*o.ymax+s[5];o.xmin=h[0]*(f+t)+h[2]*(g+i)+h[4],o.ymin=h[1]*(f+t)+h[3]*(g+i)+h[5],o.xmax=h[0]*(m+t)+h[2]*(_+i)+h[4],o.ymax=h[1]*(m+t)+h[3]*(_+i)+h[5]}return o}if(n)b(o,t*a,-i*a);else{for(var x=Q.geometryToCoordinates(o),G=(l="polyline"===o.type?o.paths:o.rings,s=r.state.transform,h=r.state.inverseTransform,0);G<x.length;G++){var w=x[G];for(v=0;v<w.length;v++){d=w[v],y=s[0]*d[0]+s[2]*d[1]+s[4],u=s[1]*d[0]+s[3]*d[1]+s[5],p=h[0]*(y+t)+h[2]*(u+i)+h[4],c=h[1]*(y+t)+h[3]*(u+i)+h[5];w[v]=X(d,p,c,void 0)}}"paths"in o?o.paths=l:o.rings=l}return o},t.scale=function(e,t,i,r){if("point"===e.type){var n=e.x,o=e.y,a=r?r[0]:n,s=r?r[1]:o,h=e.clone(),p=(n-a)*t+a,c=(o-s)*i+s;return h.x=p,h.y=c,h}if("multipoint"===e.type){for(var l=Q.geometryToCoordinates(e),v=K.create(),d=N.getRingsOrPathsBounds(v,[l]),y=d[0],u=d[1],f=d[2],g=d[3],m=r?r[0]:(y+f)/2,_=r?r[1]:(g+u)/2,x=e.clone(),G=x.points,w=0;w<G.length;w++){p=((n=(Z=G[w])[0])-m)*t+m,c=((o=Z[1])-_)*i+_;G[w]=X(Z,p,c,void 0)}return x}if("extent"===e.type){var b=e.xmin,k=e.xmax,E=e.ymin,S=e.ymax,O=r?r[0]:(b+k)/2,M=r?r[1]:(S+E)/2,P=e.clone();if(P.xmin=(b-O)*t+O,P.ymax=(S-M)*i+M,P.xmax=(k-O)*t+O,P.ymin=(E-M)*i+M,P.xmin>P.xmax){var H=P.xmin,D=P.xmax;P.xmin=D,P.xmax=H}if(P.ymin>P.ymax){var R=P.ymin,C=P.ymax;P.ymin=C,P.ymax=R}return P}for(var I=Q.geometryToCoordinates(e),V=K.create(),T=N.getRingsOrPathsBounds(V,I),A=T[0],L=T[1],U=T[2],z=T[3],F=r?r[0]:(A+U)/2,j=r?r[1]:(z+L)/2,q=e.clone(),B="polyline"===q.type?q.paths:q.rings,J=0;J<I.length;J++){var W=I[J];for(w=0;w<W.length;w++){var Z;p=((n=(Z=W[w])[0])-F)*t+F,c=((o=Z[1])-j)*i+j;B[J][w]=X(Z,p,c,void 0)}}return"paths"in q?q.paths=B:q.rings=B,q},t.getScaleRatio=function(e,t,i,r,n,o){var a=Math.sqrt((i-e)*(i-e)+(r-t)*(r-t));return Math.sqrt((n-e)*(n-e)+(o-t)*(o-t))/a},t.getRotationAngle=function(e,t,i,r,n,o){var a=180*Math.atan2(t-r,e-i)/Math.PI;return 180*Math.atan2(t-o,e-n)/Math.PI-a}}.apply(null,r))||(e.exports=n)},1746:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(49),i(54),i(23),i(8),i(15),i(16),i(2),i(1667),i(1747),i(156)],void 0===(n=function(e,t,i,r,h,n,o,l,v,a,s,d,y,p){return u=s.declared(n.EventedAccessor),i(c,u),c.prototype.initialize=function(){var t=this;this._handles.add([a.whenOnce(this,"view.ready",function(){t._viewHandles.add([t.view.on("immediate-click",function(e){return t._clickHandler(e)},p.ViewEventPriorities.TOOL),t.view.on("double-click",function(e){return t._doubleClickHandler(e)},p.ViewEventPriorities.TOOL),t.view.on("pointer-down",function(e){return t._pointerDownHandler(e)},p.ViewEventPriorities.TOOL),t.view.on("pointer-move",function(e){return t._pointerMoveHandler(e)},p.ViewEventPriorities.TOOL),t.view.on("pointer-up",function(e){return t._pointerUpHandler(e)},p.ViewEventPriorities.TOOL),t.view.on("drag",function(e){return t._dragHandler(e)},p.ViewEventPriorities.TOOL),t.view.on("key-down",function(e){return t._keyDownHandler(e)},p.ViewEventPriorities.TOOL)])})])},c.prototype.destroy=function(){this.reset(),this._viewHandles.removeAll(),this._handles.removeAll()},Object.defineProperty(c.prototype,"state",{get:function(){var e=!!this.get("view.ready"),t=!!this.get("graphics.length"),i=this._activeGraphic;return e&&t?i?"moving":"active":e?"ready":"disabled"},enumerable:!0,configurable:!0}),c.prototype.reset=function(){this._activeGraphic=null,this._hoverGraphic=null,this._dragEvent=null},c.prototype.updateGeometry=function(e,t){var i=this.graphics[e];i&&i.set("geometry",t)},c.prototype._clickHandler=function(n){var o=this;this.view.hitTest(v.createScreenPointFromEvent(n)).then(function(e){var t=e.results;if(t.length&&t[0].graphic){var i=t[0].graphic;if(-1<o.graphics.indexOf(i)){var r=new y.GraphicClickEvent(i,o.graphics.indexOf(i),n.x,n.y,n);o.emit("graphic-click",r),o.callbacks.onGraphicClick&&o.callbacks.onGraphicClick(r)}}})},c.prototype._doubleClickHandler=function(n){var o=this;this.view.hitTest(v.createScreenPointFromEvent(n)).then(function(e){var t=e.results;if(t.length&&t[0].graphic){var i=t[0].graphic;if(-1<o.graphics.indexOf(i)){var r=new y.GraphicDoubleClickEvent(i,o.graphics.indexOf(i),n.x,n.y,n);o.emit("graphic-double-click",r),o.callbacks.onGraphicDoubleClick&&o.callbacks.onGraphicDoubleClick(r)}}})},c.prototype._pointerDownHandler=function(a){var s=this;this._pointerDownEvent=a,this.view.hitTest(v.createScreenPointFromEvent(a)).then(function(e){var t=h.find(e.results,function(e){return-1!==s.graphics.indexOf(e.graphic)});if(t){var i=t.graphic;if(-1<s.graphics.indexOf(i)){s._activeGraphic=i;var r=a.x,n=a.y,o=new y.GraphicPointerDownEvent(i,s.graphics.indexOf(i),r,n,a);s.emit("graphic-pointer-down",o),s.callbacks.onGraphicPointerDown&&s.callbacks.onGraphicPointerDown(o)}else i!==s._activeGraphic&&(s._pointerDownEvent=null,s._activeGraphic=null)}else s._pointerDownEvent=null,s._activeGraphic=null})},c.prototype._pointerUpHandler=function(e){if(this._pointerDownEvent=null,this._activeGraphic){var t=e.x,i=e.y,r=this.graphics.indexOf(this._activeGraphic),n=new y.GraphicPointerUpEvent(this._activeGraphic,r,t,i,e);this._activeGraphic=null,this.emit("graphic-pointer-up",n),this.callbacks.onGraphicPointerUp&&this.callbacks.onGraphicPointerUp(n)}},c.prototype._pointerMoveHandler=function(p){var c=this;this._dragEvent||this.view.hitTest(v.createScreenPointFromEvent(p)).then(function(e){var t=e.results;if(t.length&&t[0].graphic){var i=t[0].graphic;if(i===c._hoverGraphic)return;if(-1<c.graphics.indexOf(i)){var r=p.x,n=p.y;if(c._hoverGraphic){var o=c.graphics.indexOf(c._hoverGraphic),a=new y.GraphicPointerOutEvent(c.graphics[o],o,r,n,p);c._hoverGraphic=null,c.emit("graphic-pointer-out",a),c.callbacks.onGraphicPointerOut&&c.callbacks.onGraphicPointerOut(a)}var s=c.graphics.indexOf(i),h=new y.GraphicPointerOverEvent(i,s,r,n,p);return c._hoverGraphic=i,c.emit("graphic-pointer-over",h),void(c.callbacks.onGraphicPointerOver&&c.callbacks.onGraphicPointerOver(h))}}c._hoverGraphic&&(r=p.x,n=p.y,o=c.graphics.indexOf(c._hoverGraphic),h=new y.GraphicPointerOutEvent(c.graphics[o],o,r,n,p),c._hoverGraphic=null,c.emit("graphic-pointer-out",h),c.callbacks.onGraphicPointerOut&&c.callbacks.onGraphicPointerOut(h))})},c.prototype._dragHandler=function(e){var t=this;if(this._pointerDownEvent){if("start"!==e.action&&!this._dragEvent||!this._activeGraphic||!this._activeGraphic.geometry)return;e.stopPropagation();var i=e.x,r=e.y,n=this.graphics.indexOf(this._activeGraphic),o=this._activeGraphic.geometry,a=this._dragEvent?i-this._dragEvent.x:0,s=this._dragEvent?r-this._dragEvent.y:0,h=i-e.origin.x,p=r-e.origin.y;if(this._activeGraphic.geometry=d.cloneMove(o,a,s,this.view),this.enableMoveAllGraphics&&this.graphics.forEach(function(e){e!==t._activeGraphic&&(e.geometry=d.cloneMove(e.geometry,a,s,t.view))}),"start"===(this._dragEvent=e).action){this._initialDragGeometry=l.clone(o);var c=new y.GraphicMoveStartEvent(this._activeGraphic,this.graphics,n,i,r,a,s,h,p,e);this.emit("graphic-move-start",c),this.callbacks.onGraphicMoveStart&&this.callbacks.onGraphicMoveStart(c),c.defaultPrevented&&this._activeGraphic.set("geometry",o)}else"update"===e.action?(c=new y.GraphicMoveEvent(this._activeGraphic,this.graphics,n,i,r,a,s,h,p,e),this.emit("graphic-move",c),this.callbacks.onGraphicMove&&this.callbacks.onGraphicMove(c),c.defaultPrevented&&this._activeGraphic.set("geometry",o)):(this._dragEvent=null,c=new y.GraphicMoveStopEvent(this._activeGraphic,this.graphics,n,i,r,a,s,h,p,e),this.emit("graphic-move-stop",c),this.callbacks.onGraphicMoveStop&&this.callbacks.onGraphicMoveStop(c),c.defaultPrevented&&this.graphics[n].set("geometry",this._initialDragGeometry),this._initialDragGeometry=null)}},c.prototype._keyDownHandler=function(e){"a"!==e.key&&"d"!==e.key&&"n"!==e.key||"moving"!==this.state||e.stopPropagation()},r([s.property()],c.prototype,"_activeGraphic",void 0),r([s.property({readOnly:!0})],c.prototype,"type",void 0),r([s.property()],c.prototype,"callbacks",void 0),r([s.property()],c.prototype,"enableMoveAllGraphics",void 0),r([s.property()],c.prototype,"graphics",void 0),r([s.property({dependsOn:["view.ready","graphics.length","_activeGraphic"],readOnly:!0})],c.prototype,"state",null),r([s.property()],c.prototype,"view",void 0),r([s.subclass("esri.views.draw.support.GraphicMover")],c);function c(e){var t=u.call(this,e)||this;return t._activeGraphic=null,t._dragEvent=null,t._handles=new o,t._hoverGraphic=null,t._initialDragGeometry=null,t._pointerDownEvent=null,t._viewHandles=new o,t.type="graphic-mover",t.callbacks={onGraphicClick:function(){},onGraphicDoubleClick:function(){},onGraphicMoveStart:function(){},onGraphicMove:function(){},onGraphicMoveStop:function(){},onGraphicPointerOver:function(){},onGraphicPointerOut:function(){},onGraphicPointerDown:function(){},onGraphicPointerUp:function(){}},t.enableMoveAllGraphics=!1,t.graphics=[],t.view=null,t}var u}.apply(null,r))||(e.exports=n)},1747:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function i(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-click"}t.GraphicClickEvent=i;function r(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-double-click"}t.GraphicDoubleClickEvent=r;var n=(o.prototype.preventDefault=function(){this.defaultPrevented=!0},o);function o(e,t,i,r,n,o,a,s,h,p){this.graphic=e,this.allGraphics=t,this.index=i,this.x=r,this.y=n,this.dx=o,this.dy=a,this.totalDx=s,this.totalDy=h,this.viewEvent=p,this.defaultPrevented=!1,this.type="graphic-move-start"}t.GraphicMoveStartEvent=n;var a=(s.prototype.preventDefault=function(){this.defaultPrevented=!0},s);function s(e,t,i,r,n,o,a,s,h,p){this.graphic=e,this.allGraphics=t,this.index=i,this.x=r,this.y=n,this.dx=o,this.dy=a,this.totalDx=s,this.totalDy=h,this.viewEvent=p,this.defaultPrevented=!1,this.type="graphic-move"}t.GraphicMoveEvent=a;var h=(p.prototype.preventDefault=function(){this.defaultPrevented=!0},p);function p(e,t,i,r,n,o,a,s,h,p){this.graphic=e,this.allGraphics=t,this.index=i,this.x=r,this.y=n,this.dx=o,this.dy=a,this.totalDx=s,this.totalDy=h,this.viewEvent=p,this.defaultPrevented=!1,this.type="graphic-move-stop"}t.GraphicMoveStopEvent=h;function c(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-over"}t.GraphicPointerOverEvent=c;function l(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-out"}t.GraphicPointerOutEvent=l;function v(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-down"}t.GraphicPointerDownEvent=v;function d(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-up"}t.GraphicPointerUpEvent=d}.apply(null,r))||(e.exports=n)},2762:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(28),i(89),i(54),i(23),i(12),i(16),i(2),i(305),i(167),i(1667),i(1746),i(1789),i(156)],void 0===(n=function(e,t,i,r,_,k,n,o,C,a,s,x,h,I,p,c,l){var v,d=function(e,t,i){this.graphic=e,this.mover=t,this.selected=i,this.type="reshape-start"},y=function(e,t,i){this.graphic=e,this.mover=t,this.selected=i,this.type="reshape"},u=function(e,t,i){this.graphic=e,this.mover=t,this.selected=i,this.type="reshape-stop"},f=function(e,t,i){this.mover=e,this.dx=t,this.dy=i,this.type="move-start"},g=function(e,t,i){this.mover=e,this.dx=t,this.dy=i,this.type="move"},m=function(e,t,i){this.mover=e,this.dx=t,this.dy=i,this.type="move-stop"},G=function(e){this.added=e,this.type="vertex-select"},w=function(e){this.removed=e,this.type="vertex-deselect"},b=function(e,t,i){this.added=e,this.graphic=t,this.oldGraphic=i,this.type="vertex-add"},E=function(e,t,i){this.removed=e,this.graphic=t,this.oldGraphic=i,this.type="vertex-remove"},S={removeVertex:["Backspace","Delete"]};return v=s.declared(n.EventedAccessor),i(O,v),O.prototype.initialize=function(){var i=this;this._setup(),this._handles.add([a.whenOnce(this,"view.ready",function(){var e=i.layer,t=i.view;c.addUniqueLayer(t,e),i._viewHandles.add([t.on("key-down",function(e){return i._keyDownHandler(e)},l.ViewEventPriorities.TOOL)])}),a.pausable(this,"graphic",function(){return i.refresh()}),a.pausable(this,"layer",function(e,t){t&&(i._clearSelection(),i._resetGraphics(t)),i.refresh()}),a.pausable(this,"enableMidpoints",function(){i.refresh()})])},O.prototype.destroy=function(){this._reset(),this._mover&&this._mover.destroy(),this._mover=null,this._handles.removeAll(),this._handles=null,this._viewHandles.removeAll(),this._viewHandles=null},Object.defineProperty(O.prototype,"state",{get:function(){var e=!!this.get("view.ready"),t=!(!this.get("graphic")||!this.get("layer"));return e&&t?"active":e?"ready":"disabled"},enumerable:!0,configurable:!0}),O.prototype.isUIGraphic=function(e){var t=[];return this.graphic&&t.push(this.graphic),t.concat(this.handleGraphics,this.midpointGraphics),t.length&&-1<t.indexOf(e)},O.prototype.refresh=function(){this._reset(),this._setup()},O.prototype.reset=function(){this.graphic=null},O.prototype.clearSelection=function(){this._clearSelection()},O.prototype.removeSelectedHandles=function(){this.selectedHandles.length&&this._removeVertex(this.selectedHandles)},O.prototype._setup=function(){this.graphic&&this.layer&&(this._setupGraphics(),this._setupMover())},O.prototype._reset=function(){this._clearSelection(),this._resetGraphicStateVars(),this._resetGraphics(),this._mover&&this._mover.destroy(),this._mover=null,this.view.cursor="default"},O.prototype._resetGraphicStateVars=function(){this._totalDx=0,this._totalDy=0},O.prototype._resetGraphics=function(e){var t=e||this.layer;t&&(t.removeMany(this.handleGraphics),t.removeMany(this.midpointGraphics)),this.handleGraphics.forEach(function(e){return e.destroy()}),this.midpointGraphics.forEach(function(e){return e.destroy()}),this._set("handleGraphics",[]),this._set("midpointGraphics",[]),this._set("selectedHandles",[])},O.prototype._setupGraphics=function(){var e=C.expect(this.graphic.geometry),t=x.geometryToCoordinates(e.clone());if("polygon"===e.type)for(var i=0,r=t;i<r.length;i++){var n=r[i],o=n[n.length-1];n[0][0]===o[0]&&n[0][1]===o[1]&&2<n.length&&n.pop()}this._set("handleGraphics",this._createHandleGraphics(t)),this.enableMidpoints&&this._set("midpointGraphics",this._createMidpointGraphics(t)),this._saveRelatedIndices(this.handleGraphics),this.layer.addMany(this.midpointGraphics),this.layer.addMany(this.handleGraphics)},O.prototype._createHandleGraphics=function(e){for(var t=[],i=0,r=e;i<r.length;i++)for(var n=r[i],o=e.indexOf(n),a=0,s=n;a<s.length;a++){var h=s[a],p=n.indexOf(h),c=h[0],l=h[1];t.push(new k({geometry:new _.Point({x:c,y:l,spatialReference:this.view.spatialReference}),symbol:this.handleSymbol,attributes:{pathIndex:o,pointIndex:p}}))}return t},O.prototype._createMidpointGraphics=function(e){for(var t=[],i=0,r=e;i<r.length;i++)for(var n=r[i],o=e.indexOf(n),a=0,s=n;a<s.length;a++){var h=s[a],p=n.indexOf(h),c=h[0],l=h[1],v=n[p+1]?p+1:0;if("polygon"===C.get(this.graphic.geometry,"type")||0!==v){var d=n[v],y=d[0],u=d[1],f=x.getMidpoint([c,l],[y,u]),g=f[0],m=f[1];t.push(new k({geometry:new _.Point({x:g,y:m,spatialReference:this.view.spatialReference}),symbol:this.midpointSymbol,attributes:{pathIndex:o,pointIndexStart:p,pointIndexEnd:v}}))}}return t},O.prototype._saveRelatedIndices=function(e){for(var t=0,i=e;t<i.length;t++){for(var r=i[t],n=e.indexOf(r),o=[],a=r.geometry,s=a.x,h=a.y,p=0,c=e;p<c.length;p++){var l=c[p],v=e.indexOf(l);if(n!==v){var d=l.geometry,y=d.x,u=d.y;s===y&&h===u&&o.push(v)}}r.attributes.relatedGraphicIndices=o}},O.prototype._setupMover=function(){var t=this;this._mover=new p({enableMoveAllGraphics:!1,graphics:[].concat(this.handleGraphics,this.graphic,this.midpointGraphics),view:this.view,callbacks:{onGraphicClick:function(e){return t._onGraphicClickCallback(e)},onGraphicMoveStart:function(e){return t._onGraphicMoveStartCallback(e)},onGraphicMove:function(e){return t._onGraphicMoveCallback(e)},onGraphicMoveStop:function(e){return t._onGraphicMoveStopCallback(e)},onGraphicPointerOver:function(e){return t._onGraphicPointerOverCallback(e)},onGraphicPointerOut:function(e){return t._onGraphicPointerOutCallback(e)}}})},O.prototype._onGraphicClickCallback=function(e){var t=e.graphic;if(t!==this.graphic)if(-1<this.midpointGraphics.indexOf(t)){if(e.viewEvent.stopPropagation(),2===e.viewEvent.button)return;var i=this.graphic.clone();this._createHandleFromMidpoint(t),this.refresh(),this._emitVertexAddEvent([t],i)}else-1<this.handleGraphics.indexOf(t)&&(e.viewEvent.stopPropagation(),2===e.viewEvent.button?this._removeVertex(t):(e.viewEvent.native.shiftKey||this._clearSelection(),-1===this.selectedHandles.indexOf(t)?this._addToSelection(t):this._removeFromSelection(t,!0)));else this.clearSelection()},O.prototype._onGraphicMoveStartCallback=function(e){var t=e.graphic;if(this._resetGraphicStateVars(),t===this.graphic){var i=e.dx,r=e.dy;return this.handleGraphics.forEach(function(e){return e.visible=!1}),this.midpointGraphics.forEach(function(e){return e.visible=!1}),this._clearSelection(),void this._emitMoveStartEvent(i,r)}-1<this.midpointGraphics.indexOf(t)?(this._clearSelection(),this._createHandleFromMidpoint(t),this._addToSelection(t)):-1===this.selectedHandles.indexOf(t)&&(this._clearSelection(),this._addToSelection(t)),this._emitReshapeStartEvent(t)},O.prototype._onGraphicMoveCallback=function(e){var t=e.graphic,i=e.dx,r=e.dy;this._totalDx+=i,this._totalDy+=r,t===this.graphic?this._emitMoveEvent(i,r):(this._syncGeometryAfterHandleMove(t,i,r),this._emitReshapeEvent(t))},O.prototype._onGraphicMoveStopCallback=function(e){var t=e.graphic,i=e.dx,r=e.dy;if(this._totalDx+=i,this._totalDy+=r,t===this.graphic){for(var n=0,o=[].concat(this.handleGraphics,this.midpointGraphics);n<o.length;n++)o[n].visible=!0;this._syncGraphicsWithGeometry(),this._emitMoveStopEvent()}else this._syncGeometryAfterHandleMove(t,i,r),-1<this.midpointGraphics.indexOf(t)&&this.refresh(),this._emitReshapeStopEvent(t);this._resetGraphicStateVars()},O.prototype._syncGraphicsWithGeometry=function(){var e=this.graphic.geometry,t="polyline"===e.type?e.paths:e.rings;this._updateHandleGraphicLocations(t),this._updateMidpointGraphicLocations(t)},O.prototype._updateHandleGraphicLocations=function(e){for(var t=0,i=this.handleGraphics;t<i.length;t++){var r=i[t],n=r.attributes,o=n.pathIndex,a=n.pointIndex,s=e[o][a],h=s[0],p=s[1];r.set("geometry",new _.Point(h,p,this.view.spatialReference))}},O.prototype._updateMidpointGraphicLocations=function(e){for(var t=0,i=this.midpointGraphics;t<i.length;t++){var r=i[t],n=r.attributes,o=n.pathIndex,a=n.pointIndexStart,s=n.pointIndexEnd,h=e[o][a],p=h[0],c=h[1],l=e[o][s],v=l[0],d=l[1],y=x.getMidpoint([p,c],[v,d]),u=y[0],f=y[1];r.geometry=new _.Point({x:u,y:f,spatialReference:this.view.spatialReference})}},O.prototype._syncGeometryAfterHandleMove=function(e,t,i){var r=C.expect(this.graphic.geometry).clone(),n="polyline"===r.type?r.paths:r.rings,o=e.attributes,a=o.pathIndex,s=o.pointIndex,h=e.geometry,p=h.x,c=h.y,l=n[a].length-1;if(n[a][s]=[p,c],"polygon"===r.type&&(0===s?n[a][l]=[p,c]:s===l&&(n[a][0]=[p,c])),-1<this.handleGraphics.indexOf(e)){for(var v=0,d=e.attributes.relatedGraphicIndices;v<d.length;v++){var y=d[v],u=(P=this.handleGraphics[y]).attributes,f=u.pathIndex,g=u.pointIndex;n[f][g]=[p,c],P.geometry=e.geometry}for(var m=0,_=this.selectedHandles;m<_.length;m++){var x=_[m];if(x!==e){var G=x.attributes,w=G.pathIndex,b=G.pointIndex,k=G.relatedGraphicIndices,E=I.cloneMove(x.geometry,t,i,this.view),S=n[w].length-1;n[w][b]=[E.x,E.y],x.geometry=E,"polygon"===r.type&&(0===b?n[w][S]=[E.x,E.y]:b===S&&(n[w][0]=[E.x,E.y]));for(var O=0,M=k;O<M.length;O++){y=M[O];var P,H=(P=this.handleGraphics[y]).attributes,D=H.pathIndex,R=H.pointIndex;n[D][R]=[E.x,E.y],P.geometry=E}}}this._updateMidpointGraphicLocations(n)}this.graphic.geometry=r},O.prototype._onGraphicPointerOverCallback=function(e){var t=e.graphic;-1<this.handleGraphics.indexOf(t)&&-1===this.selectedHandles.indexOf(t)&&(t.symbol=this.handleHoverSymbol),this.view.cursor="pointer"},O.prototype._onGraphicPointerOutCallback=function(e){var t=e.graphic;-1<this.handleGraphics.indexOf(t)&&-1===this.selectedHandles.indexOf(t)&&(t.symbol=this.handleSymbol),this.view.cursor="default"},O.prototype._createHandleFromMidpoint=function(e){var t=C.expect(this.graphic.geometry).clone(),i=e.attributes,r=i.pathIndex,n=i.pointIndexStart,o=i.pointIndexEnd,a=e.geometry,s=a.x,h=a.y,p=0===o?n+1:o;("polyline"===t.type?t.paths:t.rings)[r].splice(p,0,[s,h]),e.attributes={pathIndex:r,pointIndex:p,relatedGraphicIndices:[]},this.graphic.geometry=t},O.prototype._removeHandles=function(e){var t=C.expect(this.graphic.geometry).clone(),i="polygon"===t.type?t.rings:t.paths;e instanceof k&&(e=[e]);for(var r=0,n=e;r<n.length;r++)for(var o=n[r].geometry,a=o.x,s=o.y,h=0;h<i.length;h++)for(var p=i[h],c=0;c<p.length;c++){var l=p[c],v=l[0],d=l[1];a===v&&s===d&&i[h].splice(Number(c),1)}if("polygon"===t.type)for(var y=0,u=i;y<u.length;y++){var f=u[y],g=f[0],m=(a=g[0],s=g[1],f[f.length-1]),_=m[0],x=m[1];(1===f.length||f.length<3&&a===_&&s===x)&&i.splice(i.indexOf(f),1),2<f.length&&(a!==_||s!==x)&&f.push(f[0])}else for(var G=0,w=i;G<w.length;G++){var b=w[G];1===b.length&&i.splice(i.indexOf(b),1)}this.graphic.geometry=t},O.prototype._addToSelection=function(e){e instanceof k&&(e=[e]);for(var t=0,i=e;t<i.length;t++)i[t].symbol=this.handleSelectionSymbol;this._set("selectedHandles",this.selectedHandles.concat(e)),this._emitSelectEvent(e)},O.prototype._removeFromSelection=function(e,t){var i=t?this.handleHoverSymbol:this.handleSymbol;e instanceof k&&(e=[e]);for(var r=0,n=e;r<n.length;r++){var o=n[r];this.selectedHandles.splice(this.selectedHandles.indexOf(o),1),this._set("selectedHandles",this.selectedHandles),o.symbol=i}this._emitDeselectEvent(e)},O.prototype._clearSelection=function(){if(this.selectedHandles.length){for(var e=this.selectedHandles,t=0,i=this.selectedHandles;t<i.length;t++){var r=i[t];r&&(r.symbol=this.handleSymbol)}this._set("selectedHandles",[]),this._emitDeselectEvent(e)}},O.prototype._keyDownHandler=function(e){-1<S.removeVertex.indexOf(e.key)&&!e.repeat&&this.selectedHandles.length&&this._removeVertex(this.selectedHandles)},O.prototype._removeVertex=function(e){if(!("polygon"===this.graphic.geometry.type&&this.handleGraphics.length<4||this.handleGraphics.length<3)){var t=this.graphic.clone();e instanceof k&&(e=[e]),this._removeHandles(e),this.refresh(),this._emitVertexRemoveEvent(e,t)}},O.prototype._emitMoveStartEvent=function(e,t){var i=new f(this.graphic,e,t);this.emit("move-start",i),this.callbacks.onMoveStart&&this.callbacks.onMoveStart(i)},O.prototype._emitMoveEvent=function(e,t){var i=new g(this.graphic,e,t);this.emit("move",i),this.callbacks.onMove&&this.callbacks.onMove(i)},O.prototype._emitMoveStopEvent=function(){var e=new m(this.graphic,this._totalDx,this._totalDy);this.emit("move-stop",e),this.callbacks.onMoveStop&&this.callbacks.onMoveStop(e)},O.prototype._emitReshapeStartEvent=function(e){var t=new d(this.graphic,e,this.selectedHandles);this.emit("reshape-start",t),this.callbacks.onReshapeStart&&this.callbacks.onReshapeStart(t)},O.prototype._emitReshapeEvent=function(e){var t=new y(this.graphic,e,this.selectedHandles);this.emit("reshape",t),this.callbacks.onReshape&&this.callbacks.onReshape(t)},O.prototype._emitReshapeStopEvent=function(e){var t=new u(this.graphic,e,this.selectedHandles);this.emit("reshape-stop",t),this.callbacks.onReshapeStop&&this.callbacks.onReshapeStop(t)},O.prototype._emitSelectEvent=function(e){var t=new G(e);this.emit("select",t),this.callbacks.onVertexSelect&&this.callbacks.onVertexSelect(t)},O.prototype._emitDeselectEvent=function(e){var t=new w(e);this.emit("deselect",t),this.callbacks.onVertexDeselect&&this.callbacks.onVertexDeselect(t)},O.prototype._emitVertexAddEvent=function(e,t){var i=new b(e,this.graphic,t);this.emit("vertex-add",i),this.callbacks.onVertexAdd&&this.callbacks.onVertexAdd(i)},O.prototype._emitVertexRemoveEvent=function(e,t){var i=new E(e,this.graphic,t);this.emit("vertex-remove",i),this.callbacks.onVertexRemove&&this.callbacks.onVertexRemove(i)},r([s.property({readOnly:!0})],O.prototype,"type",void 0),r([s.property()],O.prototype,"callbacks",void 0),r([s.property()],O.prototype,"graphic",void 0),r([s.property({readOnly:!0})],O.prototype,"handleGraphics",void 0),r([s.property()],O.prototype,"handleHoverSymbol",void 0),r([s.property()],O.prototype,"handleSelectionSymbol",void 0),r([s.property()],O.prototype,"handleSymbol",void 0),r([s.property()],O.prototype,"layer",void 0),r([s.property({readOnly:!0})],O.prototype,"midpointGraphics",void 0),r([s.property()],O.prototype,"midpointSymbol",void 0),r([s.property()],O.prototype,"enableMidpoints",void 0),r([s.property({readOnly:!0})],O.prototype,"selectedHandles",void 0),r([s.property({dependsOn:["view.ready","graphic","layer"],readOnly:!0})],O.prototype,"state",null),r([s.property()],O.prototype,"view",void 0),r([s.subclass("esri.views.draw.support.Reshape")],O);function O(e){var t=v.call(this,e)||this;return t._handles=new o,t._mover=null,t._viewHandles=new o,t._totalDx=0,t._totalDy=0,t.type="reshape",t.callbacks={onReshapeStart:function(){},onReshape:function(){},onReshapeStop:function(){},onMoveStart:function(){},onMove:function(){},onMoveStop:function(){}},t.graphic=null,t.handleGraphics=[],t.handleHoverSymbol=new h({style:"circle",size:8,color:[33,205,255],outline:{color:[0,12,255],width:1}}),t.handleSelectionSymbol=new h({style:"circle",size:8,color:[255,255,255],outline:{color:[0,12,255],width:1}}),t.handleSymbol=new h({style:"circle",size:6,color:[33,205,255],outline:{color:[0,12,255],width:1}}),t.layer=null,t.midpointGraphics=[],t.midpointSymbol=new h({style:"circle",size:6,color:[200,200,200],outline:{color:[100,100,100],width:1}}),t.enableMidpoints=!0,t.selectedHandles=[],t.view=null,t}}.apply(null,r))||(e.exports=n)}}]);