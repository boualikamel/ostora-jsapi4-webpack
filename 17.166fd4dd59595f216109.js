(function(){(this||window).webpackJsonp.registerAbsMids({"esri/tasks/operations/PBFWorker":1568,"esri/tasks/operations/query":1569,"esri/tasks/operations/urlUtils":1632,"esri/tasks/operations/pbfQueryUtils":1634,"esri/tasks/operations/pbfFeatureServiceParser":1643,"esri/tasks/operations/pbfDehydratedFeatureSet":1644,"esri/tasks/operations/pbfOptimizedFeatureSet":1645,"esri/layers/graphics/data/QueryEngineCapabilities":1724,"esri/views/2d/layers/features/controllers/BaseController":1984,"esri/geohash/geohashUtils":1985,"esri/views/2d/layers/features/support/ClusterStore":2769,"esri/geohash/GeohashTree":2770,"esri/views/2d/layers/features/support/pixelBuffering":2771})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[17,61,69,89],{1568:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(89),r(4),r(304),r(208),r(31),r(205),r(1634),r.dj.m(e)],void 0===(i=function(e,t,r,u,i,n,o,l,c,a,s){Object.defineProperty(t,"__esModule",{value:!0});var h,p=(y.prototype._parseFeatureQuery=function(e){var t=a.parsePBFFeatureQuery(e.buffer,e.options);if(e.options&&"dehydrated"===e.options.type){var r=t;if(t.spatialReference=r.spatialReference.toJSON(),r.fields)for(var n=0;n<r.fields.length;n++)r.fields[n]=r.fields[n].toJSON()}return i.resolve(t)},y),d=(r(f,h=p),f.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},f.prototype.parseFeatureQuery=function(e,s){return e&&0!==e.byteLength?this._thread?this._thread.invoke("_parseFeatureQuery",{buffer:e,options:s},{transferList:[e]}).then(function(e){if(s&&"dehydrated"===s.type){var t=e;if(t.spatialReference=l.fromJSON(t.spatialReference),t.fields)for(var r=0;r<t.fields.length;r++)t.fields[r]=c.fromJSON(t.fields[r]);for(var n=t.spatialReference,i=0,o=t.features;i<o.length;i++){var a=o[i];a.uid=u.generateUID(),a.geometry&&(a.geometry.spatialReference=n)}}return e}):i.resolve(a.parsePBFFeatureQuery(e,s)):i.resolve(null)},f);function f(){var t=h.call(this)||this;return t._thread=void 0,o.open(n.getAbsMid("./PBFWorker",e,s),{strategy:"dedicated"}).then(function(e){void 0===t._thread?t._thread=e:e.close()}),t}function y(){}t.PBFWorker=d,t.default=function(){return new p}}.apply(null,n))||(e.exports=i)},1569:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(29),r(12),r(22),r(38),r(485),r(1634),r(1568),r(1632),r(47)],void 0===(i=function(e,t,u,l,c,r,h,p,o,a,d){function f(e,t){var r=e.geometry,n=e.toJSON(),i=n;if(r&&(i.geometry=JSON.stringify(r),i.geometryType=h.getJsonType(r),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),n.groupByFieldsForStatistics&&(i.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(i.objectIds=n.objectIds.join(",")),n.orderByFields&&(i.orderByFields=n.orderByFields.join(",")),!n.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete i.outFields:-1!==n.outFields.indexOf("*")?i.outFields="*":i.outFields=n.outFields.join(","),n.outSR?i.outSR=n.outSR.wkid||JSON.stringify(n.outSR):r&&(n.returnGeometry||n.returnCentroid)&&(i.outSR=i.inSR),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(i.outStatistics=JSON.stringify(n.outStatistics)),n.pixelSize&&(i.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(i.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.source&&(i.layer=JSON.stringify({source:n.source}),delete n.source),n.timeExtent){var o=n.timeExtent,a=o.start,s=o.end;null==a&&null==s||(i.time=a===s?a:(null==a?"null":a)+","+(null==s?"null":s)),delete n.timeExtent}return i}function s(e,n,i,o,a){void 0===o&&(o={});var s="string"==typeof e?r.urlToObject(e):e,t=n.geometry?[n.geometry]:[];return o.responseType="pbf"===i?"array-buffer":"json",p.normalizeCentralMeridian(t,null,o).then(function(e){var t=e&&e[0];c.isSome(t)&&((n=n.clone()).geometry=t);var r=d.mapParameters(u({},s.query,{f:i},a,f(n,a)));return l(s.path+"/query",u({},o,{query:r}))})}Object.defineProperty(t,"__esModule",{value:!0});var y,n="Layer does not support extent calculation.";t.queryToQueryStringParameters=f,t.executeQuery=function(e,t,r){return s(e,t,"json",r)},t.executeQueryPBF=function(e,t,n,r){var i=n.useWorker?(null==y&&(y=new a.PBFWorker),y):null;return s(e,t,"pbf",r).then(function(r){function t(e){var t=r;return t.data=e,t}return n.useWorker?i.parseFeatureQuery(r.data,n).then(function(e){return t(e)}):t(o.parsePBFFeatureQuery(r.data,n))})},t.executeQueryForIds=function(e,t,r){return s(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return s(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return s(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(n);if(t.hasOwnProperty("count"))throw new Error(n);return e})}}.apply(null,n))||(e.exports=i)},1632:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var n in t)if("declaredClass"!==n){var i=t[n];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){r[n]=[];for(var o=0;o<i.length;o++)r[n][o]=e(i[o])}else"object"==typeof i?i.toJSON&&(r[n]=JSON.stringify(i)):r[n]=i}return r}}.apply(null,n))||(e.exports=i)},1634:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1643)],void 0===(i=function(e,t,s){Object.defineProperty(t,"__esModule",{value:!0}),t.parsePBFFeatureQuery=function(e,t){var r=s.parseFeatureQuery(e,t).queryResult.featureResult;if(r&&r.features&&r.features.length&&r.objectIdFieldName)for(var n=r.objectIdFieldName,i=0,o=r.features;i<o.length;i++){var a=o[i];a.attributes&&(a.objectId=a.attributes[n])}return r}}.apply(null,n))||(e.exports=i)},1643:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(6),r(3),r(489),r(1644),r(1645)],void 0===(i=function(e,t,s,r,u,l,c){function n(e){return e>=I.length?null:I[e]}function i(e){return e>=T.length?null:T[e]}function o(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function h(e,t,r){for(var n=t.createPointGeometry(r);e.next();)switch(e.tag()){case 3:for(var i=e.getUInt32(),o=e.pos()+i,a=0;e.pos()<o;)t.addCoordinatePoint(n,e.getSInt64(),0,a++);break;case 1:case 2:default:e.skip()}return n}function p(e,t,r){for(var n=t.createGeometry(r),i=2+(r.hasZ?1:0)+(r.hasM?1:0);e.next();)switch(e.tag()){case 2:for(var o=e.getUInt32(),a=e.pos()+o,s=0;e.pos()<a;)t.addLength(n,e.getUInt32(),s++);break;case 3:for(var u=e.getUInt32(),l=(a=e.pos()+u,0),c=0;e.pos()<a;)t.addCoordinate(n,e.getSInt64(),c,l),++l==i&&(c++,l=0);break;case 1:default:e.skip()}return n}function d(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function a(e){for(var t={type:n(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=n(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=(r=e.getEnum())>=F.length?null:F[r];break;case 5:case 6:default:e.skip()}var r;return t}function f(e,t,r,n){for(var i=t.createFeature(r),o=0;e.next();)switch(e.tag()){case 1:var a=n[o++].name;i.attributes[a]=e.processMessage(d);break;case 2:i.geometry=e.processMessageWithArgs(p,t,r);break;case 4:i.centroid=e.processMessageWithArgs(h,t,r);break;default:e.skip()}return i}function y(e){for(var t=[1,1,1,1];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function g(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function v(e){for(var t={originPosition:i(0)};e.next();)switch(e.tag()){case 1:t.originPosition=i(e.getEnum());break;case 2:t.scale=e.processMessage(y);break;case 3:t.translate=e.processMessage(g);break;default:e.skip()}return t}function m(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function b(e,t){for(var r=t.createSpatialReference();e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:case 3:case 4:default:e.skip()}return r}function _(e,t){var r=t.createFeatureResult();r.geometryType=o(t,0);for(var n=!1;e.next();)switch(e.tag()){case 1:r.objectIdFieldName=e.getString();break;case 3:r.globalIdFieldName=e.getString();break;case 4:r.geohashFieldName=e.getString();break;case 5:r.geometryProperties=e.processMessage(m);break;case 7:r.geometryType=o(t,e.getEnum());break;case 8:r.spatialReference=e.processMessageWithArgs(b,t);break;case 10:r.hasZ=e.getBool();break;case 11:r.hasM=e.getBool();break;case 12:r.transform=e.processMessage(v);break;case 9:var i=e.getBool();r.exceededTransferLimit=i;break;case 13:t.addField(r,e.processMessage(a));break;case 15:n||(t.prepareFeatures(r),n=!0),t.addFeature(r,e.processMessageWithArgs(f,t,r,r.fields));break;case 2:case 6:default:e.skip()}return t.finishFeatureResult(r),r}function x(e,t){for(var r={};e.next();)switch(e.tag()){case 1:r.featureResult=e.processMessageWithArgs(_,t);break;default:e.skip()}return r}Object.defineProperty(t,"__esModule",{value:!0});var S=r.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),I=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],F=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],T=["upperLeft","lowerLeft"];t.parseFeatureQuery=function(e,t){var r,n=(r=t)&&"dehydrated"===r.type?new l.Context(r):new c.Context;try{for(var i=new u(new Uint8Array(e),new DataView(e)),o={};i.next();)switch(i.tag()){case 2:o.queryResult=i.processMessageWithArgs(x,n);break;default:i.skip()}return o}catch(e){var a=new s("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return S.error(a),{queryResult:{featureResult:n.createFeatureResult()}}}}}.apply(null,n))||(e.exports=i)},1644:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(89),r(34),r(31),r(486),r(205)],void 0===(i=function(e,t,r,n,i,o,a){function s(e,t){return t}function u(e,t,r,n){switch(r){case 0:return p(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?p:d)(e,t+n,1)}}function l(e,t,r,n){switch(r){case 0:return p(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?p:d)(e,t+n,1);case 2:return p(e,t,2)}}function c(e,t,r,n){switch(r){case 0:return p(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?p:d)(e,t+n,1);case 2:return p(e,t,3)}}function h(e,t,r,n){switch(r){case 0:return p(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?p:d)(e,t+n,1);case 2:return p(e,t,2);case 3:return p(e,t,3)}}function p(e,t,r){var n=e.translate,i=e.scale;return n[r]+t*i[r]}function d(e,t,r){var n=e.translate,i=e.scale;return n[r]-t*i[r]}Object.defineProperty(t,"__esModule",{value:!0});var f=(y.prototype.createFeatureResult=function(){return new o.DehydratedFeatureSetClass},y.prototype.finishFeatureResult=function(e){this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0},y.prototype.createSpatialReference=function(){return new i},y.prototype.addField=function(e,t){e.fields.push(a.fromJSON(t));var r=e.fields.map(function(e){return e.name});this.AttributesConstructor=function(){for(var e=0,t=r;e<t.length;e++)this[t[e]]=null}},y.prototype.addFeature=function(e,t){var r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(0<r)for(var n in t.attributes){var i=t.attributes[n];"string"==typeof i&&i.length>r&&(t.attributes[n]="")}e.features.push(t)},y.prototype.prepareFeatures=function(e){var i=this;switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"point":this.addCoordinate=function(e,t,r,n){return i.addCoordinatePoint(e,t,n)},this.createGeometry=function(e){return i.createPointGeometry(e)};break;case"polygon":this.addCoordinate=function(e,t,r,n){return i.addCoordinatePolygon(e,t,n)},this.createGeometry=function(e){return i.createPolygonGeometry(e)};break;case"polyline":this.addCoordinate=function(e,t,r,n){return i.addCoordinatePolyline(e,t,n)},this.createGeometry=function(e){return i.createPolylineGeometry(e)};break;case"multipoint":this.addCoordinate=function(e,t,r,n){return i.addCoordinateMultipoint(e,t,n)},this.createGeometry=function(e){return i.createMultipointGeometry(e)};break;default:n.neverReached(e.geometryType)}},y.prototype.createFeature=function(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,new o.DehydratedFeatureClass(r.generateUID(),null,new this.AttributesConstructor)},y.prototype.addLength=function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)},y.prototype.createPointGeometry=function(e){var t={type:"point",x:0,y:0,spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM};return t.hasZ&&(t.z=0),t.hasM&&(t.m=0),t},y.prototype.addCoordinatePoint=function(e,t,r){switch(t=this.applyTransform(this.transform,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:e.hasZ?e.z=t:e.m=t;break;case 3:e.m=t}},y.prototype.transformPathLikeValue=function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)},y.prototype.addCoordinatePolyline=function(e,t,r){this.dehydratedAddPointsCoordinate(e.paths,t,r)},y.prototype.addCoordinatePolygon=function(e,t,r){this.dehydratedAddPointsCoordinate(e.rings,t,r)},y.prototype.addCoordinateMultipoint=function(e,t,r){0===r&&e.points.push([]);var n=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(n)},y.prototype.createPolygonGeometry=function(e){return{type:"polygon",rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},y.prototype.createPolylineGeometry=function(e){return{type:"polyline",paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},y.prototype.createMultipointGeometry=function(e){return{type:"multipoint",points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},y.prototype.dehydratedAddPointsCoordinate=function(e,t,r){if(null===this.coordinateBuffer){var n=this.lengths.reduce(function(e,t){return e+t},0);this.coordinateBuffer=new Float64Array(n*this.vertexDimension)}0===r&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var i=this.transformPathLikeValue(t,r),o=e[e.length-1];0===r&&o.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=i},y.prototype.deriveApplyTransform=function(e){var t=e.hasZ,r=e.hasM;return t&&r?h:t?l:r?c:u},y);function y(e){this.options=e,this.geometryTypes=["point","multipoint","polyline","polygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=s,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}t.Context=f}.apply(null,n))||(e.exports=i)},1645:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(487),r(493),r(302)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=(a.prototype.createFeatureResult=function(){return new n.default},a.prototype.prepareFeatures=function(){},a.prototype.finishFeatureResult=function(){},a.prototype.addFeature=function(e,t){e.features.push(t)},a.prototype.createFeature=function(){return new r.default},a.prototype.createSpatialReference=function(){return{wkid:0}},a.prototype.createGeometry=function(){return new i.default},a.prototype.addField=function(e,t){e.fields.push(t)},a.prototype.addCoordinate=function(e,t){e.coords.push(t)},a.prototype.addCoordinatePoint=function(e,t){e.coords.push(t)},a.prototype.addLength=function(e,t){e.lengths.push(t)},a.prototype.createPointGeometry=function(){return new i.default},a);function a(){this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"]}t.Context=o}.apply(null,n))||(e.exports=i)},1724:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}.apply(null,n))||(e.exports=i)},1984:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(9),r(10),r(1),r(5),r(6),r(206),r(14),r(3),r(12),r(4),r(2),r(1695),r(1723),r(488),r(157),r(513),r(301),r(90),r(1894),r(2769),r(2771)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,h,p,d,f,y,g,v,m,b,_,x,S,I){function F(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return n=(r=t)&&r.getSymbols(),"backgroundFillSymbol"in r&&null!=r.backgroundFillSymbol&&"outline"in r.backgroundFillSymbol&&null!=r.backgroundFillSymbol.outline||n.some(function(e){return"outline"in e&&null!=e.outline})}var r,n}Object.defineProperty(t,"__esModule",{value:!0});var T,w=c.getLogger("esri.views.2d.layers.features.controllers.BaseController"),M=(T=d.declared(u.HandleOwner),o(k,T),k.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._initAttributeStore()},k.prototype.startup=function(){return i(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return this._initAttributeStore(),[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 1:return e.sent(),[4,p.all([this.attributeStore.updateFilters(this),this.updatePixelBuffer()])];case 2:return e.sent(),[2]}})})},k.prototype.destroy=function(){this.attributeStore&&this.attributeStore.destroy()},Object.defineProperty(k.prototype,"arcadeInfo",{get:function(){return{geometryType:this.service.geometryType,fields:this.service.fields,spatialReference:this.spatialReference}},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"featureReduction",{get:function(){return this.config.featureReduction},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"fieldsIndex",{get:function(){return new g(this.service.fields)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"geometryInfo",{get:function(){return{geometryType:this.service.geometryType,hasZ:!1,hasM:!1}},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"returnCentroid",{get:function(){return this._get("returnCentroid")||function(e,t,r){function n(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t||"web-style"===t||"cim"===t}if("esriGeometryPolygon"===t&&e.labelingInfo)return!0;if("esriGeometryPolygon"!==t)return!1;switch(r.type){case"simple":return n(r.symbol);case"unique-value":return n(r.defaultSymbol)||r.uniqueValueInfos.some(function(e){return n(e.symbol)});case"class-breaks":return n(r.defaultSymbol)||r.classBreakInfos.some(function(e){return n(e.symbol)});case"dot-density":return!1;default:return!0}}(this.config,this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"returnOutline",{get:function(){return F(this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"queryInfo",{get:function(){return{returnCentroid:this.returnCentroid,returnGeometry:!0,outFields:this.availableFields,definitionExpression:this.config.definitionExpression,gdbVersion:this.config.gdbVersion,historicMoment:this.config.historicMoment}},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"renderer",{get:function(){return this.config?v.fromJSON(this.config.renderer):(w.error("mapview-controller","Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"availableFields",{get:function(){var t=this,e=this.config.availableFields.filter(function(e){return-1===t._availableFields.indexOf(e)});return this._availableFields=this._availableFields.concat(e),this._availableFields},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"viewParams",{get:function(){return{viewingMode:"",scale:this.viewState&&this.viewState.scale||1}},enumerable:!0,configurable:!0}),k.prototype.getObjectId=function(e){return this.attributeStore.getFeatureId(e)},k.prototype.getAggregate=function(e){return null},k.prototype.getAggregateValueRanges=function(){return{}},k.prototype.getLocalId=function(e){return this.attributeStore.getLocalId(e)},k.prototype.mapValidLocalIds=function(e){var t=this;return e.map(function(e){return t.attributeStore.getLocalId(e)}).filter(function(e){return null!=e})},k.prototype.setViewState=function(e){this._set("viewState",e)},k.prototype.updatePixelBuffer=function(){return i(this,void 0,void 0,function(){var t;return n(this,function(e){switch(e.label){case 0:return[4,I.computePxBuffer(this.renderer,this.service.geometryType)];case 1:return t=e.sent(),this._pixelBuffer=Math.max(this._pixelBuffer,t),[2]}})})},k.prototype.setHighlight=function(t){return i(this,void 0,void 0,function(){return n(this,function(e){return[2,this.attributeStore.setHighlight(t)]})})},k.prototype.validateConfig=function(e){for(var t=0,r=e.filters;t<r.length;t++){var n=r[t];if(h.isSome(n)&&n.where)try{f.validateWhere(this.fieldsIndex,n.where)}catch(e){throw new s("mapview-bad-filter",e.message,{filter:n,missingFields:e.details})}}},k.prototype.onFeatureAdd=function(e){e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},k.prototype.onFeatureRemove=function(e){!e.localId&&l("esri-2d-debug")&&console.debug("Feature must have localId"),this.attributeStore.freeLocalId(e.objectId)},k.prototype.enableEvent=function(e){},k.prototype._initAttributeStore=function(){var r=this;this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new x.default({type:"remote",initialize:function(e,t){return r.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",e,{signal:t})},update:function(e,t){return r.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",e,{signal:t})},render:function(){return r.remoteClient.invoke("tileRenderer.featuresView.requestRender")}})},k.prototype._createQueryEngine=function(e){return new y.default({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:e,timeInfo:this.service.timeInfo})},k.prototype._createTempQueryEngine=function(e){return void 0===e&&(e=this._createFeatureStore()),this._createQueryEngine(e)},k.prototype._createFeatureStore=function(){var e={geometryType:this.service.geometryType,hasM:!1,hasZ:!1};return new S.ClusterStore(e,this.spatialReference,this.attributeStore,this.featureReduction)},k.prototype._createDefaultQuery=function(e){var t=new b,r=e.outFields,n=this.config,i=n.gdbVersion,o=n.historicMoment,a=n.definitionExpression;return r=.75<=r.length/this.service.fields.length?["*"]:r,t.gdbVersion=i,t.historicMoment=null!=o?new Date(o):null,t.num=e.num,t.outFields=r,t.outSpatialReference=this.spatialReference,t.returnGeometry=e.returnGeometry,t.returnCentroid=e.returnCentroid,t.start=e.resultOffset,t.where=a||"1=1",t},k.prototype._createQuery=function(e,t,r,n,i,o){var a=this.service.geometryType,s=this._createDefaultQuery(n);return s.maxRecordCountFactor=i,s.returnExceededLimitFeatures=o,s.resultType="tile",s.geometry=e,this.service.capabilities.query.supportsQuantization?(s.quantizationParameters=new m.default({mode:"view",originPosition:"upper-left",tolerance:r,extent:t}),"esriGeometryPolyline"===a&&(s.maxAllowableOffset=r)):"esriGeometryPolyline"!==a&&"esriGeometryPolygon"!==a||(s.maxAllowableOffset=r),s},k.prototype.hasGeometryFilter=function(){return this.filters.some(function(e){return h.isSome(e)&&!!e.geometry})},r([d.property({readOnly:!0,dependsOn:["config","service","spatialReference"]})],k.prototype,"arcadeInfo",null),r([d.property()],k.prototype,"config",void 0),r([d.property({readOnly:!0,dependsOn:["config"]})],k.prototype,"featureReduction",null),r([d.property({readOnly:!0,dependsOn:["service"]})],k.prototype,"fieldsIndex",null),r([d.property()],k.prototype,"filters",void 0),r([d.property({readOnly:!0,dependsOn:["service"]})],k.prototype,"geometryInfo",null),r([d.property({readOnly:!0,dependsOn:["config"]})],k.prototype,"returnCentroid",null),r([d.property({readOnly:!0,dependsOn:["service","config"]})],k.prototype,"returnOutline",null),r([d.property({readOnly:!0,dependsOn:["config","availableFields"]})],k.prototype,"queryInfo",null),r([d.property({dependsOn:["config"],readOnly:!0})],k.prototype,"renderer",null),r([d.property()],k.prototype,"processor",void 0),r([d.property({readOnly:!0,dependsOn:["config"]})],k.prototype,"availableFields",null),r([d.property({constructOnly:!0})],k.prototype,"remoteClient",void 0),r([d.property({constructOnly:!0})],k.prototype,"service",void 0),r([d.property({dependsOn:["tileStore"]})],k.prototype,"spatialReference",null),r([d.property({constructOnly:!0})],k.prototype,"tileInfo",void 0),r([d.property({constructOnly:!0})],k.prototype,"tileStore",void 0),r([d.property({readOnly:!0})],k.prototype,"viewState",void 0),r([d.property({readOnly:!0,dependsOn:["viewState"]})],k.prototype,"viewParams",null),r([d.subclass("esri.views.2d.layers.features.controllers.BaseController")],k));function k(){var e=null!==T&&T.apply(this,arguments)||this;return e._availableFields=[],e._pixelBuffer=0,e.config=null,e.filters=new Array(_.definitions.MAX_FILTERS),e.processor=null,e.remoteClient=null,e.service=null,e.tileStore=null,e}t.default=M}.apply(null,n))||(e.exports=i)},1985:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function v(e){return e<=57?e-48:e<=104?e-88:e<=107?e-89:e<=110?e-90:e-91}function m(e){return r[e]}function a(e){return(e[0]+e[1])/2}function u(e,t,r){return e[0]=t,e[1]=r,e}function s(e,t){var r=a(e),n=t,i=!t;e[0]=i*e[0]+n*r,e[1]=i*r+n*e[1]}function l(e,t){var r=a(e)<t;return s(e,r),r}function k(e,t){for(var r=u(p,f,y),n=u(d,g,F),i=0;i<t.length;i++){var o=v(t.charCodeAt(i));i%2==0?(s(n,!!(b&o)),s(n,!!(x&o)),s(n,!!(I&o)),s(r,!!(_&o)),s(r,!!(S&o))):(s(r,!!(b&o)),s(r,!!(x&o)),s(r,!!(I&o)),s(n,!!(_&o)),s(n,!!(S&o)))}return e[0]=a(r),e[1]=a(n),e}function R(e,t,r){for(var n="",i=u(p,-90,90),o=u(d,-180,180),a=0;a<r;a++){var s=0;a%2?(s|=l(i,e)<<4,s|=l(o,t)<<3,s|=l(i,e)<<2,s|=l(o,t)<<1,s|=l(i,e)<<0):(s|=l(o,t)<<4,s|=l(i,e)<<3,s|=l(o,t)<<2,s|=l(i,e)<<1,s|=l(o,t)<<0),n+=m(s)}return n}function C(e){var t=Math.floor(5*e/2);return(y-f)/Math.pow(2,t)}function P(e){var t=Math.ceil(5*e/2);return(F-g)/Math.pow(2,t)}function c(e,t){return t?I&e|(x&e)>>1|(b&e)>>2:(S&e)>>1|(_&e)>>2}function h(e,t){return t?(S&e)>>1|(_&e)>>2:I&e|(x&e)>>1|(b&e)>>2}function O(e,t,r){var n=!((e.length-1)%2),i=e.substring(0,e.length-1),o=v(e.charCodeAt(e.length-1)),a=0,s=0,u=0,l=0;n?(a=8,s=4,u=I&o|(x&o)>>1|(b&o)>>2,l=(S&o)>>1|(_&o)>>2):(a=4,s=8,l=I&o|(x&o)>>1|(b&o)>>2,u=(S&o)>>1|(_&o)>>2);var c,h,p=u+t,d=l+r,f=Math.floor(p/a),y=Math.floor(d/s),g=m((c=p-f*a,h=d-y*s,n?c&I|(h&I)<<1|(c&S)<<1|(h&S)<<2|(c&x)<<2:h&I|(c&I)<<1|(h&S)<<1|(c&S)<<2|(h&x)<<2));return 1<e.length&&(f||y)?O(i,f,y)+g:i+g}Object.defineProperty(t,"__esModule",{value:!0});var b=16,_=8,x=4,S=2,I=1,p=new Float64Array(2),d=new Float64Array(2),f=-90,y=90,g=-180,F=180,r="0123456789bcdefghjkmnpqrstuvwxyz";t.decodeBase32Char=v,t.encodeBase32Char=m,t.decodeGeohash=k,t.convertGeohash32ToXY=function(e,t){for(var r=0,n=0,i=30,o=30,a=0;a<t.length;a++){var s=v(t.charCodeAt(a)),u=a%2==0;r|=c(s,u)<<(i-=u?3:2),n|=h(s,u)<<(o-=u?2:3)}return{geohashX:r,geohashY:n}},t.decodeGeohashXY=function(e,t){for(var r=-90,n=90,i=-180,o=180,a=0;a<t;a++){for(var s=Math.ceil((a+1)/2),u=Math.floor((a+1)/2),l=1-a%2,c=30-(3*s+2*u),h=30-(2*s+3*u),p=3*l+2*(1-l),d=2*l+3*(1-l),f=3*l+7*(1-l)<<h,y=(7*l+3*(1-l)<<c&e.geohashX)>>c,g=(f&e.geohashY)>>h,v=p-1;0<=v;v--){var m=(i+o)/2,b=y&1<<v?1:0;i=(1-b)*i+b*m,o=(1-b)*m+b*o}for(v=d-1;0<=v;v--){var _=(r+n)/2,x=g&1<<v?1:0;r=(1-x)*r+x*_,n=(1-x)*_+x*n}}return[i,r,o,n]},t.setGeohashXY=function(e,t,r,n){n%2&&(n+=1);for(var i=0,o=0,a=-90,s=90,u=-180,l=180,c=0;c<n/2;c++){for(var h=0;h<5;h++){var p=(u+l)/2,d=p<r?1:0;i|=d<<29-(h+5*c),u=(1-d)*u+d*p,l=(1-d)*p+d*l}for(h=0;h<5;h++){var f=(a+s)/2,y=f<t?1:0;o|=y<<29-(h+5*c),a=(1-y)*a+y*f,s=(1-y)*f+y*s}}e.geohashX=i,e.geohashY=o},t.encodeGeohash=R,t.latDistPerGeohash=C,t.lonDistPerGeohash=P,t.unpackXBits=c,t.unpackYBits=h,t.getRelativeGeohash=O,t.getIntersectingGeohashes=function(e,t,r,n,i){for(var o=Math.abs(r-e),a=Math.abs(n-t),s=C(i),u=P(i),l=Math.ceil(a/u),c=Math.ceil(o/s),h=R(e,t,i),p=new Array,d=0;d<l;d++)for(var f=0;f<c;f++)p.push(O(h,d,f));return p},t.forEachIntersectingGeohash=function(e,t,r,n,i,o){for(var a=Math.abs(r-e),s=Math.abs(n-t),u=C(i),l=P(i),c=Math.ceil(s/l),h=Math.ceil(a/u),p=R(e,t,i),d=0;d<c;d++)for(var f=0;f<h;f++){var y=O(p,d,f),g=k([0,0],y),v=g[0],m=g[1],b=v-u/2,_=m-l/2,x=v+u/2,S=m+l/2,I=u*l,F=Math.max(e,b),T=Math.max(t,_),w=Math.min(r,x)-F,M=Math.min(n,S)-T;o(y,Math.abs(w*M)/I)}}}.apply(null,n))||(e.exports=i)},2769:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(5),r(9),r(10),r(28),r(14),r(12),r(15),r(2770),r(1985),r(55),r(44),r(487),r(302),r(1722),r(1649),r(1723),r(1674),r(26)],void 0===(i=function(e,t,r,q,c,n,D,A,V,i,h,z,s,Q,o,u,a,X,Y,Z,f){Object.defineProperty(t,"__esModule",{value:!0});function p(e){return V.andThen(e,function(e){return"cluster"!==e.type?null:q({},e,{clusterRadius:i.pt2px(e.clusterRadius/2)})})}var l,d,J=(d=o.default,r(v,d),Object.defineProperty(v.prototype,"count",{get:function(){return this.attributes.cluster_count},enumerable:!0,configurable:!0}),v.create=function(e,t,r,n,i,o,a){var s=new v(t,r,n,o,a);return s.localId=e.createLocalId(s.objectId,!0),s.tileLevel=i,s},v.prototype.update=function(e,t,r,n,i){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=n,this.geohashBoundsInfo=i,this.referenceId=null,this.invalid=!1,this},v.prototype.toJSON=function(){return{objectId:this.objectId,referenceId:this.referenceId,attributes:q({},this.attributes,{clusterId:this.objectId}),geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}},v),y=(l=a.default,r(g,l),g.prototype.update=function(u,l){return n(this,void 0,void 0,function(){var t,r,n,i,o,a,s=this;return c(this,function(e){switch(e.label){case 0:return t=this._featureReduction,r=V.andThen(l.featureReduction,p),n=l.aggregateFields.reduce(function(e,t){return e+JSON.stringify(t)},""),i=null===t&&l.featureReduction,o=n!==this._aggregateFieldsHash,a=i||o,[4,this._projectionSupportCheck];case 1:return e.sent(),this._featureReduction=r,this._aggregateFieldsHash=n,this._aggregateValueRanges={},this._invalidated=!0,V.isNone(r)?this._tree=null:(V.isSome(t)&&t.clusterRadius!==r.clusterRadius&&this._clusters.forEach(function(e){return e.canDelete=!0}),a&&(this._tree=new h.GeohashTree(l.aggregateFields),this._unindexFeatures()),(a||u)&&this._reindexFeatures(),this._handleClusterUpdates(),this._tiles.forEach(function(e){return s._getClustersForTile(e,0,r.clusterRadius,null,!1)})),[2]}})})},g.prototype._unindexFeatures=function(){this._featuresById.forEach(function(e){e.geohashIndexed=!1})},g.prototype._reindexFeatures=function(){var t=this;this._featuresById.forEach(function(e){e.geohashX||e.geohashY||t._setGeohash(e),t._attributeStore.isVisible(e)?t._insertIntoIndex(e):t._removeFromIndex(e)})},g.prototype.onTileUpdate=function(e){var t=this,r=e.added,n=e.removed;if(r.length){var i=Math.max.apply(Math,r.map(function(e){return e.level}));this._setGeohashLevel(i),r.forEach(function(e){return t._tiles.set(e.key.id,e)})}if(!V.isNone(this._featureReduction)){var o=this._featureReduction.clusterRadius;n.forEach(function(e){t._tiles.delete(e.key.id),t._markTileClustersForDeletion(e,o)})}},g.prototype.sweepClusters=function(){var r=this;this._clusters.forEach(function(e,t){e.canDelete&&(r._attributeStore.freeLocalId(e.objectId),r._clusters.delete(t))});for(var e=0,t=this._deferredDeletionQueue;e<t.length;e++){var n=t[e];this._attributeStore.addLocalId(n)}this._deferredDeletionQueue=[]},g.prototype.executeTileQuery=function(i,o,a){return n(this,void 0,void 0,function(){var t,r,n;return c(this,function(e){switch(e.label){case 0:return V.isNone(this._featureReduction)?[2,l.prototype.executeTileQuery.call(this,i,o,a)]:[4,this._projectionSupportCheck];case 1:return e.sent(),this._handleClusterUpdates(),t=this._featureReduction.clusterRadius,r=this._getTransforms(i,o),n=this._getClustersForTile(i,a.pixelBuffer,t,r),this._aggregateValueRangesChanged&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),[2,n]}})})},g.prototype.getAggregate=function(t){var r=null;return this._clusters.forEach(function(e){e.localId===t&&(r=e.toJSON())}),r},g.prototype.getAggregateValueRanges=function(){return this._aggregateValueRanges},g.prototype._getClustersForTile=function(k,e,t,R,C){var P=this;void 0===C&&(C=!0),e=Math.max(e,50);for(var r=2*t,O=new Set,G=this._getGeohashLevel(k.key.level),L=Math.pow(2,k.key.level)*Math.ceil(f.TILE_SIZE/r),n=Math.ceil(e/r)+2,i=Math.ceil(f.TILE_SIZE/r)+2*n,o=k.key,a=o.row,s=o.col*f.TILE_SIZE,u=a*f.TILE_SIZE,l=Math.floor(s/r)-n,c=Math.floor(u/r)-n,h=l+i,p=c+i,j=new Array,E=k.tileInfoView.getLODInfoAt(k.key.level),N=l;N<=h;N++)for(var B=this,d=c;d<=p;d++)!function(e){var t,r,n=N;E.wrap&&(n=N<0?N+L:N%L);var i=E.wrap&&N<0,o=E.wrap&&N%L!==N,a=B._lookupCluster(E,k.key.level,n,e,G);if(V.isSome(a)){var s=V.andThen(R,function(e){return i?e.left:o?e.right:e.tile});if(C&&V.isNone(s))return;if(!a.count)return;if(C&&1===a.count){var u=a.geohashBoundsInfo,l=u.xLL,c=u.yLL,h=u.xTR,p=u.yTR,d=u.level,f=V.expect(B._tree).findSingleOccupancyNode(l,c,h,p,d),y=V.unwrap(f).getLngLatBounds(),g={x:y[0],y:y[1]},v={x:y[2],y:y[3]},m=0,b=0,_=0,x=0;if(B._spatialReference.isWebMercator)m=(t=Q.lngLatToXY(g.x,g.y))[0],b=t[1],_=(r=Q.lngLatToXY(v.x,v.y))[0],x=r[1];else{var S=X.project(g,D.SpatialReference.WGS84,B._spatialReference),I=X.project(v,D.SpatialReference.WGS84,B._spatialReference);if(!S||!I)return A("esri-2d-debug")&&console.debug("Failed to reproject known tree node");m=S.x,b=S.y,_=I.x,x=I.y}var F=[m,b,_,x],T=null;if(B.forEachInBounds(F,function(e){P._attributeStore.isVisible(e)&&(T&&A("esri-2d-debug")&&console.debug("Expected to find only one feature, but found multiple"),T=e)}),!T)return A("esri-2d-debug")&&console.debug("Expected to find a feature, but found none");var w=Z.getGeometry(B.geometryInfo,T.geometry,0,V.expect(s)),M=q({},T.attributes,a.attributes);a.referenceId=T.localId,O.add(a.objectId),j.push(new Y.Feature(M,a.localId,w))}else C&&(O.add(a.objectId),w=Z.getGeometry(B.geometryInfo,a.geometry,0,V.expect(s)),j.push(new Y.Feature(a.attributes,a.localId,w)))}}(d);return{features:j,objectIds:O}},g.prototype._getGeohashLevel=function(e){return Math.min(Math.ceil(e/2+2),12)},g.prototype._setGeohashLevel=function(e){var t=this,r=this._geohashLevel,n=this._getGeohashLevel(e),i=2*(Math.floor(n/2)+1)-1,o=this._tree;this._geohashLevel=i,V.isNone(o)||(r<i?this._featuresById.forEach(function(e){e.geohashIndexed&&(o.insert(e,t._geohashLevel,r+1),e.geohashIndexed=!0)}):i<r&&o.dropLevels(this._geohashLevel))},g.prototype._insertIntoIndex=function(e){e.geohashIndexed||(this._invalidated=!0,e.geohashIndexed=!0,V.expect(this._tree).insert(e,this._geohashLevel))},g.prototype._removeFromIndex=function(e){e.geohashIndexed&&(this._invalidated=!0,V.expect(this._tree).remove(e,this._geohashLevel),e.geohashIndexed=!1)},g.prototype._handleClusterUpdates=function(){var t=this;this._invalidated&&this._clusters.size&&this._clusters.forEach(function(e){V.isSome(e)&&(e.invalid=e.invalid||t._invalidated)}),this._invalidated=!1},g.prototype._getTransforms=function(e,t){var r={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},n=s.getInfo(t);if(!n)return{tile:r,left:null,right:null};var i=n.valid,o=i[0],a=i[1];return{tile:r,left:q({},r,{translate:[a,e.bounds[3]]}),right:q({},r,{translate:[o-a+e.bounds[0],e.bounds[3]]})}},g.prototype._getClusterId=function(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r},g.prototype._markForDeletion=function(e,t,r){var n=this._getClusterId(e,t,r);if(this._clusters.has(n)){var i=this._clusters.get(n);V.isSome(i)?i.canDelete=!0:this._clusters.delete(n)}},g.prototype._getClusterBounds=function(e,t,r){if(V.isNone(this._featureReduction))return null;var n=this._featureReduction.clusterRadius,i=2*n,o=r%2?t*i:t*i+n,a=r*i,s=o/f.TILE_SIZE,u=a/f.TILE_SIZE,l=(o+i)/f.TILE_SIZE,c=(a-i)/f.TILE_SIZE;return[e.getXForColumn(s),e.getYForRow(u),e.getXForColumn(l),e.getYForRow(c)]},g.prototype._lookupCluster=function(e,t,r,n,i){var o,a;if(V.isNone(this._featureReduction)||V.isNone(this._tree))return null;var s=this._getClusterId(t,r,n),u=this._clusters.get(s);if(u&&V.isSome(u)&&!u.invalid&&!u.canDelete)return u;var l=this._getClusterBounds(e,r,n),c=l[0],h=l[1],p=l[2],d=l[3],f={x:c,y:h},y={x:p,y:d},g=0,v=0,m=0,b=0;if(this._spatialReference.isWebMercator)g=(o=Q.xyToLngLat(f.x,f.y))[0],v=o[1],m=(a=Q.xyToLngLat(y.x,y.y))[0],b=a[1];else{var _=X.project(f,this._spatialReference,D.SpatialReference.WGS84),x=X.project(y,this._spatialReference,D.SpatialReference.WGS84);if(!_||!x)return null;g=_.x,v=_.y,m=x.x,b=x.y}var S={geohashX:0,geohashY:0},I={geohashX:0,geohashY:0};z.setGeohashXY(S,v,g,i),z.setGeohashXY(I,b,m,i);var F=S.geohashX,T=S.geohashY,w=I.geohashX,M=I.geohashY,k={xLL:F,yLL:T,xTR:w,yTR:M,level:i},R=this._tree.getRegionStatistics(F,T,w,M,i),C=R.count,P=R.xTotal,O=R.yTotal,G=C?P/C:0,L=C?O/C:0;if(V.isSome(u)&&u.canDelete){var j=this._attributeStore.removeLocalId(u.objectId);this._deferredDeletionQueue.push(j)}var E=V.isSome(u)&&!u.canDelete&&u.invalid,N=q({cluster_count:C},R.attributes),B=this._attributeStore,A=E?u.update(G,L,t,N,k):J.create(B,s,G,L,t,N,k);return 0===C&&(A.geometry.coords[0]=(c+p)/2,A.geometry.coords[1]=(h+d)/2),this._attributeStore.setAttributeData(A.localId,A,this.geometryInfo,null),this._clusters.set(s,A),this._updateAggregateValueRangeForCluster(A,A.tileLevel),A},g.prototype._updateAggregateValueRangeForCluster=function(e,t){var r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},n=r.minValue,i=r.maxValue;r.minValue=Math.min(n,e.count),r.maxValue=Math.max(i,e.count),n===(this._aggregateValueRanges[t]=r).minValue&&i===r.maxValue||(this._aggregateValueRangesChanged=!0)},g.prototype._markTileClustersForDeletion=function(e,t){for(var r=2*t,n=Math.ceil(f.TILE_SIZE/r),i=e.key,o=i.row,a=i.col*f.TILE_SIZE,s=o*f.TILE_SIZE,u=Math.floor(a/r),l=Math.floor(s/r),c=u;c<u+n;c++)for(var h=l;h<l+n;h++)this._markForDeletion(e.key.level,c,h)},g.prototype._setGeohash=function(e){var t=e.geometry;if(t&&t.coords.length){var r={x:t.coords[0],y:t.coords[1]},n=X.project(r,this._spatialReference,D.SpatialReference.WGS84);if(!n)return void(A("esri-2d-debug")&&console.debug("Tried to project feature geometry, but got back `null`"));z.setGeohashXY(e,n.y,n.x,12)}},g.prototype._add=function(e){var t=this._featuresById.get(e.objectId);l.prototype._add.call(this,e),V.isSome(this._featureReduction)&&V.isSome(this._tree)&&(t?(e.geohashIndexed=t.geohashIndexed,e.geohashX=t.geohashX,e.geohashY=t.geohashY):this._setGeohash(e),!e.geohashIndexed&&this._attributeStore.isVisible(e)&&this._insertIntoIndex(e))},g.prototype._remove=function(e){return V.isSome(this._featureReduction)&&V.isSome(this._tree)&&this._removeFromIndex(e),l.prototype._remove.call(this,e)},g);function g(e,t,r,n){var i=l.call(this,e)||this;return i._deferredDeletionQueue=[],i._invalidated=!1,i._aggregateFieldsHash=null,i._geohashLevel=0,i._aggregateValueRanges={},i._aggregateValueRangesChanged=!1,i._clusters=new Map,i._tiles=new Map,i._spatialReference=t,i._attributeStore=r,i._featureReduction=p(n),i._projectionSupportCheck=X.checkProjectionSupport(t,D.SpatialReference.WGS84),i}function v(e,t,r,n,i){var o=this,a=new u.default([],[t,r]);return(o=d.call(this,a,n,null,e)||this).invalid=!1,o.canDelete=!1,o.geohashBoundsInfo=i,o}t.ClusterStore=y}.apply(null,n))||(e.exports=i)},2770:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(527),r(12),r(1985)],void 0===(i=function(e,t,r,i,s){Object.defineProperty(t,"__esModule",{value:!0});var n=(o.prototype._acquire=function(e,t,r){var n=this._pool.dequeue();return this._nodes++,i.isSome(n)?n.realloc(e,t,r):new a(e,t,r)},o.prototype._release=function(e){this._nodes--,this._pool.enqueue(e)},Object.defineProperty(o.prototype,"count",{get:function(){return this._root.count},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"size",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"poolSize",{get:function(){return this._pool.size},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"depth",{get:function(){var t=0;return this._forEachNode(function(e){return t=Math.max(t,e.depth)}),t},enumerable:!0,configurable:!0}),o.prototype.dropLevels=function(n){var i=this;this._forEachNode(function(e){if(e.depth>=n)for(var t=0;t<e.children.length;t++){var r=e.children[t];e.children[t]=null,r&&i._release(r)}})},o.prototype.insert=function(e,t,r){void 0===r&&(r=0);for(var n=this._root,i=0,o=0,a=0;null!==n;){if(n.depth>=r&&(n.count+=1,n.xTotal+=e.geometry.coords[0],n.yTotal+=e.geometry.coords[1],n.xGeohashTotal+=e.geohashX,n.yGeohashTotal+=e.geohashY,this._updateStatistics(e,n,1)),t<=i)return;var s=Math.ceil((i+1)/2),u=Math.floor((i+1)/2),l=1-i%2,c=30-(3*s+2*u),h=30-(2*s+3*u),p=7*l+3*(1-l)<<c,d=3*l+7*(1-l)<<h,f=8*l+4*(1-l),y=(e.geohashX&p)>>c,g=(e.geohashY&d)>>h,v=y+g*f;o=o<<3*l+2*(1-l)|y,a=a<<2*l+3*(1-l)|g,null==n.children[v]&&(n.children[v]=this._acquire(o,a,i+1)),i+=1,n=n.children[v]}},o.prototype.remove=function(e,t){for(var r=this._root,n=0;null!==r;){if(--r.count,r.xTotal-=e.geometry.coords[0],r.yTotal-=e.geometry.coords[1],r.xGeohashTotal-=e.geohashX,r.yGeohashTotal-=e.geohashY,this._updateStatistics(e,r,-1),t<=n)return;var i=Math.ceil((n+1)/2),o=Math.floor((n+1)/2),a=1-n%2,s=30-(3*i+2*o),u=30-(2*i+3*o),l=7*a+3*(1-a)<<s,c=3*a+7*(1-a)<<u,h=8*a+4*(1-a),p=((e.geohashX&l)>>s)+((e.geohashY&c)>>u)*h,d=r.children[p];1===d.count&&(this._release(d),r.children[p]=null),n+=1,r=d}},o.prototype.find=function(e,t,r){return this._root.find(e,t,r,0,0,0)},o.prototype.findSingleOccupancyNode=function(e,t,r,n,i){for(var o=this._root;null!==o;){var a=o.depth,s=o.xNode,u=o.yNode,l=1-a%2,c=o.xGeohashTotal/o.count,h=o.yGeohashTotal/o.count;if(1===o.count&&e<c&&c<=r&&t<h&&h<=n)return o;if(i<=a)o=o.next;else{for(var p=Math.ceil((a+1)/2),d=Math.floor((a+1)/2),f=30-(3*p+2*d),y=30-(2*p+3*d),g=~((1<<f)-1),v=~((1<<y)-1),m=(e&g)>>f,b=(t&v)>>y,_=(r&g)>>f,x=(n&v)>>y,S=s<<3*l+2*(1-l),I=u<<2*l+3*(1-l),F=S+8*l+4*(1-l),T=I+4*l+8*(1-l),w=Math.max(S,m),M=Math.max(I,b),k=Math.min(F,_),R=Math.min(T,x),C=null,P=null,O=M;O<=R;O++)for(var G=w;G<=k;G++){var L=G-S+(O-I)*(8*l+4*(1-l)),j=o.children[L];j&&(C||((C=j).next=o.next),P&&(P.next=j),(P=j).next=o.next)}o=C||o.next}}return null},o.prototype.getRegionStatistics=function(e,t,r,n,i){for(var o=this._root,a=0,s=0,u=0,l={};null!==o;){var c=o.depth,h=o.xNode,p=o.yNode;if(i<=c){var d=o.xGeohashTotal/o.count,f=o.yGeohashTotal/o.count;e<d&&d<=r&&t<f&&f<=n&&(a+=o.count,s+=o.xTotal,u+=o.yTotal,this._aggregateStatistics(l,o.statistics)),o=o.next}else{for(var y=Math.ceil((c+1)/2),g=Math.floor((c+1)/2),v=1-c%2,m=30-(3*y+2*g),b=30-(2*y+3*g),_=~((1<<m)-1),x=~((1<<b)-1),S=(e&_)>>m,I=(t&x)>>b,F=(r&_)>>m,T=(n&x)>>b,w=h<<3*v+2*(1-v),M=p<<2*v+3*(1-v),k=w+8*v+4*(1-v),R=M+4*v+8*(1-v),C=Math.max(w,S),P=Math.max(M,I),O=Math.min(k,F),G=Math.min(R,T),L=null,j=null,E=P;E<=G;E++)for(var N=C;N<=O;N++){var B=N-w+(E-M)*(8*v+4*(1-v)),A=o.children[B];if(A){if(E!==P&&E!==G&&N!==C&&N!==O){d=A.xGeohashTotal/A.count,f=A.yGeohashTotal/A.count,e<d&&d<=r&&t<f&&f<=n&&(a+=A.count,s+=A.xTotal,u+=A.yTotal,this._aggregateStatistics(l,A.statistics));continue}L||((L=A).next=o.next),j&&(j.next=A),(j=A).next=o.next}}o=L||o.next}}return{count:a,attributes:this._normalizeStatistics(l,a),xTotal:s,yTotal:u}},o.prototype._forEachNode=function(e){for(var t=this._root;null!==t;){var r=this._linkChildren(t)||t.next;e(t),t=r}},o.prototype._linkChildren=function(e){for(var t=null,r=null,n=0;n<=e.children.length;n++){var i=e.children[n];i&&(t||((t=i).next=e.next),r&&(r.next=i),(r=i).next=e.next)}return t},o.prototype._updateStatistics=function(e,t,r){for(var n=0,i=this._fields;n<i.length;n++){var o=i[n],a=o.name,s=o.outStatistic.onStatisticField,u=e.attributes[s];switch(o.outStatistic.statisticType){case"norm":t.statistics[a]||(t.statistics[a]={});var l=o.outStatistic.onStatisticNormalizationField,c=e.attributes[l],h=t.statistics[a].onStatisticField||0,p=t.statistics[a].onStatisticNormalizationField||0;null==u||isNaN(u)||null==c||0===c||isNaN(c)||(t.statistics[a].onStatisticField=h+r*u,t.statistics[a].onStatisticNormalizationField=p+r*c);break;case"avg":t.statistics[a]||(t.statistics[a]={value:0,nanCount:0});var d=t.statistics[a].value,f=t.statistics[a].nanCount;null==u||isNaN(u)?t.statistics[a].nanCount=f+r:t.statistics[a].value=d+r*u;break;case"avg_angle":t.statistics[a]||(t.statistics[a]={x:0,y:0,nanCount:0});var y=t.statistics[a].x,g=t.statistics[a].y,v=(f=t.statistics[a].nanCount,Math.PI/180);null==u||isNaN(u)?t.statistics[a].nanCount=f+r:(t.statistics[a].x=y+r*Math.cos(u*v),t.statistics[a].y=g+r*Math.sin(u*v));break;case"mode":t.statistics[a]||(t.statistics[a]={}),d=t.statistics[a][u]||0,t.statistics[a][u]=d+r}}},o.prototype._aggregateStatistics=function(e,t){for(var r=0,n=this._fields;r<n.length;r++){var i=n[r],o=i.name;switch(i.outStatistic.statisticType){case"avg":case"avg_angle":case"mode":case"norm":for(var a in e[o]||(e[o]={}),t[o]){var s=e[o][a]||0;e[o][a]=s+t[o][a]}}}},o.prototype._normalizeStatistics=function(e,t){for(var r={},n=0,i=this._fields;n<i.length;n++){var o=i[n],a=o.name;switch(o.outStatistic.statisticType){case"norm":var s=e[a];if(t&&null==s.onStatisticNormalizationField)break;if(t&&s.onStatisticNormalizationField){r[a]=s.onStatisticField/s.onStatisticNormalizationField;break}r[a]=0;break;case"avg":if(!t)break;var u=e[a],l=u.value;if(!(t-(c=u.nanCount)))break;r[a]=l/(t-c);break;case"avg_angle":if(!t)break;var c,h=e[a],p=h.x,d=h.y;if(!(t-(c=h.nanCount)))break;var f=p/(t-c),y=d/(t-c),g=180/Math.PI,v=Math.atan2(y,f)*g;r[a]=v;break;case"mode":var m=e[a],b=0,_=null;for(var x in m){var S=m[x];b<S&&(b=S,_=x)}r[a]="null"===_?null:_}}return r},o);function o(e){this._pool=new r.default(8024),this._nodes=0,this._root=new a(0,0,0),this._fields=e}t.GeohashTree=n;var a=(u.prototype.realloc=function(e,t,r){for(var n=0;n<this.children.length;n++)this.children[n]=null;return this.xNode=e,this.yNode=t,this.depth=r,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this},u.prototype.getLngLatBounds=function(){var e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2),n=30-(3*t+2*r),i=30-(2*t+3*r),o=this.xNode<<n,a=this.yNode<<i;return s.decodeGeohashXY({geohashX:o,geohashY:a},this.depth)},u.prototype.find=function(e,t,r,n,i,o){if(r<=n)return this;var a=1-n%2,s=3*a+2*(1-a),u=2*a+3*(1-a),l=30-i-s,c=30-o-u,h=((e&7*a+3*(1-a)<<l)>>l)+((t&3*a+7*(1-a)<<c)>>c)*(8*a+4*(1-a)),p=this.children[h];return null==p?null:p.find(e,t,r,n+1,i+s,o+u)},u);function u(e,t,r){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(var n=0;n<this.children.length;n++)this.children[n]=null;this.xNode=e,this.yNode=t,this.depth=r}}.apply(null,n))||(e.exports=i)},2771:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(9),r(10),r(4),r(15),r(90),r(1753)],void 0===(i=function(e,t,m,r,c,h,b,_){function x(e,t){return null==e?t:e}function S(g,v){return r(this,void 0,void 0,function(){var o,a,s,u,l,c,h,p,d,f,y;return m(this,function(e){switch(e.label){case 0:return"simple-marker"===g.type?(o=Math.max(x(g.size,12),v),[2,I(g)+o*F]):"picture-marker"===g.type?(a=Math.max(x(g.height,12),v),s=x(g.width,12)*(a/x(g.height,12)),u=s/2,l=a/2,[2,I(g)+Math.sqrt(u*u+l*l)]):"text"===g.type?(_.getTextSymbolEstimatedSize(T,g,b.definitions.AVERAGE_GLYPH_MOSAIC_ITEM),c=T[2]*(x(g.horizontalAlignment,"top")in w?1:.5),h=T[3]*(x(g.horizontalAlignment,"center")in M?1:.5),i=9,p=null==(n=g).font?i:x(n.font.size,i),d=Math.max(p,v)/p,[2,I(g)+Math.sqrt(c*c+h*h)*d]):"simple-line"===g.type?[2,Math.max(x(g.width,.75),v)/2]:"simple-fill"===g.type||"picture-fill"===g.type?[2,Math.max((r=0,null==(t=g).outline?r:x(t.outline.width,r)),v)/2]:"cim"===g.type?(f=b.CIMSymbolHelper.getEnvelope(g.data))?[2,Math.sqrt(f.width*f.width+f.height*f.height)]:[2,0]:"web-style"!==g.type?[3,2]:(y=S,[4,g.fetchCIMSymbol()]);case 1:return[2,y.apply(void 0,[e.sent(),v])];case 2:return[2,0]}var t,r,n,i})})}function p(n,i){return r(this,void 0,void 0,function(){var t,r;return m(this,function(e){switch(e.label){case 0:return n.type in o?(r=(t=Math).min,[4,S(n,i)]):[2,0];case 1:return[2,r.apply(t,[e.sent(),75])]}})})}function I(e){var t=x(e.xoffset,0),r=x(e.yoffset,0);return Math.sqrt(t*t+r*r)}function d(e,t){return Math.max(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var o={"simple-marker":1,"picture-marker":1,text:1,"simple-line":1,"simple-fill":1,"picture-fill":1,cim:1,"web-style":1},F=.707;t.computePxBuffer=function(u,l){return r(this,void 0,void 0,function(){var t,r,n,i,o,a,s;return m(this,function(e){switch(e.label){case 0:if("heatmap"===u.type)return[2,Math.round(3*u.blurRadius)];if("dot-density"===u.type)return[2,0];if("dictionary"===u.type)return"esriGeometryPoint"===l||"esriGeometryMultipoint"===l?[2,100]:[2,50];for(t=u.getSymbols(),r=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];return"stops"===r.transformationType?r.stops.map(function(e){return e.size}).reduce(d,0):"clamped-linear"===r.transformationType?"number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map(function(e){return e.size}).reduce(d,0):"real-world-size"===r.transformationType?30:void 0}(u),n=[],i=0,o=t;i<o.length;i++)a=o[i],n.push(p(a,r));return[4,c.all(n)];case 1:return s=e.sent(),[2,h.pt2px(s.reduce(d,0))]}})})};var T=[0,0,0,0],w={left:1,right:1},M={top:1,bottom:1,baseline:1}}.apply(null,n))||(e.exports=i)}}]);