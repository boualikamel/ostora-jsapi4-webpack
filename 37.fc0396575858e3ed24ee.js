(function(){(this||window).webpackJsonp.registerAbsMids({"esri/tasks/operations/PBFWorker":1568,"esri/tasks/operations/query":1569,"esri/tasks/operations/urlUtils":1632,"esri/tasks/operations/pbfQueryUtils":1634,"esri/tasks/operations/pbfFeatureServiceParser":1643,"esri/tasks/operations/pbfDehydratedFeatureSet":1644,"esri/tasks/operations/pbfOptimizedFeatureSet":1645,"esri/arcade/featureset/support/shared":1648,"esri/tasks/operations/queryAttachments":1651,"esri/tasks/QueryTask":1655,"esri/tasks/operations/queryRelatedRecords":1656,"esri/arcade/featureset/support/IdSet":1658,"esri/arcade/featureset/support/FeatureSet":1663,"esri/arcade/featureset/support/sqlUtils":1664,"esri/geometry/geometryEngineAsync":1748,"esri/workers/WorkerClient":1864,"esri/arcade/featureset/support/stats":1865,"esri/arcade/featureset/actions/OrderBy":1866,"esri/arcade/featureset/support/OrderbyClause":1867,"esri/arcade/featureset/sources/Empty":1868,"esri/arcade/featureset/actions/AttributeFilter":1869,"esri/arcade/featureSetUtils":2028,"esri/arcade/featureSetCollection":2029,"esri/arcade/featureset/support/cache":2030,"esri/arcade/featureset/support/sha":2031,"esri/arcade/featureset/sources/FeatureLayerMemory":2032,"esri/arcade/featureset/actions/Top":2033,"esri/arcade/featureset/actions/SpatialFilter":2034,"esri/arcade/featureset/actions/Adapted":2035,"esri/arcade/featureset/sources/FeatureLayerDynamic":2788,"esri/arcade/featureset/support/FeatureSetIterator":2789,"esri/arcade/featureset/sources/FeatureLayerRelated":2790,"esri/arcade/featureset/actions/GroupBy":2791,"esri/arcade/featureset/support/StatsField":2792,"esri/arcade/functions/featuresetbase":2793,"esri/arcade/functions/featuresetgeom":2794,"esri/arcade/functions/featuresetstats":2795,"esri/arcade/functions/featuresetstring":2796})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[37,61,69],{1568:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(11),r(89),r(4),r(304),r(208),r(31),r(205),r(1634),r.dj.m(e)],void 0===(a=function(e,t,r,l,a,n,i,u,c,s,o){Object.defineProperty(t,"__esModule",{value:!0});var f,d=(y.prototype._parseFeatureQuery=function(e){var t=s.parsePBFFeatureQuery(e.buffer,e.options);if(e.options&&"dehydrated"===e.options.type){var r=t;if(t.spatialReference=r.spatialReference.toJSON(),r.fields)for(var n=0;n<r.fields.length;n++)r.fields[n]=r.fields[n].toJSON()}return a.resolve(t)},y),p=(r(h,f=d),h.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},h.prototype.parseFeatureQuery=function(e,o){return e&&0!==e.byteLength?this._thread?this._thread.invoke("_parseFeatureQuery",{buffer:e,options:o},{transferList:[e]}).then(function(e){if(o&&"dehydrated"===o.type){var t=e;if(t.spatialReference=u.fromJSON(t.spatialReference),t.fields)for(var r=0;r<t.fields.length;r++)t.fields[r]=c.fromJSON(t.fields[r]);for(var n=t.spatialReference,a=0,i=t.features;a<i.length;a++){var s=i[a];s.uid=l.generateUID(),s.geometry&&(s.geometry.spatialReference=n)}}return e}):a.resolve(s.parsePBFFeatureQuery(e,o)):a.resolve(null)},h);function h(){var t=f.call(this)||this;return t._thread=void 0,i.open(n.getAbsMid("./PBFWorker",e,o),{strategy:"dedicated"}).then(function(e){void 0===t._thread?t._thread=e:e.close()}),t}function y(){}t.PBFWorker=p,t.default=function(){return new d}}.apply(null,n))||(e.exports=a)},1569:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(5),r(29),r(12),r(22),r(38),r(485),r(1634),r(1568),r(1632),r(47)],void 0===(a=function(e,t,l,u,c,r,f,d,i,s,p){function h(e,t){var r=e.geometry,n=e.toJSON(),a=n;if(r&&(a.geometry=JSON.stringify(r),a.geometryType=f.getJsonType(r),a.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),n.groupByFieldsForStatistics&&(a.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(a.objectIds=n.objectIds.join(",")),n.orderByFields&&(a.orderByFields=n.orderByFields.join(",")),!n.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete a.outFields:-1!==n.outFields.indexOf("*")?a.outFields="*":a.outFields=n.outFields.join(","),n.outSR?a.outSR=n.outSR.wkid||JSON.stringify(n.outSR):r&&(n.returnGeometry||n.returnCentroid)&&(a.outSR=a.inSR),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(a.outStatistics=JSON.stringify(n.outStatistics)),n.pixelSize&&(a.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(a.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.source&&(a.layer=JSON.stringify({source:n.source}),delete n.source),n.timeExtent){var i=n.timeExtent,s=i.start,o=i.end;null==s&&null==o||(a.time=s===o?s:(null==s?"null":s)+","+(null==o?"null":o)),delete n.timeExtent}return a}function o(e,n,a,i,s){void 0===i&&(i={});var o="string"==typeof e?r.urlToObject(e):e,t=n.geometry?[n.geometry]:[];return i.responseType="pbf"===a?"array-buffer":"json",d.normalizeCentralMeridian(t,null,i).then(function(e){var t=e&&e[0];c.isSome(t)&&((n=n.clone()).geometry=t);var r=p.mapParameters(l({},o.query,{f:a},s,h(n,s)));return u(o.path+"/query",l({},i,{query:r}))})}Object.defineProperty(t,"__esModule",{value:!0});var y,n="Layer does not support extent calculation.";t.queryToQueryStringParameters=h,t.executeQuery=function(e,t,r){return o(e,t,"json",r)},t.executeQueryPBF=function(e,t,n,r){var a=n.useWorker?(null==y&&(y=new s.PBFWorker),y):null;return o(e,t,"pbf",r).then(function(r){function t(e){var t=r;return t.data=e,t}return n.useWorker?a.parseFeatureQuery(r.data,n).then(function(e){return t(e)}):t(i.parsePBFFeatureQuery(r.data,n))})},t.executeQueryForIds=function(e,t,r){return o(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return o(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return o(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(n);if(t.hasOwnProperty("count"))throw new Error(n);return e})}}.apply(null,n))||(e.exports=a)},1632:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var n in t)if("declaredClass"!==n){var a=t[n];if(null!=a&&"function"!=typeof a)if(Array.isArray(a)){r[n]=[];for(var i=0;i<a.length;i++)r[n][i]=e(a[i])}else"object"==typeof a?a.toJSON&&(r[n]=JSON.stringify(a)):r[n]=a}return r}}.apply(null,n))||(e.exports=a)},1634:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1643)],void 0===(a=function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),t.parsePBFFeatureQuery=function(e,t){var r=o.parseFeatureQuery(e,t).queryResult.featureResult;if(r&&r.features&&r.features.length&&r.objectIdFieldName)for(var n=r.objectIdFieldName,a=0,i=r.features;a<i.length;a++){var s=i[a];s.attributes&&(s.objectId=s.attributes[n])}return r}}.apply(null,n))||(e.exports=a)},1643:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(6),r(3),r(489),r(1644),r(1645)],void 0===(a=function(e,t,o,r,l,u,c){function n(e){return e>=b.length?null:b[e]}function a(e){return e>=T.length?null:T[e]}function i(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function f(e,t,r){for(var n=t.createPointGeometry(r);e.next();)switch(e.tag()){case 3:for(var a=e.getUInt32(),i=e.pos()+a,s=0;e.pos()<i;)t.addCoordinatePoint(n,e.getSInt64(),0,s++);break;case 1:case 2:default:e.skip()}return n}function d(e,t,r){for(var n=t.createGeometry(r),a=2+(r.hasZ?1:0)+(r.hasM?1:0);e.next();)switch(e.tag()){case 2:for(var i=e.getUInt32(),s=e.pos()+i,o=0;e.pos()<s;)t.addLength(n,e.getUInt32(),o++);break;case 3:for(var l=e.getUInt32(),u=(s=e.pos()+l,0),c=0;e.pos()<s;)t.addCoordinate(n,e.getSInt64(),c,u),++u==a&&(c++,u=0);break;case 1:default:e.skip()}return n}function p(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function s(e){for(var t={type:n(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=n(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=(r=e.getEnum())>=I.length?null:I[r];break;case 5:case 6:default:e.skip()}var r;return t}function h(e,t,r,n){for(var a=t.createFeature(r),i=0;e.next();)switch(e.tag()){case 1:var s=n[i++].name;a.attributes[s]=e.processMessage(p);break;case 2:a.geometry=e.processMessageWithArgs(d,t,r);break;case 4:a.centroid=e.processMessageWithArgs(f,t,r);break;default:e.skip()}return a}function y(e){for(var t=[1,1,1,1];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function g(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function m(e){for(var t={originPosition:a(0)};e.next();)switch(e.tag()){case 1:t.originPosition=a(e.getEnum());break;case 2:t.scale=e.processMessage(y);break;case 3:t.translate=e.processMessage(g);break;default:e.skip()}return t}function _(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function v(e,t){for(var r=t.createSpatialReference();e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:case 3:case 4:default:e.skip()}return r}function w(e,t){var r=t.createFeatureResult();r.geometryType=i(t,0);for(var n=!1;e.next();)switch(e.tag()){case 1:r.objectIdFieldName=e.getString();break;case 3:r.globalIdFieldName=e.getString();break;case 4:r.geohashFieldName=e.getString();break;case 5:r.geometryProperties=e.processMessage(_);break;case 7:r.geometryType=i(t,e.getEnum());break;case 8:r.spatialReference=e.processMessageWithArgs(v,t);break;case 10:r.hasZ=e.getBool();break;case 11:r.hasM=e.getBool();break;case 12:r.transform=e.processMessage(m);break;case 9:var a=e.getBool();r.exceededTransferLimit=a;break;case 13:t.addField(r,e.processMessage(s));break;case 15:n||(t.prepareFeatures(r),n=!0),t.addFeature(r,e.processMessageWithArgs(h,t,r,r.fields));break;case 2:case 6:default:e.skip()}return t.finishFeatureResult(r),r}function S(e,t){for(var r={};e.next();)switch(e.tag()){case 1:r.featureResult=e.processMessageWithArgs(w,t);break;default:e.skip()}return r}Object.defineProperty(t,"__esModule",{value:!0});var F=r.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),b=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],I=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],T=["upperLeft","lowerLeft"];t.parseFeatureQuery=function(e,t){var r,n=(r=t)&&"dehydrated"===r.type?new u.Context(r):new c.Context;try{for(var a=new l(new Uint8Array(e),new DataView(e)),i={};a.next();)switch(a.tag()){case 2:i.queryResult=a.processMessageWithArgs(S,n);break;default:a.skip()}return i}catch(e){var s=new o("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return F.error(s),{queryResult:{featureResult:n.createFeatureResult()}}}}}.apply(null,n))||(e.exports=a)},1644:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(89),r(34),r(31),r(486),r(205)],void 0===(a=function(e,t,r,n,a,i,s){function o(e,t){return t}function l(e,t,r,n){switch(r){case 0:return d(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?d:p)(e,t+n,1)}}function u(e,t,r,n){switch(r){case 0:return d(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?d:p)(e,t+n,1);case 2:return d(e,t,2)}}function c(e,t,r,n){switch(r){case 0:return d(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?d:p)(e,t+n,1);case 2:return d(e,t,3)}}function f(e,t,r,n){switch(r){case 0:return d(e,t+n,0);case 1:return("lowerLeft"===e.originPosition?d:p)(e,t+n,1);case 2:return d(e,t,2);case 3:return d(e,t,3)}}function d(e,t,r){var n=e.translate,a=e.scale;return n[r]+t*a[r]}function p(e,t,r){var n=e.translate,a=e.scale;return n[r]-t*a[r]}Object.defineProperty(t,"__esModule",{value:!0});var h=(y.prototype.createFeatureResult=function(){return new i.DehydratedFeatureSetClass},y.prototype.finishFeatureResult=function(e){this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0},y.prototype.createSpatialReference=function(){return new a},y.prototype.addField=function(e,t){e.fields.push(s.fromJSON(t));var r=e.fields.map(function(e){return e.name});this.AttributesConstructor=function(){for(var e=0,t=r;e<t.length;e++)this[t[e]]=null}},y.prototype.addFeature=function(e,t){var r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(0<r)for(var n in t.attributes){var a=t.attributes[n];"string"==typeof a&&a.length>r&&(t.attributes[n]="")}e.features.push(t)},y.prototype.prepareFeatures=function(e){var a=this;switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"point":this.addCoordinate=function(e,t,r,n){return a.addCoordinatePoint(e,t,n)},this.createGeometry=function(e){return a.createPointGeometry(e)};break;case"polygon":this.addCoordinate=function(e,t,r,n){return a.addCoordinatePolygon(e,t,n)},this.createGeometry=function(e){return a.createPolygonGeometry(e)};break;case"polyline":this.addCoordinate=function(e,t,r,n){return a.addCoordinatePolyline(e,t,n)},this.createGeometry=function(e){return a.createPolylineGeometry(e)};break;case"multipoint":this.addCoordinate=function(e,t,r,n){return a.addCoordinateMultipoint(e,t,n)},this.createGeometry=function(e){return a.createMultipointGeometry(e)};break;default:n.neverReached(e.geometryType)}},y.prototype.createFeature=function(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,new i.DehydratedFeatureClass(r.generateUID(),null,new this.AttributesConstructor)},y.prototype.addLength=function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)},y.prototype.createPointGeometry=function(e){var t={type:"point",x:0,y:0,spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM};return t.hasZ&&(t.z=0),t.hasM&&(t.m=0),t},y.prototype.addCoordinatePoint=function(e,t,r){switch(t=this.applyTransform(this.transform,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:e.hasZ?e.z=t:e.m=t;break;case 3:e.m=t}},y.prototype.transformPathLikeValue=function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)},y.prototype.addCoordinatePolyline=function(e,t,r){this.dehydratedAddPointsCoordinate(e.paths,t,r)},y.prototype.addCoordinatePolygon=function(e,t,r){this.dehydratedAddPointsCoordinate(e.rings,t,r)},y.prototype.addCoordinateMultipoint=function(e,t,r){0===r&&e.points.push([]);var n=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(n)},y.prototype.createPolygonGeometry=function(e){return{type:"polygon",rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},y.prototype.createPolylineGeometry=function(e){return{type:"polyline",paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},y.prototype.createMultipointGeometry=function(e){return{type:"multipoint",points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},y.prototype.dehydratedAddPointsCoordinate=function(e,t,r){if(null===this.coordinateBuffer){var n=this.lengths.reduce(function(e,t){return e+t},0);this.coordinateBuffer=new Float64Array(n*this.vertexDimension)}0===r&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var a=this.transformPathLikeValue(t,r),i=e[e.length-1];0===r&&i.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=a},y.prototype.deriveApplyTransform=function(e){var t=e.hasZ,r=e.hasM;return t&&r?f:t?u:r?c:l},y);function y(e){this.options=e,this.geometryTypes=["point","multipoint","polyline","polygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=o,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}t.Context=h}.apply(null,n))||(e.exports=a)},1645:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(487),r(493),r(302)],void 0===(a=function(e,t,r,n,a){Object.defineProperty(t,"__esModule",{value:!0});var i=(s.prototype.createFeatureResult=function(){return new n.default},s.prototype.prepareFeatures=function(){},s.prototype.finishFeatureResult=function(){},s.prototype.addFeature=function(e,t){e.features.push(t)},s.prototype.createFeature=function(){return new r.default},s.prototype.createSpatialReference=function(){return{wkid:0}},s.prototype.createGeometry=function(){return new a.default},s.prototype.addField=function(e,t){e.fields.push(t)},s.prototype.addCoordinate=function(e,t){e.coords.push(t)},s.prototype.addCoordinatePoint=function(e,t){e.coords.push(t)},s.prototype.addLength=function(e,t){e.lengths.push(t)},s.prototype.createPointGeometry=function(){return new a.default},s);function s(){this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"]}t.Context=i}.apply(null,n))||(e.exports=a)},1648:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(4),r(37),r(205)],void 0===(a=function(e,t,i,r,n){function a(e){return e instanceof Date}var s,o;Object.defineProperty(t,"__esModule",{value:!0}),(s=t.FeatureServiceDatabaseType||(t.FeatureServiceDatabaseType={}))[s.Standardised=0]="Standardised",s[s.StandardisedNoInterval=1]="StandardisedNoInterval",s[s.SqlServer=2]="SqlServer",s[s.Oracle=3]="Oracle",s[s.Postgres=4]="Postgres",s[s.PGDB=5]="PGDB",s[s.FILEGDB=6]="FILEGDB",s[s.NotEvaluated=7]="NotEvaluated",t.cloneField=function(e){return n.fromJSON(e.toJSON())},t.esriFieldToJson=function(e){return e.toJSON()},(o=t.IdState||(t.IdState={}))[o.InFeatureSet=0]="InFeatureSet",o[o.NotInFeatureSet=1]="NotInFeatureSet",o[o.Unknown=2]="Unknown",t.isString=function(e){return"string"==typeof e||e instanceof String},t.isBoolean=function(e){return"boolean"==typeof e},t.isNumber=function(e){return"number"==typeof e},t.isArray=function(e){return e instanceof Array},t.isDate=a,t.equalityTest=function(e,t){return e===t||!(!a(e)||!a(t))&&e.getTime()===t.getTime()},t.cloneAttributes=function(e){var t={};for(var r in e)t[r]=e[r];return t},t.convertSquareUnitsToCode=function(e){if(void 0===e)return null;if("number"==typeof e)return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null},t.shapeExtent=function(e){if(null===e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new r({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null},t.convertLinearUnitsToCode=function(e){if(void 0===e)return null;if("number"==typeof e)return e;if("number"==typeof e)return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null},t.sameGeomType=function(e,t){return e===t||"point"===e&&"esriGeometryPoint"===t||"polyline"===e&&"esriGeometryPolyline"===t||"polygon"===e&&"esriGeometryPolygon"===t||"extent"===e&&"esriGeometryEnvelope"===t||"multipoint"===e&&"esriGeometryMultipoint"===t||"point"===t&&"esriGeometryPoint"===e||"polyline"===t&&"esriGeometryPolyline"===e||"polygon"===t&&"esriGeometryPolygon"===e||"extent"===t&&"esriGeometryEnvelope"===e||"multipoint"===t&&"esriGeometryMultipoint"===e},t.defaultMaxRecords=1e3,t.errback=function(t){return function(e){t.reject(e)}},t.callback=function(t,r){return function(e){try{t.apply(null,arguments)}catch(e){r.reject(e)}}},t.layerGeometryEsriConstants={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},t.toEsriGeometryType=function(e){switch(e){case"point":return"esriGeometryPoint";case"polygon":return"esriGeometryPolygon";case"multipoint":return"esriGeometryMultipoint";case"polyline":return"esriGeometryPolyline";default:return"esriGeometryPoint"}},t.reduceArrayWithPromises=function(n,a,e){return i.create(function(e,t){var r=i.resolve(!0);n.reduce(function(e,t,r,n){return e.then(function(e){try{return a(e,t,r,n)}catch(e){return i.reject(e)}},function(e){return i.reject(e)})},r).then(e,t)})},t.extractServiceUrl=function(e){return void 0===e?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]},t.stableStringify=function(e,t){"function"==typeof(t=t||{})&&(t={cmp:t});var i,l="boolean"==typeof t.cycles&&t.cycles,u=t.cmp&&(i=t.cmp,function(a){return function(e,t){var r={key:e,value:a[e]},n={key:t,value:a[t]};return i(r,n)}}),c=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var r,n;if(Array.isArray(t)){for(n="[",r=0;r<t.length;r++)r&&(n+=","),n+=e(t[r])||"null";return n+"]"}if(null===t)return"null";if(-1!==c.indexOf(t)){if(l)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=c.push(t)-1,i=Object.keys(t).sort(u&&u(t));for(n="",r=0;r<i.length;r++){var s=i[r],o=e(t[s]);o&&(n&&(n+=","),n+=JSON.stringify(s)+":"+o)}return c.splice(a,1),"{"+n+"}"}}(e)}}.apply(null,n))||(e.exports=a)},1651:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(5),r(29),r(22),r(501),r(1632)],void 0===(a=function(e,t,i,s,h,y,o){Object.defineProperty(t,"__esModule",{value:!0}),t.processAttachmentQueryResult=function(e,t){for(var r={},n=0,a=e;n<a.length;n++)for(var i=a[n],s=i.parentObjectId,o=i.parentGlobalId,l=0,u=i.attachmentInfos;l<u.length;l++){var c=u[l],f=c.id,d=h.addProxy(h.addTokenParameter(t+"/"+s+"/attachments/"+f)),p=y.fromJSON(c);p.set({url:d,parentObjectId:s,parentGlobalId:o}),r[s]?r[s].push(p):r[s]=[p]}return r},t.executeAttachmentQuery=function(e,t,r){var n,a={query:o.mapParameters(i({},e.query,{f:"json"},((n=t.toJSON()).attachmentTypes&&(n.attachmentTypes=n.attachmentTypes.join(",")),n.keywords&&(n.keywords=n.keywords.join(",")),n.globalIds&&(n.globalIds=n.globalIds.join(",")),n.objectIds&&(n.objectIds=n.objectIds.join(",")),n.size&&(n.size=n.size.join(",")),n)))};return r&&(a=i({},r,a)),s(e.path+"/queryAttachments",a)}}.apply(null,n))||(e.exports=a)},1655:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1),r(0),r(91),r(5),r(28),r(2),r(303),r(1569),r(1651),r(1656),r(497),r(207),r(301),r(498)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u,c,f,d,p,h,y){return m=o.declared(l),r(g,m),g.prototype.execute=function(e,t){return this.executeJSON(e,t).then(function(e){return p.fromJSON(e)})},g.prototype.executeJSON=function(e,t){return u.executeQuery(this.parsedUrl,this._normalizeQuery(e),i({},this.requestOptions,t)).then(function(e){return e.data})},g.prototype.executeForCount=function(e,t){return u.executeQueryForCount(this.parsedUrl,this._normalizeQuery(e),i({},this.requestOptions,t)).then(function(e){return e.data.count})},g.prototype.executeForExtent=function(e,t){return u.executeQueryForExtent(this.parsedUrl,this._normalizeQuery(e),i({},this.requestOptions,t)).then(function(e){return{count:e.data.count,extent:s.Extent.fromJSON(e.data.extent)}})},g.prototype.executeForIds=function(e,t){return u.executeQueryForIds(this.parsedUrl,this._normalizeQuery(e),i({},this.requestOptions,t)).then(function(e){return e.data.objectIds})},g.prototype.executeRelationshipQuery=function(e,t){return e=y.from(e),(this.gdbVersion||this.source)&&(e=e.clone().set({gdbVersion:this.gdbVersion||e.gdbVersion,source:this.source||e.source})),f.executeRelationshipQuery(this.parsedUrl,e,i({},this.requestOptions,t)).then(function(e){var t=e.data,r={};return Object.keys(t).forEach(function(e){return r[e]=p.fromJSON(t[e])}),r})},g.prototype.executeAttachmentQuery=function(e,t){var r=this;return c.executeAttachmentQuery(this.parsedUrl,d.from(e),i({},this.requestOptions,t)).then(function(e){return c.processAttachmentQueryResult(e.data.attachmentGroups,r.parsedUrl.path)})},g.prototype._normalizeQuery=function(e){var t=h.from(e);return this.gdbVersion||this.source?(t===e?t.clone():t).set({gdbVersion:this.gdbVersion||e.gdbVersion,source:this.source||e.source}):t},n([o.property()],g.prototype,"gdbVersion",void 0),n([o.property()],g.prototype,"source",void 0),n([o.subclass("esri.tasks.QueryTask")],g);function g(e){var t=m.call(this,e)||this;return t.gdbVersion=null,t.source=null,t}var m}.apply(null,n))||(e.exports=a)},1656:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(5),r(29),r(1632)],void 0===(a=function(e,t,a,i,s){function o(e){var t=e.toJSON();return t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.outFields&&(t.outFields=t.outFields.join(",")),t.outSpatialReference&&(t.outSR=t.outSR.wkid||JSON.stringify(t.outSR.toJSON()),delete t.outSpatialReference),t.source&&(t.layer=JSON.stringify({source:t.source}),delete t.source),t}Object.defineProperty(t,"__esModule",{value:!0}),t.toQueryStringParameters=o,t.executeRelationshipQuery=function(e,t,r){var n={query:s.mapParameters(a({},e.query,{f:"json"},o(t)))};return r&&(n=a({},r,n)),i(e.path+"/queryRelatedRecords",n).then(function(e){for(var t=e.data,r=t.geometryType,n=t.spatialReference,a={},i=0,s=t.relatedRecordGroups;i<s.length;i++){var o=s[i],l={fields:void 0,objectIdFieldName:void 0,geometryType:r,spatialReference:n,features:o.relatedRecords};if(null!=o.objectId)a[o.objectId]=l;else for(var u in o)o.hasOwnProperty(u)&&"relatedRecords"!==u&&(a[o[u]]=l)}return e.data=a,e})}}.apply(null,n))||(e.exports=a)},1658:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){return function(e,t,r,n){this._candidates=null,this._known=null,this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=e,this._known=t,this._ordered=r,this.pagesDefinition=n}}.apply(null,n))||(e.exports=a)},1663:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(2789),r(1658),r(1648),r(2030),r(1865),r(4),r(1570),r(1748),r(31),r(488)],void 0===(a=function(e,t,r,o,c,i,a,f,s,l,n,u){return d.prototype.optimisePagingFeatureQueries=function(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)},d.prototype._hasMemorySource=function(){return!0},d.prototype.prop=function(e,t){return void 0===t?this[e]:(void 0!==this[e]&&(this[e]=t),this)},d.prototype.end=function(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent},d.prototype._ensureLoaded=function(){return this.load()},d.prototype.load=function(){var r=this;return null===this._loadPromise&&(this._loadPromise=f.create(function(e,t){if(!0===r._parent.loaded)return r._initialiseFeatureSet(),void e(r);r._parent.load().then(function(){try{r._initialiseFeatureSet(),e(r)}catch(e){t(e)}},t)})),this._loadPromise},d.prototype._initialiseFeatureSet=function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.spatialReference=new n({wkid:4326}),this.geometryType=c.layerGeometryEsriConstants.point)},d.prototype.getField=function(t,e){var r;return(e=e||this.fields)&&(t=t.toLowerCase(),e.some(function(e){return e&&e.name.toLowerCase()===t&&(r=e),!!r})),r},d.prototype.getFieldsIndex=function(){return null===this._fieldsIndex&&(this._fieldsIndex=new u(this.fields)),this._fieldsIndex},d.prototype._maxProcessingRate=function(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())},d.prototype._maxQueryRate=function(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery},d.prototype._checkCancelled=function(e){if(null!==e&&e.aborted)throw new Error("Operation has been cancelled.")},d.prototype.nativeCapabilities=function(){return this._parent.nativeCapabilities()},d.prototype._canDoAggregates=function(e,t,r,n,a){return null===this._parent?f.resolve(!1):this._parent._canDoAggregates(e,t,r,n,a)},d.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,a,i,s){return null===this._parent?f.reject(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,a,i,s)},d.prototype._getAgregagtePhysicalPage=function(e,t,r){return null===this._parent?f.reject(new Error("Should never be called")):this._parent._getAgregagtePhysicalPage(e,t,r)},d.prototype.databaseType=function(){var n=this;if(this._databaseType!==c.FeatureServiceDatabaseType.NotEvaluated)return f.resolve(this._databaseType);if(null!==i.applicationCache){var e=i.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(null!==e)return e}if(null!==this._databaseTypeProbed)return this._databaseTypeProbed;var a=[{thetype:c.FeatureServiceDatabaseType.SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:c.FeatureServiceDatabaseType.Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:c.FeatureServiceDatabaseType.StandardisedNoInterval,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}],t=f.create(function(t,r){n._getDatabaseTypeImpl(a,0).then(function(e){n._databaseType=e,t(n._databaseType)},function(e){r(e)})});return null!==i.applicationCache&&(i.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),t),t=t.catch(function(e){throw i.applicationCache.clearDatabaseType(n._cacheableFeatureSetSourceKey()),e})),this._databaseTypeProbed=t,this._databaseTypeProbed},d.prototype._cacheableFeatureSetSourceKey=function(){return"MUSTBESET"},d.prototype._getDatabaseTypeImpl=function(t,r){var n=this;return r>=t.length?f.resolve(c.FeatureServiceDatabaseType.StandardisedNoInterval):this._runDatabaseProbe(t[r].testwhere).then(function(e){return!0===e?t[r].thetype:n._getDatabaseTypeImpl(t,r+1)})},d.prototype._runDatabaseProbe=function(e){return null!==this._parent?this._parent._runDatabaseProbe(e):f.reject(new Error("Not Implemented"))},d.prototype.isTable=function(){return this._parent.isTable()},d.prototype._featureFromCache=function(e){if(void 0!==this._featureCache[e])return this._featureCache[e]},d.prototype._isInFeatureSet=function(e){return c.IdState.Unknown},d.prototype._getSet=function(e){throw new Error("Not implemented in abstract class")},d.prototype._getFeature=function(e,t,r){var n=this;try{return this._checkCancelled(r),void 0!==this._featureFromCache(t)?f.resolve(this._featureFromCache(t)):this._getFeatures(e,t,this._maxProcessingRate(),r).then(function(){return n._checkCancelled(r),void 0!==n._featureFromCache(t)?n._featureFromCache(t):f.reject(new Error("Feature Not Found"))})}catch(e){return f.reject(e)}},d.prototype._getFeatureBatch=function(n,a){var i=this;try{this._checkCancelled(a);var e=new o([],n,!1,null),s=[];return this._getFeatures(e,-1,n.length,a).then(function(){i._checkCancelled(a);for(var e=0,t=n;e<t.length;e++){var r=t[e];void 0!==i._featureFromCache(r)&&s.push(i._featureFromCache(r))}return s})}catch(n){return f.reject(n)}},d.prototype._getFeatures=function(e,t,r,n){return f.resolve("success")},d.prototype._getFilteredSet=function(e,t,r,n,a){throw new Error("Not implemented in abstract class")},d.prototype._refineSetBlock=function(r,n,a){var i=this;try{if(!0===this._checkIfNeedToExpandCandidatePage(r,this._maxQueryRate(),a))return this._expandPagedSet(r,this._maxQueryRate(),0,0,a).then(function(){return i._refineSetBlock(r,n,a)});this._checkCancelled(a);var s=r._candidates.length;this._refineKnowns(r,n);var o=s-r._candidates.length;return 0===r._candidates.length||n<=o?f.resolve(r):this._refineIfParentKnown(r,n-o,a).then(function(){if(i._checkCancelled(a),i._refineKnowns(r,n-o),(o=s-r._candidates.length)<n&&0<r._candidates.length){var e=n-o,t=i._prepareFetchAndRefineSet(r._candidates,i._maxQueryRate());return i._fetchAndRefineFeatures(t,t.length>e?e:r._candidates.length,a).then(function(){return i._checkCancelled(a),i._refineKnowns(r,n-o),r})}return r})}catch(r){return f.reject(r)}},d.prototype._fetchAndRefineFeatures=function(e,t,r){return null},d.prototype._prepareFetchAndRefineSet=function(e,t){for(var r=[],n=0;n<e.length;n++)this._isPhysicalFeature(e[n])&&r.push(e[n]);return r},d.prototype._isPhysicalFeature=function(e){return null===this._parent||this._parent._isPhysicalFeature(e)},d.prototype._refineKnowns=function(e,t){var r=0,n=null,a=[];t=this._maxQueryRate();for(var i=0;i<e._candidates.length&&"GETPAGES"!==e._candidates[i];i++){var s=!1,o=this._candidateIdTransform(e._candidates[i]);o!==e._candidates[i]&&(s=!0);var l=this._isInFeatureSet(o);if(l===c.IdState.InFeatureSet)!0===s?e._known.indexOf(o)<0&&(e._known.push(o),r+=1):(e._known.push(e._candidates[i]),r+=1),null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i});else if(l===c.IdState.NotInFeatureSet)null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),r+=1;else if(l===c.IdState.Unknown&&(r+=1,!0===e._ordered))break;if(t<=r)break}null!==n&&a.push(n);for(var u=a.length-1;0<=u;u--)e._candidates.splice(a[u].start,a[u].end-a[u].start+1)},d.prototype._refineIfParentKnown=function(t,e,r){var n=this,a=new o([],[],t._ordered,null);return a._candidates=t._candidates.slice(0),this._parent._refineSetBlock(a,e,r).then(function(e){return n._parent._transformSetWithIdChanges(t),e})},d.prototype._candidateIdTransform=function(e){return this._parent._candidateIdTransform(e)},d.prototype._transformSetWithIdChanges=function(e){this._parent._transformSetWithIdChanges(e)},d.prototype._checkIfNeedToExpandKnownPage=function(e,t,r){if(null===e.pagesDefinition)return!1;for(var n=0,a=e._lastFetchedIndex;a<e._known.length;a++){if("GETPAGES"===e._known[a])return!0;if(void 0===this._featureCache[e._known[a]]&&(n+=1)>=t)break}return!1},d.prototype._checkIfNeedToExpandCandidatePage=function(e,t,r){if(null===e.pagesDefinition)return!1;for(var n=0,a=0;a<e._candidates.length;a++){if("GETPAGES"===e._candidates[a])return!0;if((n+=1)>=t)break}return!1},d.prototype._expandPagedSet=function(e,t,r,n,a){return null===this._parent?f.reject(new Error("Parent Paging not implemented")):this._parent._expandPagedSet(e,t,r,n,a)},d.prototype._expandPagedSetFeatureSet=function(t,r,n,e,a){var i=this;return 0<t._known.length&&"GETPAGES"===t._known[t._known.length-1]&&(e=1),0===e&&0<t._candidates.length&&"GETPAGES"===t._candidates[t._candidates.length-1]&&(e=2),0===e?f.resolve("finished"):this._getPage(t,e,a).then(function(e){return n+e<r?i._expandPagedSet(t,r,n+e,0,a):"success"})},d.prototype._getPage=function(e,t,r){var n=this,a=1===t?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||!0===e.pagesDefinition.internal.fullyResolved){a.length=a.length-1;for(var i=0,s=0;s<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+s>=e.pagesDefinition.internal.set.length);s++)a[a.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+s],i++;e.pagesDefinition.resultOffset+=i;var o=!1;return!0===e.pagesDefinition.internal.fullyResolved&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(o=!0),!1===o&&a.push("GETPAGES"),f.resolve(i)}return this._getPhysicalPage(e,t,r).then(function(){return n._getPage(e,t,r)})},d.prototype._getPhysicalPage=function(e,t,r){return null},d.prototype._clonePageDefinition=function(e){return null===this._parent?null:this._parent._clonePageDefinition(e)},d.prototype._first=function(e){return this.iterator(e).next()},d.prototype.first=function(e){return this._first(e)},d.prototype.calculateStatistic=function(t,r,n,a){var i=this;return this._ensureLoaded().then(function(){return i._stat(t,r,"",null,null,n,a).then(function(e){return!1===e.calculated?i._manualStat(t,r,n,a).then(function(e){return e.result}):e.result})})},d.prototype._manualStat=function(e,t,r,n){switch(e.toLowerCase()){case"count":return a.count(this,n).then(function(e){return{calculated:!0,result:e}});case"distinct":return a.distinct(this,t,r).then(function(e){return{calculated:!0,result:e}});case"avg":case"mean":return a.mean(this,t,n).then(function(e){return{calculated:!0,result:e}});case"stdev":return a.stdev(this,t,n).then(function(e){return{calculated:!0,result:e}});case"variance":return a.variance(this,t,n).then(function(e){return{calculated:!0,result:e}});case"sum":return a.sum(this,t,n).then(function(e){return{calculated:!0,result:e}});case"min":return a.min(this,t,n).then(function(e){return{calculated:!0,result:e}});case"max":return a.max(this,t,n).then(function(e){return{calculated:!0,result:e}});default:return f.resolve({calculated:!0,result:0})}},d.prototype._stat=function(t,r,n,a,i,s,o){var l=this;return this._parent._stat(t,r,n,a,i,s,o).then(function(e){return!1===e.calculated?null===i&&""===n&&null===a?l._manualStat(t,r,s,o):{calculated:!1}:e})},d.prototype._unionAllGeomSelf=function(e){var r=this,n=this.iterator(this._defaultTracker(e)),a=[];return f.create(function(e,t){r._unionShapeInBatches(a,n,e,t)})},d.prototype._unionAllGeom=function(n){var a=this;return f.create(function(e,t){var r=a.iterator(a._defaultTracker(n));a._unionShapeInBatches([],r,e,t)})},d.prototype._unionShapeInBatches=function(r,n,a,i){var s=this;n.next().then(function(t){try{null!==t&&null!==t.geometry&&r.push(t.geometry),30<r.length||null===t&&1<r.length?l.union(r).then(function(e){try{null===t?a(e):(r=[e],s._unionShapeInBatches(r,n,a,i))}catch(e){i(e)}},i):null===t?a(1===r.length?r[0]:null):s._unionShapeInBatches(r,n,a,i)}catch(e){i(e)}},i)},d.prototype.iterator=function(e){return new r(this,e)},d.prototype.intersection=function(e,t){return void 0===t&&(t=!1),d._featuresetFunctions.intersection.bind(this)(e,t)},d.prototype.difference=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!0),d._featuresetFunctions.difference.bind(this)(e,t,r)},d.prototype.symmetricDifference=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!0),d._featuresetFunctions.symmetricDifference.bind(this)(e,t,r)},d.prototype.morphShape=function(e,t,r,n){return void 0===r&&(r="unknown"),void 0===n&&(n=null),d._featuresetFunctions.morphShape.bind(this)(e,t,r,n)},d.prototype.morphShapeAndAttributes=function(e,t,r){return void 0===r&&(r="unknown"),d._featuresetFunctions.morphShapeAndAttributes.bind(this)(e,t,r)},d.prototype.union=function(e,t){return void 0===t&&(t=!1),d._featuresetFunctions.union.bind(this)(e,t)},d.prototype.intersects=function(e){return d._featuresetFunctions.intersects.bind(this)(e)},d.prototype.envelopeIntersects=function(e){return d._featuresetFunctions.envelopeIntersects.bind(this)(e)},d.prototype.contains=function(e){return d._featuresetFunctions.contains.bind(this)(e)},d.prototype.overlaps=function(e){return d._featuresetFunctions.overlaps.bind(this)(e)},d.prototype.relate=function(e,t){return d._featuresetFunctions.relate.bind(this)(e,t)},d.prototype.within=function(e){return d._featuresetFunctions.within.bind(this)(e)},d.prototype.touches=function(e){return d._featuresetFunctions.touches.bind(this)(e)},d.prototype.top=function(e){return d._featuresetFunctions.top.bind(this)(e)},d.prototype.crosses=function(e){return d._featuresetFunctions.crosses.bind(this)(e)},d.prototype.buffer=function(e,t,r,n){return void 0===n&&(n=!0),d._featuresetFunctions.buffer.bind(this)(e,t,r,n)},d.prototype.filter=function(e,t){return void 0===t&&(t=null),d._featuresetFunctions.filter.bind(this)(e,t)},d.prototype.orderBy=function(e){return d._featuresetFunctions.orderBy.bind(this)(e)},d.prototype.dissolve=function(e,t){return d._featuresetFunctions.dissolve.bind(this)(e,t)},d.prototype.groupby=function(e,t){return d._featuresetFunctions.groupby.bind(this)(e,t)},d.prototype.reduce=function(r,n,a){var i=this;return void 0===n&&(n=null),f.create(function(e,t){i._reduceImpl(i.iterator(i._defaultTracker(a)),r,n,0,e,t,0)})},d.prototype._reduceImpl=function(r,n,a,i,s,o,l){var u=this;try{if(1e3<++l)return void setTimeout(function(){l=0,u._reduceImpl(r,n,a,i,s,o,l)});r.next().then(function(e){try{if(null===e)s(a);else{var t=n(a,e,i,u);f.isPromiseLike(t)?t.then(function(e){u._reduceImpl(r,n,e,i+1,s,o,l)},o):u._reduceImpl(r,n,t,i+1,s,o,l)}}catch(e){o(e)}},o)}catch(r){o(r)}},d.prototype.removeField=function(e){return d._featuresetFunctions.removeField.bind(this)(e)},d.prototype.addField=function(e,t,r){return void 0===r&&(r=null),d._featuresetFunctions.addField.bind(this)(e,t,r)},d.prototype.sumArea=function(e,r,t){void 0===r&&(r=!1);var n=c.convertSquareUnitsToCode(e);return this.reduce(function(t,e){return null===e.geometry?0:r?l.geodesicArea(e.geometry,n).then(function(e){return t+e}):l.planarArea(e.geometry,n).then(function(e){return t+e})},0,t)},d.prototype.sumLength=function(e,r,t){void 0===r&&(r=!1);var n=c.convertLinearUnitsToCode(e);return this.reduce(function(t,e){return null===e.geometry?0:r?l.geodesicLength(e.geometry,n).then(function(e){return t+e}):l.planarLength(e.geometry,n).then(function(e){return t+e})},0,t)},d.prototype._substituteVars=function(e,t){if(null!==t){var r={};for(var n in t)r[n.toLowerCase()]=t[n];e.parameters=r}},d.prototype.distinct=function(t,r,n,a){var i=this;return void 0===r&&(r=1e3),void 0===n&&(n=null),this.load().then(function(){var e=s.WhereClause.create(t,i.getFieldsIndex());return i._substituteVars(e,n),i.calculateStatistic("distinct",e,r,i._defaultTracker(a))})},d.prototype.min=function(t,r,n){var a=this;return void 0===r&&(r=null),this.load().then(function(){var e=s.WhereClause.create(t,a.getFieldsIndex());return a._substituteVars(e,r),a.calculateStatistic("min",e,-1,a._defaultTracker(n))})},d.prototype.max=function(t,r,n){var a=this;return void 0===r&&(r=null),this.load().then(function(){var e=s.WhereClause.create(t,a.getFieldsIndex());return a._substituteVars(e,r),a.calculateStatistic("max",e,-1,a._defaultTracker(n))})},d.prototype.avg=function(t,r,n){var a=this;return void 0===r&&(r=null),this.load().then(function(){var e=s.WhereClause.create(t,a.getFieldsIndex());return a._substituteVars(e,r),a.calculateStatistic("avg",e,-1,a._defaultTracker(n))})},d.prototype.sum=function(t,r,n){var a=this;return void 0===r&&(r=null),this.load().then(function(){var e=s.WhereClause.create(t,a.getFieldsIndex());return a._substituteVars(e,r),a.calculateStatistic("sum",e,-1,a._defaultTracker(n))})},d.prototype.stdev=function(t,r,n){var a=this;return void 0===r&&(r=null),this.load().then(function(){var e=s.WhereClause.create(t,a.getFieldsIndex());return a._substituteVars(e,r),a.calculateStatistic("stdev",e,-1,a._defaultTracker(n))})},d.prototype.variance=function(t,r,n){var a=this;return void 0===r&&(r=null),this.load().then(function(){var e=s.WhereClause.create(t,a.getFieldsIndex());return a._substituteVars(e,r),a.calculateStatistic("variance",e,-1,a._defaultTracker(n))})},d.prototype.count=function(e){var t=this;return this.load().then(function(){return t.calculateStatistic("count",s.WhereClause.create("1",t.getFieldsIndex()),-1,t._defaultTracker(e))})},d.prototype._defaultTracker=function(e){return e||{aborted:!1}},d.prototype.forEach=function(r,n){var a=this;return f.create(function(e,t){a._forEachImpl(a.iterator(a._defaultTracker(n)),r,a,e,t,0)})},d.prototype._forEachImpl=function(r,n,a,i,s,o){var l=this;try{if(1e3<++o)return void setTimeout(function(){o=0,l._forEachImpl(r,n,a,i,s,o)},0);r.next().then(function(e){try{if(null===e)i(a);else{var t=n(e);null==t?l._forEachImpl(r,n,a,i,s,o):f.isPromiseLike(t)?t.then(function(){try{l._forEachImpl(r,n,a,i,s,o)}catch(e){s(e)}},s):l._forEachImpl(r,n,a,i,s,o)}}catch(e){s(e)}},s)}catch(r){s(r)}},d.prototype.convertToJSON=function(e){for(var n={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}},t=0;t<this.fields.length;t++)n.layerDefinition.fields.push(c.esriFieldToJson(this.fields[t]));return this.reduce(function(e){var t={geometry:e.geometry&&e.geometry.toJSON(),attributes:{}};for(var r in e.attributes)t.attributes[r]=e.attributes[r];return n.featureSet.features.push(t),1},0,e)},d.prototype.castToText=function(){return"object, FeatureSet"},d.prototype.queryAttachments=function(e,t,r,n){return this._parent.queryAttachments(e,t,r,n)},d.prototype.serviceUrl=function(){return this._parent.serviceUrl()},d.prototype.relationshipMetaData=function(){return this._parent.relationshipMetaData()},d.prototype.schema=function(){for(var e=[],t=0,r=this.fields;t<r.length;t++){var n=r[t];e.push(c.esriFieldToJson(n))}return{objectIdField:this.objectIdField,typeIdField:this.typeIdField,geometryType:void 0===c.layerGeometryEsriConstants[this.geometryType]?"":c.layerGeometryEsriConstants[this.geometryType],hasZ:this.hasZ,hasM:this.hasM,fields:e}},d.prototype.convertToText=function(e,t){var r=this;return"schema"===e?this._ensureLoaded().then(function(){return JSON.stringify(r.schema())}):"featureset"===e?this._ensureLoaded().then(function(){var n=[];return r.reduce(function(e,t){var r={geometry:t.geometry?t.geometry.toJSON():null,attributes:t.attributes};return null!==r.geometry&&r.geometry.spatialReference&&delete r.geometry.spatialReference,n.push(r),1},0,t).then(function(){var e=r.schema();return e.features=n,e.spatialReference=r.spatialReference.toJSON(),JSON.stringify(e)})}):f.resolve(this.castToText())},d.prototype.getFeatureByObjectId=function(e,t){return this._parent.getFeatureByObjectId(e,t)},d._featuresetFunctions={},d;function d(e){this.recentlyUsedQueries=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=c.FeatureServiceDatabaseType.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=[],this.types=null,this.fields=null,this.geometryType="",this.objectIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,e&&e.lrucache&&(this.recentlyUsedQueries=e.lrucache)}}.apply(null,n))||(e.exports=a)},1664:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1640),r(1648),r(1570)],void 0===(a=function(e,t,a,s,i){function n(e,t){return m(e.parseTree,t,e.parameters)}function m(e,t,r,n,a){var i,s,o,l;switch(void 0===n&&(n=null),void 0===a&&(a=null),e.type){case"interval":return S(m(e.value,t,r,n,a),e.qualifier,e.op,t);case"case_expression":var u=" CASE ";"simple"===e.format&&(u+=m(e.operand,t,r,n,a));for(var c=0;c<e.clauses.length;c++)u+=" WHEN "+m(e.clauses[c].operand,t,r,n,a)+" THEN "+m(e.clauses[c].value,t,r,n,a);return null!==e.else&&(u+=" ELSE "+m(e.else,t,r,n,a)),u+" END ";case"param":var f=r[e.value.toLowerCase()];if("string"==typeof f)return"'"+r[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(f instanceof Date)return v(f,t);if(f instanceof Array){var d=[];for(c=0;c<f.length;c++)"string"==typeof f[c]?d.push("'"+f[c].toString().replace(/'/g,"''")+"'"):f[c]instanceof Date?d.push(v(f[c],t)):d.push(f[c].toString());return d}return f.toString();case"expr_list":s=[];for(var p=0,h=e.value;p<h.length;p++){var y=h[p];s.push(m(y,t,r,n,a))}return s;case"unary_expr":return" ( NOT "+m(e.expr,t,r,n,a)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+m(e.left,t,r,n,a)+" AND "+m(e.right,t,r,n,a)+") ";case"OR":return" ("+m(e.left,t,r,n,a)+" OR "+m(e.right,t,r,n,a)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+m(e.left,t,r,n,a)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+m(e.left,t,r,n,a)+" IS NOT NULL )";case"IN":return i=[],"expr_list"===e.right.type?(i=m(e.right,t,r,n,a)," ("+m(e.left,t,r,n,a)+" IN ("+i.join(",")+")) "):(l=m(e.right,t,r,n,a))instanceof Array?" ("+m(e.left,t,r,n,a)+" IN ("+l.join(",")+")) ":" ("+m(e.left,t,r,n,a)+" IN ("+l+")) ";case"NOT IN":return i=[],"expr_list"===e.right.type?(i=m(e.right,t,r,n,a)," ("+m(e.left,t,r,n,a)+" NOT IN ("+i.join(",")+")) "):(l=m(e.right,t,r,n,a))instanceof Array?" ("+m(e.left,t,r,n,a)+" NOT IN ("+l.join(",")+")) ":" ("+m(e.left,t,r,n,a)+" NOT IN ("+l+")) ";case"BETWEEN":return o=m(e.right,t,r,n,a)," ("+m(e.left,t,r,n,a)+" BETWEEN "+o[0]+" AND "+o[1]+" ) ";case"NOTBETWEEN":return o=m(e.right,t,r,n,a)," ("+m(e.left,t,r,n,a)+" NOT BETWEEN "+o[0]+" AND "+o[1]+" ) ";case"LIKE":return""!==e.escape?" ("+m(e.left,t,r,n,a)+" LIKE "+m(e.right,t,r,n,a)+" ESCAPE '"+e.escape+"') ":" ("+m(e.left,t,r,n,a)+" LIKE "+m(e.right,t,r,n,a)+") ";case"NOT LIKE":return""!==e.escape?" ("+m(e.left,t,r,n,a)+" NOT LIKE "+m(e.right,t,r,n,a)+" ESCAPE '"+e.escape+"') ":" ("+m(e.left,t,r,n,a)+" NOT LIKE "+m(e.right,t,r,n,a)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+m(e.left,t,r,n,a)+" "+e.operator+" "+m(e.right,t,r,n,a)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return v(e.value,t);case"number":return e.value.toString();case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?w(!0,t):"CURRENT_TIMESTAMP"===e.column.toUpperCase()?w(!1,t):n&&n.toLowerCase()===e.column.toLowerCase()?"("+a+")":e.column;case"function":var g=m(e.args,t,r,n,a);return _(e.name,g,t)}throw new Error("Unsupported sql syntax "+e.type)}function _(e,t,r){switch(e.toLowerCase().trim()){case"abs":if(1!==t.length)throw new Error("Invalid Parameter for call to ABS");return"abs("+t[0]+")";case"ceiling":case"ceil":if(1!==t.length)throw new Error("Invalid Parameter for call to CEILING");switch(r){case s.FeatureServiceDatabaseType.Standardised:case s.FeatureServiceDatabaseType.StandardisedNoInterval:default:return"CEILING("+t[0]+")"}case"floor":if(1!==t.length)throw new Error("Invalid Parameter for call to Floor");return"FLOOR("+t[0]+")";case"log":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG");return"LOG("+t[0]+")";case"log10":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG10");return"LOG10("+t[0]+")";case"power":if(2!==t.length)throw new Error("Invalid Parameter for call to POWER");return"POWER("+t[0]+","+t[1]+")";case"round":if(2===t.length)return"ROUND("+t[0]+","+t[1]+")";if(1===t.length)return"ROUND("+t[0]+")";throw new Error("Invalid Parameter for call to ROUND");case"truncate":if(t.length<1||2<t.length)throw new Error("Invalid Parameter for TRUNCATE function");switch(r){case s.FeatureServiceDatabaseType.SqlServer:return"ROUND("+t[0]+(1===t.length?"0":","+t[1])+",1)";default:return"TRUNCATE("+t[0]+(1===t.length?")":","+t[1]+")")}case"char_length":case"len":if(1!==t.length)throw new Error("Invalid Parameter for CHAR_LENGTH function");switch(r){case s.FeatureServiceDatabaseType.SqlServer:return"LEN("+t[0]+")";case s.FeatureServiceDatabaseType.Oracle:return"LENGTH("+t[0]+")";default:return"CHAR_LENGTH("+t[0]+")"}case"concat":if(t.length<1)throw new Error("Invalid Parameter for CONCAT function");for(var n="CONCAT(",a=0;a<t.length;a++)0!==a&&(n+=","),n+=t[a];return n+")";case"lower":case"lcase":if(1!==t.length)throw new Error("Invalid Parameter for Lower function");return"LOWER("+t[0]+")";case"upper":case"ucase":if(1!==t.length)throw new Error("Invalid Parameter for Upper function");return"UPPER("+t[0]+")";case"substring":var i="";switch(r){case s.FeatureServiceDatabaseType.Oracle:return i="SUBSTR("+t[0]+","+t[1],3===t.length&&(i+=","+t[2]),i+")";case s.FeatureServiceDatabaseType.SqlServer:return 3===t.length?"SUBSTRING("+t[0]+","+t[1]+","+t[2]+")":"SUBSTRING("+t[0]+",  "+t[1]+", LEN("+t[0]+") - "+t[1]+")";default:return i="SUBSTRING("+t[0]+" FROM "+t[1],3===t.length&&(i+=" FOR "+t[2]),i+")"}case"extract":return"EXTRACT("+t[0].replace(/\'/g,"")+" FROM "+t[1]+")"}throw new Error("Function Not Recognised")}function v(e,t){var r=a.MomentLibrary.Moment(e),n=0===r.minute()&&0===r.hour()&&0===r.second()&&0===r.millisecond();switch(t){case s.FeatureServiceDatabaseType.FILEGDB:case s.FeatureServiceDatabaseType.Standardised:case s.FeatureServiceDatabaseType.StandardisedNoInterval:return n?"date '"+r.format("YYYY-MM-DD")+"'":"date '"+r.format("YYYY-MM-DD HH:mm:ss")+"'";case s.FeatureServiceDatabaseType.Oracle:return n?"TO_DATE('"+r.format("YYYY-MM-DD")+"','YYYY-MM-DD')":"TO_DATE('"+r.format("YYYY-MM-DD HH:mm:ss")+"','YYYY-MM-DD HH24:MI:SS')";case s.FeatureServiceDatabaseType.SqlServer:return"'"+r.format(n?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";case s.FeatureServiceDatabaseType.PGDB:return"#"+r.format(n?"MM-DD-YYYY":"MM-DD-YYYY HH:mm:ss")+"#";case s.FeatureServiceDatabaseType.Postgres:return"TIMESTAMP '"+r.format(n?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";default:return"date '"+r.format("YYYY-MM-DD HH:mm:ss")+"'"}}function w(e,t){switch(t){case s.FeatureServiceDatabaseType.FILEGDB:case s.FeatureServiceDatabaseType.Standardised:case s.FeatureServiceDatabaseType.StandardisedNoInterval:case s.FeatureServiceDatabaseType.Oracle:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP";case s.FeatureServiceDatabaseType.SqlServer:return e?"CAST(GETDATE() AS DATE)":"GETDATE()";case s.FeatureServiceDatabaseType.PGDB:case s.FeatureServiceDatabaseType.Postgres:default:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP"}}function g(e){if(e){for(var t="",r=0,n=e;r<n.length;r++){var a=n[r];""!==a&&(t=""===t||l[t]<l[a]?a:t)}return t}return""}function o(e){return""+e.period.toUpperCase()}function S(e,t,r,n){return"INTERVAL "+r+" "+e+" "+("interval-period"===t.type?o(t):o(t.start)+" TO "+o(t.end))}Object.defineProperty(t,"__esModule",{value:!0}),t.toWhereClause=n,t.toWhereClauseFromTree=function(e,t,r){return m(e,t,r)},t.reformulateWithoutField=function(e,t,r,n){return i.WhereClause.create(m(e.parseTree,s.FeatureServiceDatabaseType.Standardised,e.parameters,t,r),n)},t.combine=function(e,t,r){return void 0===r&&(r="AND"),i.WhereClause.create("(("+n(e,s.FeatureServiceDatabaseType.Standardised)+")"+r+"("+n(t,s.FeatureServiceDatabaseType.Standardised)+"))",e.fieldsIndex)},t.translateFunctionToDatabaseSpecific=_,t.makeDateString=v,t.makeToday=w,t.predictType=function(e,t,r){void 0===r&&(r={});for(var n={},a={},i={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",oid:"integer",long:"integer","small-integer":"integer",integer:"integer",single:"double",double:"double",date:"date",string:"string"},s=0,o=t;s<o.length;s++){var l=i[(u=o[s]).type];n[u.name.toLowerCase()]=void 0===l?"":l}for(var u in r){l=i[r[u]];a[u.toLowerCase()]=void 0===l?"":l}switch(function e(t,r,n,a){var i;switch(r.type){case"interval":return"integer";case"case_expression":var s=[];if("simple"===r.format){for(var o=0;o<r.clauses.length;o++)s.push(e(t,r.clauses[o].value,n,a));null!==r.else&&s.push(e(t,r.else,n,a))}else{for(var o=0;o<r.clauses.length;o++)s.push(e(t,r.else,n,a));null!==r.else&&s.push(e(t,r.else,n,a))}return g(s);case"param":var l=a[r.value.toLowerCase()];if(void 0===l&&n){var u=n[r.value.toLowerCase()];if(void 0===u)return"";if(null===u)return"";if("string"==typeof u||u instanceof String)return"string";if("boolean"==typeof u)return"boolean";if(u instanceof Date)return"date";if("number"==typeof u)return u%1==0?"integer":"double"}return void 0===l?"":l;case"expr_list":for(var c=[],f=0,d=r.value;f<d.length;f++){var p=d[f];c.push(e(t,p,n,a))}return c;case"unary_expr":return"boolean";case"binary_expr":switch(r.operator){case"AND":case"OR":return"boolean";case"IS":case"ISNOT":if("null"!==r.right.type)throw new Error("Unsupported RHS for IS");return"boolean";case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":return"boolean";case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"*":case"-":case"+":case"/":return g([e(t,r.left,n,a),e(t,r.right,n,a)])}throw new Error("Not Supported Operator "+r.operator);case"null":return"";case"bool":return"boolean";case"string":return"string";case"number":return null===r.value?"":r.value%1==0?"integer":"double";case"date":case"timestamp":return"date";case"column_ref":if("CURRENT_DATE"===r.column.toUpperCase())return"date";if("CURRENT_TIMESTAMP"===r.column.toUpperCase())return"date";var h=t[r.column.toLowerCase()];return void 0===h?"":h;case"function":switch(r.name.toLowerCase()){case"position":case"extract":case"char_length":return"integer";case"round":return(i=e(t,r.args,n,a))instanceof Array?0<i.length?i[0]:"":i;case"sign":return(i=e(t,r.args,n,a))instanceof Array&&(i=g(i)),"integer"===i||"double"===i?i:"double";case"ceiling":case"floor":case"abs":var y=e(t,r.args,n,a);return y instanceof Array?g(y):y;case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"power":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string";case"truncate":return"double";case"round":return(i=e(t,r.args,n,a))instanceof Array?0<i.length?i[0]:"":i}return""}throw new Error("Unsupported sql syntax "+r.type)}(n,e.parseTree,e.parameters,a)){case"double":return"double";case"integer":return"integer";case"double":return"double";case"date":return"date";case"string":return"string"}return""};var l={boolean:1,string:2,integer:3,double:4,date:5};t.scanForField=function(e,t){return function e(t,r){if(null==t)return!1;switch(t.type){case"when_clause":return e(t.operand,r)||e(t.value,r);case"case_expression":for(var n=0,a=t.clauses;n<a.length;n++){var i=a[n];if(e(i,r))return!0}return!("simple"!==t.format||!e(t.operand,r))||!(null===t.else||!e(t.else,r));case"param":return!1;case"expr_list":for(var s=0,o=t.value;s<o.length;s++){var i=o[s];if(e(i,r))return!0}return!1;case"unary_expr":return e(t.expr,r);case"binary_expr":return e(t.left,r)||e(t.right,r);case"null":case"bool":case"date":case"timestamp":case"string":case"number":return!1;case"column_ref":return r.toLowerCase()===t.column.toLowerCase();case"function":return e(t.args,r)}return!1}(e.parseTree,t)},t.isSingleField=function(e){return"column_ref"===e.parseTree.type},t.convertIntervalToSql=S}.apply(null,n))||(e.exports=a)},1748:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(125),r.dj.m(e),r(81),r(152),r(153),r(43),r(37),r(209),r(1864),r(128)],void 0===(a=function(e,t,r,n,f,a,i,s,o,l,u,d){function p(e,t){var r;if(null==e||void 0===e)return e;if("number"==typeof e)return e;var n=e.toString();if(""===n)return null;if(2==t){if(void 0!==(r=b[n]))return r}else if(0==t){if(void 0!==(r=F[n]))return r;if(void 0!==(r=I[e]))return r}else if(3==t&&void 0!==(r=F[n]))return r;if(1==t&&void 0!==(r=I[e]))return r;if(!0===/^\d+$/.test(n))return parseInt(n);throw Error("Unrecognised Unit Type")}function h(e){if(null!=e)switch(e){case"loxodrome":return 1;case"great-elliptic":return 2;case"normal-section":return 3;case"shape-preserving":return 4}return 0}function y(e){if(null==e)return null;if(S)switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m};case"multipoint":return{points:e.points,hasZ:e.hasZ,hasM:e.hasM};case"polyline":return{paths:e.paths,hasZ:e.hasZ,hasM:e.hasM};case"polygon":return{rings:e.rings,hasZ:e.hasZ,hasM:e.hasM};case"extent":return{xmin:e.xmin,ymin:e.ymin,xmax:e.xmax,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax}}else switch(e.type){case"point":return{x:e.x,y:e.y};case"multipoint":return{points:e.points};case"polyline":return{paths:e.paths};case"polygon":return{rings:e.rings};case"extent":return{xmin:e.xmin,ymin:e.ymin,xmax:e.xmax,ymax:e.ymax}}return null}function g(e,t){if(null===e)return null;var r=function(e){if(void 0===s.fromJson){if(void 0!==e.x&&void 0!==e.y)return new s(e);if(void 0!==e.paths)return new i(e);if(void 0!==e.rings)return new a(e);if(void 0!==e.points)return new l(e);if(void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax)return new o(e)}else{if(void 0!==e.x&&void 0!==e.y)return s.fromJson(e);if(void 0!==e.paths)return i.fromJson(e);if(void 0!==e.rings)return a.fromJson(e);if(void 0!==e.points)return l.fromJson(e);if(void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax)return o.fromJson(e)}}(e);return S?r.set("spatialReference",t):r.setSpatialReference(t),r}function m(e){return null==e||void 0===e?null:-1!=e.wkid&&null!==e.wkid&&void 0!==e.wkid?{wkid:e.wkid}:""!==e.wkt&&void 0!==e.wkt&&null!==e.wkt?{wkt:e.wkt}:null}function c(e,t,r){var n=new d,a=t.spatialReference;return x.a({action:e,geoma:y(t),geomb:y(r),spatialReference:m(t.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(g(e.result,a))},function(e){n.reject(e)}),n.promise}function _(e,t,r){var n=new d;return x.a({action:e,geoma:y(t),geomb:y(r),spatialReference:m(t.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise}var v,w,S=0==r.version.indexOf("4.");(w=v=v||{})[w.Linear=0]="Linear",w[w.Angular=1]="Angular",w[w.Area=2]="Area",w[w.LinearOrAngular=3]="LinearOrAngular";var F={feet:9002,kilometers:9036,meters:9001,miles:9035,"nautical-miles":9030,yards:9096},b={acres:109402,ares:109463,hectares:109401,"square-feet":109405,"square-kilometers":109414,"square-meters":109404,"square-miles":109413,"square-yards":109442},I={degrees:9102,radians:9101},T=(R.prototype.A=function(e){var t=this;this.i=new u,this.i.setWorker(this.l(),function(){t.c=!1,e()})},R.prototype.l=function(){return e.B?e.B("./geometryenginewebworker"):n.id.replace(/\/[^\/]*$/gi,"/")+"./geometryenginewebworker"},R),x=(C.a=function(e){var t=new d;return C.h.push({task:e,d:t}),C.f(),t.promise},C.f=function(){if(0<C.h.length){for(var t=null,e=0;e<C.b.length;e++)if(!1===C.b[e].c){t=C.b[e];break}if(null===t&&C.b.length<C.g&&(e=new T,C.b.push(e),e.A(function(){C.f()})),null!==t){var r=this.h.shift();t.c=!0,t.i.postMessage(r.task).then(function(e){t.c=!1;try{r.d.resolve(e)}catch(e){}C.f()},function(e){t.c=!1;try{r.d.reject(e)}catch(e){}C.f()})}}},C.b=[],C.h=[],C.g=4,C);function C(){}function R(){this.c=!0,this.i=null}return E._removeAllWorkers=function(){x.b=[]},E._setMaxWorkers=function(e){E._removeAllWorkers(),x.g=e},E._getMaxWorkers=function(){return x.g},E._getNumWorkers=function(){return x.b.length},E.extendedSpatialReferenceInfo=function(e){var t=new d;return x.a({action:"extendedspatialreferenceinfo",spatialReference:m(e)}).then(function(e){0===e.status?t.reject(Error(e.error.message)):t.resolve(e.result)},function(e){t.reject(e)}),t.promise},E.equals=function(e,t){return!(null===e&&null!==t||null===t&&null!==e)&&_("equals",e,t)},E.intersects=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return _("intersects",e,t)},E.touches=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return _("touches",e,t)},E.within=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return _("within",e,t)},E.disjoint=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return _("disjoint",e,t)},E.overlaps=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return _("overlaps",e,t)},E.crosses=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return _("crosses",e,t)},E.contains=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return _("contains",e,t)},E.isSimple=function(e){return _("issimple",e,null)},E.clip=function(e,t){return c("clip",e,t)},E.simplify=function(e){var t=new d,r=e.spatialReference;return x.a({action:"simplify",geoma:y(e),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?t.reject(Error(e.error.message)):t.resolve(g(e.result,r))},function(e){t.reject(e)}),t.promise},E.rotate=function(e,t,r){var n=new d,a=e.spatialReference;if(null==r)switch(e.type){case"point":r=e;break;case"extent":r=S?e.get("center"):e.getCenter();break;default:r=S?e.get("extent").get("center"):e.getExtent().getCenter()}return x.a({action:"rotate",geoma:y(e),spatialReference:m(e.spatialReference),angle:t,rotpt:y(r)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(g(e.result,a))},function(e){n.reject(e)}),n.promise},E.flipHorizontal=function(e,t){var r=new d,n=e.spatialReference;if(null==t)switch(e.type){case"point":t=e;break;case"extent":t=S?e.get("center"):e.getCenter();break;default:t=S?e.get("extent").get("center"):e.getExtent().getCenter()}return x.a({action:"fliph",geoma:y(e),spatialReference:m(e.spatialReference),flippt:y(t)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(g(e.result,n))},function(e){r.reject(e)}),r.promise},E.flipVertical=function(e,t){var r=new d,n=e.spatialReference;if(null==t)switch(e.type){case"point":t=e;break;case"extent":t=S?e.get("center"):e.getCenter();break;default:t=S?e.get("extent").get("center"):e.getExtent().getCenter()}return x.a({action:"flipv",geoma:y(e),spatialReference:m(e.spatialReference),flippt:y(t)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(g(e.result,n))},function(e){r.reject(e)}),r.promise},E.distance=function(e,t,r){var n=new d;return x.a({action:"distance",geoma:y(e),geomb:y(t),spatialReference:m(e.spatialReference),distanceunits:p(r,3)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise},E.relate=function(e,t,r){var n=new d;return x.a({action:"relate",geoma:y(e),geomb:y(t),relation:r,spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise},E.nearestCoordinate=function(e,t,r){var n=new d,a=e.spatialReference;return x.a({action:"nearestcoord",geoma:y(e),geomb:y(t),spatialReference:m(e.spatialReference),testinterior:void 0===r||r}).then(function(e){0===e.status?n.reject(Error(e.error.message)):(e.result.coordinate=g(e.result.coordinate,a),n.resolve(e.result))},function(e){n.reject(e)}),n.promise},E.nearestVertex=function(e,t){var r=new d,n=e.spatialReference;return x.a({action:"nearestvertex",geoma:y(e),geomb:y(t),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):(e.result.coordinate=g(e.result.coordinate,n),r.resolve(e.result))},function(e){r.reject(e)}),r.promise},E.nearestVertices=function(e,t,r,n){var a=new d,i=e.spatialReference;return x.a({action:"nearestvertices",geoma:y(e),geomb:y(t),spatialReference:m(e.spatialReference),searchradius:r,maxreturn:n}).then(function(e){if(0===e.status)a.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t].coordinate=g(e.result[t].coordinate,i);a.resolve(e.result)}},function(e){a.reject(e)}),a.promise},E.cut=function(e,t){var r=new d,n=e.spatialReference;return x.a({action:"cut",geoma:y(e),geomb:y(t),spatialReference:m(e.spatialReference)}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=g(e.result[t],n);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},E.generalize=function(e,t,r,n){var a=new d,i=e.spatialReference;return x.a({action:"generalize",geoma:y(e),maxdeviation:t,removedegenerateparts:r,maxdeviationunit:p(n,3),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?a.reject(Error(e.error.message)):a.resolve(g(e.result,i))},function(e){a.reject(e)}),a.promise},E.densify=function(e,t,r){var n=new d,a=e.spatialReference;return x.a({action:"densify",geoma:y(e),maxsegmentlength:t,maxsegmentlengthunit:p(r,3),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(g(e.result,a))},function(e){n.reject(e)}),n.promise},E.geodesicDensify=function(e,t,r,n){void 0===n&&(n=0);var a=new d,i=e.spatialReference;return x.a({action:"geodensify",geoma:y(e),maxsegmentlength:t,maxsegmentlengthunit:p(r,3),spatialReference:m(e.spatialReference),curveType:n}).then(function(e){0===e.status?a.reject(Error(e.error.message)):a.resolve(g(e.result,i))},function(e){a.reject(e)}),a.promise},E.intersect=function(e,t){return e instanceof f?c("intersect",e,t):E.u(e,t)},E.u=function(e,t){for(var r=new d,n=[],a=0;a<e.length;a++)n.push(y(e[a]));var i=t.spatialReference;return x.a({action:"intersectmany",geom:y(t),geometries:n,spatialReference:m(t.spatialReference)}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=g(e.result[t],i);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},E.difference=function(e,t){return e instanceof f?c("difference",e,t):E.s(e,t)},E.s=function(e,t){for(var r=new d,n=[],a=0;a<e.length;a++)n.push(y(e[a]));var i=t.spatialReference;return x.a({action:"differencemany",geom:y(t),geometries:n,spatialReference:m(t.spatialReference)}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=g(e.result[t],i);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},E.symmetricDifference=function(e,t){return e instanceof f?c("symdifference",e,t):E.w(e,t)},E.w=function(e,t){for(var r=new d,n=[],a=0;a<e.length;a++)n.push(y(e[a]));var i=t.spatialReference;return x.a({action:"symdifferencemany",geom:y(t),geometries:n,spatialReference:m(t.spatialReference)}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=g(e.result[t],i);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},E.union=function(e,t){void 0===t&&(t=null);var r=new d,n=[];if(null===e)return r.resolve(null),r.promise;if(e instanceof f&&(e=[e],null!==t&&e.push(t)),0===e.length)return r.resolve(null),r.promise;for(var a=0;a<e.length;a++)n.push(y(e[a]));var i=e[0].spatialReference;return x.a({action:"unionmany",geometries:n,spatialReference:m(i)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(g(e.result,i))},function(e){r.reject(e)}),r.promise},E.buffer=function(e,t,r,n){if(void 0===n&&(n=!1),e instanceof f){var a=new d,i=e.spatialReference;return x.a({action:"buffer",geoma:y(e),spatialReference:m(e.spatialReference),distance:t,unit:p(r,3),geodesic:!1,geodesicmaxdeviation:NaN,geodesiccurvetype:0}).then(function(e){0===e.status?a.reject(Error(e.error.message)):a.resolve(g(e.result,i))},function(e){a.reject(e)}),a.promise}if("[object Array]"!==Object.prototype.toString.call(t)){for(var s=[],o=0;o<e.length;o++)s.push(t);t=s}if(t.length!=e.length){if(0==t.length)throw Error("Illegal Argument Exception");s=[];var l=0;for(o=0;o<e.length;o++)void 0===t[o]?s.push(l):(s.push(t[o]),l=t[o]);t=s}return E.j(e,t,r,!1,n,"geodesic",NaN)},E.geodesicBuffer=function(e,t,r,n,a,i){if(e instanceof f){var s=new d;void 0===a&&(a=NaN);var o=e.spatialReference;return x.a({action:"buffer",geoma:y(e),spatialReference:m(e.spatialReference),distance:t,unit:p(r,0),geodesic:!0,geodesicmaxdeviation:a,geodesiccurvetype:h(n)}).then(function(e){0===e.status?s.reject(Error(e.error.message)):s.resolve(g(e.result,o))},function(e){s.reject(e)}),s.promise}if("[object Array]"!==Object.prototype.toString.call(t)){for(var l=[],u=0;u<e.length;u++)l.push(t);t=l}if(t.length!=e.length){if(0==t.length)throw Error("Illegal Argument Exception");l=[];var c=0;for(u=0;u<e.length;u++)void 0===t[u]?l.push(c):(l.push(t[u]),c=t[u]);t=l}return E.j(e,t,r,!0,n,a,i)},E.j=function(e,t,r,n,a,i,s){var o=new d,l=[];if(void 0===s&&(s=NaN),null===e||0===e.length)return o.resolve(null),o.promise;for(var u=0;u<e.length;u++)l.push(y(e[u]));r=p(r,n?0:3);var c=e[0].spatialReference;return x.a({action:"buffermany",geometries:l,spatialReference:m(c),distances:t,tounionresults:a,unit:r,geodesic:n,geodesicmaxdeviation:s,geodesiccurvetype:h(i)}).then(function(e){if(0===e.status)o.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=g(e.result[t],c);o.resolve(e.result)}},function(e){o.reject(e)}),o.promise},E.convexHull=function(e,t){if(void 0===t&&(t=!1),e instanceof f){var r=new d,n=e.spatialReference;return x.a({action:"convexhull",geoma:y(e),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(g(e.result,n))},function(e){r.reject(e)}),r.promise}return E.o(e,t)},E.o=function(e,t){for(var r=new d,n=[],a=0;a<e.length;a++)n.push(y(e[a]));var i=0<e.length?e[0].spatialReference:null;return x.a({action:"convexhullmany",geometries:n,merge:t}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=g(e.result[t],i);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},E.offset=function(e,t,r,n,a,i){var s=0;if(null!=n&&null!=n)switch(n){case"round":s=0;break;case"bevel":s=1;break;case"miter":s=2;break;case"square":s=3}if(e instanceof f){var o=new d,l=e.spatialReference;return x.a({action:"offset",geoma:y(e),spatialReference:m(e.spatialReference),distance:t,joins:s,bevelratio:a,flattenerror:i,offsetunit:p(r,3)}).then(function(e){0===e.status?o.reject(Error(e.error.message)):o.resolve(g(e.result,l))},function(e){o.reject(e)}),o.promise}return E.v(e,t,r,s,a,i)},E.v=function(e,t,r,n,a,i){for(var s=new d,o=[],l=0;l<e.length;l++)o.push(y(e[l]));var u=0<e.length?e[0].spatialReference:null;return x.a({action:"offsetmany",geometries:o,spatialReference:m(u),distance:t,joins:n,bevelratio:a,offsetunit:p(r,3),flattenerror:i}).then(function(e){if(0===e.status)s.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=g(e.result[t],u);s.resolve(e.result)}},function(e){s.reject(e)}),s.promise},E.planarArea=function(e,t){var r=new d;return x.a({action:"area",geoma:y(e),unit:p(t,2),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(e.result)},function(e){r.reject(e)}),r.promise},E.planarLength=function(e,t){var r=new d;return x.a({action:"length",geoma:y(e),unit:p(t,3),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(e.result)},function(e){r.reject(e)}),r.promise},E.geodesicArea=function(e,t,r){var n=new d;return x.a({action:"geodesicarea",geoma:y(e),unit:p(t,2),geodesiccurvetype:h(r),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise},E.geodesicLength=function(e,t,r){var n=new d;return x.a({action:"geodesiclength",geoma:y(e),unit:p(t,0),geodesiccurvetype:h(r),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise},E;function E(){}}.apply(null,n))||(e.exports=a)},1864:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(4),r(22)],void 0===(a=function(n,e,a,s){return t.prototype.setWorker=function(e,t){var r=this._getUrl(e);r=s.normalize(r);var n,a=!s.hasSameOrigin(r,location.href);if(this.worker&&((n=this.worker).removeEventListener("message",this._acceptMessage,!1),n.removeEventListener("error",this._errorMessage,!1),n.terminate(),n=null),a){var i=URL.createObjectURL(new Blob(['\nfunction actionHandler(evt) {\n  var msg = evt.data;\n  var error, success;\n\n  if (msg.action) {\n    switch (msg.action) {\n      case "import-script":\n        try {\n          if (!Array.isArray(msg.url)) {\n            msg.url = [msg.url];\n          }\n\n          importScripts(msg.url);\n          success = true;\n        }\n        catch (err) {\n          error = err;\n        }\n\n        break;\n    }\n\n    if (success) {\n      postMessage({\n        msgId: msg.msgId,\n        success: true\n      });\n    }\n    else if (error) {\n      postMessage({\n        status: "error",\n        msgId: msg.msgId,\n        message: error.message\n      });\n    }\n  }\n}\n\nself.addEventListener("message", actionHandler, false);\n'],{type:"text/javascript"}));t(this._createWorker(i,r))}else t(this._createWorker(r))},t.prototype.postMessage=function(e,t){if(!this.worker)return a.reject({message:"No worker was set."});!Array.isArray(e)&&"object"==typeof e||(e={data:e});var r=a.createDeferred(),n=Math.floor(64e9*Math.random()).toString(36);return e.msgId=n,this._queue.set(n,r),t?this.worker.postMessage(e,t):this.worker.postMessage(e),r.promise},t.prototype.terminate=function(){this.worker&&this.worker.terminate(),this._queue.forEach(function(e){e.reject(a.createAbortError("terminated"))}),this._queue.clear()},t.prototype.importScripts=function(e){var r=this;Array.isArray(e)||(e=[e]);var t=e.map(function(e){var t=r._getUrl(e,!0);return r._useProxy&&!s.hasSameOrigin(t,location.href)&&(t=s.getProxyUrl(t).path+"?"+encodeURI(t)),t});return this.postMessage({action:"import-script",url:t}).then(function(e){e.target=r})},t.prototype._createWorker=function(e,t){var r=new Worker(e);return r.addEventListener("message",this._acceptMessage,!1),r.addEventListener("error",this._errorMessage,!1),this.worker=r,t&&this.importScripts(t),r},t.prototype._getUrl=function(e,t){void 0===t&&(t=!1),e.match(/\.js$/)||(e+=".js");var r=n.toUrl(e);return t?s.makeAbsolute(r):r},t;function t(){var a=this;this.worker=null,this._queue=new Map,this._useProxy=!1,this._acceptMessage=function(e){var t=e.data,r=t.msgId;if(a._queue.has(r)){var n=a._queue.get(r);"error"===t.status?n.reject(e.data):n.resolve(e.data),a._queue.delete(r)}},this._errorMessage=function(e){console.log("Worker Error: "+e.message+"\nIn "+e.filename+" on "+e.lineno)}}}.apply(null,n))||(e.exports=a)},1865:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1640),r(1648),r(1664),r(4)],void 0===(a=function(e,t,u,c,a,i){function s(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function n(e){for(var t=s(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/e.length}function o(e){for(var t=s(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/(e.length-1)}function l(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}function f(e,r,t,n){void 0===n&&(n=!1);try{var a=e.iterator(t);return i.create(function(e,t){!function r(n,a,i,s,o,l){u.tick(n.next().then(function(e){try{if(null!==e){var t=i.calculateValue(e);return null===t?!1===s&&(a[a.length]=t):a[a.length]=t,r(n,a,i,s,o,l)}o(a)}catch(e){l(e)}},l))}(a,[],r,n,e,t)})}catch(e){return i.reject(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.decodeStatType=function(e){switch(e.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""},t.calculateStat=function(e,t,r){switch(void 0===r&&(r=1e3),e.toLowerCase()){case"distinct":return function(e,t){for(var r=[],n={},a=[],i=0;i<e.length;i++){if(void 0!==e[i]&&null!==e[i]){var s=e[i];if(c.isNumber(s)||c.isString(s))void 0===n[s]&&(r.push(s),n[s]=1);else{for(var o=!1,l=0;l<a.length;l++)!0===c.equalityTest(a[l],s)&&(o=!0);!1===o&&(a.push(s),r.push(s))}}if(r.length>=t&&-1!==t)return r}return r}(t,r);case"avg":case"mean":return s(t);case"min":return Math.min.apply(Math,t);case"sum":return l(t);case"max":return Math.max.apply(Math,t);case"stdev":case"stddev":return Math.sqrt(n(t));case"var":case"variance":return n(t);case"count":return t.length}return 0},t.min=function(e,t,r){return f(e,t,r,!0).then(function(e){return 0===e.length?null:Math.min.apply(Math,e)})},t.max=function(e,t,r){return f(e,t,r,!0).then(function(e){return 0===e.length?null:Math.max.apply(Math,e)})},t.mean=function(e,t,r){var n="";return!1===a.isSingleField(t)&&(n=a.predictType(t,e.fields,null)),f(e,t,r,!0).then(function(e){if(0===e.length)return null;var t,r=s(e);return null===r?r:"integer"===n?(t=+(t=r),isFinite(t)?t-t%1||(t<0?-0:0===t?t:0):t):r})},t.variance=function(e,t,r){return f(e,t,r,!0).then(function(e){return 0===e.length?null:o(e)})},t.stdev=function(e,t,r){return f(e,t,r,!0).then(function(e){return 0===e.length?null:Math.sqrt(o(e))})},t.sum=function(e,t,r){return f(e,t,r,!0).then(function(e){return 0===e.length?null:l(e)})},t.count=function(e,t){try{return e.iterator(t).count()}catch(e){return i.reject(e)}},t.distinct=function(e,t,r,n){return void 0===r&&(r=1e3),void 0===n&&(n=null),function(e,t,r,n){try{return function r(n,a,i,s,o){return n.next().then(function(e){if(null===e)return i;var t=s.calculateValue(e);return null!=t&&void 0===a[t]&&(i.push(t),a[t]=1),i.length>=o&&-1!==o?i:r(n,a,i,s,o)})}(e.iterator(n),{},[],t,r)}catch(e){return i.reject(e)}}(e,t,r,n)}}.apply(null,n))||(e.exports=a)},1866:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(11),r(1640),r(1663),r(1658),r(1867),r(4)],void 0===(a=function(e,t,r,n,a,o,i,u){var s,l=(r(c,s=a),c.prototype._getSet=function(t){var r=this;return null===this._wset?this._ensureLoaded().then(function(){return r._getFilteredSet("",null,null,r._orderbyclause,t)}).then(function(e){return r._checkCancelled(t),r._wset=e,r._wset}):u.resolve(this._wset)},c.prototype.manualOrderSet=function(e,t){var n=this;return this.getIdColumnDictionary(e,[],-1,t).then(function(e){n._orderbyclause.order(e);for(var t=new o([],[],!0,null),r=0;r<e.length;r++)t._known.push(e[r].id);return t})},c.prototype.getIdColumnDictionary=function(a,i,s,o){var l=this;if(s<a._known.length-1){var e=this._maxQueryRate();if("GETPAGES"===a._known[s+1])return n.tick(this._parent._expandPagedSet(a,e,0,0,o)).then(function(e){return l.getIdColumnDictionary(a,i,s,o)});for(var t=s+1,r=[];t<a._known.length&&"GETPAGES"!==a._known[t];)r.push(a._known[t]),t++;return s+=r.length,n.tick(this._parent._getFeatureBatch(r,o)).then(function(e){l._checkCancelled(o);for(var t=0,r=e;t<r.length;t++){var n=r[t];i.push({id:n.attributes[l.objectIdField],feature:n})}return l.getIdColumnDictionary(a,i,s,o)})}return 0<a._candidates.length?n.tick(this._refineSetBlock(a,this._maxProcessingRate(),o)).then(function(){return l._checkCancelled(o),l.getIdColumnDictionary(a,i,s,o)}):u.resolve(i)},c.prototype._isInFeatureSet=function(e){return this._parent._isInFeatureSet(e)},c.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},c.prototype._featureFromCache=function(e){if(void 0!==this._featureCache[e])return this._featureCache[e];var t=this._parent._featureFromCache(e);return void 0!==t?null===t?null:this._featureCache[e]=t:void 0},c.prototype._fetchAndRefineFeatures=function(e,t,r){return u.reject(new Error("Fetch and Refine should not be called in this featureset"))},c.prototype._getFilteredSet=function(e,n,a,t,i){var s=this;return this._ensureLoaded().then(function(){return s._parent._getFilteredSet(e,n,a,null===t?s._orderbyclause:t,i)}).then(function(e){var t;s._checkCancelled(i),t=new o(e._candidates.slice(0),e._known.slice(0),e._ordered,s._clonePageDefinition(e.pagesDefinition));var r=!0;return 0<e._candidates.length&&(r=!1),!1===t._ordered?s.manualOrderSet(t,i).then(function(e){return!1===r&&(null===n&&null===a||(e=new o(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,s._clonePageDefinition(e.pagesDefinition)))),e}):t})},c);function c(e){var t=s.call(this,e)||this;return t._orderbyclause=null,t.declaredClass="esri.arcade.featureset.actions.OrderBy",t._maxProcessing=100,t._orderbyclause=e.orderbyclause,t._parent=e.parentfeatureset,t}return a._featuresetFunctions.orderBy=function(e){return""===e?this:new l({parentfeatureset:this,orderbyclause:new i(e)})},l}.apply(null,n))||(e.exports=a)},1867:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){function o(e,t){return e===t?0:null===e?-1:null===t?1:e<t?-1:1}return l.prototype.constructClause=function(){for(var e="",t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e},l.prototype.order=function(e){var s=this;e.sort(function(e,t){for(var r=0;r<s._fields.length;r++){var n,a=s.featureValue(e.feature,s._fields[r],r),i=s.featureValue(t.feature,s._fields[r],r);if(0!==(n=1===s._directions[r]?o(a,i):-1*o(a,i)))return n}return 0})},l.prototype.scanForField=function(e){for(var t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1},l.prototype.replaceFields=function(e){for(var t="",r=0;r<this._fields.length;r++){0!==r&&(t+=",");for(var n=this._fields[r],a=0,i=e;a<i.length;a++){var s=i[a];if(n.toLowerCase()===s.field.toLowerCase()){n=s.newfield;break}}t+=n,1===this._directions[r]?t+=" ASC":t+=" DESC"}return new l(t)},l.prototype.featureValue=function(e,t,r){var n=e.attributes[t];if(void 0!==n)return n;for(var a in e.attributes)if(t.toLowerCase()===a.toLowerCase())return this._fields[r]=a,e.attributes[a];return null},l;function l(e){var t=e.split(",");this._fields=[],this._directions=[];for(var r=0;r<t.length;r++){var n=t[r].match(/\S+/g);this._fields.push(n[0]),2===n.length?"asc"===n[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}}.apply(null,n))||(e.exports=a)},1868:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(11),r(1663),r(1658),r(1648),r(4)],void 0===(a=function(e,t,r,n,i,a,s){return r(o,l=n),o.prototype._getSet=function(e){return s.resolve(this._wset)},o.prototype.optimisePagingFeatureQueries=function(e){},o.prototype._isInFeatureSet=function(e){return a.IdState.NotInFeatureSet},o.prototype._getFeature=function(e,t){return s.reject(new Error("No Feature Found in EmptySet"))},o.prototype.queryAttachments=function(e,t,r,n){return s.resolve([])},o.prototype._getFeatures=function(e,t,r,n){return s.resolve("success")},o.prototype._featureFromCache=function(e){return null},o.prototype._fetchAndRefineFeatures=function(e,t,r){return s.reject(new Error("Fetch and Refine should not be called in this featureset"))},o.prototype._getFilteredSet=function(e,t,r,n,a){return s.resolve(new i([],[],!1,null))},o.prototype._stat=function(e,t,r,n,a,i,s){return this._manualStat(e,t,i,s)},o.prototype._canDoAggregates=function(e,t,r,n,a){return s.resolve(!1)},o;function o(e){var t=l.call(this,e)||this;return t.declaredClass="esri.layers.featureset.sources.Empty",t._maxProcessing=1e3,t._wset=new i([],[],!1,null),t._parent=e.parentfeatureset,t._databaseType=a.FeatureServiceDatabaseType.Standardised,t}var l}.apply(null,n))||(e.exports=a)},1869:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(11),r(1663),r(1658),r(1648),r(1664),r(4),r(1570),r(31)],void 0===(a=function(e,t,r,n,l,u,c,f,a,i){var s,o=(r(d,s=n),d.prototype._initialiseFeatureSet=function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.spatialReference=new i({wkid:4326}),this.geometryType=u.layerGeometryEsriConstants.point)},d.prototype._getSet=function(t){var r=this;return null===this._wset?this._ensureLoaded().then(function(){return r._parent._getFilteredSet("",null,r._whereclause,null,t)}).then(function(e){return r._checkCancelled(t),null!==r._whereClauseFunction?r._wset=new l(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,r._clonePageDefinition(e.pagesDefinition)):r._wset=new l(e._candidates.slice(0),e._known.slice(0),e._ordered,r._clonePageDefinition(e.pagesDefinition)),r._wset}):f.resolve(this._wset)},d.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);return t===u.IdState.NotInFeatureSet?t:void 0===(t=this._idstates[e])?u.IdState.Unknown:t},d.prototype._getFeature=function(e,t,r){return this._parent._getFeature(e,t,r)},d.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},d.prototype._featureFromCache=function(e){return this._parent._featureFromCache(e)},d.prototype.executeWhereClause=function(e){return this._whereclause.testFeature(e)},d.prototype.executeWhereClauseDeferred=function(e){if(null!==this._whereClauseFunction)try{var t=this._whereClauseFunction(e);return f.isPromiseLike(t)?t:f.resolve(t)}catch(e){return f.reject(e)}return f.resolve(this.executeWhereClause(e))},d.prototype._fetchAndRefineFeatures=function(n,a,i){var s=this,e=new l([],n,!1,null),o=Math.min(a,n.length);return this._parent._getFeatures(e,-1,o,i).then(function(){if(s._checkCancelled(i),null==s._whereClauseFunction){for(var e=0;e<o;e++){var t=s._parent._featureFromCache(n[e]);!0===s.executeWhereClause(t)?s._idstates[n[e]]=u.IdState.InFeatureSet:s._idstates[n[e]]=u.IdState.NotInFeatureSet}return"success"}var r=[];for(e=0;e<o;e++)t=s._parent._featureFromCache(n[e]),r.push(s.executeWhereClauseDeferred(t));return f.all(r).then(function(e){for(var t=0;t<a;t++)!0===e[t]?s._idstates[n[t]]=u.IdState.InFeatureSet:s._idstates[n[t]]=u.IdState.NotInFeatureSet;return"success"})})},d.prototype._getFilteredSet=function(e,t,r,n,a){var i=this;return null!==this._whereClauseFunction||(null!==r?null!==this._whereclause&&(r=c.combine(this._whereclause,r)):r=this._whereclause),this._ensureLoaded().then(function(){return i._parent._getFilteredSet(e,t,r,n,a)}).then(function(e){return i._checkCancelled(a),null!==i._whereClauseFunction?new l(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,i._clonePageDefinition(e.pagesDefinition)):new l(e._candidates.slice(0),e._known.slice(0),e._ordered,i._clonePageDefinition(e.pagesDefinition))})},d.prototype._stat=function(t,r,n,a,i,s,o){var l=this;if(null!==this._whereClauseFunction)return null===i&&""===n&&null===a?this._manualStat(t,r,s,o):f.resolve({calculated:!1});var e=this._whereclause;return null!==i&&null!==this._whereclause&&(e=c.combine(this._whereclause,i)),this._parent._stat(t,r,n,a,e,s,o).then(function(e){return!1===e.calculated?null===i&&""===n&&null===a?l._manualStat(t,r,s,o):{calculated:!1}:e})},d.prototype._canDoAggregates=function(e,t,r,n,a){return null!==this._whereClauseFunction?f.resolve(!1):(null!==a?null!==this._whereclause&&(a=c.combine(this._whereclause,a)):a=this._whereclause,null===this._parent?f.resolve(!1):this._parent._canDoAggregates(e,t,r,n,a))},d.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,a,i,s){return null===this._parent?f.reject(new Error("Should never be called")):(null!==a?null!==this._whereclause&&(a=c.combine(this._whereclause,a)):a=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,a,i,s))},d);function d(e){var t=s.call(this,e)||this;return t.declaredClass="esri.arcade.featureset.actions.AttributeFilter",t._maxProcessing=1e3,t._parent=e.parentfeatureset,e.whereclause instanceof a.WhereClause?(t._whereclause=e.whereclause,t._whereClauseFunction=null):(t._whereClauseFunction=e.whereclause,t._whereclause=null),t}return n._featuresetFunctions.filter=function(e){if("function"==typeof e)return new o({parentfeatureset:this,whereclause:e});var t=null;return e instanceof a.WhereClause&&(t=e),new o({parentfeatureset:this,whereclause:t})},o}.apply(null,n))||(e.exports=a)},2028:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(11),r(5),r(29),r(2029),r(2788),r(2032),r(2790),r(2030),r(1648),r(4),r(154),r(53),r(158),r(1866),r(2033),r(2034),r(1869),r(2791)],void 0===(a=function(e,t,r,c,v,n,i,s,l,w,f,S,d,a,p){function h(t,r){if(w.applicationCache){var e=w.applicationCache.getLayerInfo(t);if(e)return e.then(function(e){return S.resolve(new d({url:t,outFields:r,sourceJSON:e}))});var n=new d({url:t,outFields:r}),a=S.create(function(e,t){n.load().then(function(){e(n.sourceJSON)},function(e){t(e)})});return w.applicationCache&&(w.applicationCache.setLayerInfo(t,a),a=a.catch(function(e){throw w.applicationCache.clearLayerInfo(t),e})),a.then(function(e){return S.resolve(n)})}return S.resolve(new d({url:t,outFields:r}))}function F(e,t,r,n,a){return h(e,["*"]).then(function(e){return S.resolve(y(e,t,r,n,a))})}function y(e,t,r,n,a){return void 0===t&&(t=null),void 0===r&&(r=null),void 0===n&&(n=!0),void 0===a&&(a=null),new(!0===e._hasMemorySource()?s:i)({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a})}function o(t){if(null!==w.applicationCache){var e=w.applicationCache.getLayerInfo(t);if(null!==e)return e}var r=v(t,{responseType:"json",query:{f:"json"}}).then(function(e){if(e.data){var t=e.data;return t.layers||(t.layers=[]),t.tables||(t.tables=[]),S.resolve(t)}return S.resolve({layers:[],tables:[]})});return null!==w.applicationCache&&(w.applicationCache.setLayerInfo(t,r),r=r.catch(function(e){throw w.applicationCache.clearLayerInfo(t),e})),r}Object.defineProperty(t,"__esModule",{value:!0}),t.initialiseMetaDataCache=function(){null===w.applicationCache&&(w.applicationCache=new w)},t.constructFeatureSetFromUrl=F,t.constructFeatureSet=y,t.constructAssociationMetaDataFeatureSetFromUrl=function(g,m){var _={metadata:null,networkId:-1,terminals:[],queryelem:null,layerNameLkp:{},lkp:null};return o(g).then(function(e){if((_.metadata=e).controllerDatasetLayers&&void 0!==e.controllerDatasetLayers.utilityNetworkLayerId&&null!==e.controllerDatasetLayers.utilityNetworkLayerId){if(e.layers)for(var t=0,r=e.layers;t<r.length;t++){var n=r[t];_.layerNameLkp[n.id]=n.name}if(e.tables)for(var a=0,i=e.tables;a<i.length;a++){n=i[a];_.layerNameLkp[n.id]=n.name}var y=e.controllerDatasetLayers.utilityNetworkLayerId;return _.networkId=y,function(e,t){var r="QUERYDATAELEMTS:"+t.toString()+":"+e;if(null!==w.applicationCache){var n=w.applicationCache.getLayerInfo(r);if(null!==n)return n}var a=v(e+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([t.toString()]),f:"json"}}).then(function(e){if(e.data){var t=e.data;if(t.layerDataElements&&t.layerDataElements[0])return t.layerDataElements[0]}throw new Error("Not Found")});return null!==w.applicationCache&&(w.applicationCache.setLayerInfo(r,a),a=a.catch(function(e){throw w.applicationCache.clearLayerInfo(r),e})),a}(g,y).then(function(e){if(e){_.queryelem=e,_.lkp={},_.queryelem.dataElement.domainNetworks||(_.queryelem.dataElement.domainNetworks=[]);for(var t=0,r=_.queryelem.dataElement.domainNetworks;t<r.length;t++){for(var n=r[t],a=0,i=n.edgeSources?n.edgeSources:[];a<i.length;a++){(u={layerId:(l=i[a]).layerId,sourceId:l.sourceId,className:_.layerNameLkp[l.layerId]?_.layerNameLkp[l.layerId]:null}).className&&(_.lkp[u.className]=u)}for(var s=0,o=n.junctionSources?n.junctionSources:[];s<o.length;s++){var l,u;(u={layerId:(l=o[s]).layerId,sourceId:l.sourceId,className:_.layerNameLkp[l.layerId]?_.layerNameLkp[l.layerId]:null}).className&&(_.lkp[u.className]=u)}}if(_.queryelem.dataElement.terminalConfigurations)for(var c=0,f=_.queryelem.dataElement.terminalConfigurations;c<f.length;c++)for(var d=0,p=f[c].terminals;d<p.length;d++){var h=p[d];_.terminals.push({terminalId:h.terminalId,terminalName:h.terminalName})}return function(t){if(null!==w.applicationCache){var e=w.applicationCache.getLayerInfo(t);if(null!==e)return e}var r=v(t,{responseType:"json",query:{f:"json"}}).then(function(e){if(e.data){var t=e.data;return S.resolve(t)}return S.resolve(null)});return null!==w.applicationCache&&(w.applicationCache.setLayerInfo(t,r),r=r.catch(function(e){throw w.applicationCache.clearLayerInfo(t),e})),r}(g+"/"+y).then(function(e){return e.systemLayers&&void 0!==e.systemLayers.associationsTableId&&null!==e.systemLayers.associationsTableId?F(g+"/"+e.systemLayers.associationsTableId.toString(),m,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID"],!1,null).then(function(e){return e.load()}).then(function(e){return{lkp:_.lkp,associations:e,terminals:_.terminals}}):{associations:null,lkp:null,terminals:[]}})}return{associations:null,lkp:null,terminals:[]}})}return{associations:null,lkp:null,terminals:[]}})},t.constructFeatureSetFromRelationship=function(t,r,n,a,i,s,o){void 0===a&&(a=null),void 0===i&&(i=null),void 0===s&&(s=!0),void 0===o&&(o=null);var e=t.serviceUrl();return e?F(e="/"===e.charAt(e.length-1)?e+r.relatedTableId.toString():e+"/"+r.relatedTableId.toString(),a,i,s,o).then(function(e){return new l({layer:t,relatedLayer:e,relationship:r,objectId:n,spatialReference:a,outFields:i,includeGeometry:s,lrucache:o})}):null};var u,g,m=(r(I,g=n),I.prototype.makeAndAddFeatureSet=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=null);var n=y(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n},I.prototype.featureSetByName=function(t,e,r){var n=this;if(void 0===e&&(e=!0),void 0===r&&(r=null),void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then(function(){try{return n.featureSetByName(t,e,r)}catch(e){return S.reject(e)}});null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var a=JSON.stringify(r),i=0;i<this._instantLayers.length;i++){var s=this._instantLayers[i];if(s.opitem.title===t&&s.includeGeometry===e&&s.outFields===a)return this.resolvePromise(this._instantLayers[i].featureset)}var o=this._map.layers.find(function(e){return e instanceof d&&e.title===t});if(o)return this.resolvePromise(this.makeAndAddFeatureSet(o,e,r));if(this._map.tables){var l=this._map.tables.find(function(e){return!!(e.title&&e.title===t||e.title&&e.title===t)});if(l){if(!l._materializedTable){var u=l.outFields?l:c({},l,{outFields:["*"]});l._materializedTable=new d(u)}return l._materializedTable.load().then(function(){return n.resolvePromise(n.makeAndAddFeatureSet(l._materializedTable,e,r))})}}return this.resolvePromise(null)},I.prototype.featureSetById=function(t,e,r){var n=this;if(void 0===e&&(e=!0),void 0===r&&(r=["*"]),void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then(function(){try{return n.featureSetById(t,e,r)}catch(e){return S.reject(e)}});null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var a=JSON.stringify(r),i=0;i<this._instantLayers.length;i++){var s=this._instantLayers[i];if(s.opitem.id===t&&s.includeGeometry===e&&s.outFields===a)return this.resolvePromise(this._instantLayers[i].featureset)}var o=this._map.layers.find(function(e){return e instanceof d&&e.id===t});if(o)return this.resolvePromise(this.makeAndAddFeatureSet(o,e,r));if(this._map.tables){var l=this._map.tables.find(function(e){return e.id===t});if(l){if(!l._materializedTable){var u=c({},l,{outFields:["*"]});l._materializedTable=new d(u)}return l._materializedTable.load().then(function(){return n.resolvePromise(n.makeAndAddFeatureSet(l._materializedTable,e,r))})}}return this.resolvePromise(null)},I),_=(r(b,u=n),Object.defineProperty(b.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),b.prototype.makeAndAddFeatureSet=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=null);var n=y(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n},b.prototype._loadMetaData=function(){var t=this;return o(this._url).then(function(e){return t.metadata=e})},b.prototype.load=function(){return this._loadMetaData()},b.prototype.clone=function(){return new b(this._url,this._overridespref,this.lrucache)},b.prototype.featureSetByName=function(o,l,u){var c=this;void 0===l&&(l=!0),void 0===u&&(u=null),null===u&&(u=["*"]),u=(u=u.slice(0)).sort();for(var e=JSON.stringify(u),t=0;t<this._instantLayers.length;t++){var r=this._instantLayers[t];if(r.opitem.title===o&&r.includeGeometry===l&&r.outFields===e)return this.resolvePromise(this._instantLayers[t].featureset)}return this._loadMetaData().then(function(e){for(var t=null,r=0,n=e.layers?e.layers:[];r<n.length;r++)(s=n[r]).name===o&&(t=s);if(!t)for(var a=0,i=e.tables?e.tables:[];a<i.length;a++){var s;(s=i[a]).name===o&&(t=s)}return t?h(c._url+"/"+t.id,["*"]).then(function(e){return c.makeAndAddFeatureSet(e,l,u)}):c.resolvePromise(null)})},b.prototype.featureSetById=function(o,l,u){var c=this;void 0===l&&(l=!0),void 0===u&&(u=["*"]),null===u&&(u=["*"]),u=(u=u.slice(0)).sort();var e=JSON.stringify(u);o=null!=o?o.toString():"";for(var t=0;t<this._instantLayers.length;t++){var r=this._instantLayers[t];if(r.opitem.id===o&&r.includeGeometry===l&&r.outFields===e)return this.resolvePromise(this._instantLayers[t].featureset)}return this._loadMetaData().then(function(e){for(var t=null,r=0,n=e.layers?e.layers:[];r<n.length;r++)null!==(s=n[r]).id&&void 0!==s.id&&s.id.toString()===o&&(t=s);if(!t)for(var a=0,i=e.tables?e.tables:[];a<i.length;a++){var s;null!==(s=i[a]).id&&void 0!==s.id&&s.id.toString()===o&&(t=s)}return t?h(c._url+"/"+t.id,["*"]).then(function(e){return c.makeAndAddFeatureSet(e,l,u)}):c.resolvePromise(null)})},b);function b(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);var n=u.call(this)||this;return n._url=e,n._overridespref=t,n.lrucache=r,n.metadata=null,n._instantLayers=[],n}function I(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);var n=g.call(this)||this;return n._map=e,n._overridespref=t,n.lrucache=r,n._instantLayers=[],n}t.createFeatureSetCollectionFromMap=function(e,t,r){return void 0===r&&(r=null),new m(e,t,r)},t.createFeatureSetCollectionFromService=function(e,t,r){return void 0===r&&(r=null),new _(e,t,r)},t.getPortal=function(e,t){return null===e?t:new a({url:e.field("url")})},t.constructFeatureSetFromPortalItem=function(t,a,i,s,o,l,u){if(w.applicationCache){var e=w.applicationCache.getLayerInfo(t+":"+l.url);if(e)return e.then(function(e){try{var t=new d({url:f.extractServiceUrl(e.url)+"/"+a,outFields:["*"]});return S.resolve(y(t,i,s,o,u))}catch(e){return S.reject(e)}},function(e){return S.reject(e)})}return S.create(function(r,n){var e=new p({id:t,portal:l}).load();w.applicationCache&&w.applicationCache.setLayerInfo(t+":"+l.url,e),e.then(function(e){try{var t=new d({url:f.extractServiceUrl(e.url)+"/"+a,outFields:["*"]});r(y(t,i,s,o,u))}catch(e){n(e)}},function(e){w.applicationCache&&w.applicationCache.clearLayerInfo(t+":"+l.url),n(e)})})}}.apply(null,n))||(e.exports=a)},2029:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(4)],void 0===(a=function(e,t,r){return n.prototype.add=function(e,t,r){this._layerById[t]=r,this._layerByName[e]=r},n.prototype.featureSetByName=function(e,t,r){return void 0===t&&(t=!0),void 0===r&&(r=["*"]),void 0===this._layerByName[e]?this.resolvePromise(null):this.resolvePromise(this._layerByName[e])},n.prototype.featureSetById=function(e,t,r){return void 0===t&&(t=!0),void 0===r&&(r=["*"]),void 0===this._layerById[e]?this.resolvePromise(null):this.resolvePromise(this._layerById[e])},n.prototype.castToText=function(){return"object, FeatureSetCollection"},n.prototype.resolvePromise=function(e){return r.resolve(e)},n;function n(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}}.apply(null,n))||(e.exports=a)},2030:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){return r.prototype.clearDatabaseType=function(e){void 0===this._databaseTypeMetaData[e]&&delete this._databaseTypeMetaData[e]},r.prototype.getDatabaseType=function(e){return"MUSTBESET"===e||void 0===this._databaseTypeMetaData[e]?null:this._databaseTypeMetaData[e]},r.prototype.setDatabaseType=function(e,t){this._databaseTypeMetaData[e]=t},r.prototype.getLayerInfo=function(e){return void 0===this._layerInfo[e]?null:this._layerInfo[e]},r.prototype.setLayerInfo=function(e,t){this._layerInfo[e]=t},r.prototype.clearLayerInfo=function(e){void 0!==this._layerInfo[e]&&delete this._layerInfo[e]},r.applicationCache=null,r;function r(){this._databaseTypeMetaData={},this._layerInfo={}}}.apply(null,n))||(e.exports=a)},2031:function(e,t,r){var n,a;
/**
 * @preserve A JavaScript implementation of the SHA family of hashes, as
 * defined in FIPS PUB 180-2 as well as the corresponding HMAC implementation
 * as defined in FIPS PUB 198a
 *
 * Copyright Brian Turek 2008-2015
 * Distributed under the BSD License
 * See http://caligatio.github.com/jsSHA/ for more information
 *
 * Several functions taken from Paul Johnston
 */n=[r.dj.c(e.i),t],void 0===(a=function(e,t){function m(e,t){var r,n,a,i,s=[],o=[],l=0;if("UTF8"===t)for(n=0;n<e.length;n+=1)for(o=[],(r=e.charCodeAt(n))<128?o.push(r):r<2048?(o.push(192|r>>>6),o.push(128|63&r)):r<55296||57344<=r?o.push(224|r>>>12,128|r>>>6&63,128|63&r):(n+=1,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),o.push(240|r>>>18,128|r>>>12&63,128|r>>>6&63,128|63&r)),a=0;a<o.length;a+=1){for(i=l>>>2;s.length<=i;)s.push(0);s[i]|=o[a]<<24-l%4*8,l+=1}else if("UTF16BE"===t||"UTF16LE"===t)for(n=0;n<e.length;n+=1){for(r=e.charCodeAt(n),"UTF16LE"===t&&(r=(a=255&r)<<8|r>>8),i=l>>>2;s.length<=i;)s.push(0);s[i]|=r<<16-l%4*8,l+=2}return{value:s,binLen:8*l}}function _(e){var t,r,n,a=[],i=e.length;if(0!=i%2)throw"String of HEX type must be in byte increments";for(t=0;t<i;t+=2){if(r=parseInt(e.substr(t,2),16),isNaN(r))throw"String of HEX type contains invalid characters";for(n=t>>>3;a.length<=n;)a.push(0);a[t>>>3]|=r<<24-t%8*4}return{value:a,binLen:4*i}}function v(e){var t,r,n,a=[];for(r=0;r<e.length;r+=1)t=e.charCodeAt(r),n=r>>>2,a.length<=n&&a.push(0),a[n]|=t<<24-r%4*8;return{value:a,binLen:8*e.length}}function w(e){var t,r,n,a,i,s,o=[],l=0;if(-1===e.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";if(i=e.indexOf("="),e=e.replace(/\=/g,""),-1!==i&&i<e.length)throw"Invalid '=' found in base-64 string";for(t=0;t<e.length;t+=4){for(a=e.substr(t,4),r=n=0;r<a.length;r+=1)n|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[r])<<18-6*r;for(r=0;r<a.length-1;r+=1){for(s=l>>>2;o.length<=s;)o.push(0);o[s]|=(n>>>16-8*r&255)<<24-l%4*8,l+=1}}return{value:o,binLen:8*l}}function S(e,t){var r,n,a="0123456789abcdef",i="",s=4*e.length;for(r=0;r<s;r+=1)n=e[r>>>2]>>>8*(3-r%4),i+=a.charAt(n>>>4&15)+a.charAt(15&n);return t.outputUpper?i.toUpperCase():i}function F(e,t){var r,n,a,i,s,o,l="",u=4*e.length;for(r=0;r<u;r+=3)for(i=r+1>>>2,s=e.length<=i?0:e[i],i=r+2>>>2,o=e.length<=i?0:e[i],a=(e[r>>>2]>>>8*(3-r%4)&255)<<16|(s>>>8*(3-(r+1)%4)&255)<<8|o>>>8*(3-(r+2)%4)&255,n=0;n<4;n+=1)8*r+6*n<=32*e.length?l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>6*(3-n)&63):l+=t.b64Pad;return l}function b(e,t){var r,n,a="",i=4*e.length;for(r=0;r<i;r+=1)n=e[r>>>2]>>>8*(3-r%4)&255,a+=String.fromCharCode(n);return a}function I(e){var t={outputUpper:!1,b64Pad:"="};try{e.hasOwnProperty("outputUpper")&&(t.outputUpper=e.outputUpper),e.hasOwnProperty("b64Pad")&&(t.b64Pad=e.b64Pad)}catch(e){}if("boolean"!=typeof t.outputUpper)throw"Invalid outputUpper formatting option";if("string"!=typeof t.b64Pad)throw"Invalid b64Pad formatting option";return t}function T(e,t){return e<<t|e>>>32-t}function r(e,t){return e>>>t|e<<32-t}function a(e,t){var r=new ae(e.highOrder,e.lowOrder);return t<=32?new ae(r.highOrder>>>t|r.lowOrder<<32-t&4294967295,r.lowOrder>>>t|r.highOrder<<32-t&4294967295):new ae(r.lowOrder>>>t-32|r.highOrder<<64-t&4294967295,r.highOrder>>>t-32|r.lowOrder<<64-t&4294967295)}function n(e,t){return e>>>t}function i(e,t){return t<=32?new ae(e.highOrder>>>t,e.lowOrder>>>t|e.highOrder<<32-t&4294967295):new ae(0,e.highOrder>>>t-32)}function x(e,t,r){return e^t^r}function M(e,t,r){return e&t^~e&r}function B(e,t,r){return new ae(e.highOrder&t.highOrder^~e.highOrder&r.highOrder,e.lowOrder&t.lowOrder^~e.lowOrder&r.lowOrder)}function U(e,t,r){return e&t^e&r^t&r}function q(e,t,r){return new ae(e.highOrder&t.highOrder^e.highOrder&r.highOrder^t.highOrder&r.highOrder,e.lowOrder&t.lowOrder^e.lowOrder&r.lowOrder^t.lowOrder&r.lowOrder)}function W(e){return r(e,2)^r(e,13)^r(e,22)}function Q(e){var t=a(e,28),r=a(e,34),n=a(e,39);return new ae(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function H(e){return r(e,6)^r(e,11)^r(e,25)}function J(e){var t=a(e,14),r=a(e,18),n=a(e,41);return new ae(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function V(e){return r(e,7)^r(e,18)^n(e,3)}function Y(e){var t=a(e,1),r=a(e,8),n=i(e,7);return new ae(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function z(e){return r(e,17)^r(e,19)^n(e,10)}function K(e){var t=a(e,19),r=a(e,61),n=i(e,6);return new ae(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function Z(e,t){var r=(65535&e)+(65535&t);return(65535&(e>>>16)+(t>>>16)+(r>>>16))<<16|65535&r}function X(e,t,r,n){var a=(65535&e)+(65535&t)+(65535&r)+(65535&n);return(65535&(e>>>16)+(t>>>16)+(r>>>16)+(n>>>16)+(a>>>16))<<16|65535&a}function $(e,t,r,n,a){var i=(65535&e)+(65535&t)+(65535&r)+(65535&n)+(65535&a);return(65535&(e>>>16)+(t>>>16)+(r>>>16)+(n>>>16)+(a>>>16)+(i>>>16))<<16|65535&i}function ee(e,t){var r,n,a;return r=(65535&e.lowOrder)+(65535&t.lowOrder),a=(65535&(n=(e.lowOrder>>>16)+(t.lowOrder>>>16)+(r>>>16)))<<16|65535&r,r=(65535&e.highOrder)+(65535&t.highOrder)+(n>>>16),n=(e.highOrder>>>16)+(t.highOrder>>>16)+(r>>>16),new ae((65535&n)<<16|65535&r,a)}function te(e,t,r,n){var a,i,s;return a=(65535&e.lowOrder)+(65535&t.lowOrder)+(65535&r.lowOrder)+(65535&n.lowOrder),s=(65535&(i=(e.lowOrder>>>16)+(t.lowOrder>>>16)+(r.lowOrder>>>16)+(n.lowOrder>>>16)+(a>>>16)))<<16|65535&a,a=(65535&e.highOrder)+(65535&t.highOrder)+(65535&r.highOrder)+(65535&n.highOrder)+(i>>>16),i=(e.highOrder>>>16)+(t.highOrder>>>16)+(r.highOrder>>>16)+(n.highOrder>>>16)+(a>>>16),new ae((65535&i)<<16|65535&a,s)}function re(e,t,r,n,a){var i,s,o;return i=(65535&e.lowOrder)+(65535&t.lowOrder)+(65535&r.lowOrder)+(65535&n.lowOrder)+(65535&a.lowOrder),o=(65535&(s=(e.lowOrder>>>16)+(t.lowOrder>>>16)+(r.lowOrder>>>16)+(n.lowOrder>>>16)+(a.lowOrder>>>16)+(i>>>16)))<<16|65535&i,i=(65535&e.highOrder)+(65535&t.highOrder)+(65535&r.highOrder)+(65535&n.highOrder)+(65535&a.highOrder)+(s>>>16),s=(e.highOrder>>>16)+(t.highOrder>>>16)+(r.highOrder>>>16)+(n.highOrder>>>16)+(a.highOrder>>>16)+(i>>>16),new ae((65535&s)<<16|65535&i,o)}function C(e,t){var r,n,a,i,s,o,l,u,c,f,d=[],p=M,h=x,y=U,g=T,m=Z,_=$,v=[1732584193,4023233417,2562383102,271733878,3285377520];for(f=15+(t+65>>>9<<4);e.length<=f;)e.push(0);for(e[t>>>5]|=128<<24-t%32,e[f]=t,c=e.length,l=0;l<c;l+=16){for(r=v[0],n=v[1],a=v[2],i=v[3],s=v[4],u=0;u<80;u+=1)d[u]=u<16?e[u+l]:g(d[u-3]^d[u-8]^d[u-14]^d[u-16],1),o=u<20?_(g(r,5),p(n,a,i),s,1518500249,d[u]):u<40?_(g(r,5),h(n,a,i),s,1859775393,d[u]):u<60?_(g(r,5),y(n,a,i),s,2400959708,d[u]):_(g(r,5),h(n,a,i),s,3395469782,d[u]),s=i,i=a,a=g(n,30),n=r,r=o;v[0]=m(r,v[0]),v[1]=m(n,v[1]),v[2]=m(a,v[2]),v[3]=m(i,v[3]),v[4]=m(s,v[4])}return v}function R(e,t,r){var n,a,i,s,o,l,u,c,f,d,p,h,y,g,m,_,v,w,S,F,b,I,T,x,C,R,E,D,k,A,O,N,P=[],j=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],L=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],G=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];if(("SHA-224"===r||"SHA-256"===r)&&2&ne)h=64,y=15+(t+65>>>9<<4),_=16,v=1,E=Number,w=Z,S=X,F=$,b=V,I=z,T=W,x=H,R=U,C=M,p="SHA-224"===r?L:G;else{if("SHA-384"!==r&&"SHA-512"!==r||!(4&ne))throw"Unexpected error in SHA-2 implementation";h=80,y=31+(t+128>>>10<<5),_=32,v=2,w=ee,S=te,F=re,b=Y,I=K,T=Q,x=J,R=q,C=B,j=[new(E=ae)(j[0],3609767458),new E(j[1],602891725),new E(j[2],3964484399),new E(j[3],2173295548),new E(j[4],4081628472),new E(j[5],3053834265),new E(j[6],2937671579),new E(j[7],3664609560),new E(j[8],2734883394),new E(j[9],1164996542),new E(j[10],1323610764),new E(j[11],3590304994),new E(j[12],4068182383),new E(j[13],991336113),new E(j[14],633803317),new E(j[15],3479774868),new E(j[16],2666613458),new E(j[17],944711139),new E(j[18],2341262773),new E(j[19],2007800933),new E(j[20],1495990901),new E(j[21],1856431235),new E(j[22],3175218132),new E(j[23],2198950837),new E(j[24],3999719339),new E(j[25],766784016),new E(j[26],2566594879),new E(j[27],3203337956),new E(j[28],1034457026),new E(j[29],2466948901),new E(j[30],3758326383),new E(j[31],168717936),new E(j[32],1188179964),new E(j[33],1546045734),new E(j[34],1522805485),new E(j[35],2643833823),new E(j[36],2343527390),new E(j[37],1014477480),new E(j[38],1206759142),new E(j[39],344077627),new E(j[40],1290863460),new E(j[41],3158454273),new E(j[42],3505952657),new E(j[43],106217008),new E(j[44],3606008344),new E(j[45],1432725776),new E(j[46],1467031594),new E(j[47],851169720),new E(j[48],3100823752),new E(j[49],1363258195),new E(j[50],3750685593),new E(j[51],3785050280),new E(j[52],3318307427),new E(j[53],3812723403),new E(j[54],2003034995),new E(j[55],3602036899),new E(j[56],1575990012),new E(j[57],1125592928),new E(j[58],2716904306),new E(j[59],442776044),new E(j[60],593698344),new E(j[61],3733110249),new E(j[62],2999351573),new E(j[63],3815920427),new E(3391569614,3928383900),new E(3515267271,566280711),new E(3940187606,3454069534),new E(4118630271,4000239992),new E(116418474,1914138554),new E(174292421,2731055270),new E(289380356,3203993006),new E(460393269,320620315),new E(685471733,587496836),new E(852142971,1086792851),new E(1017036298,365543100),new E(1126000580,2618297676),new E(1288033470,3409855158),new E(1501505948,4234509866),new E(1607167915,987167468),new E(1816402316,1246189591)],p="SHA-384"===r?[new E(3418070365,L[0]),new E(1654270250,L[1]),new E(2438529370,L[2]),new E(355462360,L[3]),new E(1731405415,L[4]),new E(41048885895,L[5]),new E(3675008525,L[6]),new E(1203062813,L[7])]:[new E(G[0],4089235720),new E(G[1],2227873595),new E(G[2],4271175723),new E(G[3],1595750129),new E(G[4],2917565137),new E(G[5],725511199),new E(G[6],4215389547),new E(G[7],327033209)]}for(;e.length<=y;)e.push(0);for(e[t>>>5]|=128<<24-t%32,e[y]=t,O=e.length,g=0;g<O;g+=_){for(n=p[0],a=p[1],i=p[2],s=p[3],o=p[4],l=p[5],u=p[6],c=p[7],m=0;m<h;m+=1)m<16?(A=m*v+g,D=e.length<=A?0:e[A],k=e.length<=A+1?0:e[A+1],P[m]=new E(D,k)):P[m]=S(I(P[m-2]),P[m-7],b(P[m-15]),P[m-16]),f=F(c,x(o),C(o,l,u),j[m],P[m]),d=w(T(n),R(n,a,i)),c=u,u=l,l=o,o=w(s,f),s=i,i=a,a=n,n=w(f,d);p[0]=w(n,p[0]),p[1]=w(a,p[1]),p[2]=w(i,p[2]),p[3]=w(s,p[3]),p[4]=w(o,p[4]),p[5]=w(l,p[5]),p[6]=w(u,p[6]),p[7]=w(c,p[7])}if("SHA-224"===r&&2&ne)N=[p[0],p[1],p[2],p[3],p[4],p[5],p[6]];else if("SHA-256"===r&&2&ne)N=p;else if("SHA-384"===r&&4&ne)N=[p[0].highOrder,p[0].lowOrder,p[1].highOrder,p[1].lowOrder,p[2].highOrder,p[2].lowOrder,p[3].highOrder,p[3].lowOrder,p[4].highOrder,p[4].lowOrder,p[5].highOrder,p[5].lowOrder];else{if(!("SHA-512"===r&&4&ne))throw"Unexpected error in SHA-2 implementation";N=[p[0].highOrder,p[0].lowOrder,p[1].highOrder,p[1].lowOrder,p[2].highOrder,p[2].lowOrder,p[3].highOrder,p[3].lowOrder,p[4].highOrder,p[4].lowOrder,p[5].highOrder,p[5].lowOrder,p[6].highOrder,p[6].lowOrder,p[7].highOrder,p[7].lowOrder]}return N}var ne=7,ae=function(e,t){this.highOrder=e,this.lowOrder=t};return s.prototype.getHash=function(e,t,r,n){var a,i=null,s=this.strToHash.slice(),o=this.strBinLen;if(3===arguments.length?"number"!=typeof r&&(n=r,r=1):2===arguments.length&&(r=1),r!==parseInt(r,10)||r<1)throw"numRounds must a integer >= 1";switch(t){case"HEX":i=S;break;case"B64":i=F;break;case"BYTES":i=b;break;default:throw"format must be HEX, B64, or BYTES"}if("SHA-1"===e&&1&ne)for(a=0;a<r;a+=1)s=C(s,o),o=160;else if("SHA-224"===e&&2&ne)for(a=0;a<r;a+=1)s=R(s,o,e),o=224;else if("SHA-256"===e&&2&ne)for(a=0;a<r;a+=1)s=R(s,o,e),o=256;else if("SHA-384"===e&&4&ne)for(a=0;a<r;a+=1)s=R(s,o,e),o=384;else{if(!("SHA-512"===e&&4&ne))throw"Chosen SHA variant is not supported";for(a=0;a<r;a+=1)s=R(s,o,e),o=512}return i(s,I(n))},s.prototype.getHMAC=function(e,t,r,n,a){var i,s,o,l,u,c,f,d,p,h=[],y=[],g=null;switch(n){case"HEX":i=S;break;case"B64":i=F;break;case"BYTES":i=b;break;default:throw"outputFormat must be HEX, B64, or BYTES"}if("SHA-1"===r&&1&ne)o=64,p=160;else if("SHA-224"===r&&2&ne)o=64,p=224;else if("SHA-256"===r&&2&ne)o=64,p=256;else if("SHA-384"===r&&4&ne)o=128,p=384;else{if(!("SHA-512"===r&&4&ne))throw"Chosen SHA variant is not supported";o=128,p=512}if("HEX"===t)d=(g=_(e)).binLen,s=g.value;else if("TEXT"===t)d=(g=m(e,this.utfType)).binLen,s=g.value;else if("B64"===t)d=(g=w(e)).binLen,s=g.value;else{if("BYTES"!==t)throw"inputFormat must be HEX, TEXT, B64, or BYTES";d=(g=v(e)).binLen,s=g.value}if(l=8*o,f=o/4-1,o<d/8){if("SHA-1"===r&&1&ne)s=C(s,d);else{if(!(6&ne))throw"Unexpected error in HMAC implementation";s=R(s,d,r)}for(;s.length<=f;)s.push(0);s[f]&=4294967040}else if(d/8<o){for(;s.length<=f;)s.push(0);s[f]&=4294967040}for(u=0;u<=f;u+=1)h[u]=909522486^s[u],y[u]=1549556828^s[u];if("SHA-1"===r&&1&ne)c=C(y.concat(C(h.concat(this.strToHash),l+this.strBinLen)),l+p);else{if(!(6&ne))throw"Unexpected error in HMAC implementation";c=R(y.concat(R(h.concat(this.strToHash),l+this.strBinLen,r)),l+p,r)}return i(c,I(a))},s;function s(e,t,r){this.strBinLen=0,this.strToHash=null,this.utfType="";var n=null;if(this.strToHash=[0],this.strBinLen=0,this.utfType=r||"UTF8","UTF8"!==this.utfType&&"UTF16BE"!==this.utfType&&"UTF16LE"!==this.utfType)throw"encoding must be UTF8, UTF16BE, or UTF16LE";if("HEX"===t){if(0!=e.length%2)throw"srcString of HEX type must be in byte increments";n=_(e),this.strBinLen=n.binLen,this.strToHash=n.value}else if("TEXT"===t)n=m(e,this.utfType),this.strBinLen=n.binLen,this.strToHash=n.value;else if("B64"===t)n=w(e),this.strBinLen=n.binLen,this.strToHash=n.value;else{if("BYTES"!==t)throw"inputFormat must be HEX, TEXT, B64, or BYTES";n=v(e),this.strBinLen=n.binLen,this.strToHash=n.value}}}.apply(null,n))||(e.exports=a)},2032:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(11),r(89),r(1663),r(1658),r(1648),r(1664),r(4),r(81),r(154),r(205),r(301)],void 0===(a=function(e,t,r,i,n,c,f,d,p,T,x,C,h){return r(R,a=n),R.prototype._maxQueryRate=function(){return f.defaultMaxRecords},R.prototype.end=function(){return this._layer},R.prototype.optimisePagingFeatureQueries=function(e){},R.prototype.load=function(){var r=this;return null===this._loadPromise&&(this._loadPromise=p.create(function(e,t){if(!0===r._layer.loaded)return r._initialiseFeatureSet(),void e(r);r._layer.when().then(function(){try{r._initialiseFeatureSet(),e(r)}catch(e){t(e)}},t),r._layer.load()})),this._loadPromise},R.prototype._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields&&(1!==this._layer.outFields.length||"*"!==this._layer.outFields[0])){for(var e=[],t=0,r=this.fields;t<r.length;t++)if("oid"===(l=r[t]).type)e.push(l);else for(var n=0,a=this._layer.outFields;n<a.length;n++)if(a[n].toLowerCase()===l.name.toLowerCase()){e.push(l);break}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{e=[];for(var i=[],s=0,o=this.fields;s<o.length;s++){var l;if("oid"===(l=o[s]).type)e.push(l),i.push(l.name);else for(var u=0,c=this._overrideFields;u<c.length;u++)if(c[u].toLowerCase()===l.name.toLowerCase()){e.push(l),i.push(l.name);break}}this.fields=e,this._overrideFields=i}this.objectIdField=this._layer.objectIdField,this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=f.FeatureServiceDatabaseType.Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types},R.prototype.isTable=function(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType},R.prototype._isInFeatureSet=function(e){return f.IdState.InFeatureSet},R.prototype._transformSetWithIdChanges=function(e){},R.prototype._candidateIdTransform=function(e){return e},R.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._getFilteredSet("",null,null,null,e)}).then(function(e){return t._wset=e}):p.resolve(this._wset)},R.prototype._changeFeature=function(e){for(var t={},r=0,n=this.fields;r<n.length;r++){var a=n[r];t[a.name]=e.attributes[a.name]}return new i({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})},R.prototype._getFilteredSet=function(e,t,r,n,a){var i=this,s="",o=!1;if(null!==n&&(s=n.constructClause(),o=!0),this.isTable()&&t&&null!==e&&""!==e){var l=new c([],[],!0,null);return p.resolve(l)}var u=new h;return u.where=null===r?null===t?"1=1":"":d.toWhereClause(r,f.FeatureServiceDatabaseType.Standardised),u.spatialRelationship=this._makeRelationshipEnum(e),u.outSpatialReference=this.spatialReference,u.orderByFields=""!==s?s.split(","):null,u.geometry=null===t?null:t,u.returnGeometry=!0,u.relationParameter=this._makeRelationshipParam(e),this._layer.queryFeatures(u).then(function(e){if(null===e)return new c([],[],o,null);i._checkCancelled(a);var r=[];return e.features.forEach(function(e){var t=e.attributes[i._layer.objectIdField];r.push(t),i._featureCache[t]=i._changeFeature(e)}),new c([],r,o,null)})},R.prototype._makeRelationshipEnum=function(e){if(0<=e.indexOf("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e},R.prototype._makeRelationshipParam=function(e){return 0<=e.indexOf("esriSpatialRelRelation")?e.split(":")[1]:""},R.prototype._queryAllFeatures=function(){var n=this;if(this._wset)return p.resolve(this._wset);var e=new h;return e.where="1=1",this._ensureLoaded().then(function(){if(n._layer.source&&n._layer.source.items){var r=[];return n._layer.source.items.forEach(function(e){var t=e.attributes[n._layer.objectIdField];r.push(t),n._featureCache[t]=n._changeFeature(e)}),n._wset=new c([],r,!1,null),n._wset}return n._layer.queryFeatures(e).then(function(e){var r=[];return e.features.forEach(function(e){var t=e.attributes[n._layer.objectIdField];r.push(t),n._featureCache[t]=n._changeFeature(e)}),n._wset=new c([],r,!1,null),n._wset})})},R.prototype._getFeatures=function(e,t,r,n){var a=[];-1!==t&&void 0===this._featureCache[t]&&a.push(t);for(var i=e._lastFetchedIndex;i<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[i]]&&(e._known[i]!==t&&a.push(e._known[i]),a.length>r)));i++);return 0===a.length?p.resolve("success"):p.reject(new Error("Unaccounted for Features. Not in Feature Collection"))},R.prototype._refineSetBlock=function(e,t,r){return p.resolve(e)},R.prototype._stat=function(e,t,r,n,a,i,s){return p.resolve({calculated:!1})},R.prototype._canDoAggregates=function(e,t,r,n,a){return p.resolve(!1)},R.prototype.relationshipMetaData=function(){return[]},R._cloneAttr=function(e){var t={};for(var r in e)t[r]=e[r];return t},R.prototype.nativeCapabilities=function(){return{title:this._layer.title,canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}},R.create=function(e,t){var r=e.layerDefinition.objectIdField,n=e.layerDefinition.geometryType;void 0===n&&(n=e.featureSet.geometryType||"");var a=e.featureSet.features,i=t.toJSON();if(""===r||void 0===r){for(var s=!1,o=0,l=e.layerDefinition.fields;o<l.length;o++)if("oid"===(b=l[o]).type||"esriFieldTypeOID"===b.type){r=b.name,s=!0;break}if(!1===s){for(var u="FID",c=!0,f=0;c;){for(var d=!0,p=0,h=e.layerDefinition.fields;p<h.length;p++)if((b=h[p]).name===u){d=!1;break}!0===d?c=!1:u="FID"+(++f).toString()}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:u,alias:u});for(var y=[],g=0;g<a.length;g++)y.push({geometry:e.featureSet.features[g].geometry,attributes:e.featureSet.features[g].attributes?this._cloneAttr(e.featureSet.features[g].attributes):{}}),y[g].attributes[u]=g;a=y,r=u}}for(var m=[],_=0,v=e.layerDefinition.fields;_<v.length;_++)(b=v[_])instanceof C?m.push(b):m.push(C.fromJSON(b));var w=n;switch(w){case"esriGeometryPoint":w="point";break;case"esriGeometryPolyline":w="polyline";break;case"esriGeometryPolygon":w="polygon";break;case"esriGeometryExtent":w="extent";break;case"esriGeometryMultipoint":w="multipoint"}for(var S=0,F=a;S<F.length;S++){var b;(b=F[S]).geometry&&b.geometry instanceof T==0&&(b.geometry.type=w,void 0===b.geometry.spatialReference&&(b.geometry.spatialReference=i))}var I={outFields:["*"],source:a,fields:m,objectIdField:r,spatialReference:t};return I.geometryType=w||"point",new R({layer:new x(I),spatialReference:t,isTable:null===w||""===w})},R.prototype.queryAttachments=function(e,t,r,n){return p.resolve([])},R.prototype.getFeatureByObjectId=function(e,t){var r=new h;return r.where=this.objectIdField+"="+e.toString(),this._layer.queryFeatures(r).then(function(e){return 1===e.features.length?e.features[0]:null})},R;function R(e){var t=a.call(this,e)||this;return t.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",t._removeGeometry=!1,t._overrideFields=null,t._forceIsTable=!1,e.spatialReference&&(t.spatialReference=e.spatialReference),t._transparent=!0,t._maxProcessing=1e3,t._layer=e.layer,!(t._wset=null)===e.isTable&&(t._forceIsTable=!0),void 0!==e.outFields&&(t._overrideFields=e.outFields),void 0!==e.includeGeometry&&(t._removeGeometry=!1===e.includeGeometry),t}var a}.apply(null,n))||(e.exports=a)},2033:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(11),r(1663),r(1658),r(1648),r(4)],void 0===(a=function(e,t,r,n,f,l,d){var a,i=(r(s,a=n),s.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._parent._getSet(e)}).then(function(e){return t._wset=new f(e._candidates.slice(0),e._known.slice(0),!1,t._clonePageDefinition(e.pagesDefinition)),t._setKnownLength(t._wset)>t._topnum&&(t._wset._known=t._wset._known.slice(0,t._topnum)),t._setKnownLength(t._wset)>=t._topnum&&(t._wset._candidates=[]),t._wset}):d.resolve(this._wset)},s.prototype._setKnownLength=function(e){return 0<e._known.length&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length},s.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);if(t===l.IdState.NotInFeatureSet)return t;var r=this._idstates[e];return r===l.IdState.InFeatureSet||r===l.IdState.NotInFeatureSet?r:t===l.IdState.InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=l.IdState.InFeatureSet,this._countedin++,l.IdState.InFeatureSet):(this._idstates[e]=l.IdState.NotInFeatureSet,l.IdState.NotInFeatureSet):l.IdState.Unknown},s.prototype._expandPagedSet=function(t,e,r,n,a){var i=this;if(null===this._parent)return d.reject(new Error("Parent Paging not implemented"));if(e>this._topnum&&(e=this._topnum),this._countedin>=this._topnum&&t.pagesDefinition.internal.set.length<=t.pagesDefinition.resultOffset){var s=t._known.length;return 0<s&&"GETPAGES"===t._known[s-1]&&(t._known.length=s-1),0<(s=t._candidates.length)&&"GETPAGES"===t._candidates[s-1]&&(t._candidates.length=s-1),d.resolve("success")}return this._parent._expandPagedSet(t,e,r,n,a).then(function(e){return i._setKnownLength(t)>i._topnum&&(t._known.length=i._topnum),i._setKnownLength(t)>=i._topnum&&(t._candidates.length=0),e})},s.prototype._getFeatures=function(t,r,n,a){var i=this,s=[],e=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(t,e,a))return this._expandPagedSet(t,e,0,0,a).then(function(e){return i._getFeatures(t,r,n,a)});-1!==r&&void 0===this._featureCache[r]&&s.push(r);for(var o=0,l=t._lastFetchedIndex;l<t._known.length&&(++o<=n&&(t._lastFetchedIndex+=1),!(void 0===this._featureCache[t._known[l]]&&(t._known[l]!==r&&s.push(t._known[l]),s.length>e-1)));l++);if(0===s.length)return d.resolve("success");var u=new f([],s,!1,null),c=Math.min(s.length,n);return this._parent._getFeatures(u,-1,c,a).then(function(e){for(var t=0;t<c;t++){var r=i._parent._featureFromCache(s[t]);void 0!==r&&(i._featureCache[s[t]]=r)}return"success"})},s.prototype._getFilteredSet=function(e,t,r,n,a){var i=this;return this._ensureLoaded().then(function(){return i._getSet(a)}).then(function(e){return new f(e._candidates.slice(0).concat(e._known.slice(0)),[],!1,i._clonePageDefinition(e.pagesDefinition))})},s.prototype._refineKnowns=function(e,t){for(var r=0,n=null,a=[],i=0;i<e._candidates.length;i++){var s=this._isInFeatureSet(e._candidates[i]);if(s===l.IdState.InFeatureSet){if(e._known.push(e._candidates[i]),r+=1,null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),e._known.length>=this._topnum)break}else if(s===l.IdState.NotInFeatureSet)null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),r+=1;else if(s===l.IdState.Unknown)break;if(t<=r)break}null!==n&&a.push(n);for(var o=a.length-1;0<=o;o--)e._candidates.splice(a[o].start,a[o].end-a[o].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])},s.prototype._stat=function(e,t,r,n,a,i,s){return d.resolve({calculated:!1})},s.prototype._canDoAggregates=function(e,t,r,n,a){return d.resolve(!1)},s);function s(e){var t=a.call(this,e)||this;return t._topnum=0,t.declaredClass="esri.arcade.featureset.actions.Top",t._countedin=0,t._maxProcessing=100,t._topnum=e.topnum,t._parent=e.parentfeatureset,t}return n._featuresetFunctions.top=function(e){return new i({parentfeatureset:this,topnum:e})},i}.apply(null,n))||(e.exports=a)},2034:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(11),r(1868),r(1663),r(1658),r(1648),r(4),r(1748)],void 0===(a=function(e,t,r,n,a,o,l,u,i){var s,c=(r(f,s=a),f.prototype._getSet=function(t){var r=this;return null===this._wset?this._ensureLoaded().then(function(){return r._parent._getFilteredSet("esriSpatialRelRelation"!==r._relation?r._relation:r._relation+":"+r._relationString,r._relationGeom,null,null,t)}).then(function(e){return r._checkCancelled(t),r._wset=new o(e._candidates.slice(0),e._known.slice(0),e._ordered,r._clonePageDefinition(e.pagesDefinition)),r._wset}):u.resolve(this._wset)},f.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);return t===l.IdState.NotInFeatureSet?t:void 0===(t=this._idstates[e])?l.IdState.Unknown:t},f.prototype._getFeature=function(e,t,r){return this._parent._getFeature(e,t,r)},f.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},f.prototype._featureFromCache=function(e){return this._parent._featureFromCache(e)},f.prototype.executeSpatialRelationTest=function(e){if(null===e.geometry)return u.resolve(!1);switch(this._relation){case"esriSpatialRelEnvelopeIntersects":var t=l.shapeExtent(this._relationGeom),r=l.shapeExtent(e.geometry);return i.intersects(t,r);case"esriSpatialRelIntersects":return i.intersects(this._relationGeom,e.geometry);case"esriSpatialRelContains":return i.contains(this._relationGeom,e.geometry);case"esriSpatialRelOverlaps":return i.overlaps(this._relationGeom,e.geometry);case"esriSpatialRelWithin":return i.within(this._relationGeom,e.geometry);case"esriSpatialRelTouches":return i.touches(this._relationGeom,e.geometry);case"esriSpatialRelCrosses":return i.crosses(this._relationGeom,e.geometry);case"esriSpatialRelRelation":return i.relate(this._relationGeom,e.geometry,this._relationString)}},f.prototype._fetchAndRefineFeatures=function(n,r,a){var i=this,e=new o([],n,!1,null),s=Math.min(r,n.length);return this._parent._getFeatures(e,-1,s,a).then(function(){i._checkCancelled(a);for(var e=[],t=0;t<s;t++){var r=i._parent._featureFromCache(n[t]);e.push(i.executeSpatialRelationTest(r))}return u.all(e)}).then(function(e){for(var t=0;t<r;t++)!0===e[t]?i._idstates[n[t]]=l.IdState.InFeatureSet:i._idstates[n[t]]=l.IdState.NotInFeatureSet;return"success"})},f.prototype._getFilteredSet=function(e,t,r,n,a){var i=this;return this._ensureLoaded().then(function(){return i._parent._getFilteredSet("esriSpatialRelRelation"!==i._relation?i._relation:i._relation+":"+i._relationString,i._relationGeom,r,n,a)}).then(function(e){return i._checkCancelled(a),null!==t?new o(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,i._clonePageDefinition(e.pagesDefinition)):new o(e._candidates.slice(0),e._known.slice(0),e._ordered,i._clonePageDefinition(e.pagesDefinition))})},f.prototype._stat=function(t,r,n,a,i,s,o){var l=this;return""!==n?u.resolve({calculated:!1}):this._parent._stat(t,r,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,i,s,o).then(function(e){return!1===e.calculated?null===i&&""===n&&null===a?l._manualStat(t,r,s,o):{calculated:!1}:e})},f.prototype._canDoAggregates=function(e,t,r,n,a){return""!==r||null!==n||null===this._parent?u.resolve(!1):this._parent._canDoAggregates(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a)},f.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,a,i,s){return null===this._parent?u.reject(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,i,s)},f);function f(e){var t=s.call(this,e)||this;return t._relation="",t._relationGeom=null,t._relationString="",t.declaredClass="esri.arcade.featureset.actions.SpatialFilter",t._relationString=e.relationString,t._parent=e.parentfeatureset,t._maxProcessing=40,t._relation=e.relation,t._relationGeom=e.relationGeom,t}return a._featuresetFunctions.intersects=function(e){return null==e?new n({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:e})},a._featuresetFunctions.envelopeIntersects=function(e){return null==e?new n({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:e})},a._featuresetFunctions.contains=function(e){return null==e?new n({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:e})},a._featuresetFunctions.overlaps=function(e){return null==e?new n({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:e})},a._featuresetFunctions.within=function(e){return null==e?new n({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:e})},a._featuresetFunctions.touches=function(e){return null==e?new n({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:e})},a._featuresetFunctions.crosses=function(e){return null==e?new n({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:e})},a._featuresetFunctions.relate=function(e,t){return null==e?new n({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:e,relationString:t})},c}.apply(null,n))||(e.exports=a)},2035:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(11),r(89),r(1767),r(1663),r(1658),r(1648),r(1664),r(4),r(1570),r(31)],void 0===(a=function(e,t,r,y,g,n,m,I,T,_,a,i){Object.defineProperty(t,"__esModule",{value:!0});var s=(o.prototype.extractValue=function(e){return null},o.prototype.postInitialization=function(e,t){},o.prototype.rewriteSql=function(e,t){return{rewritten:this.sqlRewritable,where:e}},o);function o(){this.sqlRewritable=!1}t.AdaptedField=s;var l,h=(r(u,l=s),u.prototype.extractValue=function(e){return e.attributes[this.field.name]},u.prototype.rewriteSql=function(e,t){return{rewritten:this.sqlRewritable,where:e}},u);function u(e){var t=l.call(this)||this;return t.field=e,t.sqlRewritable=!0,t}t.OriginalField=h;var c,p=(r(f,c=s),f.prototype.rewriteSql=function(e,t){return{rewritten:this.sqlRewritable,where:T.reformulateWithoutField(e,this.field.name,this.originalField.name,t.getFieldsIndex())}},f.prototype.extractValue=function(e){return e.attributes[this.originalField.name]},f);function f(e,t,r){var n=c.call(this)||this;return n.originalField=e,n.sqlRewritable=!0,n.field=I.cloneField(e),n.field.name=t,n.field.alias=r,n}t.FieldRename=p;var d,v=(r(x,d=s),x.prototype.rewriteSql=function(e,t){var r=this.evaluateNodeToWhereClause(e.parseTree,I.FeatureServiceDatabaseType.Standardised,this.field.name,this.codefield instanceof a.WhereClause?T.toWhereClause(this.codefield,I.FeatureServiceDatabaseType.Standardised):this.codefield,e.parameters);return 0<=r.indexOf(x.BADNESS)?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:a.WhereClause.create(r,t._parent.getFieldsIndex())}},x.prototype.evaluateNodeToWhereClause=function(e,t,r,n,a){var i,s,o,l;switch(void 0===r&&(r=null),void 0===n&&(n=null),e.type){case"interval":return T.convertIntervalToSql(this.evaluateNodeToWhereClause(e.value,t,r,n,a),e.qualifier,e.op,I.FeatureServiceDatabaseType.Standardised);case"case_expression":var u=" CASE ";"simple"===e.format&&(u+=this.evaluateNodeToWhereClause(e.operand,t,r,x.BADNESS,a));for(var c=0;c<e.clauses.length;c++)u+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[c].operand,t,r,x.BADNESS,a)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[c].value,t,r,x.BADNESS,a);return null!==e.else&&(u+=" ELSE "+this.evaluateNodeToWhereClause(e.else,t,r,x.BADNESS,a)),u+" END ";case"param":var f=a[e.value.toLowerCase()];if("string"==typeof f)return"'"+a[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(f instanceof Date)return T.makeDateString(f,t);if(f instanceof Array){var d=[];for(c=0;c<f.length;c++)"string"==typeof f[c]?d.push("'"+f[c].toString().replace(/'/g,"''")+"'"):f[c]instanceof Date?d.push(T.makeDateString(f[c],t)):d.push(f[c].toString());return d}return f.toString();case"expr_list":s=[];for(var p=0,h=e.value;p<h.length;p++){var y=h[p];s.push(this.evaluateNodeToWhereClause(y,t,r,n,a))}return s;case"unary_expr":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,t,r,x.BADNESS,a)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" AND "+this.evaluateNodeToWhereClause(e.right,t,r,n,a)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" OR "+this.evaluateNodeToWhereClause(e.right,t,r,n,a)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" IS NOT NULL )";case"IN":if(i=[],"expr_list"!==e.right.type)return(l=this.evaluateNodeToWhereClause(e.right,t,r,n,a))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" IN ("+l.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" IN ("+l+")) ";if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){for(var g=[],m=!0,_=0,v=e.right.value;_<v.length;_++){if("string"!==(F=v[_]).type){m=!1;break}if(void 0===this.lkp[F.value]){m=!1;break}g.push(this.lkp[F.value].toString())}if(m)return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" IN ("+g.join(",")+")) "}return i=this.evaluateNodeToWhereClause(e.right,t,r,n,a)," ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" IN ("+i.join(",")+")) ";case"NOT IN":if(i=[],"expr_list"!==e.right.type)return(l=this.evaluateNodeToWhereClause(e.right,t,r,n,a))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" NOT IN ("+l.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" NOT IN ("+l+")) ";if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){g=[],m=!0;for(var w=0,S=e.right.value;w<S.length;w++){var F;if("string"!==(F=S[w]).type){m=!1;break}if(void 0===this.lkp[F.value]){m=!1;break}g.push(this.lkp[F.value].toString())}if(m)return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" NOT IN ("+g.join(",")+")) "}return i=this.evaluateNodeToWhereClause(e.right,t,r,n,a)," ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" NOT IN ("+i.join(",")+")) ";case"BETWEEN":return o=this.evaluateNodeToWhereClause(e.right,t,r,x.BADNESS,a)," ("+this.evaluateNodeToWhereClause(e.left,t,r,x.BADNESS,a)+" BETWEEN "+o[0]+" AND "+o[1]+" ) ";case"NOTBETWEEN":return o=this.evaluateNodeToWhereClause(e.right,t,r,x.BADNESS,a)," ("+this.evaluateNodeToWhereClause(e.left,t,r,x.BADNESS,a)+" NOT BETWEEN "+o[0]+" AND "+o[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,r,x.BADNESS,a)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,x.BADNESS,a)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,x.BADNESS,a)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,x.BADNESS,a)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,r,x.BADNESS,a)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,x.BADNESS,a)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,x.BADNESS,a)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,x.BADNESS,a)+") ";case"<>":case"=":if("column_ref"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+n+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column_ref"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+n+") ";return" ("+this.evaluateNodeToWhereClause(e.left,t,r,x.BADNESS,a)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,r,x.BADNESS,a)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,x.BADNESS,a)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,r,x.BADNESS,a)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return T.makeDateString(e.value,t);case"number":return e.value.toString();case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?T.makeToday(!0,t):"CURRENT_TIMESTAMP"===e.column.toUpperCase()?T.makeToday(!1,t):r&&r.toLowerCase()===e.column.toLowerCase()?"("+n+")":e.column;case"function":var b=this.evaluateNodeToWhereClause(e.args,t,r,x.BADNESS,a);return T.translateFunctionToDatabaseSpecific(e.name,b,t)}throw new Error("Unsupported sql syntax "+e.type)},x.prototype.extractValue=function(e){return this.codefield instanceof a.WhereClause?this.reverseLkp[this.codefield.calculateValueCompiled(e)]:this.reverseLkp[e.attributes[this.codefield]]},x.BADNESS="_!!!_BAD_LKP_!!!!",x);function x(e,t,r){var n=d.call(this)||this;for(var a in n.field=e,n.codefield=t,n.lkp=r,n.reverseLkp={},r)n.reverseLkp[r[a]]=a;return n.sqlRewritable=!0,n}t.StringToCodeAdapted=v;var w,S=(r(F,w=s),F.prototype.rewriteSql=function(e,t){return{rewritten:!0,where:T.reformulateWithoutField(e,this.field.name,T.toWhereClause(this.sql,I.FeatureServiceDatabaseType.Standardised),t.getFieldsIndex())}},F.prototype.postInitialization=function(e,t){},F.prototype.extractValue=function(e){return this.sql.calculateValueCompiled(e)},F);function F(e,t){var r=w.call(this)||this;return r.field=e,r.sql=t,r}t.SqlExpressionAdapted=S;var b,C=(r(R,b=n),R.findField=function(e,t){for(var r=0,n=e;r<n.length;r++){var a=n[r];if(a.name.toLowerCase()===t.toString().toLowerCase())return a}return null},R.prototype._initialiseFeatureSet=function(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new i({wkid:4326}),this.objectIdField="",this.geometryType=I.layerGeometryEsriConstants.point,this.typeIdField="",this.types=null),this.fields=[];for(var e=0,t=this.adaptedFields;e<t.length;e++){var r=t[e];r.postInitialization(this,this._parent),this.fields.push(r.field)}},R.prototype._getSet=function(t){var r=this;return null===this._wset?this._ensureLoaded().then(function(){return r._extraFilter?r._getFilteredSet("",null,null,null,t):r._parent._getSet(t)}).then(function(e){return r._checkCancelled(t),r._wset=new m(e._candidates.slice(0),e._known.slice(0),e._ordered,r._clonePageDefinition(e.pagesDefinition)),r._wset}):_.resolve(this._wset)},R.prototype._isInFeatureSet=function(e){return this._parent._isInFeatureSet(e)},R.prototype._getFeatures=function(t,r,n,f){var d=this,p=[];-1!==r&&void 0===this._featureCache[r]&&p.push(r);var e=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(t,e,f))return this._expandPagedSet(t,e,0,0,f).then(function(e){return d._getFeatures(t,r,n,f)});for(var a=0,i=t._lastFetchedIndex;i<t._known.length&&(++a<=n&&(t._lastFetchedIndex+=1),!(void 0===this._featureCache[t._known[i]]&&(t._known[i]!==r&&p.push(t._known[i]),p.length>=e-1)));i++);if(0===p.length)return _.resolve("success");t=new m([],p,t._ordered,null);var h=Math.min(p.length,n);return this._parent._getFeatures(t,-1,h,f).then(function(e){d._checkCancelled(f);for(var t=[],r=0;r<h;r++){var n=d._parent._featureFromCache(p[r]);void 0!==n&&t.push({geometry:n.geometry,attributes:n.attributes,id:p[r]})}for(var a=0,i=t;a<i.length;a++){for(var s=i[a],o=[],l=0,u=d.adaptedFields;l<u.length;l++){var c=u[l];o[c.field.name]=c.extractValue(s)}d._featureCache[s.id]=new y({attributes:o,geometry:g.cloneGeometry(s.geometry)})}return"success"})},R.prototype._fetchAndRefineFeatures=function(e,t,r){return _.reject(new Error("Fetch and Refine should not be called in this featureset"))},R.prototype._getFilteredSet=function(e,t,r,n,a){var i,s=this,o=this.reformulateWithoutAdaptions(r);i=o.cannot,r=o.where;var l=!1;if(null!==n){l=!0;for(var u=[],c=0,f=this.adaptedFields;c<f.length;c++){var d=f[c];if(!(d instanceof h)&&!0===n.scanForField(d.field.name)){if(!(d instanceof p)){n=null,l=!1;break}u.push({field:d.field.name,newfield:d.originalField.name})}}n&&0<u.length&&(n=n.replaceFields(u))}return null!==r?null!==this._extraFilter&&(r=T.combine(this._extraFilter,r)):r=this._extraFilter,this._ensureLoaded().then(function(){return s._parent._getFilteredSet(e,t,r,n,a)}).then(function(e){return s._checkCancelled(a),!0===i?new m(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===l&&e._ordered,s._clonePageDefinition(e.pagesDefinition)):new m(e._candidates.slice(0),e._known.slice(0),!0===l&&e._ordered,s._clonePageDefinition(e.pagesDefinition))})},R.prototype.reformulateWithoutAdaptions=function(e){var t={cannot:!1,where:e};if(null!==e)for(var r=0,n=this.adaptedFields;r<n.length;r++){var a=n[r];if(!0===T.scanForField(e,a.field.name)){var i=a.rewriteSql(e,this);if(!0!==i.rewritten){t.cannot=!0,t.where=null;break}t.where=i.where}}return t},R.prototype._stat=function(t,r,n,a,i,s,o){var l=this,e=!1,u=this.reformulateWithoutAdaptions(r);return e=u.cannot,r=u.where,u=this.reformulateWithoutAdaptions(i),e=e||u.cannot,null!==(i=u.where)?null!==this._extraFilter&&(i=T.combine(this._extraFilter,i)):i=this._extraFilter,!0===e?null===i&&""===n&&null===a?this._manualStat(t,r,s,o):_.resolve({calculated:!1}):this._parent._stat(t,r,n,a,i,s,o).then(function(e){return!1===e.calculated?null===i&&""===n&&null===a?l._manualStat(t,r,s,o):{calculated:!1}:e})},R.prototype._canDoAggregates=function(e,t,r,n,a){if(null===this._parent)return _.resolve(!1);for(var i=0;i<e.length;i++)for(var s=0,o=this.adaptedFields;s<o.length;s++){var l=o[s];if(e[i].toLowerCase()===l.field.name.toLowerCase()&&!(l instanceof h))return _.resolve(!1)}var u=[];for(i=0;i<t.length;i++){var c=t[i];if(null!==c.workingexpr){var f=this.reformulateWithoutAdaptions(c.workingexpr);if(f.cannot)return _.resolve(!1);var d=c.clone();d.workingexpr=f.where,u.push(d)}else u.push(c)}var p=this.reformulateWithoutAdaptions(a);return p.cannot?_.resolve(!1):(null!==(a=p.where)?null!==this._extraFilter&&(a=T.combine(this._extraFilter,a)):a=this._extraFilter,this._parent._canDoAggregates(e,u,r,n,a))},R.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,a,i,s){if(null===this._parent)return _.reject(new Error("Should never be called"));for(var o=[],l=0;l<t.length;l++){var u=t[l];if(null!==u.workingexpr){var c=this.reformulateWithoutAdaptions(u.workingexpr);if(c.cannot)return _.reject(new Error("Should never be called"));var f=u.clone();f.workingexpr=c.where,o.push(f)}else o.push(u)}var d=this.reformulateWithoutAdaptions(a);return d.cannot?_.reject(new Error("Should never be called")):(null!==(a=d.where)?null!==this._extraFilter&&(a=T.combine(this._extraFilter,a)):a=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(e,o,r,n,a,i,s))},R);function R(e){var t=b.call(this,e)||this;return t._calcFunc=null,t.declaredClass="esri.arcade.featureset.actions.Adapted",t.adaptedFields=null,t._extraFilter=null,t._extraFilter=e.extraFilter,t._parent=e.parentfeatureset,t._maxProcessing=30,t.adaptedFields=e.adaptedFields,t}t.AdaptedFeatureSet=C}.apply(null,n))||(e.exports=a)},2788:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(11),r(89),r(29),r(1766),r(1663),r(1658),r(2031),r(1648),r(1664),r(1664),r(1865),r(4),r(38),r(154),r(306),r(1655),r(1569),r(207),r(301),r(524)],void 0===(a=function(e,t,r,p,n,s,a,_,i,d,v,f,h,y,g,o,l,u,c,m,w,S){return r(F,b=a),F.prototype._maxQueryRate=function(){return d.defaultMaxRecords},F.prototype.end=function(){return this._layer},F.prototype.optimisePagingFeatureQueries=function(e){this._pageJustIds=e},F.prototype.convertQueryToLruCacheKey=function(e){var t=d.stableStringify(e.toJSON());return new i(t,"TEXT").getHash("SHA-1","B64")},F.prototype.load=function(){var r=this;return null===this._loadPromise&&(this._loadPromise=y.create(function(e,t){try{if(!0===r._layer.loaded)return r._initialiseFeatureSet(),void e(r);r._layer.when().then(function(){try{r._initialiseFeatureSet(),e(r)}catch(e){t(e)}},t),r._layer.load()}catch(e){t(e)}})),this._loadPromise},F.prototype._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields&&(1!==this._layer.outFields.length||"*"!==this._layer.outFields[0])){for(var e=[],t=0,r=this.fields;t<r.length;t++)if("oid"===(l=r[t]).type)e.push(l);else for(var n=0,a=this._layer.outFields;n<a.length;n++)if(a[n].toLowerCase()===l.name.toLowerCase()){e.push(l);break}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{e=[];for(var i=[],s=0,o=this.fields;s<o.length;s++){var l;if("oid"===(l=o[s]).type)e.push(l),i.push(l.name);else for(var u=0,c=this._overrideFields;u<c.length;u++)if(c[u].toLowerCase()===l.name.toLowerCase()){e.push(l),i.push(l.name);break}}this.fields=e,this._overrideFields=i}if(this._layer.source&&this._layer.source.sourceJSON){var f=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=d.FeatureServiceDatabaseType.StandardisedNoInterval,null!=f&&10.61<=f&&(this._databaseType=d.FeatureServiceDatabaseType.Standardised)):null!=f&&(10.5<=f&&(this._databaseType=d.FeatureServiceDatabaseType.StandardisedNoInterval,this._requestStandardised=!0),10.61<=f&&(this._databaseType=d.FeatureServiceDatabaseType.Standardised))}this.objectIdField=this._layer.objectIdField,this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types},F.prototype._isInFeatureSet=function(){return d.IdState.InFeatureSet},F.prototype._refineSetBlock=function(e){return y.resolve(e)},F.prototype._candidateIdTransform=function(e){return e},F.prototype._transformSetWithIdChanges=function(){},F.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._getFilteredSet("",null,null,null,e)}).then(function(e){return t._wset=e}):y.resolve(this._wset)},F.prototype._runDatabaseProbe=function(n){var a=this;return y.create(function(t,r){try{a._ensureLoaded().then(function(){try{var e=new w;e.where=n.replace("OBJECTID",a._layer.objectIdField),a._layer.queryObjectIds(e).then(function(){t(!0)},function(e){try{t(!1)}catch(e){r(e)}})}catch(e){r(e)}})}catch(e){r(e)}})},F.prototype._canUsePagination=function(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)},F.prototype._cacheableFeatureSetSourceKey=function(){return this._layer.url},F.prototype.pbfSupportedForQuery=function(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF&&!0===this._layer.capabilities.query.supportsQuantizationEditMode},F.prototype.queryPBF=function(e,t){return e.quantizationParameters={mode:"edit"},c.executeQueryPBF(this._layer.parsedUrl,e,{type:"optimized"}).then(function(e){return m.fromJSON(l.convertToFeatureSet(e.data)).unquantize()})},F.prototype.nativeCapabilities=function(){return{title:this._layer.title,source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}},F.prototype.executeQuery=function(e,t){var r=this,n=new u({url:this._layer.parsedUrl.path}),a="execute"===t&&this.pbfSupportedForQuery(e),i=null;if(this.recentlyUsedQueries){var s=this.convertQueryToLruCacheKey(e);null===(i=this.recentlyUsedQueries.getFromCache(s))&&(i=!0!==a?n[t](e):this.queryPBF(e,n),this.recentlyUsedQueries.addToCache(s,i),i=i.catch(function(e){throw r.recentlyUsedQueries.removeFromCache(s),e}))}return null===i&&(i=!0!==a?n[t](e):this.queryPBF(e,n)),i},F.prototype._getFilteredSet=function(a,i,s,o,l){var u=this;return this.databaseType().then(function(e){if(u.isTable()&&i&&null!==a&&""!==a)return new _([],[],!0,null);if(u._canUsePagination())return u._getFilteredSetUsingPaging(a,i,s,o,l);var t="",r=!1;null!==o&&u._layer.capabilities&&u._layer.capabilities.query&&!0===u._layer.capabilities.query.supportsOrderBy&&(t=o.constructClause(),r=!0);var n=new w;return n.where=null===s?null===i?"1=1":"":v.toWhereClause(s,e),u._requestStandardised&&(n.sqlFormat="standard"),n.spatialRelationship=u._makeRelationshipEnum(a),n.outSpatialReference=u.spatialReference,n.orderByFields=""!==t?t.split(","):null,n.geometry=null===i?null:i,n.relationParameter=u._makeRelationshipParam(a),u.executeQuery(n,"executeForIds").then(function(e){return null===e&&(e=[]),u._checkCancelled(l),new _([],e,r,null)})})},F.prototype._expandPagedSet=function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)},F.prototype._getFilteredSetUsingPaging=function(o,l,u,e,c){var f=this;try{var d="",p=!1;return null!==e&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(d=e.constructClause(),p=!0),this.databaseType().then(function(e){var t=null===u?null===l?"1=1":"":v.toWhereClause(u,e);f._layer.definitionExpression&&(t=""!==t?"(("+f._layer.definitionExpression+") AND ("+t+"))":f._layer.definitionExpression);var r=f._maxQueryRate(),n=f._layer.capabilities.query.maxRecordCount;void 0!==n&&n<r&&(r=n);var a=null;if(!0===f._pageJustIds)a=new _([],["GETPAGES"],p,{spatialRel:f._makeRelationshipEnum(o),relationParam:f._makeRelationshipParam(o),outFields:f._layer.objectIdField,resultRecordCount:r,resultOffset:0,geometry:null===l?null:l,where:t,orderByFields:d,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}});else{var i=!0;!0===f._removeGeometry&&(i=!1);var s=null!==f._overrideFields?f._overrideFields:f._fieldsIncludingObjectId(f._layer.outFields?f._layer.outFields:["*"]);a=new _([],["GETPAGES"],p,{spatialRel:f._makeRelationshipEnum(o),relationParam:f._makeRelationshipParam(o),outFields:s.join(","),resultRecordCount:r,resultOffset:0,geometry:null===l?null:l,where:t,orderByFields:d,returnGeometry:i,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}})}return f._expandPagedSet(a,r,0,1,c).then(function(){return a})})}catch(o){return y.reject(o)}},F.prototype._clonePageDefinition=function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}},F.prototype._getPhysicalPage=function(r,e,n){var a=this;try{var i=r.pagesDefinition.internal.lastRetrieved,s=i,t=new w;return this._requestStandardised&&(t.sqlFormat="standard"),t.spatialRelationship=r.pagesDefinition.spatialRel,t.relationParameter=r.pagesDefinition.relationParam,t.outFields=r.pagesDefinition.outFields.split(","),t.num=r.pagesDefinition.resultRecordCount,t.start=r.pagesDefinition.internal.lastRetrieved,t.geometry=r.pagesDefinition.geometry,t.where=r.pagesDefinition.where,t.orderByFields=""!==r.pagesDefinition.orderByFields?r.pagesDefinition.orderByFields.split(","):null,t.returnGeometry=r.pagesDefinition.returnGeometry,t.outSpatialReference=this.spatialReference,this.executeQuery(t,"execute").then(function(e){if(a._checkCancelled(n),r.pagesDefinition.internal.lastRetrieved!==i)return"done";for(var t=0;t<e.features.length;t++)r.pagesDefinition.internal.set[s+t]=e.features[t].attributes[a._layer.objectIdField];if(!1===a._pageJustIds)for(t=0;t<e.features.length;t++)a._featureCache[e.features[t].attributes[a._layer.objectIdField]]=e.features[t];return e.features.length!==r.pagesDefinition.resultRecordCount&&(r.pagesDefinition.internal.fullyResolved=!0),r.pagesDefinition.internal.lastRetrieved=i+r.pagesDefinition.resultRecordCount,"done"})}catch(r){return y.reject(r)}},F.prototype._fieldsIncludingObjectId=function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(-1<t.indexOf("*"))return t;for(var r=!1,n=0,a=t;n<a.length;n++)if(a[n].toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t},F.prototype._getFeatures=function(e,t,r,n){var a=this,i=[];try{if(-1!==t&&void 0===this._featureCache[t]&&i.push(t),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate(),n))return this._expandPagedSet(e,this._maxProcessingRate(),0,0,n).then(function(){return a._getFeatures(e,t,r,n)});for(var s=0,o=e._lastFetchedIndex;o<e._known.length;o++){if(e._lastFetchedIndex+=1,s++,void 0===this._featureCache[e._known[o]]){var l=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){var u=this._layer._mode;if(void 0!==u._featureMap[e._known[o]]){var c=u._featureMap[e._known[o]];null!==c&&(l=!0,this._featureCache[e._known[o]]=c)}}if(!1===l&&(e._known[o]!==t&&i.push(e._known[o]),i.length>=this._maxProcessingRate()-1))break}if(r<=s&&0===i.length)break}if(0===i.length)return y.resolve("success");try{var f=new w;return this._requestStandardised&&(f.sqlFormat="standard"),f.objectIds=i,f.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),(f.returnGeometry=!0)===this._removeGeometry&&(f.returnGeometry=!1),f.outSpatialReference=this.spatialReference,this.executeQuery(f,"execute").then(function(e){if(a._checkCancelled(n),void 0!==e.error)return y.reject(new Error(e.error));for(var t=0;t<e.features.length;t++)a._featureCache[e.features[t].attributes[a._layer.objectIdField]]=e.features[t];return"success"})}catch(e){return y.reject(e)}}catch(e){return y.reject(e)}},F.prototype._getDistinctPages=function(i,s,o,l,u,c,f,d,p){var h=this;return this._ensureLoaded().then(function(){return h.databaseType()}).then(function(e){for(var a=o.parseTree.column,t=0;t<h._layer.fields.length;t++)if(h._layer.fields[t].name.toLowerCase()===a.toLowerCase()){a=h._layer.fields[t].name;break}var r=new w;h._requestStandardised&&(r.sqlFormat="standard");var n=null===c?null===u?"1=1":"":v.toWhereClause(c,e);return h._layer.definitionExpression&&(n=""!==n?"(("+h._layer.definitionExpression+") AND ("+n+"))":h._layer.definitionExpression),r.where=n,r.spatialRelationship=h._makeRelationshipEnum(l),r.relationParameter=h._makeRelationshipParam(l),r.geometry=null===u?null:u,r.returnDistinctValues=!0,r.returnGeometry=!1,r.outFields=[a],h.executeQuery(r,"execute").then(function(e){if(h._checkCancelled(p),!e.hasOwnProperty("features"))return y.reject(new Error("Unnexected Result querying statistics from layer"));for(var t=!1,r=0;r<h._layer.fields.length;r++)if(h._layer.fields[r].name===a){"date"===h._layer.fields[r].type&&(t=!0);break}for(r=0;r<e.features.length;r++){if(t){var n=e.features[r].attributes[a];null!==n?d.push(new Date(n)):d.push(n)}else d.push(e.features[r].attributes[a]);if(d.length>=f)break}return 0===e.features.length?d:e.features.length===h._layer.capabilities.query.maxRecordCount&&d.length<f?h._getDistinctPages(i+e.features.length,s,o,l,u,c,f,d,p).then(function(e){return{calculated:!0,result:e}}):d})})},F.prototype._distinctStat=function(e,t,r,n,a,i,s){return this._getDistinctPages(0,e,t,r,n,a,i,[],s).then(function(e){return{calculated:!0,result:e}})},F.prototype.isTable=function(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType},F.prototype._countstat=function(e,n,a,i,t){var s=this;return this.databaseType().then(function(e){var t=new w;if(s._requestStandardised&&(t.sqlFormat="standard"),s.isTable()&&a&&null!==n&&""!==n)return{calculated:!0,result:0};var r=null===i?null===a?"1=1":"":v.toWhereClause(i,e);return s._layer.definitionExpression&&(r=""!==r?"(("+s._layer.definitionExpression+") AND ("+r+"))":s._layer.definitionExpression),t.where=r,t.where=r,t.spatialRelationship=s._makeRelationshipEnum(n),t.relationParameter=s._makeRelationshipParam(n),t.geometry=null===a?null:a,t.returnGeometry=!1,s.executeQuery(t,"executeForCount").then(function(e){return{calculated:!0,result:e}})})},F.prototype._stats=function(i,s,o,l,u,n,a){var c=this;return this._ensureLoaded().then(function(){var e=c._layer.capabilities&&c._layer.capabilities.query&&!0===c._layer.capabilities.query.supportsSqlExpression,t=c._layer.capabilities&&c._layer.capabilities.query&&!0===c._layer.capabilities.query.supportsStatistics,r=c._layer.capabilities&&c._layer.capabilities.query&&!0===c._layer.capabilities.query.supportsDistinct;return"count"===i?r?c._countstat(i,o,l,u,a):{calculated:!1}:!1===t||!1===f.isSingleField(s)&&!1===e||!1===s.isStandardized?""!==o||null!==u?{calculated:!1}:c._manualStat(i,s,n,a):"distinct"===i?!1===r?""!==o||null!==u?{calculated:!1}:c._manualStat(i,s,n,a):c._distinctStat(i,s,o,l,u,n,a):c.databaseType().then(function(e){if(c.isTable()&&l&&null!==o&&""!==o)return{calculated:!0,result:null};var t=new w;c._requestStandardised&&(t.sqlFormat="standard");var r=null===u?null===l?"1=1":"":v.toWhereClause(u,e);c._layer.definitionExpression&&(r=""!==r?"(("+c._layer.definitionExpression+") AND ("+r+"))":c._layer.definitionExpression),t.where=r,t.spatialRelationship=c._makeRelationshipEnum(o),t.relationParameter=c._makeRelationshipParam(o),t.geometry=null===l?null:l;var n=new S;n.statisticType=h.decodeStatType(i),n.onStatisticField=v.toWhereClause(s,e),n.outStatisticFieldName="ARCADE_STAT_RESULT",t.returnGeometry=!1;var a="ARCADE_STAT_RESULT";return t.outStatistics=[n],c.executeQuery(t,"execute").then(function(e){if(!e.hasOwnProperty("features")||0===e.features.length)return y.reject(new Error("Unnexected Result querying statistics from layer"));for(var t=!1,r=0;r<e.fields.length;r++)if("ARCADE_STAT_RESULT"===e.fields[r].name.toUpperCase()){a=e.fields[r].name,"date"===e.fields[r].type&&(t=!0);break}if(t){var n=e.features[0].attributes[a];return null!==n&&(n=new Date(e.features[0].attributes[a])),{calculated:!0,result:n}}return{calculated:!0,result:e.features[0].attributes[a]}})})})},F.prototype._stat=function(e,t,r,n,a,i,s){return this._stats(e,t,r,n,a,i,s)},F.prototype._canDoAggregates=function(e,n,t,r,a){var i=this;return this._ensureLoaded().then(function(){var e=!1,t=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsSqlExpression;if(void 0!==i._layer.capabilities&&null!==i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsStatistics&&!0===i._layer.capabilities.query.supportsOrderBy&&(e=!0),e)for(var r=0;r<n.length-1;r++)null!==n[r].workingexpr&&(!1===n[r].workingexpr.isStandardized?e=!1:!1===f.isSingleField(n[r].workingexpr)&&!1===t&&(e=!1));return!1!==e})},F.prototype._makeRelationshipEnum=function(e){if(0<=e.indexOf("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e},F.prototype._makeRelationshipParam=function(e){return 0<=e.indexOf("esriSpatialRelRelation")?e.split(":")[1]:""},F.prototype._getAggregatePagesDataSourceDefinition=function(c,f,d,p,h,y,g){var m=this;return this._ensureLoaded().then(function(){return m.databaseType()}).then(function(e){var t="",r=!1,n=!1;null!==y&&m._layer.capabilities&&m._layer.capabilities.query&&!0===m._layer.capabilities.query.supportsOrderBy&&(t=y.constructClause(),n=!0),m._layer.capabilities&&m._layer.capabilities.query&&!1===m._layer.capabilities.query.supportsPagination&&(r=!(n=!1),t=m._layer.objectIdField);for(var a=[],i=0;i<f.length;i++){var s=new S;s.onStatisticField=null!==f[i].workingexpr?v.toWhereClause(f[i].workingexpr,e):"",s.outStatisticFieldName=f[i].field,s.statisticType=f[i].toStatisticsName(),a.push(s)}""===t&&(t=c.join(","));var o=m._maxQueryRate(),l=m._layer.capabilities.query.maxRecordCount;void 0!==l&&l<o&&(o=l);var u=null===h?null===p?"1=1":"":v.toWhereClause(h,e);return m._layer.definitionExpression&&(u=""!==u?"(("+m._layer.definitionExpression+") AND ("+u+"))":m._layer.definitionExpression),new _([],["GETPAGES"],n,{groupbypage:!0,spatialRel:m._makeRelationshipEnum(d),relationParam:m._makeRelationshipParam(d),outFields:["*"],useOIDpagination:r,generatedOid:g,resultRecordCount:o,resultOffset:0,groupByFieldsForStatistics:c,outStatistics:a,geometry:null===p?null:p,where:u,orderByFields:t,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,fullyResolved:!1}})})},F.prototype._getAgregagtePhysicalPage=function(n,e,a){var i=this;try{var t=n.pagesDefinition.where;!0===n.pagesDefinition.useOIDpagination&&(t=""!==t?"("+t+") AND ("+n.pagesDefinition.generatedOid+">"+n.pagesDefinition.internal.lastMaxId.toString()+")":n.pagesDefinition.generatedOid+">"+n.pagesDefinition.internal.lastMaxId.toString());var s=n.pagesDefinition.internal.lastRetrieved,o=s,r=new w;return this._requestStandardised&&(r.sqlFormat="standard"),r.where=t,r.spatialRelationship=n.pagesDefinition.spatialRel,r.relationParameter=n.pagesDefinition.relationParam,r.outFields=n.pagesDefinition.outFields,r.outStatistics=n.pagesDefinition.outStatistics,r.geometry=n.pagesDefinition.geometry,r.groupByFieldsForStatistics=n.pagesDefinition.groupByFieldsForStatistics,r.num=n.pagesDefinition.resultRecordCount,r.start=n.pagesDefinition.internal.lastRetrieved,r.returnGeometry=n.pagesDefinition.returnGeometry,r.orderByFields=""!==n.pagesDefinition.orderByFields?n.pagesDefinition.orderByFields.split(","):null,this.isTable()&&r.geometry&&r.spatialRelationship?y.resolve([]):this.executeQuery(r,"execute").then(function(e){if(i._checkCancelled(a),!e.hasOwnProperty("features"))return y.reject(new Error("Unnexected Result querying aggregates from layer"));var t=[];if(n.pagesDefinition.internal.lastRetrieved!==s)return[];for(var r=0;r<e.features.length;r++)n.pagesDefinition.internal.set[o+r]=e.features[r].attributes[n.pagesDefinition.generatedOid];for(r=0;r<e.features.length;r++)t.push(new p({attributes:e.features[r].attributes,geometry:null}));return!0===n.pagesDefinition.useOIDpagination?0===e.features.length?n.pagesDefinition.internal.fullyResolved=!0:n.pagesDefinition.internal.lastMaxId=e.features[e.features.length-1].attributes[n.pagesDefinition.generatedOid]:e.features.length!==n.pagesDefinition.resultRecordCount&&(n.pagesDefinition.internal.fullyResolved=!0),n.pagesDefinition.internal.lastRetrieved=s+n.pagesDefinition.resultRecordCount,t})}catch(n){return y.reject(n)}},F.create=function(e,t,r,n){return new F({layer:new o({url:e,outFields:null===t?["*"]:t}),spatialReference:r,lrucache:n})},F.prototype.relationshipMetaData=function(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]},F.prototype.serviceUrl=function(){return d.extractServiceUrl(this._layer.parsedUrl.path)},F.prototype.queryAttachments=function(n,e,t,r){var a=this;if(this._layer.capabilities.data.supportsAttachment&&this._layer.capabilities.operations.supportsQueryAttachments){var i={objectIds:[n]};return(e&&0<e||t&&0<t)&&(i.size=[e&&0<e?e:0,t&&0<t?t:e+1]),r&&0<r.length&&(i.attachmentTypes=r),this._layer.queryAttachments(i).then(function(e){var r=[];return e&&e[n]&&e[n].forEach(function(e){var t=a._layer.parsedUrl.path+"/"+n.toString()+"/attachments/"+e.id.toString();r.push(new s(e.id,e.name,e.contentType,e.size,t))}),r})}return y.resolve([])},F.prototype.queryRelatedFeatures=function(e){var t={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields.join(","),returnGeometry:e.returnGeometry.toString()};return void 0!==e.resultOffset&&null!==e.resultOffset&&(t.resultOffset=e.resultOffset.toString()),void 0!==e.resultRecordCount&&null!==e.resultRecordCount&&(t.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(t.orderByFields=e.orderByFields.join(",")),0<e.objectIds.length&&(t.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(t.outSR=JSON.stringify(e.outSpatialReference.toJSON())),n(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:t}).then(function(e){if(e.data){var t={},r=e.data;if(r&&r.relatedRecordGroups)for(var n=r.spatialReference,a=0,i=r.relatedRecordGroups;a<i.length;a++){for(var s=i[a],o=s.objectId,l=[],u=0,c=s.relatedRecords;u<c.length;u++){var f=c[u];f.geometry&&(f.geometry.spatialReference=n);var d=new p({geometry:f.geometry?g.fromJSON(f.geometry):null,attributes:f.attributes});l.push(d)}t[o]={features:l,exceededTransferLimit:!0===r.exceededTransferLimit}}return t}return y.reject("Invalid Request")})},F.prototype.getFeatureByObjectId=function(e,t){var r=new u({url:this._layer.parsedUrl.path}),n=new w;return n.outFields=t,n.returnGeometry=!1,n.outSpatialReference=this.spatialReference,n.where=this.objectIdField+"="+e.toString(),r.execute(n).then(function(e){return 1===e.features.length?e.features[0]:null})},F;function F(e){var t=b.call(this,e)||this;return t.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",t._removeGeometry=!1,t._overrideFields=null,t.formulaCredential=null,t._pageJustIds=!1,t._requestStandardised=!1,e.spatialReference&&(t.spatialReference=e.spatialReference),t._transparent=!0,t._maxProcessing=1e3,t._layer=e.layer,t._wset=null,void 0!==e.outFields&&(t._overrideFields=e.outFields),void 0!==e.includeGeometry&&(t._removeGeometry=!1===e.includeGeometry),t}var b}.apply(null,n))||(e.exports=a)},2789:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(4)],void 0===(a=function(e,t,i){return r.prototype.reset=function(){this._lastId=-1},r.prototype.nextBatch=function(s){var o=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then(function(e){return o.nextBatch(s)},function(e){return o.nextBatch(s)});var l={returnpromise:null,hasset:!1},u=[];return l.returnpromise=i.create(function(a,i){o._parent._getSet(o._progress).then(function(e){var t=e._known.length-1;if("GETPAGES"===e._known[e._known.length-1]&&--t,o._lastId+s<t&&0<e._known.length&&"GETPAGES"===e._known[e._known.length-1])o._parent._expandPagedSet(e,o._parent._maxQueryRate(),0,0,o._progress).then(function(e){return l.hasset=!0,o._parent._mainSetInUse=null,o.nextBatch(s)},function(e){l.hasset=!0,o._parent._mainSetInUse=null,i(e)});else{if(t>=o._lastId+s||0===e._candidates.length){for(var r=0;r<s;r++){var n=r+o._lastId+1;if(n>=e._known.length)break;u[r]=e._known[n]}return o._lastId+=u.length,0===u.length&&(l.hasset=!0,o._parent._mainSetInUse=null,a([])),void o._parent._getFeatureBatch(u,o._progress).then(function(e){l.hasset=!0,o._parent._mainSetInUse=null,a(e)},function(e){l.hasset=!0,o._parent._mainSetInUse=null,i(e)})}o._parent._refineSetBlock(e,o._parent._maxProcessingRate(),o._progress).then(function(){l.hasset=!0,o._parent._mainSetInUse=null,o.nextBatch(s).then(a,i)},function(e){l.hasset=!0,o._parent._mainSetInUse=null,i(e)})}},function(e){l.hasset=!0,o._parent._mainSetInUse=null,i(e)})}),!1===l.hasset&&(this._parent._mainSetInUse=l.returnpromise,l.hasset=!0),l.returnpromise},r.prototype.next=function(){var n=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then(function(e){return n.next()},function(e){return n.next()});var a={returnpromise:null,hasset:!1};return a.returnpromise=i.create(function(t,r){n._parent._getSet(n._progress).then(function(e){n._lastId<e._known.length-1?"GETPAGES"===e._known[n._lastId+1]?n._parent._expandPagedSet(e,n._parent._maxQueryRate(),0,0,n._progress).then(function(e){return a.hasset=!0,n._parent._mainSetInUse=null,n.next()}).then(t,r):(n._lastId+=1,n._parent._getFeature(e,e._known[n._lastId],n._progress).then(function(e){a.hasset=!0,n._parent._mainSetInUse=null,t(e)},function(e){a.hasset=!0,n._parent._mainSetInUse=null,r(e)})):0<e._candidates.length?n._parent._refineSetBlock(e,n._parent._maxProcessingRate(),n._progress).then(function(){a.hasset=!0,n._parent._mainSetInUse=null,n.next().then(t,r)},function(e){a.hasset=!0,n._parent._mainSetInUse=null,r(e)}):(a.hasset=!0,n._parent._mainSetInUse=null,t(null))},function(e){a.hasset=!0,n._parent._mainSetInUse=null,r(e)})}),!1===a.hasset&&(this._parent._mainSetInUse=a.returnpromise,a.hasset=!0),a.returnpromise},r.prototype.count=function(){var t=this;return-1!==this._parent._totalCount?i.resolve(this._parent._totalCount):this._parent._getSet(this._progress).then(function(e){return t._refineAllSets(e)}).then(function(e){return t._parent._totalCount=e._known.length,i.resolve(t._parent._totalCount)})},r.prototype._refineAllSets=function(t){var r=this;return 0<t._known.length&&"GETPAGES"===t._known[t._known.length-1]?this._parent._expandPagedSet(t,this._parent._maxQueryRate(),0,1,this._progress).then(function(e){return r._refineAllSets(t)}).then(function(e){return i.resolve(e)}):0<t._candidates.length?"GETPAGES"===t._known[t._candidates.length-1]?this._parent._expandPagedSet(t,this._parent._maxQueryRate(),0,2,this._progress).then(function(e){return r._refineAllSets(t)}).then(function(e){return i.resolve(e)}):this._parent._refineSetBlock(t,this._parent._maxProcessingRate(),this._progress).then(function(e){return 0<e._candidates.length?r._refineAllSets(e):i.resolve(e)}):i.resolve(t)},r;function r(e,t){this._lastId=-1,this._progress=t,this._parent=e}}.apply(null,n))||(e.exports=a)},2790:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(11),r(89),r(1663),r(1658),r(1648),r(4),r(498)],void 0===(a=function(e,t,r,i,n,g,a,m,p){return r(s,o=n),s.prototype._maxQueryRate=function(){return a.defaultMaxRecords},s.prototype.end=function(){return this._layer},s.prototype.optimisePagingFeatureQueries=function(e){},s.prototype.load=function(){var r=this;return null===this._loadPromise&&(this._loadPromise=m.create(function(e,t){m.all([r._layer.load(),r.relatedLayer.load()]).then(function(){r._initialiseFeatureSet(),e(r)},t)})),this._loadPromise},s.prototype.nativeCapabilities=function(){return this.relatedLayer.nativeCapabilities()},s.prototype._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this.relatedLayer.geometryType,this.fields=this.relatedLayer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{for(var e=[],t=[],r=0,n=this.fields;r<n.length;r++){var a=n[r];if("oid"===a.type)e.push(a),t.push(a.name);else for(var i=0,s=this._overrideFields;i<s.length;i++)if(s[i].toLowerCase()===a.name.toLowerCase()){e.push(a),t.push(a.name);break}}this.fields=e,this._overrideFields=t}var o=this._layer.nativeCapabilities();o&&(this._databaseType=o.databaseType,this._requestStandardised=o.requestStandardised),this.objectIdField=this.relatedLayer.objectIdField,this.hasM=this.relatedLayer.supportsM,this.hasZ=this.relatedLayer.supportsZ,this.typeIdField=this.relatedLayer.typeIdField,this.types=this.relatedLayer.types},s.prototype.databaseType=function(){var e=this;return this.relatedLayer.databaseType().then(function(){return e._databaseType=e.relatedLayer._databaseType,e._databaseType})},s.prototype.isTable=function(){return this.relatedLayer.isTable()},s.prototype._isInFeatureSet=function(e){return a.IdState.InFeatureSet},s.prototype._transformSetWithIdChanges=function(e){},s.prototype._candidateIdTransform=function(e){return e},s.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._getFilteredSet("",null,null,null,e)}).then(function(e){return t._wset=e}):m.resolve(this._wset)},s.prototype._changeFeature=function(e){for(var t={},r=0,n=this.fields;r<n.length;r++){var a=n[r];t[a.name]=e.attributes[a.name]}return new i({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})},s.prototype._getFilteredSet=function(o,l,u,c,f){var d=this;return this.databaseType().then(function(e){if(d.isTable()&&l&&null!==o&&""!==o)return new g([],[],!0,null);var t=d._layer.nativeCapabilities();if(!1===t.canQueryRelated)return new g([],[],!0,null);if(t.capabilities.queryRelated&&t.capabilities.queryRelated.supportsPagination)return d._getFilteredSetUsingPaging(o,l,u,c,f);var r="",s=!1;null!==c&&t.capabilities&&t.capabilities.queryRelated&&!0===t.capabilities.queryRelated.supportsOrderBy&&(r=c.constructClause(),s=!0);var n=new p;n.objectIds=[d._findObjectId];var a=null!==d._overrideFields?d._overrideFields:d._fieldsIncludingObjectId(d.relatedLayer.fields?d.relatedLayer.fields.map(function(e){return e.name}):["*"]);n.outFields=a,n.relationshipId=d.relationship.id,n.where="1=1";var i=!0;return!0===d._removeGeometry&&(i=!1),n.returnGeometry=i,d._requestStandardised&&(n.sqlFormat="standard"),n.outSpatialReference=d.spatialReference,n.orderByFields=""!==r?r.split(","):null,t.source.queryRelatedFeatures(n).then(function(e){d._checkCancelled(f);for(var t=e[d._findObjectId]?e[d._findObjectId].features:[],r=[],n=0;n<t.length;n++)d._featureCache[t[n].attributes[d._layer.objectIdField]]=t[n],r.push(t[n].attributes[d._layer.objectIdField]);var a=l&&null!==o&&""!==o,i=null!=u;return new g(a||i?r:[],a||i?[]:r,s,null)})})},s.prototype._fieldsIncludingObjectId=function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(-1<t.indexOf("*"))return t;for(var r=!1,n=0,a=t;n<a.length;n++)if(a[n].toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t},s.prototype._getFilteredSetUsingPaging=function(l,u,c,e,f){var d=this;try{var p="",h=!1,y=this._layer.nativeCapabilities();return null!==e&&y&&y.capabilities.queryRelated&&!0===y.capabilities.queryRelated.supportsOrderBy&&(p=e.constructClause(),h=!0),this.databaseType().then(function(e){var t=d._maxQueryRate(),r=y.capabilities.query.maxRecordCount;void 0!==r&&r<t&&(t=r);var n,a=u&&null!==l&&""!==l,i=null!=c,s=!0;!0===d._removeGeometry&&(s=!1);var o=null!==d._overrideFields?d._overrideFields:d._fieldsIncludingObjectId(d.relatedLayer.fields?d.relatedLayer.fields.map(function(e){return e.name}):["*"]);return n=new g(a||i?["GETPAGES"]:[],a||i?[]:["GETPAGES"],h,{outFields:o.join(","),resultRecordCount:t,resultOffset:0,objectIds:[d._findObjectId],where:"1=1",orderByFields:p,returnGeometry:s,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}}),d._expandPagedSet(n,t,0,0,f).then(function(){return n})})}catch(l){return m.reject(l)}},s.prototype._expandPagedSet=function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)},s.prototype._clonePageDefinition=function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}},s.prototype._getPhysicalPage=function(a,e,i){var s=this;try{var o=a.pagesDefinition.internal.lastRetrieved,l=o,t=this._layer.nativeCapabilities(),r=new p;return!0===this._requestStandardised&&(r.sqlFormat="standard"),r.relationshipId=this.relationship.id,r.objectIds=a.pagesDefinition.objectIds,r.resultOffset=a.pagesDefinition.internal.lastRetrieved,r.resultRecordCount=a.pagesDefinition.resultRecordCount,r.outFields=a.pagesDefinition.outFields.split(","),r.where=a.pagesDefinition.where,r.orderByFields=""!==a.pagesDefinition.orderByFields?a.pagesDefinition.orderByFields.split(","):null,r.returnGeometry=a.pagesDefinition.returnGeometry,r.outSpatialReference=this.spatialReference,t.source.queryRelatedFeatures(r).then(function(e){if(s._checkCancelled(i),a.pagesDefinition.internal.lastRetrieved!==o)return 0;for(var t=e[s._findObjectId]?e[s._findObjectId].features:[],r=0;r<t.length;r++)a.pagesDefinition.internal.set[l+r]=t[r].attributes[s._layer.objectIdField];for(r=0;r<t.length;r++)s._featureCache[t[r].attributes[s._layer.objectIdField]]=t[r];var n=!e[s._findObjectId]||!1===e[s._findObjectId].exceededTransferLimit;return t.length!==a.pagesDefinition.resultRecordCount&&n&&(a.pagesDefinition.internal.fullyResolved=!0),a.pagesDefinition.internal.lastRetrieved=o+t.length,t.length})}catch(a){return m.reject(a)}},s.prototype._getFeatures=function(t,r,n,a){var i=this,e=[];-1!==r&&void 0===this._featureCache[r]&&e.push(r);var s=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(t,s,a))return this._expandPagedSet(t,s,0,0,a).then(function(e){return i._getFeatures(t,r,n,a)});for(var o=0,l=t._lastFetchedIndex;l<t._known.length&&(++o<=n&&(t._lastFetchedIndex+=1),!("GETPAGES"!==t._known[l]&&void 0===this._featureCache[t._known[l]]&&(t._known[l]!==r&&e.push(t._known[l]),e.length>n)))&&!(n<=o&&0===e.length);l++);return 0===e.length?m.resolve("success"):m.reject(new Error("Unaccounted for Features. Not in Feature Collection"))},s.prototype._refineSetBlock=function(e,t,r){return m.resolve(e)},s.prototype._stat=function(e,t,r,n,a,i,s){return m.resolve({calculated:!1})},s.prototype._canDoAggregates=function(e,t,r,n,a){return m.resolve(!1)},s.prototype.relationshipMetaData=function(){return this.relatedLayer.relationshipMetaData()},s.prototype.serviceUrl=function(){return this.relatedLayer.serviceUrl()},s.prototype.queryAttachments=function(e,t,r,n){return this.relatedLayer.queryAttachments(e,t,r,n)},s.prototype.getFeatureByObjectId=function(e,t){return this.relatedLayer.getFeatureByObjectId(e,t)},s;function s(e){var t=o.call(this,e)||this;return t.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",t._findObjectId=-1,t._requestStandardised=!1,t._removeGeometry=!1,t._overrideFields=null,t.featureObjectId=null,t.relatedLayer=null,t.relationship=null,e.spatialReference&&(t.spatialReference=e.spatialReference),t._transparent=!0,t._maxProcessing=1e3,t._layer=e.layer,t._wset=null,t._findObjectId=e.objectId,t.featureObjectId=e.objectId,t.relationship=e.relationship,t.relatedLayer=e.relatedLayer,void 0!==e.outFields&&(t._overrideFields=e.outFields),void 0!==e.includeGeometry&&(t._removeGeometry=!1===e.includeGeometry),t}var o}.apply(null,n))||(e.exports=a)},2791:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(11),r(89),r(1640),r(2035),r(1869),r(1866),r(1663),r(1658),r(1867),r(2031),r(1648),r(1664),r(1664),r(1865),r(2792),r(4),r(1570),r(31),r(205),r(488)],void 0===(a=function(e,t,r,f,c,T,d,p,n,h,y,s,x,C,R,o,E,g,D,k,A,O){function N(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}var a,i=(r(l,a=n),l.prototype.isTable=function(){return!0},l.prototype._getSet=function(e){var t=this;return null===this._wset?this._getFilteredSet("",null,null,null,e).then(function(e){return t._wset=e,t._wset}):g.resolve(this._wset)},l.prototype._isInFeatureSet=function(e){return x.IdState.InFeatureSet},l.prototype.nextUniqueName=function(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;var t="T"+this._uniqueIds.toString();return e[t]=1,t},l.prototype.convertToEsriFieldType=function(e){return e},l.prototype._initialiseFeatureSet=function(){var e={},t=!1,r=1,n=this._parent?this._parent.getFieldsIndex():new O([]);for(this.objectIdField="ROW__ID";!1===t;){for(var a=!1,i=0;i<this._config.groupbyfields.length;i++)if(this._config.groupbyfields[i].name.toLowerCase()===this.objectIdField.toLowerCase()){a=!0;break}if(!1===a)for(i=0;i<this._config.statsfields.length;i++)if(this._config.statsfields[i].name.toLowerCase()===this.objectIdField.toLowerCase()){a=!0;break}!1===a?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}for(var s=0,o=this._config.statsfields;s<o.length;s++){var l=o[s],u=new E;u.field=l.name,u.tofieldname=l.name,u.workingexpr=l.expression instanceof D.WhereClause?l.expression:D.WhereClause.create(l.expression,n),u.typeofstat=N(l.statistic),this._decodedStatsfield.push(u)}this._decodedGroupbyfield=[];for(var c=0,f=this._config.groupbyfields;c<f.length;c++){var d={name:(l=f[c]).name,singlefield:null,tofieldname:l.name,expression:l.expression instanceof D.WhereClause?l.expression:D.WhereClause.create(l.expression,n)};this._decodedGroupbyfield.push(d)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(var p=0,h=this._parent.fields;p<h.length;p++)e[(l=h[p]).name.toUpperCase()]=1;this.types=null}else this.geometryType=x.layerGeometryEsriConstants.point,this.typeIdField="",this.types=null,this.spatialReference=new k({wkid:4326});this.fields=[];var y=new E;y.field=this.nextUniqueName(e),y.tofieldname=this.objectIdField,y.workingexpr=D.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex()),y.typeofstat="MIN",this._decodedStatsfield.push(y);for(var g=0,m=this._decodedGroupbyfield;g<m.length;g++){var _=m[g],v=new A;if(_.name=this.nextUniqueName(e),v.name=_.tofieldname,v.alias=v.name,C.isSingleField(_.expression)){if(!(b=this._parent.getField(R.toWhereClause(_.expression,x.FeatureServiceDatabaseType.Standardised))))throw new Error("Field is not present for Aggregation");_.name=b.name,_.singlefield=b.name,this.phsyicalgroupbyfields.push(b.name),v.type=b.type}else{v.type=this.convertToEsriFieldType(R.predictType(_.expression,this._parent.fields));var w=new A;w.name=_.name,w.alias=w.name,this.phsyicalgroupbyfields.push(_.name),this._adaptedFields.push(new T.SqlExpressionAdapted(w,_.expression)),this._candosimplegroupby=!1}this.fields.push(v)}if(0<this._adaptedFields.length)for(var S=0,F=this._parent.fields;S<F.length;S++)l=F[S],this._adaptedFields.push(new T.OriginalField(l));for(i=0;i<this._decodedStatsfield.length;i++){v=new A;var b=null;(_=this._decodedStatsfield[i]).field=this.nextUniqueName(e),_.tofieldname===this.objectIdField&&(this._internalObjectIdField=_.field),v.name=_.tofieldname,v.alias=v.name;var I=null!==_.workingexpr&&C.isSingleField(_.workingexpr)?R.toWhereClause(_.workingexpr,x.FeatureServiceDatabaseType.Standardised):"";switch(this._decodedStatsfield[i].typeofstat){case"SUM":if(""!==I){if(!(b=this._parent.getField(I)))throw new Error("Field is not present for Aggregation");v.type=b.type}else v.type="double";break;case"MIN":case"MAX":if(""!==I){if(!(b=this._parent.getField(I)))throw new Error("Field is not present for Aggregation");v.type=b.type}else v.type="double";break;case"COUNT":v.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==I&&!(b=this._parent.getField(I)))throw new Error("Field is not present for Aggregation");v.type="double"}this.fields.push(v)}},l.prototype._canDoAggregates=function(e,t,r,n,a){return g.resolve(!1)},l.prototype._getFeatures=function(t,r,n,a){var i=this;-1!==r&&void 0===this._featureCache[r]&&[].push(r);var e=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(t,e,a)?this._expandPagedSet(t,e,0,0,a).then(function(e){return i._getFeatures(t,r,n,a)}):g.resolve("success")},l.prototype._getFilteredSet=function(e,t,s,o,l){var u=this;if(""!==e)return g.resolve(new h([],[],!0,null));var c=null,f={ordered:!1,nowhereclause:!1};return this._ensureLoaded().then(function(){if(null!==s)for(var e=0;e<u._decodedStatsfield.length;e++)if(!0===C.scanForField(s,u._decodedStatsfield[e].tofieldname)){f.nowhereclause=!0,s=null;break}if(null!==o){for(f.ordered=!0,e=0;e<u._decodedStatsfield.length;e++)if(!0===o.scanForField(u._decodedStatsfield[e].tofieldname)){o=null,f.ordered=!1;break}if(null!==o)for(var t=0,r=u._decodedGroupbyfield;t<r.length;t++){var n=r[t];if(null===n.singlefield&&!0===o.scanForField(n.tofieldname)){o=null,f.ordered=!1;break}}}return!1===u._candosimplegroupby?g.resolve(!1):u._parent._canDoAggregates(u.phsyicalgroupbyfields,u._decodedStatsfield,"",null,null)}).then(function(e){if(e){var t=null;s&&(t=u._reformulateWhereClauseWithoutGroupByFields(s));var r=null;return o&&(r=u._reformulateOrderClauseWithoutGroupByFields(o)),u._parent._getAggregatePagesDataSourceDefinition(u.phsyicalgroupbyfields,u._decodedStatsfield,"",null,t,r,u._internalObjectIdField).then(function(e){return u._checkCancelled(l),c=!0===f.nowhereclause?new h(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===f.ordered&&e._ordered,u._clonePageDefinition(e.pagesDefinition)):new h(e._candidates.slice(0),e._known.slice(0),!0===f.ordered&&e._ordered,u._clonePageDefinition(e.pagesDefinition))})}var n=u._parent;if(0<u._adaptedFields.length&&(n=new T.AdaptedFeatureSet({parentfeatureset:u._parent,adaptedFields:u._adaptedFields,extraFilter:null})),!0===f.nowhereclause)c=new h(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:u._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new p({parentfeatureset:n,orderbyclause:new y(u.phsyicalgroupbyfields.join(",")+","+u._parent.objectIdField+" ASC")})}});else{var a=n;if(null!==s){var i=null;s&&(i=u._reformulateWhereClauseWithoutGroupByFields(s)),a=new d({parentfeatureset:a,whereclause:i})}c=new h(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:u._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new p({parentfeatureset:a,orderbyclause:new y(u.phsyicalgroupbyfields.join(",")+","+u._parent.objectIdField+" ASC")})}})}return c})},l.prototype._reformulateWhereClauseWithoutStatsFields=function(e){for(var t=0,r=this._decodedStatsfield;t<r.length;t++){var n=r[t];e=R.reformulateWithoutField(e,n.tofieldname,R.toWhereClause(n.workingexpr,x.FeatureServiceDatabaseType.Standardised),this._parent.getFieldsIndex())}return e},l.prototype._reformulateWhereClauseWithoutGroupByFields=function(e){for(var t=0,r=this._decodedGroupbyfield;t<r.length;t++){var n=r[t];n.tofieldname!==n.name&&(e=R.reformulateWithoutField(e,n.tofieldname,R.toWhereClause(n.expression,x.FeatureServiceDatabaseType.Standardised),this._parent.getFieldsIndex()))}return e},l.prototype._reformulateOrderClauseWithoutGroupByFields=function(e){for(var t=[],r=0,n=this._decodedGroupbyfield;r<n.length;r++){var a=n[r];a.tofieldname!==a.name&&t.push({field:a.tofieldname,newfield:a.name})}return 0<t.length?e.replaceFields(t):e},l.prototype._clonePageDefinition=function(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)},l.prototype._refineSetBlock=function(t,r,n){var a=this;try{return!0===this._checkIfNeedToExpandCandidatePage(t,this._maxQuery,n)?this._expandPagedSet(t,this._maxQuery,0,0,n).then(function(e){return a._refineSetBlock(t,r,n)}):(this._checkCancelled(n),t._candidates.length,this._refineKnowns(t,r),t._candidates.length,t._candidates.length,g.resolve(t))}catch(t){return g.reject(t)}},l.prototype._expandPagedSet=function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)},l.prototype._getPhysicalPage=function(r,e,n){var c=this;return!0===r.pagesDefinition.aggregatefeaturesetpagedefinition?g.create(function(t,e){c._sequentialGetPhysicalItem(r,r.pagesDefinition.resultRecordCount,n,[]).then(function(e){t(e)},e)}):this._getAgregagtePhysicalPage(r,e,n).then(function(e){for(var t=0,r=e;t<r.length;t++){for(var n=r[t],a={geometry:n.geometry,attributes:{}},i=0,s=c._decodedGroupbyfield;i<s.length;i++){var o=s[i];a.attributes[o.tofieldname]=n.attributes[o.name]}for(var l=0,u=c._decodedStatsfield;l<u.length;l++)o=u[l],a.attributes[o.tofieldname]=n.attributes[o.field];c._featureCache[a.attributes[c.objectIdField]]=new f(a)}return e.length})},l.prototype._sequentialGetPhysicalItem=function(r,n,a,i){var s=this;return g.create(function(t,e){null===r.pagesDefinition.internal.iterator&&(r.pagesDefinition.internal.iterator=r.pagesDefinition.internal.subfeatureset.iterator(a)),!0===r.pagesDefinition.internal.fullyResolved||0===n?t(i.length):s._nextAggregateItem(r,n,a,i,function(e){null===e?t(i.length):(--n,t(s._sequentialGetPhysicalItem(r,n,a,i)))},e)})},l.prototype._nextAggregateItem=function(n,a,i,s,o,l){var u=this;try{c.tick(n.pagesDefinition.internal.iterator.next()).then(function(e){if(null===e)if(null!==n.pagesDefinition.internal.workingItem){var t=u._calculateAndAppendAggregateItem(n.pagesDefinition.internal.workingItem);s.push(t),n.pagesDefinition.internal.workingItem=null,n.pagesDefinition.internal.set.push(t.attributes[u.objectIdField]),n.pagesDefinition.internal.fullyResolved=!0,o(null)}else n.pagesDefinition.internal.fullyResolved=!0,o(null);else{var r=u._generateAggregateHash(e);if(null===n.pagesDefinition.internal.workingItem)n.pagesDefinition.internal.workingItem={features:[e],id:r};else{if(r!==n.pagesDefinition.internal.workingItem.id)return t=u._calculateAndAppendAggregateItem(n.pagesDefinition.internal.workingItem),s.push(t),n.pagesDefinition.internal.workingItem=null,n.pagesDefinition.internal.set.push(t.attributes[u.objectIdField]),--a,n.pagesDefinition.internal.workingItem={features:[e],id:r},void o(t);n.pagesDefinition.internal.workingItem.features.push(e)}u._nextAggregateItem(n,a,i,s,o,l)}},l)}catch(n){l(n)}},l.prototype._calculateFieldStat=function(e,t,r){for(var n=[],a=0;a<e.features.length;a++)if(null!==t.workingexpr){var i=t.workingexpr.calculateValue(e.features[a]);null!==i&&n.push(i)}else n.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=o.calculateStat("min",n,-1);break;case"MAX":r.attributes[t.tofieldname]=o.calculateStat("max",n,-1);break;case"SUM":r.attributes[t.tofieldname]=o.calculateStat("sum",n,-1);break;case"COUNT":r.attributes[t.tofieldname]=n.length;break;case"VAR":r.attributes[t.tofieldname]=o.calculateStat("var",n,-1);break;case"STDDEV":r.attributes[t.tofieldname]=o.calculateStat("stddev",n,-1);break;case"AVG":r.attributes[t.tofieldname]=o.calculateStat("avg",n,-1)}return!0},l.prototype._calculateAndAppendAggregateItem=function(e){for(var t={attributes:{},geometry:null},r=0,n=this._decodedGroupbyfield;r<n.length;r++){var a=n[r],i=a.singlefield?e.features[0].attributes[a.singlefield]:a.expression.calculateValue(e.features[0]);t.attributes[a.tofieldname]=i}for(var s=0,o=this._decodedStatsfield;s<o.length;s++){var l=o[s];this._calculateFieldStat(e,l,t)}for(var u=[],c=0;c<this._decodedStatsfield.length;c++)u.push(this._calculateFieldStat(e,this._decodedStatsfield[c],t));return this._featureCache[t.attributes[this.objectIdField]]=new f({attributes:t.attributes,geometry:t.geometry}),t},l.prototype._generateAggregateHash=function(e){for(var t="",r=0,n=this._decodedGroupbyfield;r<n.length;r++){var a=n[r],i=a.singlefield?e.attributes[a.singlefield]:a.expression.calculateValue(e);t+=null==i?":":":"+i.toString()}return new s(t,"TEXT").getHash("SHA-1","B64")},l.prototype._stat=function(e,t,r,n,a,i,s){return g.resolve({calculated:!1})},l.prototype.getFeatureByObjectId=function(e,t){return g.resolve(null)},l);function l(e){var t=a.call(this,e)||this;return t._decodedStatsfield=[],t._decodedGroupbyfield=[],t._candosimplegroupby=!0,t.phsyicalgroupbyfields=[],t.objectIdField="ROW__ID",t._internalObjectIdField="ROW__ID",t._adaptedFields=[],t.declaredClass="esri.arcade.featureset.actions.Aggregate",t._uniqueIds=1,t._maxQuery=10,t._maxProcessing=10,t._parent=e.parentfeatureset,t._config=e,t}return n._featuresetFunctions.groupby=function(e,t){return new i({parentfeatureset:this,groupbyfields:e,statsfields:t})},i}.apply(null,n))||(e.exports=a)},2792:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1648),r(1664),r(1570)],void 0===(a=function(e,t,o,l,u){return c.prototype.clone=function(){var e=new c;return e.field=this.field,e.tofieldname=this.tofieldname,e.typeofstat=this.typeofstat,e.workingexpr=this.workingexpr,e},c.parseStatField=function(e,t,r){var n=new c;n.field=e;var a=u.WhereClause.create(t,r),i=function(e){if("function"!==e.parseTree.type)return null;if(0===e.parseTree.args.value.length)return{name:e.parseTree.name,expr:null};if(1<e.parseTree.args.value.length)throw new Error("Statistic does not have 1 or 0 Parameters");var t=u.WhereClause.create(l.toWhereClauseFromTree(e.parseTree.args.value[0],o.FeatureServiceDatabaseType.Standardised,e.parameters),e.fieldsIndex);return{name:e.parseTree.name,expr:t}}(a);if(null===i)throw new Error("Invalid Statistic Function");var s=i.name.toUpperCase().trim();if("MIN"===s){if(n.typeofstat="MIN",n.workingexpr=i.expr,null===a)throw new Error("Invalid Statistic Function Parameters")}else if("MAX"===s){if(n.typeofstat="MAX",n.workingexpr=i.expr,null===a)throw new Error("Invalid Statistic Function Parameters")}else if("COUNT"===s)n.typeofstat="COUNT",n.workingexpr=i.expr;else if("STDEV"===s){if(n.typeofstat="STDDEV",n.workingexpr=i.expr,null===a)throw new Error("Invalid Statistic Function Parameters")}else if("SUM"===s){if(n.typeofstat="SUM",n.workingexpr=i.expr,null===a)throw new Error("Invalid Statistic Function Parameters")}else if("MEAN"===s){if(n.typeofstat="AVG",n.workingexpr=i.expr,null===a)throw new Error("Invalid Statistic Function Parameters")}else if("AVG"===s){if(n.typeofstat="AVG",n.workingexpr=i.expr,null===a)throw new Error("Invalid Statistic Function Parameters")}else{if("VAR"!==s)throw new Error("Invalid Statistic Function");if(n.typeofstat="VAR",n.workingexpr=i.expr,null===a)throw new Error("Invalid Statistic Function Parameters")}return n},c.prototype.toStatisticsName=function(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg";default:return"count"}},c;function c(){}}.apply(null,n))||(e.exports=a)},2793:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1728),r(1657),r(1657),r(1675),r(2029),r(2028),r(1640),r(2035),r(1869),r(1866),r(2033),r(1868),r(2032),r(1867),r(1648),r(1664),r(1824),r(4),r(1570),r(154),r(205)],void 0===(a=function(e,t,p,R,P,u,s,h,j,A,l,a,n,c,E,i,O,L,r,G,M,f,B){function U(n,e,t){var a=n.getVariables();if(0<a.length){for(var r=[],i=0;i<a.length;i++){var s={name:a[i]};r.push(e.evaluateIdentifier(t,s))}return G.all(r).then(function(e){for(var t={},r=0;r<a.length;r++)t[a[r]]=e[r];return n.parameters=t,n})}return G.resolve(n)}function D(e,t,r){for(var n in void 0===r&&(r=null),e)if(n.toLowerCase()===t.toLowerCase())return e[n];return r}function k(e){if(null===e)return null;var t={type:D(e,"type",""),name:D(e,"name","")};if("range"===t.type)t.range=D(e,"range",[]);else{t.codedValues=[];for(var r=0,n=D(e,"codedValues",[]);r<n.length;r++){var a=n[r];t.codedValues.push({name:D(a,"name",""),code:D(a,"code",null)})}}return t}function q(e){if(null===e)return null;var t={},r=D(e,"wkt",null);null!==r&&(t.wkt=r);var n=D(e,"wkid",null);return null!==n&&(t.wkid=n),t}function W(e){if(null===e)return null;var t={hasZ:D(e,"hasz",!1),hasM:D(e,"hasm",!1)},r=D(e,"spatialreference",null);r&&(t.spatialReference=q(r));var n=D(e,"x",null);if(null!==n)return t.x=n,t.y=D(e,"y",null),t;var a=D(e,"rings",null);if(null!==a)return t.rings=a,t;var i=D(e,"paths",null);if(null!==i)return t.paths=i,t;var s=D(e,"points",null);if(null!==s)return t.points=s,t;for(var o=0,l=["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"];o<l.length;o++){var u=l[o],c=D(e,u,null);null!==c&&(t[u]=c)}return t}function Q(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==function(e,t){for(var r=0,n=t;r<n.length;r++)if(n[r]===e)return!0;return!1}(e.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==e.layerDefinition.objectIdField&&""!==e.layerDefinition.objectIdField&&!1!==j.isArray(e.layerDefinition.fields)&&!1!==j.isArray(e.featureSet.features)}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(N){"async"===N.mode&&(N.functions.featuresetbyid=function(e,t){return N.standardFunctionAsync(e,t,function(e,t,r){if(j.pcCheck(r,2,4),r[0]instanceof s){var n=j.toString(r[1]),a=j.defaultUndefined(r[2],null),i=j.toBoolean(j.defaultUndefined(r[3],!0));if(null===a&&(a=["*"]),!1===j.isArray(a))throw new Error("Invalid Parameter");return r[0].featureSetById(n,i,a)}throw new Error("Invalid Parameter")})},N.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),N.functions.featuresetbyportalitem=function(d,e){return N.standardFunctionAsync(d,e,function(e,t,r){if(j.pcCheck(r,2,5),null===r[0])throw new Error("Portal is required");if(r[0]instanceof p){var n=j.toString(r[1]),a=j.toString(r[2]),i=j.defaultUndefined(r[3],null),s=j.toBoolean(j.defaultUndefined(r[4],!0));if(null===i&&(i=["*"]),!1===j.isArray(i))throw new Error("Invalid Parameter");var o=null;return d.services&&d.services.portal&&(o=d.services.portal),o=h.getPortal(r[0],o),h.constructFeatureSetFromPortalItem(n,a,d.spatialReference,i,s,o,d.lrucache)}if(!1===j.isString(r[0]))throw new Error("Portal is required");var l=j.toString(r[0]),u=j.toString(r[1]),c=j.defaultUndefined(r[2],null),f=j.toBoolean(j.defaultUndefined(r[3],!0));if(null===c&&(c=["*"]),!1===j.isArray(c))throw new Error("Invalid Parameter");if(d.services&&d.services.portal)return h.constructFeatureSetFromPortalItem(l,u,d.spatialReference,c,f,d.services.portal,d.lrucache);throw new Error("Portal is required")})},N.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),N.functions.featuresetbyname=function(e,t){return N.standardFunctionAsync(e,t,function(e,t,r){if(j.pcCheck(r,2,4),r[0]instanceof s){var n=j.toString(r[1]),a=j.defaultUndefined(r[2],null),i=j.toBoolean(j.defaultUndefined(r[3],!0));if(null===a&&(a=["*"]),!1===j.isArray(a))throw new Error("Invalid Parameter");return r[0].featureSetByName(n,i,a)}throw new Error("Invalid Parameter")})},N.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),N.functions.featureset=function(C,e){return N.standardFunction(C,e,function(e,t,r){j.pcCheck(r,1,1);var n=r[0],a={layerDefinition:{geometryType:"",objectIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(j.isString(n))void 0!==(n=JSON.parse(n)).layerDefinition?(a.layerDefinition=n.layerDefinition,a.featureSet=n.featureSet,n.layerDefinition.spatialReference&&(a.layerDefinition.spatialReference=n.layerDefinition.spatialReference)):(a.featureSet.features=n.features,a.featureSet.geometryType=n.geometryType,a.layerDefinition.geometryType=a.featureSet.geometryType,a.layerDefinition.objectIdField=n.objectIdFieldName,a.layerDefinition.typeIdField=n.typeIdFieldName,a.layerDefinition.fields=n.fields,n.spatialReference&&(a.layerDefinition.spatialReference=n.spatialReference));else{if(!(r[0]instanceof R))throw new Error("Invalid Parameter");var i=D(n=JSON.parse(r[0].castToText()),"layerdefinition");if(null!==i){a.layerDefinition.geometryType=D(i,"geometrytype",""),a.featureSet.geometryType=a.layerDefinition.geometryType,a.layerDefinition.objectIdField=D(i,"objectidfield",""),a.layerDefinition.typeIdField=D(i,"typeidfield",""),(_=D(i,"spatialreference",null))&&(a.layerDefinition.spatialReference=q(_));for(var s=0,o=D(i,"fields",[]);s<o.length;s++){var l={name:D(S=o[s],"name",""),alias:D(S,"alias",""),type:D(S,"type",""),nullable:D(S,"nullable",!0),editable:D(S,"editable",!0),length:D(S,"length",null),domain:k(D(S,"domain"))};a.layerDefinition.fields.push(l)}var u=D(n,"featureset",null);if(u){for(var c={},f=0,d=a.layerDefinition.fields;f<d.length;f++){c[(m=d[f]).name.toLowerCase()]=m.name}for(var p=0,h=D(u,"features",[]);p<h.length;p++){var y={},g=D(x=h[p],"attributes",{});for(var m in g)y[c[m.toLowerCase()]]=g[m];a.featureSet.features.push({attributes:y,geometry:W(D(x,"geometry",null))})}}}else{var _;a.layerDefinition.geometryType=D(n,"geometrytype",""),a.featureSet.geometryType=a.layerDefinition.geometryType,a.layerDefinition.objectIdField=D(n,"objectidfieldname",""),a.layerDefinition.typeIdField=D(n,"typeidfieldname",""),(_=D(n,"spatialreference",null))&&(a.layerDefinition.spatialReference=q(_));for(var v=0,w=D(n,"fields",[]);v<w.length;v++){var S;l={name:D(S=w[v],"name",""),alias:D(S,"alias",""),type:D(S,"type",""),nullable:D(S,"nullable",!0),editable:D(S,"editable",!0),length:D(S,"length",null),domain:k(D(S,"domain"))};a.layerDefinition.fields.push(l)}c={};for(var F=0,b=a.layerDefinition.fields;F<b.length;F++){c[(m=b[F]).name.toLowerCase()]=m.name}for(var I=0,T=D(n,"features",[]);I<T.length;I++){var x;y={},g=D(x=T[I],"attributes",{});for(var m in g)y[c[m.toLowerCase()]]=g[m];a.featureSet.features.push({attributes:y,geometry:W(D(x,"geometry",null))})}}}if(!1===Q(a))throw new Error("Invalid Parameter");return E.create(a,C.spatialReference)})},N.signatures.push({name:"featureset",min:"1",max:"1"}),N.functions.filter=function(o,e){return N.standardFunctionAsync(o,e,function(e,t,s){return j.pcCheck(s,2,2),j.isFeatureSet(s[0])?s[0].load().then(function(e){var n=M.WhereClause.create(s[1],e.getFieldsIndex()),a=n.getVariables();if(0<a.length){for(var t=[],r=0;r<a.length;r++){var i={name:a[r]};t.push(N.evaluateIdentifier(o,i))}return G.all(t).then(function(e){for(var t={},r=0;r<a.length;r++)t[a[r]]=e[r];return n.parameters=t,new l({parentfeatureset:s[0],whereclause:n})})}return G.resolve(new l({parentfeatureset:s[0],whereclause:n}))}):N.failDefferred("Filter cannot accept this parameter type")})},N.signatures.push({name:"filter",min:"2",max:"2"}),N.functions.orderby=function(e,t){return N.standardFunctionAsync(e,t,function(e,t,r){if(j.pcCheck(r,2,2),j.isFeatureSet(r[0])){var n=new i(r[1]);return G.resolve(new a({parentfeatureset:r[0],orderbyclause:n}))}return N.failDefferred("Order cannot accept this parameter type")})},N.signatures.push({name:"orderby",min:"2",max:"2"}),N.functions.top=function(e,t){return N.standardFunctionAsync(e,t,function(e,t,r){return j.pcCheck(r,2,2),j.isFeatureSet(r[0])?G.resolve(new n({parentfeatureset:r[0],topnum:r[1]})):j.isArray(r[0])?j.toNumber(r[1])>=r[0].length?r[0].slice(0):r[0].slice(0,j.toNumber(r[1])):j.isImmutableArray(r[0])?j.toNumber(r[1])>=r[0].length()?r[0].slice(0):r[0].slice(0,j.toNumber(r[1])):N.failDefferred("Top cannot accept this parameter type")})},N.signatures.push({name:"top",min:"2",max:"2"}),N.functions.first=function(e,t){return N.standardFunctionAsync(e,t,function(e,t,r){return j.pcCheck(r,1,1),j.isFeatureSet(r[0])?r[0].first(e.abortSignal).then(function(e){if(null!==e){var t=u.createFromGraphicLikeObject(e.geometry,e.attributes,r[0]);t._underlyingGraphic=e,e=t}return e}):j.isArray(r[0])?0===r[0].length?G.resolve(null):G.resolve(r[0][0]):j.isImmutableArray(r[0])?0===r[0].length()?G.resolve(null):G.resolve(r[0].get(0)):null})},N.signatures.push({name:"first",min:"1",max:"1"}),N.functions.attachments=function(s,e){return N.standardFunctionAsync(s,e,function(e,t,r){j.pcCheck(r,1,2);var n={minsize:-1,maxsize:-1,types:null};if(1<r.length)if(r[1]instanceof R){if(r[1].hasField("minsize")&&(n.minsize=j.toNumber(r[1].field("minsize"))),r[1].hasField("maxsize")&&(n.maxsize=j.toNumber(r[1].field("maxsize"))),r[1].hasField("types")){var a=j.toStringArray(r[1].field("types"),!1);0<a.length&&(n.types=a)}}else if(null!==r[1])throw new Error("Invalid Parameter");if(r[0]instanceof u){var i=r[0]._layer;return i instanceof f&&(i=h.constructFeatureSet(i,s.spatialReference,["*"],!0,s.lrucache)),null===i||!1===j.isFeatureSet(i)?[]:i.load().then(function(){return i.queryAttachments(r[0].field(i.objectIdField),n.minsize,n.maxsize,n.types)})}if(null===r[0])return[];throw new Error("Invalid Parameter")})},N.signatures.push({name:"attachments",min:"1",max:"2"}),N.functions.featuresetbyrelationshipname=function(l,e){return N.standardFunctionAsync(l,e,function(e,t,r){j.pcCheck(r,2,4);var i=r[0],n=j.toString(r[1]),s=j.defaultUndefined(r[2],null),o=j.toBoolean(j.defaultUndefined(r[3],!0));if(null===s&&(s=["*"]),!1===j.isArray(s))throw new Error("Invalid Parameter");if(null===r[0])return null;if(!(r[0]instanceof u))throw new Error("Invalid Parameter");var a=i._layer;return a instanceof f&&(a=h.constructFeatureSet(a,l.spatialReference,["*"],!0,l.lrucache)),null===a||!1===j.isFeatureSet(a)?null:a.load().then(function(t){var a=t.relationshipMetaData().filter(function(e){return e.name===n});if(0===a.length)return null;if(void 0!==a[0].relationshipTableId&&null!==a[0].relationshipTableId&&-1<a[0].relationshipTableId)return h.constructFeatureSetFromRelationship(t,a[0],i.field(t.objectIdField),t.spatialReference,s,o,l.lrucache);var e=t.serviceUrl();return e?(e="/"===e.charAt(e.length-1)?e+a[0].relatedTableId.toString():e+"/"+a[0].relatedTableId.toString(),h.constructFeatureSetFromUrl(e,t.spatialReference,s,o,l.lrucache).then(function(n){return n.load().then(function(){return n.relationshipMetaData()}).then(function(r){if(r=r.filter(function(e){return e.id===a[0].id}),!1===i.hasField(a[0].keyField)||null===i.field(a[0].keyField))return t.getFeatureByObjectId(i.field(t.objectIdField),[a[0].keyField]).then(function(e){if(e){var t=M.WhereClause.create(r[0].keyField+"= @id",n.getFieldsIndex());return t.parameters={id:e.attributes[a[0].keyField]},n.filter(t)}return new c({parentfeatureset:n})});var e=M.WhereClause.create(r[0].keyField+"= @id",n.getFieldsIndex());return e.parameters={id:i.field(a[0].keyField)},n.filter(e)})})):null})})},N.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),N.functions.featuresetbyassociation=function(n,e){return N.standardFunctionAsync(n,e,function(e,t,r){j.pcCheck(r,2,3);var R=r[0],E=j.toString(j.defaultUndefined(r[1],"")).toLowerCase(),D=j.isString(r[2])?j.toString(r[2]):null;if(null===r[0])return null;if(!(r[0]instanceof u))throw new Error("Invalid Parameter");var k=R._layer;return k instanceof f&&(k=h.constructFeatureSet(k,n.spatialReference,["*"],!0,n.lrucache)),null===k||!1===j.isFeatureSet(k)?null:k.load().then(function(){var e=k.serviceUrl();return h.constructAssociationMetaDataFeatureSetFromUrl(e,n.spatialReference)}).then(function(e){var t=null,r=null,n=!1;if(null!==D&&""!==D&&void 0!==D){for(var a=0,i=e.terminals;a<i.length;a++){var s=i[a];s.terminalName===D&&(r=s.terminalId)}null===r&&(n=!0)}for(var o=e.associations.getFieldsIndex(),l=o.get("TOGLOBALID").name,u=o.get("FROMGLOBALID").name,c=o.get("TOTERMINALID").name,f=o.get("FROMTERMINALID").name,d=o.get("FROMNETWORKSOURCEID").name,p=o.get("TONETWORKSOURCEID").name,h=o.get("ASSOCIATIONTYPE").name,y=o.get("ISCONTENTVISIBLE").name,g=o.get("OBJECTID").name,m=0,_=k.fields;m<_.length;m++){var v=_[m];if("global-id"===v.type){t=R.field(v.name);break}}var w=null,S={};for(var F in e.lkp)S[F]=e.lkp[F].sourceId;var b=new A.StringToCodeAdapted(new B({name:"classname",alias:"classname",type:"string"}),null,S),I="";switch(E){case"connected":var T=l+"='@T'",x=u+"='@T'";null!==r&&(T+=" AND "+c+"=@A",x+=" AND "+f+"=@A"),I="(("+T+") OR ("+x+"))",I=j.multiReplace(I,"@T",t),T=j.multiReplace(T,"@T",t),null!==r&&(T=j.multiReplace(T,"@A",r.toString()),I=j.multiReplace(I,"@A",r.toString())),b.codefield=M.WhereClause.create("CASE WHEN "+T+" THEN "+d+" ELSE "+p+" END",e.associations.getFieldsIndex());var C=O.cloneField(A.AdaptedFeatureSet.findField(e.associations.fields,u));C.name="globalid",C.alias="globalid",w=new A.SqlExpressionAdapted(C,M.WhereClause.create("CASE WHEN "+T+" THEN "+u+" ELSE "+l+" END",e.associations.getFieldsIndex()));break;case"container":I=l+"='"+t+"' AND "+h+" = 2",null!==r&&(I+=" AND "+c+" = "+r.toString()),b.codefield=d,I="( "+I+" )",w=new A.FieldRename(A.AdaptedFeatureSet.findField(e.associations.fields,u),"globalid","globalid");case"content":I="("+u+"='"+t+"' AND "+h+" = 2)",null!==r&&(I+=" AND "+f+" = "+r.toString()),b.codefield=p,I="( "+I+" )",w=new A.FieldRename(A.AdaptedFeatureSet.findField(e.associations.fields,l),"globalid","globalid");break;case"structure":I="("+l+"='"+t+"' AND "+h+" = 3)",null!==r&&(I+=" AND "+c+" = "+r.toString()),b.codefield=d,I="( "+I+" )",w=new A.FieldRename(A.AdaptedFeatureSet.findField(e.associations.fields,u),"globalid","globalId");break;case"attached":I="("+u+"='"+t+"' AND "+h+" = 3)",null!==r&&(I+=" AND "+f+" = "+r.toString()),b.codefield=p,I="( "+I+" )",w=new A.FieldRename(A.AdaptedFeatureSet.findField(e.associations.fields,l),"globalid","globalId");break;default:throw new Error("Invalid Parameter")}return n&&(I="1 <> 1"),new A.AdaptedFeatureSet({parentfeatureset:e.associations,adaptedFields:[new A.OriginalField(A.AdaptedFeatureSet.findField(e.associations.fields,g)),new A.OriginalField(A.AdaptedFeatureSet.findField(e.associations.fields,y)),w,b],extraFilter:I?M.WhereClause.create(I,e.associations.getFieldsIndex()):null})})})},N.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),N.functions.groupby=function(O,e){return N.standardFunctionAsync(O,e,function(e,t,A){return j.pcCheck(A,3,3),j.isFeatureSet(A[0])?A[0].load().then(function(e){var t=[],r=[],n=!1,a=[];if(j.isString(A[1]))a.push(A[1]);else if(A[1]instanceof P)a.push(A[1]);else if(j.isArray(A[1]))a=A[1];else{if(!j.isImmutableArray(A[1]))return N.failDefferred("Illegal Value: GroupBy");a=A[1].toArray()}for(var i=0,s=a;i<s.length;i++){var o=s[i];if(j.isString(o)){var l=M.WhereClause.create(j.toString(o),e.getFieldsIndex()),u=!0===L.isSingleField(l)?j.toString(o):"%%%%FIELDNAME";t.push({name:u,expression:l}),"%%%%FIELDNAME"===u&&(n=!0)}else{if(!(o instanceof P))return N.failDefferred("Illegal Value: GroupBy");var c=o.hasField("name")?o.field("name"):"%%%%FIELDNAME";l=o.hasField("expression")?o.field("expression"):"";if("%%%%FIELDNAME"===c&&(n=!0),!c)return N.failDefferred("Illegal Value: GroupBy");t.push({name:c,expression:M.WhereClause.create(l||c,e.getFieldsIndex())})}}if(a=[],j.isString(A[2]))a.push(A[2]);else if(j.isArray(A[2]))a=A[2];else if(j.isImmutableArray(A[2]))a=A[2].toArray();else{if(!(A[2]instanceof P))return N.failDefferred("Illegal Value: GroupBy");a.push(A[2])}for(var f=0,d=a;f<d.length;f++){if(!((o=d[f])instanceof P))return N.failDefferred("Illegal Value: GroupBy");var p=o.hasField("name")?o.field("name"):"",h=o.hasField("statistic")?o.field("statistic"):"";l=o.hasField("expression")?o.field("expression"):"";if(!p||!h||!l)return N.failDefferred("Illegal Value: GroupBy");r.push({name:p,statistic:h.toLowerCase(),expression:M.WhereClause.create(l,e.getFieldsIndex())})}if(n){for(var y={},g=0,m=e.fields;g<m.length;g++){y[(T=m[g]).name.toLowerCase()]=1}for(var _=0,v=t;_<v.length;_++){"%%%%FIELDNAME"!==(T=v[_]).name&&(y[T.name.toLowerCase()]=1)}for(var w=0,S=r;w<S.length;w++){"%%%%FIELDNAME"!==(T=S[w]).name&&(y[T.name.toLowerCase()]=1)}for(var F=0,b=0,I=t;b<I.length;b++){var T;if("%%%%FIELDNAME"===(T=I[b]).name){for(;1===y["field_"+F.toString()];)F++;y["field_"+F.toString()]=1,T.name="FIELD_"+F.toString()}}}for(var x=[],C=0,R=t;C<R.length;C++){var E=R[C];x.push(U(E.expression,N,O))}for(var D=0,k=r;D<k.length;D++){E=k[D];x.push(U(E.expression,N,O))}return 0<x.length?G.all(x).then(function(){return G.resolve(A[0].groupby(t,r))}):G.resolve(A[0].groupby(t,r))}):N.failDefferred("Illegal Value: GroupBy")})},N.signatures.push({name:"groupby",min:"3",max:"3"}),N.functions.distinct=function(I,e){return N.standardFunctionAsync(I,e,function(e,t,b){return j.isFeatureSet(b[0])?(j.pcCheck(b,2,2),b[0].load().then(function(e){var t=[],r=[];if(j.isString(b[1]))r.push(b[1]);else if(b[1]instanceof P)r.push(b[1]);else if(j.isArray(b[1]))r=b[1];else{if(!j.isImmutableArray(b[1]))return N.failDefferred("Illegal Value: GroupBy");r=b[1].toArray()}for(var n=!1,a=0,i=r;a<i.length;a++){var s=i[a];if(j.isString(s)){var o=M.WhereClause.create(j.toString(s),e.getFieldsIndex()),l=!0===L.isSingleField(o)?j.toString(s):"%%%%FIELDNAME";t.push({name:l,expression:o}),"%%%%FIELDNAME"===l&&(n=!0)}else{if(!(s instanceof P))return N.failDefferred("Illegal Value: GroupBy");var u=s.hasField("name")?s.field("name"):"%%%%FIELDNAME";o=s.hasField("expression")?s.field("expression"):"";if("%%%%FIELDNAME"===u&&(n=!0),!u)return N.failDefferred("Illegal Value: GroupBy");t.push({name:u,expression:M.WhereClause.create(o||u,e.getFieldsIndex())})}}if(n){for(var c={},f=0,d=e.fields;f<d.length;f++){c[(_=d[f]).name.toLowerCase()]=1}for(var p=0,h=t;p<h.length;p++){"%%%%FIELDNAME"!==(_=h[p]).name&&(c[_.name.toLowerCase()]=1)}for(var y=0,g=0,m=t;g<m.length;g++){var _;if("%%%%FIELDNAME"===(_=m[g]).name){for(;1===c["field_"+y.toString()];)y++;c["field_"+y.toString()]=1,_.name="FIELD_"+y.toString()}}}for(var v=[],w=0,S=t;w<S.length;w++){var F=S[w];v.push(U(F.expression,N,I))}return 0<v.length?G.all(v).then(function(){return G.resolve(b[0].groupby(t,[]))}):G.resolve(b[0].groupby(t,[]))})):function(e,t){if(1===t.length){if(j.isArray(t[0]))return r.calculateStat(e,t[0],-1);if(j.isImmutableArray(t[0]))return r.calculateStat(e,t[0].toArray(),-1)}return r.calculateStat(e,t,-1)}("distinct",b)})})}}.apply(null,n))||(e.exports=a)},2794:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1767),r(1640),r(2034),r(1868),r(4),r(81),r(1748)],void 0===(a=function(e,t,s,o,l,u,c,f,d){function n(e,t,a,i,r){return r(e,t,function(e,t,r){if(r.length<2)return i(new Error("Missing Parameters"));if(null===(r=o.autoCastFeatureToGeometry(r))[0]&&null===r[1])return c.resolve(!1);if(o.isFeatureSet(r[0]))return r[1]instanceof f?c.resolve(new l({parentfeatureset:r[0],relation:a,relationGeom:r[1]})):null===r[1]?c.resolve(new u({parentfeatureset:r[0]})):i("Spatial Relation cannot accept this parameter type");if(r[0]instanceof f){if(r[1]instanceof f){var n=null;switch(a){case"esriSpatialRelEnvelopeIntersects":n=d.intersects(s.shapeExtent(r[0]),s.shapeExtent(r[1]));break;case"esriSpatialRelIntersects":n=d.intersects(r[0],r[1]);break;case"esriSpatialRelContains":n=d.contains(r[0],r[1]);break;case"esriSpatialRelOverlaps":n=d.overlaps(r[0],r[1]);break;case"esriSpatialRelWithin":n=d.within(r[0],r[1]);break;case"esriSpatialRelTouches":n=d.touches(r[0],r[1]);break;case"esriSpatialRelCrosses":n=d.crosses(r[0],r[1])}return null!==n?n:c.reject(new Error("Unrecognised Relationship"))}return o.isFeatureSet(r[1])?c.resolve(new l({parentfeatureset:r[1],relation:a,relationGeom:r[0]})):null===r[1]?c.resolve(!1):i("Spatial Relation cannot accept this parameter type")}return null!==r[0]?i("Spatial Relation cannot accept this parameter type"):o.isFeatureSet(r[1])?c.resolve(new u({parentfeatureset:r[1]})):r[1]instanceof f||null===r[1]?c.resolve(!1):void 0})}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(r){"async"===r.mode&&(r.functions.intersects=function(e,t){return n(e,t,"esriSpatialRelIntersects",r.failDefferred,r.standardFunctionAsync)},r.functions.envelopeintersects=function(e,t){return n(e,t,"esriSpatialRelEnvelopeIntersects",r.failDefferred,r.standardFunctionAsync)},r.signatures.push({name:"envelopeintersects",min:"2",max:"2"}),r.functions.contains=function(e,t){return n(e,t,"esriSpatialRelContains",r.failDefferred,r.standardFunctionAsync)},r.functions.overlaps=function(e,t){return n(e,t,"esriSpatialRelOverlaps",r.failDefferred,r.standardFunctionAsync)},r.functions.within=function(e,t){return n(e,t,"esriSpatialRelWithin",r.failDefferred,r.standardFunctionAsync)},r.functions.touches=function(e,t){return n(e,t,"esriSpatialRelTouches",r.failDefferred,r.standardFunctionAsync)},r.functions.crosses=function(e,t){return n(e,t,"esriSpatialRelCrosses",r.failDefferred,r.standardFunctionAsync)},r.functions.relate=function(e,t){return r.standardFunctionAsync(e,t,function(e,t,r){if(r=o.autoCastFeatureToGeometry(r),o.pcCheck(r,3,3),r[0]instanceof f&&r[1]instanceof f)return d.relate(r[0],r[1],o.toString(r[2]));if(r[0]instanceof f&&null===r[1])return!1;if(r[1]instanceof f&&null===r[0])return!1;if(o.isFeatureSet(r[0])&&null===r[1])return new u({parentfeatureset:r[0]});if(o.isFeatureSet(r[1])&&null===r[0])return new u({parentfeatureset:r[1]});if(o.isFeatureSet(r[0])&&r[1]instanceof f)return r[0].relate(r[1],o.toString(r[2]));if(o.isFeatureSet(r[1])&&r[0]instanceof f)return r[1].relate(r[0],o.toString(r[2]));if(null===r[0]&&null===r[1])return!1;throw new Error("Illegal Argument")})})}}.apply(null,n))||(e.exports=a)},2795:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1640),r(1824),r(4),r(1570)],void 0===(a=function(e,t,s,o,l,u){function i(t,r,e,n,a,i){if(1===n.length){if(s.isArray(n[0]))return l.resolve(o.calculateStat(t,n[0],s.defaultUndefined(n[1],-1)));if(s.isImmutableArray(n[0]))return l.resolve(o.calculateStat(t,n[0].toArray(),s.defaultUndefined(n[1],-1)))}else if(2===n.length){if(s.isArray(n[0]))return l.resolve(o.calculateStat(t,n[0],s.defaultUndefined(n[1],-1)));if(s.isImmutableArray(n[0]))return l.resolve(o.calculateStat(t,n[0].toArray(),s.defaultUndefined(n[1],-1)));if(s.isFeatureSet(n[0]))return n[0].load().then(function(e){return c(u.WhereClause.create(n[1],e.getFieldsIndex()),i,a).then(function(e){return n[0].calculateStatistic(t,e,s.defaultUndefined(n[2],1e3),r.abortSignal)})})}else if(3===n.length&&s.isFeatureSet(n[0]))return n[0].load().then(function(e){return c(u.WhereClause.create(n[1],e.getFieldsIndex()),i,a).then(function(e){return n[0].calculateStatistic(t,e,s.defaultUndefined(n[2],1e3),r.abortSignal)})});return l.resolve(o.calculateStat(t,n,-1))}function c(n,e,t){try{var a=n.getVariables();if(0<a.length){for(var r=[],i=0;i<a.length;i++){var s={name:a[i]};r.push(e.evaluateIdentifier(t,s))}return l.all(r).then(function(e){for(var t={},r=0;r<a.length;r++)t[a[r]]=e[r];return n.parameters=t,n})}return l.resolve(n)}catch(n){return l.reject(n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(a){"async"===a.mode&&(a.functions.stdev=function(n,e){return a.standardFunctionAsync(n,e,function(e,t,r){return i("stdev",e,0,r,n,a)})},a.functions.variance=function(n,e){return a.standardFunctionAsync(n,e,function(e,t,r){return i("variance",e,0,r,n,a)})},a.functions.average=function(n,e){return a.standardFunctionAsync(n,e,function(e,t,r){return i("mean",e,0,r,n,a)})},a.functions.mean=function(n,e){return a.standardFunctionAsync(n,e,function(e,t,r){return i("mean",e,0,r,n,a)})},a.functions.sum=function(n,e){return a.standardFunctionAsync(n,e,function(e,t,r){return i("sum",e,0,r,n,a)})},a.functions.min=function(n,e){return a.standardFunctionAsync(n,e,function(e,t,r){return i("min",e,0,r,n,a)})},a.functions.max=function(n,e){return a.standardFunctionAsync(n,e,function(e,t,r){return i("max",e,0,r,n,a)})},a.functions.count=function(e,t){return a.standardFunctionAsync(e,t,function(e,t,r){if(s.pcCheck(r,1,1),s.isFeatureSet(r[0]))return r[0].count(e.abortSignal);if(s.isArray(r[0])||s.isString(r[0]))return r[0].length;if(s.isImmutableArray(r[0]))return r[0].length();throw new Error("Invalid Parameters for Count")})})}}.apply(null,n))||(e.exports=a)},2796:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1675),r(1640)],void 0===(a=function(e,t,n,a){Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(r){"async"===r.mode&&(r.functions.domainname=function(e,t){return r.standardFunctionAsync(e,t,function(e,t,r){if(a.pcCheck(r,2,4),r[0]instanceof n)return r[0].domainValueLookup(a.toString(r[1]),r[2],void 0===r[3]?void 0:a.toNumber(r[3]));if(a.isFeatureSet(r[0]))return r[0]._ensureLoaded().then(function(){var e=a.getDomain(a.toString(r[1]),r[0],null,void 0===r[3]?void 0:a.toNumber(r[3]));return a.getDomainValue(e,r[2])});throw new Error("Invalid Parameter")})},r.signatures.push({name:"domainname",min:"2",max:"4"}),r.functions.domaincode=function(e,t){return r.standardFunctionAsync(e,t,function(e,t,r){if(a.pcCheck(r,2,4),r[0]instanceof n)return r[0].domainCodeLookup(a.toString(r[1]),r[2],void 0===r[3]?void 0:a.toNumber(r[3]));if(a.isFeatureSet(r[0]))return r[0]._ensureLoaded().then(function(){var e=a.getDomain(a.toString(r[1]),r[0],null,void 0===r[3]?void 0:a.toNumber(r[3]));return a.getDomainCode(e,r[2])});throw new Error("Invalid Parameter")})},r.signatures.push({name:"domaincode",min:"2",max:"4"})),r.functions.text=function(e,t){return r.standardFunctionAsync(e,t,function(e,t,r){if(a.pcCheck(r,1,2),!a.isFeatureSet(r[0]))return a.toStringExplicit(r[0],r[1]);var n=a.defaultUndefined(r[1],"");return""===n?r[0].castToText():"schema"===n.toLowerCase()?r[0].convertToText("schema",e.abortSignal):"featureset"===n.toLowerCase()?r[0].convertToText("featureset",e.abortSignal):void 0})}}}.apply(null,n))||(e.exports=a)}}]);