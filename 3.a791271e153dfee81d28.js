(function(){(this||window).webpackJsonp.registerAbsMids({"esri/renderers/visualVariables/support/visualVariableUtils":130})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{130:function(e,a,i){var r,n;r=[i.dj.c(e.i),a,i(24),i(89),i(3),i(12),i(218),i(323)],void 0===(n=function(e,a,F,i,r,D,R,y){function v(e,a,i){var r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"color"===e.type})[0]:e;if(r){if("esri.renderers.visualVariables.ColorVariable"!==r.declaredClass)return void N.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");var n="number"==typeof a,s=n?null:a,t=s&&s.attributes,l=n?a:null,o=r.field,u=r.cache,c=u.ipData,v=u.hasExpression,f=r.cache.compiledFunc;if(!o&&!v){var d=r.stops;return d&&d[0]&&d[0].color}if("number"!=typeof l)if(v){if(!D.isSome(i)||!D.isSome(i.arcade))return void N.error("Use of arcade expressions requires an arcade context");var p={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},b=i.arcade.arcadeUtils,h=b.getViewInfo(p),m=b.createExecContext(s,h);if(!f){var V=b.createSyntaxTree(r.valueExpression);f=b.createFunction(V),r.cache.compiledFunc=f}l=b.executeFunction(f,m)}else t&&(l=t[o]);var x=r.normalizationField,w=t?parseFloat(t[x]):void 0;if(null!=l&&(!x||n||!isNaN(w)&&0!==w)){isNaN(w)||n||(l/=w);var y=U(l,c);if(y){var g=y[0],S=y[1],z=g===S?r.stops[g].color:F.blendColors(r.stops[g].color,r.stops[S].color,y[2],D.isSome(i)?i.color:void 0);return new F(z)}}}}function f(e,a,i){var r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"opacity"===e.type})[0]:e;if(r){if("esri.renderers.visualVariables.OpacityVariable"!==r.declaredClass)return void N.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");var n="number"==typeof a,s=n?null:a,t=s&&s.attributes,l=n?a:null,o=r.field,u=r.cache,c=u.ipData,v=u.hasExpression,f=r.cache.compiledFunc;if(!o&&!v){var d=r.stops;return d&&d[0]&&d[0].opacity}if("number"!=typeof l)if(v){if(D.isNone(i)||D.isNone(i.arcade))return void N.error("Use of arcade expressions requires an arcade context");var p={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},b=i.arcade.arcadeUtils,h=b.getViewInfo(p),m=b.createExecContext(s,h);if(!f){var V=b.createSyntaxTree(r.valueExpression);f=b.createFunction(V),r.cache.compiledFunc=f}l=b.executeFunction(f,m)}else t&&(l=t[o]);var x=r.normalizationField,w=t?parseFloat(t[x]):void 0;if(null!=l&&(!x||n||!isNaN(w)&&0!==w)){isNaN(w)||n||(l/=w);var y=U(l,c);if(y){var g=y[0],S=y[1];if(g===S)return r.stops[g].opacity;var z=r.stops[g].opacity;return z+(r.stops[S].opacity-z)*y[2]}}}}function d(e,a,i){var r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"rotation"===e.type})[0]:e;if(r){if("esri.renderers.visualVariables.RotationVariable"!==r.declaredClass)return void N.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");var n=r.axis||"heading",s="heading"===n&&"arithmetic"===r.rotationType?90:0,t="heading"===n&&"arithmetic"===r.rotationType?-1:1,l="number"==typeof a?null:a,o=l&&l.attributes,u=r.field,c=r.cache.hasExpression,v=r.cache.compiledFunc,f=0;if(!u&&!c)return f;if(c){if(D.isNone(i)||D.isNone(i.arcade))return void N.error("Use of arcade expressions requires an arcade context");var d={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},p=i.arcade.arcadeUtils,b=p.getViewInfo(d),h=p.createExecContext(l,b);if(!v){var m=p.createSyntaxTree(r.valueExpression);v=p.createFunction(m),r.cache.compiledFunc=v}f=p.executeFunction(v,h)}else o&&(f=o[u]||0);return"number"!=typeof f||isNaN(f)?null:s+t*f}}function p(e,a,i){var r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"size"===e.type})[0]:e;if(r){if("esri.renderers.visualVariables.SizeVariable"!==r.declaredClass)return void N.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");var n=s(function(e,a,i){var r,n,s,t,l="number"==typeof a,o=l?null:a,u=o&&o.attributes,c=l?a:null,v=e.cache.isScaleDriven,f=e.cache.compiledFunc;if(v){var d=D.isSome(i)?i.scale:void 0,p=D.isSome(i)?i.view:void 0;c=null==d||p&&"3d"===p.type?(s=n=null,t=(r=e).stops,s=t?(n=t[0].value,t[t.length-1].value):(n=r.minDataValue||0,r.maxDataValue||0),(n+s)/2):d}else if(!l)switch(e.inputValueType){case"expression":if(D.isNone(i)||D.isNone(i.arcade))return void N.error("Use of arcade expressions requires an arcade context");var b={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},h=i.arcade.arcadeUtils,m=h.getViewInfo(b),V=h.createExecContext(o,m);if(!f){var x=h.createSyntaxTree(e.valueExpression);f=h.createFunction(x),e.cache.compiledFunc=f}c=h.executeFunction(f,V);break;case"field":u&&(c=u[e.field]);break;case"unknown":c=null}if(!y.isValidNumber(c))return null;if(l||!e.normalizationField)return c;var w=u?parseFloat(u[e.normalizationField]):null;return y.isValidNumber(w)&&0!==w?c/w:null}(r,a,i),r,a,i,r.cache.ipData);return null==n||isNaN(n)?0:n}}function C(e,a,i){return null==e?null:y.isSizeVariable(e)?p(e,a,i):y.isValidNumber(e)?e:null}function T(e,a,i){return y.isValidNumber(i)&&i<e?i:y.isValidNumber(a)&&e<a?a:e}function s(e,a,i,r,n){switch(a.transformationType){case"additive":return M=i,E=r,e+(C((N=a).minSize,M,E)||N.minDataValue);case"constant":return g=i,S=r,z=(y=a).stops,null==(F=z&&z.length&&z[0].size)&&(F=y.minSize),C(F,g,S);case"clamped-linear":return function(e,a,i,r){var n=(e-a.minDataValue)/(a.maxDataValue-a.minDataValue),s=C(a.minSize,i,r),t=C(a.maxSize,i,r),l=D.isSome(r)?r.shape:void 0;if(e<=a.minDataValue)return s;if(e>=a.maxDataValue)return t;if("area"===a.scaleBy&&l){var o="circle"===l,u=o?k*Math.pow(s/2,2):s*s,c=u+n*((o?k*Math.pow(t/2,2):t*t)-u);return o?2*Math.sqrt(c/k):Math.sqrt(c)}return s+n*(t-s)}(e,a,i,r);case"proportional":return d=e,p=a,b=i,h=r,m=D.isSome(h)?h.shape:void 0,V=d/p.minDataValue,x=C(p.minSize,b,h),w=C(p.maxSize,b,h),T("circle"===m?2*Math.sqrt(V*Math.pow(x/2,2)):"square"===m||"diamond"===m||"image"===m?Math.sqrt(V*Math.pow(x,2)):V*x,x,w);case"stops":return function(e,a,i,r,n){var s=U(e,n),t=s[0],l=s[1],o=s[2];if(t===l)return C(a.stops[t].size,i,r);var u=C(a.stops[t].size,i,r);return u+(C(a.stops[l].size,i,r)-u)*o}(e,a,i,r,n);case"real-world-size":return s=e,t=a,l=i,o=r,u=(D.isSome(o)&&o.resolution?o.resolution:1)*R.meterIn[t.valueUnit],c=C(t.minSize,l,o),v=C(t.maxSize,l,o),T("area"===(f=t.valueRepresentation)?2*Math.sqrt(s/k)/u:"radius"===f||"distance"===f?2*s/u:s/u,c,v);case"identity":return e;case"unknown":return null}var s,t,l,o,u,c,v,f,d,p,b,h,m,V,x,w,y,g,S,z,F,N,M,E}function U(i,e){if(e){var r=0,n=e.length-1;return e.some(function(e,a){return i<e?(n=a,!0):(r=a,!1)}),[r,n,(i-e[r])/(e[n]-e[r])]}}Object.defineProperty(a,"__esModule",{value:!0});var N=r.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),u=new i,k=Math.PI;a.getColor=v,a.getOpacity=f,a.getRotationAngle=d,a.getSize=p,a.getSizeFromNumberOrVariable=C,a.getSizeForValue=s,a.getSizeRangeAtScale=function(e,a,i){var r=e.cache.isScaleDriven,n=i&&"3d"===i.type;if(!(r&&n||a))return null;var s={scale:a,view:i},t=C(e.minSize,u,s),l=C(e.maxSize,u,s);if(null!=t||null!=l){if(l<t){var o=l;l=t,t=o}return{minSize:t,maxSize:l}}},a.getVisualVariableValues=function(e,i,r){if(e.visualVariables){for(var n=[],a=[],s=[],t=[],l=[],o=0,u=e.visualVariables;o<u.length;o++){var c=u[o];switch(c.type){case"color":a.push(c);break;case"opacity":s.push(c);break;case"rotation":l.push(c);break;case"size":t.push(c)}}return a.forEach(function(e){var a=v(e,i,r);n.push({variable:e,value:a})}),s.forEach(function(e){var a=f(e,i,r);n.push({variable:e,value:a})}),l.forEach(function(e){var a=d(e,i,r);n.push({variable:e,value:a})}),t.forEach(function(e){var a=p(e,i,r);n.push({variable:e,value:a})}),n.filter(function(e){return null!=e.value})}}}.apply(null,r))||(e.exports=n)}}]);