(function(){(this||window).webpackJsonp.registerAbsMids({"esri/core/libs/gl-matrix-2/mat4f64":1633,"esri/layers/graphics/data/projectionSupport":1649,"esri/core/libs/gl-matrix-2/mat3f64":1654,"esri/core/libs/gl-matrix-2/factories/mat3f64":1659,"esri/core/libs/gl-matrix-2/factories/mat4f64":1714,"esri/views/2d/layers/graphics/graphicsUtils":1753,"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":1796,"esri/views/3d/layers/support/FastSymbolUpdates":1797,"esri/views/3d/support/debugFlags":1798,"esri/views/2d/layers/features/support/AttributeStore":1894})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{1633:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1714)],void 0===(n=function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.mat4f64=i}.apply(null,r))||(e.exports=n)},1649:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(9),i(10),i(6),i(4),i(316),i(55),i(44)],void 0===(n=function(e,t,o,s,l,u,c,p,n){function i(e,t){var i,r,n;if(!t)return null;if("x"in t){var a={x:0,y:0};return i=e(t.x,t.y,m),a.x=i[0],a.y=i[1],null!=t.z&&(a.z=t.z),null!=t.m&&(a.m=t.m),a}if("xmin"in t){a={xmin:0,ymin:0,xmax:0,ymax:0};return r=e(t.xmin,t.ymin,m),a.xmin=r[0],a.ymin=r[1],n=e(t.xmax,t.ymax,m),a.xmax=n[0],a.ymax=n[1],t.hasZ&&(a.zmin=t.zmin,a.zmax=t.zmax,a.hasZ=!0),t.hasM&&(a.mmin=t.mmin,a.mmax=t.mmax,a.hasM=!0),a}return"rings"in t?{rings:f(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:f(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:d(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function f(e,t){for(var i=[],r=0,n=e;r<n.length;r++){var a=n[r];i.push(d(a,t))}return i}function d(e,t){for(var i=[],r=0,n=e;r<n.length;r++){var a=n[r],o=t(a[0],a[1],[0,0]);i.push(o),2<a.length&&o.push(a[2]),3<a.length&&o.push(a[3])}return i}function v(e,t){return!(!p.isValid(e)||!p.isValid(t)||p.equals(e,t)||n.canProject(e,t))}Object.defineProperty(t,"__esModule",{value:!0});var h="feature-store:unsupported-query",m=[0,0];t.doesBrowserSupportProjection=function(e,t){return!v(e,t)||c.isSupported()},t.checkProjectionSupport=function(n,a){return s(this,void 0,void 0,function(){var t,i,r;return o(this,function(e){if(!a)return[2];if(Array.isArray(n)){for(t=0,i=n;t<i.length;t++)if(v((r=i[t]).geometry&&r.geometry.spatialReference,a)){if(c.isSupported())return[2,c.load()];throw new l(h,"projection not supported",{inSpatialReference:n,outSpatialReference:a})}return[2]}if(!v(n,a))return[2];if(c.isSupported())return[2,c.load()];throw new l(h,"projection not supported",{inSpatialReference:n,outSpatialReference:a})})})};var a=i.bind(null,n.lngLatToXY),y=i.bind(null,n.xyToLngLat);t.project=function(e,t,i){return e?(i||(i=t,t=e.spatialReference),p.isValid(t)&&p.isValid(i)&&!p.equals(t,i)?n.canProject(t,i)?(p.isWebMercator(i)?a:y)(e):c.projectMany([e],t,i,null,!0)[0]:e):e};var _=new(r.prototype.push=function(r,n,a){return s(this,void 0,void 0,function(){var t,i=this;return o(this,function(e){return r&&r.length&&n&&a&&!p.equals(n,a)||u.resolve(r),t={geometries:r,inSpatialReference:n,outSpatialReference:a,resolve:null},this._jobs.push(t),[2,u.create(function(e){t.resolve=e,null===i._timer&&(i._timer=setTimeout(i._process,10))},function(){var e=i._jobs.indexOf(t);-1<e&&i._jobs.splice(e,1)})]})})},r.prototype._process=function(){this._timer=null;var e=this._jobs.shift();if(e){var t=e.geometries,i=e.inSpatialReference,r=e.outSpatialReference;(0,e.resolve)(n.canProject(i,r)?p.isWebMercator(r)?t.map(a):t.map(y):c.projectMany(t,i,r,null,!0)),0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}},r);function r(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}t.projectMany=function(t,i,r){return s(this,void 0,void 0,function(){return o(this,function(e){return[2,_.push(t,i,r)]})})}}.apply(null,r))||(e.exports=n)},1654:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1659)],void 0===(n=function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.mat3f64=i}.apply(null,r))||(e.exports=n)},1659:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[1,0,0,0,1,0,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},t.fromValues=function(e,t,i,r,n,a,o,s,l){return[e,t,i,r,n,a,o,s,l]},t.createView=function(e,t){return new Float64Array(e,t,9)}}.apply(null,r))||(e.exports=n)},1714:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){function i(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.clone=function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},t.fromValues=function(e,t,i,r,n,a,o,s,l,u,c,p,f,d,v,h){return[e,t,i,r,n,a,o,s,l,u,c,p,f,d,v,h]},t.createView=function(e,t){return new Float64Array(e,t,16)},t.IDENTITY=i()}.apply(null,r))||(e.exports=n)},1753:function(r,n,a){(function(e){var t,i;t=[a.dj.c(r.i),n,a(12),a(15),a(78),a(83),a(48),a(59),a(31),a(80),a(490),a(318),a(38),a(485),a(55),a(55),a(90)],void 0===(i=function(e,t,i,x,g,r,E,n,a,o,m,y,_,S,T,b,I){function z(e,t,i,r,n){var a,o,s=x.pt2px(i.xoffset),l=x.pt2px(i.yoffset),u=N*i.angle,c=N*n;switch(i.type){case"simple-marker":var p=i;a=o=x.pt2px(p.size);break;case"picture-marker":var f=i;a=x.pt2px(f.width),o=x.pt2px(f.height)}var d=g.mat2d.identity(w);g.mat2d.translate(d,d,E.vec2.set(C,e,t)),g.mat2d.rotate(d,d,c-u),g.mat2d.scale(d,d,E.vec2.set(C,r,-r)),g.mat2d.translate(d,d,E.vec2.set(C,s,-l));var v=[0,0];E.vec2.transformMat2d(v,E.vec2.set(C,-.5*a,-.5*o),d);var h=[0,0];E.vec2.transformMat2d(h,E.vec2.set(C,-.5*a,.5*o),d);var m=[0,0];E.vec2.transformMat2d(m,E.vec2.set(C,.5*a,-.5*o),d);var y=[0,0];return E.vec2.transformMat2d(y,E.vec2.set(C,.5*a,.5*o),d),{rings:[[v,m,y,h,v]]}}function M(e,t,i,r,n){var a=I.CIMSymbolHelper.getEnvelope(i.data);if(!a)return null;var o=x.pt2px(a.width),s=x.pt2px(a.height),l=x.pt2px(a.x),u=x.pt2px(a.y),c=0*N,p=N*n,f=g.mat2d.identity(w);g.mat2d.translate(f,f,E.vec2.set(C,e,t)),g.mat2d.rotate(f,f,p-c),g.mat2d.scale(f,f,E.vec2.set(C,r,r));var d=[0,0];E.vec2.transformMat2d(d,E.vec2.set(C,l,u+s),f);var v=[0,0];E.vec2.transformMat2d(v,E.vec2.set(C,l,u),f);var h=[0,0];E.vec2.transformMat2d(h,E.vec2.set(C,l+o,u+s),f);var m=[0,0];return E.vec2.transformMat2d(m,E.vec2.set(C,l+o,u),f),{rings:[[d,h,m,v,d]]}}function A(e,t,i,r,n,a){var o=I.alignmentUtils.getYAnchorDirection(i.verticalAlignment||"baseline"),s="baseline"===(i.verticalAlignment||"baseline"),l=x.pt2px(i.xoffset),u=x.pt2px(i.yoffset),c=x.pt2px(i.font.size)/24,p=4*c,f=s?25*c:r[1]+(1+o)*r[3]*.5,d=N*i.angle,v=N*a,h=g.mat2d.identity(w);g.mat2d.translate(h,h,E.vec2.set(C,e,t)),g.mat2d.rotate(h,h,v-d),g.mat2d.scale(h,h,E.vec2.set(C,n,-n)),g.mat2d.translate(h,h,E.vec2.set(C,l,-u)),g.mat2d.translate(h,h,E.vec2.set(C,-p,-p-f));var m=[0,0];E.vec2.transformMat2d(m,E.vec2.set(C,r[0],r[1]),h);var y=[0,0];E.vec2.transformMat2d(y,E.vec2.set(C,r[0],r[1]+r[3]),h);var _=[0,0];E.vec2.transformMat2d(_,E.vec2.set(C,r[0]+r[2],r[1]),h);var S=[0,0];return E.vec2.transformMat2d(S,E.vec2.set(C,r[0]+r[2],r[1]+r[3]),h),{rings:[[m,_,S,y,m]]}}function f(e,t,i){if(!i||0===i.glyphMosaicItems.length)return e;var r=I.bidiText(t.text),n=r[0],a=r[1],o=I.alignmentUtils.getJustification(t.horizontalAlignment||"center"),s=I.alignmentUtils.getXAnchorDirection(t.horizontalAlignment||"center"),l=i.glyphMosaicItems,u=new I.TextShapingNew([l],I.definitions.TEXT_MAX_WIDTH,I.definitions.TEXT_LINE_HEIGHT,I.definitions.TEXT_SPACING,[0,.5*-d],.5*(1-s),0,o).getShaping(n,a),c=I.fontUtils.getFontDecorationTop(t.font.decoration);isNaN(c)||I.TextShapingNew.addDecoration(u,c);var p=I.TextShapingNew.getBox(u),f=x.pt2px(t.font.size)/h;return e[0]=f*p.x,e[1]=f*p.y,e[2]=f*p.width,e[3]=f*p.height,e}function R(e,t){return Math.ceil((e-t)/(2*t))}function O(e,t){var i,r=t.valid,n=r[0],a=r[1],o=2*a,s=0;return a<e?(e-=(i=Math.ceil(Math.abs(e-a)/o))*o,s=i):e<n&&(e+=(i=Math.ceil(Math.abs(e-n)/o))*o,s=-i),{x:e,frameId:s}}function L(e,t){var i=t.xmin,r=t.ymin,n=t.xmax,a=t.ymax;return s(e,i,r)&&s(e,i,a)&&s(e,n,a)&&s(e,n,r)}function s(e,t,i){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax}function D(e,t,i){var r;if(Array.isArray(e)){if(t<(r=e[0])){var n=R(r,t);e[0]=r+n*(-2*t)}else if(r<i){n=R(r,i);e[0]=r+n*(-2*i)}}else if(t<(r=e.x)){n=R(r,t);e.x+=n*(-2*t)}else if(r<i){n=R(r,i);e.x+=n*(-2*i)}return e}Object.defineProperty(t,"__esModule",{value:!0});var N=Math.PI/180,p=I.definitions.TEXT_MAX_WIDTH,d=I.definitions.TEXT_LINE_HEIGHT,v=I.definitions.TEXT_SPACING,w=r.mat2df32.create(),C=n.vec2f32.create(),V=o.create();t.getBounds=function(e,t,i,r,n,a,o){if(!r||!i)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;var s=r;if(!_.isPoint(s)){m.getBoundsXY(e,s);var l=t[0];0===l&&(l=function(e,t){var i=0;switch(e.type){case"simple-fill":case"picture-fill":var r=e.outline;if(!r)return 0;i=r.width;break;case"simple-line":i=e.width;break;case"simple-marker":i=e.size;break;case"picture-marker":i=Math.max(e.width,e.height);break;case"text":var n=[0,0,0,0];f(n,e,t),i=Math.max(n[0],n[1]);break;case"cim":var a=I.CIMSymbolHelper.getEnvelope(e.data);i=Math.sqrt(a.width*a.width+a.height*a.height)}return i}(i,n),t[0]=l);var u=a*l/2;return e[0]-=u,e[1]-=u,e[2]+=u,e[3]+=u,e}var c=s.x,p=s.y;return"text"===i.type&&0===t[2]&&0===t[3]&&f(t,i,n),function(e,t,i,r,n,a,o){var s;switch(r.type){case"simple-marker":case"picture-marker":s=z(t,i,r,a,0);break;case"text":s=A(t,i,r,n,a,0);break;case"cim":s=M(t,i,r,a,0)}for(var l,u,c=0,p=0;p<s.rings[0].length-1;p++)u=s.rings[0][p],l=(t-u[0])*(t-u[0])+(i-u[1])*(i-u[1]),c=Math.max(c,l);c=Math.sqrt(c);var f=S.normalizeMapX(t-c,o),d=S.normalizeMapX(t+c,o);if(d<f){var v=b.getInfo(o);if(v){var h=v.valid,m=h[0],y=h[1];f=m,d=y}}e[0]=f,e[1]=i-c,e[2]=d,e[3]=i+c}(e,c,p,i,t,a,o),e},t.isMarkerSymbol=function(e){return"simple-marker"===e||"picture-marker"===e||"text"===e},t.graphicGeometryToNumber=function(e){switch(i.expect(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0};var F=n.vec2f32.create(),B=n.vec2f32.create(),P=n.vec2f32.create(),k=n.vec2f32.create(),H=n.vec2f32.create(),U=n.vec2f32.create(),G=n.vec2f32.create();t.isPointOnPolyline=function(e,t,i,r){E.vec2.set(P,t,i);for(var n,a,o,s,l,u,c,p,f,d=e.paths,v=1/0,h=0;h<d.length;h++){var m=d[h];if(!(m.length<2))for(var y=1;y<m.length;y++)n=m[y-1][0],o=m[y-1][1],a=m[y][0],s=m[y][1],l=Math.min(n,a)-r,u=Math.min(o,s)-r,c=Math.max(n,a)+r,p=Math.max(o,s)+r,t<l||c<t||i<u||p<i||(E.vec2.set(F,n,o),E.vec2.set(B,a,s),E.vec2.subtract(k,B,F),E.vec2.subtract(H,F,P),E.vec2.scale(U,k,E.vec2.dot(k,H)/E.vec2.dot(k,k)),E.vec2.subtract(G,H,U),(f=E.vec2.dot(G,G))<v&&(v=f))}return Math.sqrt(v)<=r},t.getMarkerSymbolBounds=z,t.getCIMMarkerBounds=M,t.getTextSymbolBounds=A,t.normalizeCentralMeridian=function(e){var t,i,r,n,a,o,s,l,u=null;if(!e)return null;t=e.spatialReference,i=T.getInfo(t),r=t.isWebMercator,n=j[o=r?102100:4326].maxX,a=j[o].minX,s=j[o].plus180Line,l=j[o].minus180Line;var c,p=e.toJSON();if(!i)return p;if("mesh"===e.type)c=p;else if(_.isPoint(p))c=D(p,n,a);else if(_.isMultipoint(p))p.points=p.points.map(function(e){return D(e,n,a)}),c=p;else if(_.isExtent(p))c=function(e,t){if(!t)return e;var i=function(e,t){var i,r=[],n=e.ymin,a=e.ymax,o=e.xmax-e.xmin,s=e.xmin,l=e.xmax,u=t.valid,c=u[0],p=u[1],f=(i=O(e.xmin,t)).x,d=i.frameId,v=(i=O(e.xmax,t)).x,h=i.frameId,m=f===v&&0<o;if(2*p<o){var y={xmin:s<l?f:v,ymin:n,xmax:p,ymax:a},_={xmin:c,ymin:n,xmax:s<l?v:f,ymax:a},S={xmin:0,ymin:n,xmax:p,ymax:a},x={xmin:c,ymin:n,xmax:0,ymax:a},g=[],E=[];L(y,S)&&g.push(d),L(y,x)&&E.push(d),L(_,S)&&g.push(h),L(_,x)&&E.push(h);for(var T=d+1;T<h;T++)g.push(T),E.push(T);r.push({extent:y,frameIds:[d]},{extent:_,frameIds:[h]},{extent:S,frameIds:g},{extent:x,frameIds:E})}else v<f||m?r.push({extent:{xmin:f,ymin:n,xmax:p,ymax:a},frameIds:[d]},{extent:{xmin:c,ymin:n,xmax:v,ymax:a},frameIds:[h]}):r.push({extent:{xmin:f,ymin:n,xmax:v,ymax:a},frameIds:[d]});return r}(e,t).map(function(e){return e.extent});return i.length<2?i[0]||e:2<i.length?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:i.map(function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]})}}(p,i);else if(_.isPolygon(p)||_.isPolyline(p)){var f=V;m.getBoundsXY(f,p);var d={xmin:f[0],ymin:f[1],xmax:f[2],ymax:f[3]},v=R(d.xmin,a)*(2*n),h=0==v?p:function(e,t){for(var i=function(e){return _.isPolygon(e)?e.rings:e.paths}(e),r=0,n=i;r<n.length;r++)for(var a=n[r],o=0,s=a;o<s.length;o++){s[o][0]+=t}return e}(p,v);d.xmin+=v,d.xmax+=v,y.extentIntersectsPolyline(d,s)&&d.xmax!==n||y.extentIntersectsPolyline(d,l)&&d.xmin!==a?u=h:c=h}else c=e.clone();return null!==u?(new W).cut(u,n):c};var h=24;t.getTextSymbolSize=f,t.getTextSymbolEstimatedSize=function(e,t,i){var r=I.bidiText(t.text),n=r[0],a=r[1],o=I.alignmentUtils.getJustification(t.horizontalAlignment||"center"),s=I.alignmentUtils.getXAnchorDirection(t.horizontalAlignment||"center"),l=new I.TextShapingNew([],p,d,v,[0,.5*-d],.5*(1-s),0,o).getEstimatedShaping(n,a,i),u=I.TextShapingNew.getBox(l),c=x.pt2px(t.font.size)/h;return e[0]=c*u.x,e[1]=c*u.y,e[2]=c*u.width,e[3]=c*u.height,e};var j={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:a.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:a.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:a.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:a.WGS84}}},W=(l.prototype.cut=function(e,t){var i;if(e.rings)this.closed=!0,i=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,i=e.paths,this.minPts=2}for(var r=i.length,n=-2*t,a=0;a<r;a++){var o=i[a];if(o&&o.length>=this.minPts){for(var s=[],l=0,u=o;l<u.length;l++){var c=u[l];s.push([c[0]+n,c[1]])}i.push(s)}}return this.closed?e.rings=i:e.paths=i,e},l);function l(){}}.apply(null,t))||(r.exports=i)}).call(this,require("jquery"))},1796:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(5),i(15),i(90),i(26),i(1797)],void 0===(n=function(e,t,d,s,v,l,h){function i(e){return{value:e.value,size:s.toPt(e.size)}}function m(e){return e.map(function(e){return i(e)})}function y(e){if("string"==typeof e||"number"==typeof e)return s.toPt(e);return{type:"size",expression:e.expression,stops:m(e.stops)}}function _(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(v.Utils.isString(e.field)){if(!e.stops)return null;if(8<e.stops.length)return null;for(var i=e.stops,r=0;r<8;++r){var n=i[Math.min(r,i.length-1)];t.values[r]=n.value,t.opacities[r]=n.opacity}}else{if(!(e.stops&&0<=e.stops.length))return null;var a=e.stops&&0<=e.stops.length&&e.stops[0].opacity;for(r=0;r<8;r++)t.values[r]=1/0,t.opacities[r]=a}return t}Object.defineProperty(t,"__esModule",{value:!0});var S=v.enums.WGLVVFlag;t.getVisualVariableSizeValueRepresentationRatio=function(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e},t.stopToSizeStop=i,t.normalizeSizeStops=m,t.normalizeSizeElement=y,t.getVisualVariablesFields=function(e){var i=e&&0<e.length?{}:null;return i&&e.forEach(function(e){var t=e.type;e.field&&(i[t]=e.field)}),i};function x(e){for(var t=[],i=[],r=m(e),n=r.length,a=0;a<6;a++){var o=r[Math.min(a,n-1)];t.push(o.value),i.push(null==o.size?l.NAN_MAGIC_NUMBER:s.pt2px(o.size))}return{values:new Float32Array(t),sizes:new Float32Array(i)}}t.convertVisualVariables=function(e){var t=e&&0<e.length?{}:null,i=t?{}:null;if(!t)return{vvFields:t,vvRanges:i};for(var r=0,n=e;r<n.length;r++){var a=n[r],o=a.type;if(a.field&&(t[o]=a.field),"size"===o){i.size||(i.size={});var s=a;switch(v.getTypeOfSizeVisualVariable(s)){case S.SIZE_MINMAX_VALUE:i.size.minMaxValue={minDataValue:s.minDataValue,maxDataValue:s.maxDataValue,minSize:y(s.minSize),maxSize:y(s.maxSize)};break;case S.SIZE_SCALE_STOPS:i.size.scaleStops={stops:m(s.stops)};break;case S.SIZE_FIELD_STOPS:if(s.levels){var l={};for(var u in s.levels)l[u]=x(s.levels[u]);i.size.fieldStops={type:"level-dependent",levels:l}}else i.size.fieldStops=d({type:"static"},x(s.stops));break;case S.SIZE_UNIT_VALUE:i.size.unitValue={unit:s.valueUnit,valueRepresentation:s.valueRepresentation}}}else if("color"===o){var c=h.convertVisualVariables([a],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null});i.color=c.color;for(var p=0;p<32;p+=4)v.color.premultiplyAlpha(i.color.colors,p,!0)}else if("opacity"===o)i.opacity=_(a);else if("rotation"===o){var f=a;i.rotation={type:f.rotationType}}}return{vvFields:t,vvRanges:i}}}.apply(null,r))||(e.exports=n)},1797:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(34),i(33),i(214),i(1654),i(484),i(1633),i(118),i(150),i(218),i(1798)],void 0===(n=function(e,t,l,o,n,a,s,u,c,i,p,r){function f(e){return null!=e}function d(e){return"number"==typeof e}function v(e){return"string"==typeof e}function h(e,t){e&&e.push(t),y(t)}function m(e){L&&console.warn("[FastSymbolUpdates] "+e)}function y(e){L&&console.info("[FastSymbolUpdates] "+e)}function _(e,t,i,r,n){var a=e.minSize,o=e.maxSize;if(e.expression)return h(n,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){var s=r.symbolSize[i];return t.minSize[i]=s,t.maxSize[i]=s,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=1,!0}if(f(e.field))return f(e.stops)?2===e.stops.length&&d(e.stops[0].size)&&d(e.stops[1].size)?(S(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=1,!0):(h(n,"Could not convert size info: stops only supported with 2 elements"),!1):d(a)&&d(o)&&f(e.minDataValue)&&f(e.maxDataValue)?(S(a,o,e.minDataValue,e.maxDataValue,t,i),t.type[i]=1,!0):null!=p.meterIn[e.valueUnit]?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/p.meterIn[e.valueUnit],t.type[i]=1,!0):("unknown"===e.valueUnit?h(n,"Could not convert size info: proportional size not supported"):h(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!f(e.field)){if(e.stops&&e.stops[0]&&d(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=1,!0;if(d(a))return t.minSize[i]=a,t.maxSize[i]=a,t.offset[i]=a,t.factor[i]=0,t.type[i]=1,!0}return h(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function S(e,t,i,r,n,a){var o=0<Math.abs(r-i)?(t-e)/(r-i):0;n.minSize[a]=0<o?e:t,n.maxSize[a]=0<o?t:e,n.offset[a]=e-i*o,n.factor[a]=o}function x(e,t,i,r){if(e.normalizationField||e.valueRepresentation)return h(r,"Could not convert size info: unsupported property"),null;if(null!=(n=e.field)&&!v(n))return h(r,"Could not convert size info: field is not a string"),null;var n,a;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return h(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};switch(e.axis){case"width":return(a=_(e,t.size,0,i,r))?t:null;case"height":return(a=_(e,t.size,2,i,r))?t:null;case"depth":return(a=_(e,t.size,1,i,r))?t:null;case"width-and-depth":return(a=_(e,t.size,0,i,r))&&_(e,t.size,1,i,r),a?t:null;case null:case void 0:case"all":return(a=(a=(a=_(e,t.size,0,i,r))&&_(e,t.size,1,i,r))&&_(e,t.size,2,i,r))?t:null;default:return h(r,'Could not convert size info: unknown axis "'+e.axis+'""'),null}}function g(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function E(e,t,i){var r=2===i&&"arithmetic"===e.rotationType;t.offset[i]=r?90:0,t.factor[i]=r?-1:1,t.type[i]=1}function T(e,i,r){if(!e)return null;var n=!i.supportedTypes||!!i.supportedTypes.size,a=!i.supportedTypes||!!i.supportedTypes.color,o=!i.supportedTypes||!!i.supportedTypes.rotation,s=!!i.supportedTypes&&!!i.supportedTypes.opacity;L&&(r=r||[]);var t=e.reduce(function(e,t){if(!e)return e;if(t.valueExpression)return h(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(t.type){case"size":return n?x(t,e,i,r):e;case"color":return a?function(e,t,i){if(e.normalizationField)return h(i,"Could not convert color info: unsupported property"),null;if(v(e.field)){if(!e.stops)return h(i,"Could not convert color info: missing stops or colors"),null;if(8<e.stops.length)return h(i,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(var r=e.stops,n=0;n<8;++n){var a=r[Math.min(n,r.length-1)];t.color.values[n]=a.value,g(t.color.colors,n,a.color)}}else{if(!(e.stops&&0<=e.stops.length))return h(i,"Could not convert color info: no field and no colors/stops"),null;var o=e.stops&&0<=e.stops.length&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(n=0;n<8;n++)t.color.values[n]=1/0,g(t.color.colors,n,o)}return t}(t,e,r):e;case"opacity":return s?function(e,t,i){if(e.normalizationField)return h(i,"Could not convert opacity info: unsupported property"),null;if(v(e.field)){if(!e.stops)return h(i,"Could not convert opacity info: missing stops or opacities"),null;if(8<e.stops.length)return h(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(var r=e.stops,n=0;n<8;++n){var a=r[Math.min(n,r.length-1)];t.opacity.values[n]=a.value,t.opacity.opacityValues[n]=a.opacity}}else{if(!(e.stops&&0<=e.stops.length))return h(i,"Could not convert opacity info: no field and no opacities/stops"),null;var o=e.stops&&0<=e.stops.length&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(n=0;n<8;n++)t.opacity.values[n]=1/0,t.opacity.opacityValues[n]=o}return t}(t,e,r):null;case"rotation":return o?function(e,t,i){if(!v(e.field))return h(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return h(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return E(e,t.rotation,0),t;case"roll":return E(e,t.rotation,1),t;case null:case void 0:case"heading":return E(e,t.rotation,2),t;default:return h(i,'Could not convert rotation info: unknown axis "'+e.axis+'""'),null}}(t,e,r):e;default:return l.neverReached(t),null}},{size:null,color:null,opacity:null,rotation:null});return!(0<e.length&&t)||t.size||t.color||t.opacity||t.rotation?t&&t.size&&!function(e,t,i){for(var r=0;r<3;++r){var n=t.unitInMeters;1===e.type[r]&&(n*=t.modelSize[r],e.type[r]=2),e.minSize[r]=e.minSize[r]/n,e.maxSize[r]=e.maxSize[r]/n,e.offset[r]=e.offset[r]/n,e.factor[r]=e.factor[r]/n}var a;if(0!==e.type[0])a=0;else if(0!==e.type[1])a=1;else{if(0===e.type[2])return h(i,"No size axis contains a valid size or scale"),!1;a=2}for(r=0;r<3;++r)0===e.type[r]&&(e.minSize[r]=e.minSize[a],e.maxSize[r]=e.maxSize[a],e.offset[r]=e.offset[a],e.factor[r]=e.factor[a],e.type[r]=e.type[a]);return!0}(t.size,i,r)?null:t:null}function b(e){return e&&null!=e.size}function I(e,t,i){if(!!e!=!!t)return m("State update failed ({$name} enabled/disabled)"),!1;if(e&&e.field!==t.field)return m("State update failed ({$name} field changed)"),!1;if(e&&"rotation"===i)for(var r=e,n=t,a=0;a<3;a++)if(r.type[a]!==n.type[a]||r.offset[a]!==n.offset[a]||r.factor[a]!==n.factor[a])return!1;return!0}function z(e,t){var i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=b(e);return e&&e.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=e.size.minSize,i.vvSizeMaxSize=e.size.maxSize,i.vvSizeOffset=e.size.offset,i.vvSizeFactor=e.size.factor):e&&r&&(i.vvSizeValue=t.transformation.scale),e&&r&&(i.vvSymbolAnchor=t.transformation.anchor,i.vvSymbolRotationMatrix=a.mat3f64.create(),s.mat4.identity(D),function(e,t,i,r){void 0===r&&(r=u.mat4f64.create());var n=e||0,a=t||0,o=i||0;0!==n&&s.mat4.rotateZ(r,r,-n/180*Math.PI),0!==a&&s.mat4.rotateX(r,r,a/180*Math.PI),0!==o&&s.mat4.rotateY(r,r,o/180*Math.PI)}(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],D),n.mat3.fromMat4(i.vvSymbolRotationMatrix,D)),e&&e.color&&(i.vvColorEnabled=!0,i.vvColorValues=e.color.values,i.vvColorColors=e.color.colors),e&&e.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=e.opacity.values,i.vvOpacityOpacities=e.opacity.opacityValues),i}Object.defineProperty(t,"__esModule",{value:!0});var M,A,R,O,L=!1;t.convertVisualVariables=T,t.initFastSymbolUpdatesState=function(e,t){if(0,!e)return m("State not initialized, fast updates disabled (no renderer)"),{enabled:!1};if(r.DISABLE_FAST_UPDATES)return m("State not initialized, fast updates disabled (DISABLE_FAST_SYMBOL_UPDATES set)"),{enabled:!1};var i=T(e.visualVariables,t);return i?(y("State initialized, fast updates enabled"),{enabled:!0,visualVariables:i,materialParameters:z(i,t),requiresShaderTransformation:b(i)}):(m("State not initialized, fast updates disabled (conversion failed)"),{enabled:!1})},t.updateFastSymbolUpdatesState=function(e,t,i){if(!t||!e.enabled)return!1;var r=e.visualVariables,n=T(t.visualVariables,i);return n?!!(I(r.size,n.size,"size")&&I(r.color,n.color,"color")&&I(r.rotation,n.rotation,"rotation")&&I(r.opacity,n.opacity,"opacity"))&&(e.visualVariables=n,e.materialParameters=z(n,i),e.requiresShaderTransformation=b(n),y("State updated"),!0):(m("State update failed (conversion failed)"),!1)},t.getMaterialParams=z,A=M=M||{},R=u.mat4f64.create(),O=i.vec3f64.create(),A.evaluateModelTransform=function(e,t,i){if(!e.vvSizeEnabled)return i;s.mat4.copy(R,i);var r=e.vvSymbolRotationMatrix;s.mat4.set(D,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),s.mat4.multiply(R,R,D);for(var n=0;n<3;++n){var a=e.vvSizeOffset[n]+t[0]*e.vvSizeFactor[n];O[n]=o.clamp(a,e.vvSizeMinSize[n],e.vvSizeMaxSize[n])}return s.mat4.scale(R,R,O),s.mat4.translate(R,R,e.vvSymbolAnchor),R},A.evaluateModelTransformScale=function(e,t,i){if(!t.vvSizeEnabled)return c.vec3.set(e,1,1,1);for(var r=0;r<3;++r){var n=t.vvSizeOffset[r]+i[0]*t.vvSizeFactor[r];e[r]=o.clamp(n,t.vvSizeMinSize[r],t.vvSizeMaxSize[r])}return e};var D=u.mat4f64.create();t.evaluateModelTransform=M.evaluateModelTransform,t.evaluateModelTransformScale=M.evaluateModelTransformScale}.apply(null,r))||(e.exports=n)},1798:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(13),i(2)],void 0===(n=function(e,t,i,r,n,a){return s=a.declared(n),i(o,s),r([a.property()],o.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),r([a.property()],o.prototype,"SCENEVIEW_LOCKING_LOG",void 0),r([a.property()],o.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),r([a.property()],o.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0),r([a.property()],o.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),r([a.property()],o.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0),r([a.property()],o.prototype,"DECONFLICTOR_SHOW_OUTLINES_INVISIBLE",void 0),r([a.property()],o.prototype,"DECONFLICTOR_SHOW_GRID",void 0),r([a.property()],o.prototype,"LABELS_SHOW_BORDER",void 0),r([a.property()],o.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0),r([a.property()],o.prototype,"OVERLAY_SHOW_CENTER",void 0),r([a.property()],o.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),r([a.property()],o.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),r([a.property()],o.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),r([a.property()],o.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),r([a.property()],o.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),r([a.property()],o.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),r([a.property()],o.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),r([a.property()],o.prototype,"I3S_TREE_SHOW_TILES",void 0),r([a.property()],o.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),r([a.property()],o.prototype,"DISABLE_FAST_UPDATES",void 0),r([a.property()],o.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),r([a.property()],o.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),r([a.property()],o.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),new(r([a.subclass("esri.views.3d.support.DebugFlags")],o));function o(){var e=null!==s&&s.apply(this,arguments)||this;return e.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,e.SCENEVIEW_LOCKING_LOG=!1,e.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,e.HIGHLIGHTS_VISUALIZE_BLOCKS=!1,e.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,e.DECONFLICTOR_SHOW_OUTLINES=!1,e.DECONFLICTOR_SHOW_OUTLINES_INVISIBLE=!1,e.DECONFLICTOR_SHOW_GRID=!1,e.LABELS_SHOW_BORDER=!1,e.OVERLAY_DRAW_TEST_TEXTURE=!1,e.OVERLAY_SHOW_CENTER=!1,e.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,e.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,e.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,e.DRAW_MESH_GEOMETRY_NORMALS=!1,e.FEATURE_TILE_FETCH_SHOW_TILES=!1,e.FEATURE_TILE_TREE_SHOW_TILES=!1,e.TERRAIN_TILE_TREE_SHOW_TILES=!1,e.I3S_TREE_SHOW_TILES=!1,e.ENABLE_PROFILE_DEPTH_RANGE=!1,e.DISABLE_FAST_UPDATES=!1,e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,e.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,e}var s}.apply(null,r))||(e.exports=n)},1894:function(e,t,M){var i,r;i=[M.dj.c(e.i),t,M(9),M(10),M(6),M(14),M(3),M(33),M(12),M(4),M(488),M(82),M(20),M(90),M(230),M(26),M(1796),M(47)],void 0===(r=function(e,t,v,h,s,i,r,m,y,l,o,u,n,_,c,S,p){Object.defineProperty(t,"__esModule",{value:!0});function x(e){return(2147483648&e)>>>31}function a(e){return 2147483647&e}function f(n,a){return function(e,t,i){var r;try{r=a(e,t,i)}catch(e){r=NaN}return(null===r||isNaN(r)||r===1/0)&&n||r}}var d=(n.enums.PixelType,r.getLogger("esri.views.layers.2d.features.support.AttributeStore")),g=_.debug.createDebugLogger(_.debug.DEBUG_ATTR_UPDATES,d),E={sharedArrayBuffer:i("esri-shared-array-buffer"),oesTextureFloat:i("esri-webgl-texture-float"),maxTextureSize:i("esri-webgl-max-texture-size"),atomics:i("esri-atomics")},T=(Object.defineProperty(z.prototype,"buffer",{get:function(){return y.andThen(this.data,function(e){return e.buffer})},enumerable:!0,configurable:!0}),z.prototype.getData=function(e,t){var i=a(e);return y.expect(this.data)[i*this.texelSize+t]},z.prototype.setData=function(e,t,i){var r=a(e),n=1<<t;0!=(this.layout&n)?(this.data[r*this.texelSize+t]=i,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)):d.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")},z.prototype.lock=function(){5121===this.pixelType?this._shared&&E.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1):i("esri-2d-debug")&&d.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array")},z.prototype.unlock=function(){5121===this.pixelType?this._shared&&E.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0):i("esri-2d-debug")&&d.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array")},z.prototype.expand=function(e){if(!this.textureOnly){var t=this._initData(this.pixelType,e,this._shared,this._ctype),i=y.expect(this.data);t.set(i),this.data=t}},z.prototype.toMessage=function(){var e=this.dirtyStart,t=this.dirtyEnd,i=this.texelSize;if(t<e)return null;this._resetRange();var r=!(this._shared||"local"===this._ctype),n=this.pixelType,a=this.layout,o=y.expect(this.data);return o.slice?{start:e,end:t,data:r&&o.slice(e*i,(t+1)*i)||null,pixelType:n,layout:a}:r?{start:e,end:t,data:new(_.Utils.getPixelArrayCtor(this.pixelType))(Array.prototype.slice.call(this.data,e*i,(t+1)*i)),pixelType:n,layout:a}:{start:e,end:t,data:null,pixelType:n,layout:a}},z.prototype._initData=function(e,t,i,r){for(var n=i&&"local"!==r?SharedArrayBuffer:ArrayBuffer,a=_.Utils.getPixelArrayCtor(e),o=new a(new n(t*t*4*a.BYTES_PER_ELEMENT)),s=0;s<o.length;s+=4)o[s+1]=255;return o},z.prototype._resetRange=function(){this.dirtyStart=2147483647,this.dirtyEnd=0},z),b=(I.prototype.destroy=function(){this._abortController.abort()},Object.defineProperty(I.prototype,"hasScaleExpr",{get:function(){return this._hasScaleExpr},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"_signal",{get:function(){return this._abortController.signal},enumerable:!0,configurable:!0}),I.prototype.invalidateResources=function(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=l.createAbortController()},I.prototype.createLocalId=function(e,t){if(void 0===t&&(t=!1),!this._idMap.has(e)){var i=(r=this._getFreeTexel(),((t?2147483648:0)|r)>>>0);this._idMap.set(e,-1==i?0:i),this._localToObjectId.set(i,e)}var r;return this._idMap.get(e)},I.prototype.addLocalId=function(e){this._getBlock(0).setData(e,0,0),this._freeTexelsList.push(a(e))},I.prototype.removeLocalId=function(e){var t=this._idMap.get(e);return this._idMap.delete(e),this._localToObjectId.delete(t),t},I.prototype.freeLocalId=function(e){var t=this._idMap.get(e);i("esri-2d-debug")&&!t&&console.debug("Called freeLocalId for an invalid id"),this._getBlock(0).setData(t,0,0),this._idMap.delete(e),this._localToObjectId.delete(t),this._freeTexelsList.push(a(t))},I.prototype.getFeatureId=function(e){return this._localToObjectId.get(e)},I.prototype.getLocalId=function(e){return this._idMap.has(e)?this._idMap.get(e):null},I.prototype.setHighlight=function(l){return h(this,void 0,void 0,function(){var t,i,r,n,a,o,s=this;return v(this,function(e){switch(e.label){case 0:for(this._getBlock(0).lock(),this._idsToHighlight.forEach(function(e){var t=s.getLocalId(e);if(t){var i=s._getBlock(0).getData(t,0);s._getBlock(0).setData(t,0,-2&i)}}),this._idsToHighlight.clear(),t=0,i=l;t<i.length;t++)r=i[t],this._idsToHighlight.add(r);for(n=0;n<l.length;n++)null!=(a=this.getLocalId(l[n]))&&(o=this._getBlock(0).getData(a,0),this._getBlock(0).setData(a,0,1|o));return this._getBlock(0).unlock(),[4,this.sendUpdates()];case 1:return e.sent(),[2]}})})},I.prototype.addHighlight=function(){return h(this,void 0,void 0,function(){return v(this,function(e){return[2]})})},I.prototype.removeHighlight=function(){return h(this,void 0,void 0,function(){return v(this,function(e){return[2]})})},I.prototype.updateFilters=function(s){return h(this,void 0,void 0,function(){var t,i,r,n,a,o=this;return v(this,function(e){switch(e.label){case 0:return t=s.config,i=s.service,r=s.spatialReference,n=t.filters,a=n.map(function(e,t){return o._updateFilter(s,e,t,i,r)}),[4,l.all(a)];case 1:return e.sent(),[2]}})})},I.prototype.setAttributeBindings=function(t,i){return h(this,void 0,void 0,function(){return v(this,function(e){switch(this._hasScaleExpr=!1,t.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return[2,this._bindVVEvaluators(t.visualVariables,i)];case"dot-density":return[2,this._bindDDEvaluators(t.attributes,i)];case"heatmap":break;default:d.error(new s("attribute-store","Found invalid renderer type: "+t))}return[2]})})},I.prototype.setData=function(e,t,i,r){this._getBlock(t).setData(e,i,r)},I.prototype.getData=function(e,t,i){return this._getBlock(t).getData(e,i)},I.prototype.getHighlightFlag=function(e){return this._idsToHighlight.has(e)?S.HIGHLIGHT_FLAG:0},I.prototype.setAttributeData=function(e,u,c,p){var f=this,d=e;this._getBlock(0).setData(d,0,this.getFilterFlags(u));var t=this._attributeComputeMap,v=E.oesTextureFloat?1:2;t.forEach(function(e,t){var i=t*v%4,r=Math.floor(t*v/4),n=f._getBlock(r+S.ATTRIBUTE_DATA_VV),a=e(u,{$view:p},c);if(E.oesTextureFloat)n.setData(d,i,a);else if(a===_.definitions.NAN_MAGIC_NUMBER)n.setData(d,i,255),n.setData(d,1+i,255);else{var o=m.clamp(Math.round(a),-32767,32766)+32768,s=255&o,l=(65280&o)>>8;n.setData(d,i,s),n.setData(d,1+i,l)}})},I.prototype.sendUpdates=function(){var i=this;if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=l.createResolver(),this._nextUpdate.promise;var r={blocks:this._blocks.map(function(e){return y.isSome(e)?e.toMessage():null})};return this._currUpdate=this._createResources().then(function(){function e(){if(i._currUpdate=null,i._nextUpdate){var e=i._nextUpdate;i._nextUpdate=null,i.sendUpdates().then(function(){return e.resolve()})}}var t=i._client.update(r,i._signal).then(e).catch(e);return i._client.render(),t}).catch(function(e){return l.isAbortError(e)?(i._createResourcesPromise=null,i._createResources()):(d.error(new s("mapview-attribute-store","Encountered an error during client update",e)),l.resolve())}),this._currUpdate},I.prototype._createResources=function(){var t=this;if(y.isSome(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(S.ATTRIBUTE_DATA_ANIMATION),g("Initializing AttributeStore");var e={shared:E.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:y.mapMany(this._blocks,function(e){return{textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType}})},i=this._client.initialize(e,this._signal).catch(function(e){l.isAbortError(e)&&(t._createResourcesPromise=null),d.error(new s("mapview-attribute-store","Encountered an error during client initialization",e))});return(this._createResourcesPromise=i).then(function(){return y.isNone(t._createResourcesPromise)?t._createResources():void 0}),i},I.prototype._getBlock=function(e){var t=this._blocks[e];if(y.isSome(t))return t;g("Initializing AttributeBlock at index "+e);var i=E.sharedArrayBuffer,r=this._client.type,n=new T(i,r,this._size,this._blockDescriptors[e]);return this._blocks[e]=n,this._createResourcesPromise=null,n},I.prototype._expand=function(){if(this._size<E.maxTextureSize){var t=this._size<<=1;return g("Expanding block size to",t,this._blocks),y.forEachSome(this._blocks,function(e){return e.expand(t)}),this._createResourcesPromise=null,this._size=t,0}return d.error(new s("mapview-limitations","Maximum number of onscreen features exceeded.")),-1},I.prototype._getFreeTexel=function(){return this._freeTexelsList.length?this._freeTexelsList.pop():this._idCounter>=this._size*this._size&&this._expand()?-1:this._idCounter++},I.prototype._updateFilter=function(u,c,p,f,d){return h(this,void 0,void 0,function(){var t,i,r,n,a,o,s,l=this;return v(this,function(e){switch(e.label){case 0:return t=this._filters[p],(y.isSome(t)&&t.hash)===JSON.stringify(c)?[2]:(i=1<<p+1,y.isNone(c)?(this._filters[p]=null,this._idMap.forEach(function(e){var t=l._getBlock(0).getData(e,0);l._getBlock(0).setData(e,0,t|i)}),[2]):[4,u.queryObjectIds(c)]);case 1:return r=e.sent(),c.hiddenIds&&c.hiddenIds.length&&(r=r.filter(function(e){return-1===c.hiddenIds.indexOf(e)})),n=r.map(function(e){return l._idMap.get(e)}),[4,this._getFilter(p,f)];case 2:for(e.sent().update(c,d),this._getBlock(0).lock(),this._idMap.forEach(function(e){if(1!==x(e)){var t=l._getBlock(0).getData(e,0);l._getBlock(0).setData(e,0,t&~i)}}),a=0;a<n.length;a++)null!=(o=n[a])&&(s=this._getBlock(0).getData(o,0),this._getBlock(0).setData(o,0,s|i));return this._getBlock(0).unlock(),[2]}})})},I.prototype._getFilter=function(n,a){return h(this,void 0,void 0,function(){var t,i,r;return v(this,function(e){switch(e.label){case 0:return t=this._filters[n],y.isSome(t)?[2,t]:[4,new Promise(function(t,e){Promise.all([M.e(0),M.e(54)]).then(function(){var e=[M(2767)];t.apply(null,e)}.bind(this)).catch(e.bind(this))})];case 1:return i=e.sent().default,r=new i({geometryType:a.geometryType,hasM:!1,hasZ:!1,timeInfo:a.timeInfo,fieldsIndex:new o(a.fields)}),[2,this._filters[n]=r]}})})},I.prototype.isVisible=function(e){return!!(2&this._getBlock(0).getData(e.localId,0))},I.prototype.getFilterFlags=function(e){for(var t=0,i=(o=e.localId,1===x(o)?254:255),r=0;r<this._filters.length;r++){var n=!!(i&1<<r),a=this._filters[r];t|=(!n||y.isNone(a)||a.check(e)?1:0)<<r}var o,s=this.getFeatureId(e.localId);return t<<1|this.getHighlightFlag(s)},I.prototype._bindVVEvaluators=function(i,n){return h(this,void 0,void 0,function(){var t=this;return v(this,function(e){switch(e.label){case 0:return this._attributeComputeMap.clear(),y.isSome(i)?[4,l.all(i.map(function(r){return h(t,void 0,void 0,function(){var t,i;return v(this,function(e){switch(e.label){case 0:return t=_.Utils.getVVType(r.type),[4,this._createGetValueFunction(r,n)];case 1:return i=e.sent(),y.isSome(i)&&this._attributeComputeMap.set(t,i),[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},I.prototype._bindDDEvaluators=function(a,o){return h(this,void 0,void 0,function(){var t,i,r,n=this;return v(this,function(e){switch(e.label){case 0:return this._attributeComputeMap.clear(),a.length>_.definitions.DOT_DENSITY_MAX_FIELDS&&d.warn("mapview-invalid-value","DotDensityRenderer supports a maximum of "+_.definitions.DOT_DENSITY_MAX_FIELDS+" attribtues, but found "+a.length),[4,l.all(a.map(function(e){return n._createNormalizedFunction(e,o)}))];case 1:for(t=e.sent().map(function(e){return f(0,e)}),i=0;i<_.definitions.DOT_DENSITY_MAX_FIELDS;i++)(r=i<a.length&&t[i])?this._attributeComputeMap.set(i,r):this._attributeComputeMap.has(i)&&this._attributeComputeMap.delete(i);return[2]}})})},I.prototype._createGetValueFunction=function(l,u){return h(this,void 0,void 0,function(){var t,i,r,n,a,o,s;return v(this,function(e){switch(e.label){case 0:return"size"!==l.type?[3,2]:(t=_.getTypeOfSizeVisualVariable(l))===_.enums.WGLVVFlag.SIZE_SCALE_STOPS?[2,null]:(i=t===_.enums.WGLVVFlag.SIZE_UNIT_VALUE,r=i&&function(e){return p.getVisualVariableSizeValueRepresentationRatio(e,l.valueRepresentation)},n=f,a=[_.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(l,u,r)]);case 1:return[2,n.apply(void 0,a.concat([e.sent()]))];case 2:return o=f,s=[_.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(l,u)];case 3:return[2,o.apply(void 0,s.concat([e.sent()]))]}})})},I.prototype._createNormalizedFunction=function(n,a,o){return h(this,void 0,void 0,function(){var i,r,t;return v(this,function(e){switch(e.label){case 0:return(i=n.field)?"string"==typeof i?(r=n.normalizationField)?[2,function(e){if(e.attributes[i]&&e.attributes[r]){var t=e.attributes[i]/e.attributes[r];return o?o(t):t}}]:[2,o?function(e){return o(e.attributes[i])}:function(e){return e.attributes[i]}]:(d.error(new s("mapview-rendering:invalid-type","The field for a vv must be a string or a number, but got "+typeof i)),[2,function(){}]):n.valueExpression?(this._hasScaleExpr=this._hasScaleExpr||-1!==n.valueExpression.indexOf("scale"),[4,u.createVVExpression(n.valueExpression,a.spatialReference,a.fields)]):[3,2];case 1:return t=e.sent(),[2,c.callWithOptimizedFeature.bind(null,t)];case 2:return d.error("Unable to create a normalized function for visual variable: "+n),[2,function(){}]}})})},I);function I(e){this._attributeComputeMap=new Map,this._blocks=new Array,this._idMap=new Map,this._localToObjectId=new Map,this._filters=new Array(_.definitions.MAX_FILTERS),this._freeTexelsList=[],this._abortController=l.createAbortController(),this._hasScaleExpr=!1,this._size=32,this._idCounter=1,this._idsToHighlight=new Set;var t=E.oesTextureFloat?5126:5121;g("Creating AttributeStore "+(E.sharedArrayBuffer?"with":"without")+" shared memory"),i("esri-2d-debug")&&E.sharedArrayBuffer&&!E.atomics&&d.warn("Browser supports SharedArrayBuffer but not Atomics. Rendering may be impacted"),this._client=e,this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:t,layout:15},{pixelType:t,layout:15}],this._blocks=this._blockDescriptors.map(function(){return null})}function z(e,t,i,r){this.texelSize=4;var n=r.pixelType,a=r.layout,o=r.textureOnly;this.textureOnly=o||!1,this.pixelType=n,this._ctype=t,this.layout=a,this._resetRange(),this._shared=e,o||(this.data=this._initData(n,i,e,t))}t.default=b}.apply(null,i))||(e.exports=r)}}]);