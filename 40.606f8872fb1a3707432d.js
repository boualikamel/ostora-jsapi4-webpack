(function(){(this||window).webpackJsonp.registerAbsMids({"esri/core/libs/gl-matrix-2/factories/mat3f64":1659,"esri/support/elevationInfoUtils":1668,"esri/core/libs/gl-matrix-2/quat":1669,"esri/core/libs/gl-matrix-2/math/vec4":1670,"esri/core/libs/gl-matrix-2/factories/quatf64":1680,"esri/views/draw/DrawAction":1705,"esri/views/draw/input/Keys":1706,"esri/core/libs/gl-matrix-2/math/quat":1707,"esri/core/libs/gl-matrix-2/quatf64":1708,"esri/views/draw/input/DrawEvents":1749,"esri/views/draw/support/layerUtils":1789,"esri/layers/GraphicsLayer":1871,"esri/views/3d/interactive/editingTools/isSupportedGraphicUtils":1872,"esri/views/3d/interactive/editingTools/graphicMove3D/isSupportedGraphic":1873,"esri/views/3d/interactive/editingTools/graphicReshape3D/isSupportedGraphic":1874,"esri/geometry/Circle":1875,"esri/views/3d/interactive/editingTools/graphicTransform3D/isSupportedGraphic":1876,"esri/widgets/Sketch/SketchViewModel":2167,"esri/views/draw/Draw":2168,"esri/views/draw/MultipointDrawAction":2169,"esri/views/draw/PointDrawAction":2170,"esri/views/draw/PolygonDrawAction":2171,"esri/views/draw/PolylineDrawAction":2172,"esri/views/draw/SegmentDrawAction":2173,"esri/views/draw/support/createUtils":2174,"esri/widgets/Sketch/support/OperationHandle":2175})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{1659:function(e,t,r){var i,o;i=[r.dj.c(e.i),t],void 0===(o=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[1,0,0,0,1,0,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},t.fromValues=function(e,t,r,i,o,n,a,s,c){return[e,t,r,i,o,n,a,s,c]},t.createView=function(e,t){return new Float64Array(e,t,9)}}.apply(null,i))||(e.exports=o)},1668:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(12)],void 0===(o=function(e,t,i){function o(e,t){var r=!!i.isSome(e)&&e.hasZ;return i.isNone(t)?r?"absolute-height":"on-the-ground":"relative-to-ground"!==t.mode||!i.isNone(t.offset)&&0!==t.offset||!i.isSome(e)||"point"!==e.type||r&&0!==e.z?t.mode:"on-the-ground"}function n(e){var t=a(e);return o(e.geometry,t)}function a(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getGeometryEffectiveElevationMode=o,t.getGraphicEffectiveElevationMode=n,t.getGraphicEffectiveElevationInfo=function(e){var t=a(e),r=o(e.geometry,t);return{mode:r,offset:i.isSome(t)&&"on-the-ground"!==r?t.offset:0,featureExpressionInfo:i.isSome(t)&&"on-the-ground"!==r?t.featureExpressionInfo:null}},t.hasGraphicFeatureExpressionInfo=function(e){if("on-the-ground"===n(e))return!1;var t=a(e),r=i.isSome(t)&&t.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!r||"0"===r)}}.apply(null,i))||(e.exports=o)},1669:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(1707)],void 0===(o=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.quat=r}.apply(null,i))||(e.exports=o)},1670:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(103)],void 0===(o=function(e,t,l){function r(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function i(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function o(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function n(e,t){var r=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(r*r+i*i+o*o+n*n)}function a(e,t){var r=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2],n=t[3]-e[3];return r*r+i*i+o*o+n*n}function s(e){var t=e[0],r=e[1],i=e[2],o=e[3];return Math.sqrt(t*t+r*r+i*i+o*o)}function c(e){var t=e[0],r=e[1],i=e[2],o=e[3];return t*t+r*r+i*i+o*o}Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.set=function(e,t,r,i,o){return e[0]=t,e[1]=r,e[2]=i,e[3]=o,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=r,t.multiply=i,t.divide=o,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},t.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},t.distance=n,t.squaredDistance=a,t.length=s,t.squaredLength=c,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},t.normalize=function(e,t){var r=t[0],i=t[1],o=t[2],n=t[3],a=r*r+i*i+o*o+n*n;return 0<a&&(a=1/Math.sqrt(a),e[0]=r*a,e[1]=i*a,e[2]=o*a,e[3]=n*a),e},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.lerp=function(e,t,r,i){var o=t[0],n=t[1],a=t[2],s=t[3];return e[0]=o+i*(r[0]-o),e[1]=n+i*(r[1]-n),e[2]=a+i*(r[2]-a),e[3]=s+i*(r[3]-s),e},t.random=function(e,t){var r,i,o,n,a,s;for(t=t||1;1<=(a=(r=2*l.RANDOM()-1)*r+(i=2*l.RANDOM()-1)*i););for(;1<=(s=(o=2*l.RANDOM()-1)*o+(n=2*l.RANDOM()-1)*n););var c=Math.sqrt((1-a)/s);return e[0]=t*r,e[1]=t*i,e[2]=t*o*c,e[3]=t*n*c,e},t.transformMat4=function(e,t,r){var i=t[0],o=t[1],n=t[2],a=t[3];return e[0]=r[0]*i+r[4]*o+r[8]*n+r[12]*a,e[1]=r[1]*i+r[5]*o+r[9]*n+r[13]*a,e[2]=r[2]*i+r[6]*o+r[10]*n+r[14]*a,e[3]=r[3]*i+r[7]*o+r[11]*n+r[15]*a,e},t.transformQuat=function(e,t,r){var i=t[0],o=t[1],n=t[2],a=r[0],s=r[1],c=r[2],p=r[3],l=p*i+s*n-c*o,d=p*o+c*i-a*n,u=p*n+a*o-s*i,h=-a*i-s*o-c*n;return e[0]=l*p+h*-a+d*-c-u*-s,e[1]=d*p+h*-s+u*-a-l*-c,e[2]=u*p+h*-c+l*-s-d*-a,e[3]=t[3],e},t.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var r=e[0],i=e[1],o=e[2],n=e[3],a=t[0],s=t[1],c=t[2],p=t[3];return Math.abs(r-a)<=l.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=l.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-c)<=l.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(n-p)<=l.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))},t.sub=r,t.mul=i,t.div=o,t.dist=n,t.sqrDist=a,t.len=s,t.sqrLen=c}.apply(null,i))||(e.exports=o)},1680:function(e,t,r){var i,o;i=[r.dj.c(e.i),t],void 0===(o=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[0,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3]]},t.fromValues=function(e,t,r,i){return[e,t,r,i]},t.createView=function(e,t){return new Float64Array(e,t,4)}}.apply(null,i))||(e.exports=o)},1705:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(1),r(0),r(54),r(2)],void 0===(o=function(e,t,r,i,o,n){return s=n.declared(o.EventedAccessor),r(a,s),a.prototype.canUndo=function(){return 0<this.history.length},a.prototype.canRedo=function(){return 0<this.redoHistory.length},a.prototype.undo=function(){if(this.canUndo()){var e=this.history.pop();e.undo(),this.redoHistory.push(e)}},a.prototype.redo=function(){if(this.canRedo()){var e=this.redoHistory.pop();e.redo(),this.history.push(e)}},a.prototype.getCoordsFromScreenPoint=function(e){var t=this.view.toMap(e);return t?[t.x,t.y]:null},a.prototype.isDuplicateVertex=function(e,t){if(e.length){var r=e[e.length-1],i=r[0],o=r[1];return i===t[0]&&o===t[1]}return!1},i([n.property({readOnly:!0})],a.prototype,"history",void 0),i([n.property({readOnly:!0})],a.prototype,"redoHistory",void 0),i([n.property()],a.prototype,"view",void 0),i([n.subclass("esri.views.draw.DrawAction")],a);function a(){var e=null!==s&&s.apply(this,arguments)||this;return e.history=[],e.redoHistory=[],e.view=null,e}var s}.apply(null,i))||(e.exports=o)},1706:function(e,t,r){var i,o;i=[r.dj.c(e.i),t],void 0===(o=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.KEYS={drawCompleteKey:"c",redoKey:"r",undoKey:"z",vertexAddKey:"f",panKey:" "}}.apply(null,i))||(e.exports=o)},1707:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(1659),r(1680),r(224),r(103),r(511),r(1670)],void 0===(o=function(e,n,t,r,i,m,o,a){function s(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function c(e,t,r){var i=t[0],o=t[1],n=t[2],a=t[3],s=r[0],c=r[1],p=r[2],l=r[3];return e[0]=i*l+a*s+o*p-n*c,e[1]=o*l+a*c+n*s-i*p,e[2]=n*l+a*p+i*c-o*s,e[3]=a*l-i*s-o*c-n*p,e}function p(e,t,r,i){var o,n,a,s,c,p=t[0],l=t[1],d=t[2],u=t[3],h=r[0],v=r[1],y=r[2],f=r[3];return(n=p*h+l*v+d*y+u*f)<0&&(n=-n,h=-h,v=-v,y=-y,f=-f),c=1-n>m.EPSILON?(o=Math.acos(n),a=Math.sin(o),s=Math.sin((1-i)*o)/a,Math.sin(i*o)/a):(s=1-i,i),e[0]=s*p+c*h,e[1]=s*l+c*v,e[2]=s*d+c*y,e[3]=s*u+c*f,e}function l(e,t){var r,i=t[0]+t[4]+t[8];if(0<i)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var o=0;t[4]>t[0]&&(o=1),t[8]>t[3*o+o]&&(o=2);var n=(o+1)%3,a=(o+2)%3;r=Math.sqrt(t[3*o+o]-t[3*n+n]-t[3*a+a]+1),e[o]=.5*r,r=.5/r,e[3]=(t[3*n+a]-t[3*a+n])*r,e[n]=(t[3*n+o]+t[3*o+n])*r,e[a]=(t[3*a+o]+t[3*o+a])*r}return e}Object.defineProperty(n,"__esModule",{value:!0}),n.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},n.setAxisAngle=s,n.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>m.EPSILON?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r},n.multiply=c,n.rotateX=function(e,t,r){r*=.5;var i=t[0],o=t[1],n=t[2],a=t[3],s=Math.sin(r),c=Math.cos(r);return e[0]=i*c+a*s,e[1]=o*c+n*s,e[2]=n*c-o*s,e[3]=a*c-i*s,e},n.rotateY=function(e,t,r){r*=.5;var i=t[0],o=t[1],n=t[2],a=t[3],s=Math.sin(r),c=Math.cos(r);return e[0]=i*c-n*s,e[1]=o*c+a*s,e[2]=n*c+i*s,e[3]=a*c-o*s,e},n.rotateZ=function(e,t,r){r*=.5;var i=t[0],o=t[1],n=t[2],a=t[3],s=Math.sin(r),c=Math.cos(r);return e[0]=i*c+o*s,e[1]=o*c-i*s,e[2]=n*c+a*s,e[3]=a*c-n*s,e},n.calculateW=function(e,t){var r=t[0],i=t[1],o=t[2];return e[0]=r,e[1]=i,e[2]=o,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-o*o)),e},n.slerp=p,n.random=function(e){var t=m.RANDOM(),r=m.RANDOM(),i=m.RANDOM(),o=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=o*Math.sin(2*Math.PI*r),e[1]=o*Math.cos(2*Math.PI*r),e[2]=n*Math.sin(2*Math.PI*i),e[3]=n*Math.cos(2*Math.PI*i),e},n.invert=function(e,t){var r=t[0],i=t[1],o=t[2],n=t[3],a=r*r+i*i+o*o+n*n,s=a?1/a:0;return e[0]=-r*s,e[1]=-i*s,e[2]=-o*s,e[3]=n*s,e},n.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},n.fromMat3=l,n.fromEuler=function(e,t,r,i){var o=.5*Math.PI/180;t*=o,r*=o,i*=o;var n=Math.sin(t),a=Math.cos(t),s=Math.sin(r),c=Math.cos(r),p=Math.sin(i),l=Math.cos(i);return e[0]=n*c*l-a*s*p,e[1]=a*s*l+n*c*p,e[2]=a*c*p-n*s*l,e[3]=a*c*l+n*s*p,e},n.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},n.copy=a.copy,n.set=a.set,n.add=a.add,n.mul=c,n.scale=a.scale,n.dot=a.dot,n.lerp=a.lerp,n.length=a.length,n.len=n.length,n.squaredLength=a.squaredLength,n.sqrLen=n.squaredLength,n.normalize=a.normalize,n.exactEquals=a.exactEquals,n.equals=a.equals,n.rotationTo=function(e,t,r){var i=o.dot(t,r);return i<-.999999?(o.cross(d,u,t),o.len(d)<1e-6&&o.cross(d,h,t),o.normalize(d,d),s(e,d,Math.PI),e):.999999<i?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(o.cross(d,t,r),e[0]=d[0],e[1]=d[1],e[2]=d[2],e[3]=1+i,n.normalize(e,e))};var d=i.create(),u=i.fromValues(1,0,0),h=i.fromValues(0,1,0);n.sqlerp=function(e,t,r,i,o,n){return p(v,t,o,n),p(y,r,i,n),p(e,v,y,2*n*(1-n)),e};var v=r.create(),y=r.create();n.setAxes=function(e,t,r,i){var o=f;return o[0]=r[0],o[3]=r[1],o[6]=r[2],o[1]=i[0],o[4]=i[1],o[7]=i[2],o[2]=-t[0],o[5]=-t[1],o[8]=-t[2],n.normalize(e,l(e,o))};var f=t.create()}.apply(null,i))||(e.exports=o)},1708:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(1680)],void 0===(o=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.quatf64=r}.apply(null,i))||(e.exports=o)},1749:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(1)],void 0===(o=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=(o.prototype.preventDefault=function(){this.defaultPrevented=!0},o);function o(e,t,r,i){this.view=e,this.native=t,this.vertexIndex=r,this.vertices=i,this.defaultPrevented=!1,this.type="vertex-add"}t.VertexAddEvent=i;var n=(a.prototype.preventDefault=function(){this.defaultPrevented=!0},a);function a(e,t,r,i){this.view=e,this.native=t,this.vertexIndex=r,this.vertices=i,this.defaultPrevented=!1,this.type="vertex-update"}t.VertexUpdateEvent=n;var s=(c.prototype.preventDefault=function(){this.defaultPrevented=!0},c);function c(e,t,r,i){this.view=e,this.native=t,this.vertexIndex=r,this.vertices=i,this.defaultPrevented=!1,this.type="vertex-remove"}t.VertexRemoveEvent=s;var p=(l.prototype.preventDefault=function(){this.defaultPrevented=!0},l);function l(e,t,r,i,o){void 0===o&&(o=null),this.view=e,this.native=t,this.vertexIndex=r,this.vertices=i,this.mapPoint=o,this.defaultPrevented=!1,this.type="cursor-update"}t.CursorUpdateEvent=p;var d=(u.prototype.preventDefault=function(){this.defaultPrevented=!0},u);function u(e,t){this.native=e,this.vertices=t,this.defaultPrevented=!1,this.type="draw-complete"}t.DrawCompleteEvent=d}.apply(null,i))||(e.exports=o)},1789:function(e,t,r){var i,o;i=[r.dj.c(e.i),t],void 0===(o=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.addUniqueLayer=function(e,t){if(t&&e&&e.map){var r=e.map;r.layers.find(function(e){return e===t})||r.add(t)}}}.apply(null,i))||(e.exports=o)},1871:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(1),r(0),r(5),r(9),r(10),r(2),r(100),r(155),r(535),r(512)],void 0===(o=function(e,t,r,i,o,n,a,s,c,p,l,d){return h=s.declared(p.ScaleRangeLayer(c)),r(u,h),u.prototype.destroy=function(){this.removeAll()},u.prototype.add=function(e){return this.graphics.add(e),this},u.prototype.addMany=function(e){return this.graphics.addMany(e),this},u.prototype.removeAll=function(){return this.graphics.removeAll(),this},u.prototype.remove=function(e){this.graphics.remove(e)},u.prototype.removeMany=function(e){this.graphics.removeMany(e)},u.prototype.on=function(e,t){return this.inherited(arguments,[e,t])},u.prototype.graphicChanged=function(e){this.emit("graphic-update",e)},i([s.property({type:d})],u.prototype,"elevationInfo",void 0),i([s.property(l.graphicsCollectionProperty)],u.prototype,"graphics",void 0),i([s.property({type:["show","hide"]})],u.prototype,"listMode",void 0),i([s.property()],u.prototype,"screenSizePerspectiveEnabled",void 0),i([s.property({readOnly:!0})],u.prototype,"type",void 0),i([s.subclass("esri.layers.GraphicsLayer")],u);function u(e){var t=h.call(this,e)||this;return t.elevationInfo=null,t.graphics=new l.default,t.screenSizePerspectiveEnabled=!0,t.type="graphics",t}var h}.apply(null,i))||(e.exports=o)},1872:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(34)],void 0===(o=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isSupportedGraphicResultMessage=function(e){switch(e){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the elevation mode is not supported";case 5:return"the symbol type is not supported";default:r.neverReached(e)}return""}}.apply(null,i))||(e.exports=o)},1873:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(34),r(12),r(1668),r(504)],void 0===(o=function(e,t,i,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),t.isSupportedGraphic=function(e){if("graphics"!==e.layer.type)return 1;if(o.isNone(e.geometry))return 2;var t=e.geometry.type;switch(t){case"polygon":case"point":case"polyline":break;case"multipoint":case"extent":case"mesh":return 3;default:return i.neverReached(t),3}var r=n.getGraphicEffectiveElevationMode(e);return"on-the-ground"===r||a.enableEditing3D()&&"absolute-height"===r&&!n.hasGraphicFeatureExpressionInfo(e)?0:4}}.apply(null,i))||(e.exports=o)},1874:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(34),r(12),r(1875),r(1668),r(504)],void 0===(o=function(e,t,o,n,a,s,c){Object.defineProperty(t,"__esModule",{value:!0}),t.isSupportedGraphic=function(e){if("graphics"!==e.layer.type)return 1;var t=e.geometry;if(n.isNone(t))return 2;var r=t.type;switch(r){case"polygon":if(t instanceof a)return 3;break;case"polyline":break;case"point":case"multipoint":case"extent":case"mesh":return 3;default:return o.neverReached(r),3}var i=s.getGraphicEffectiveElevationMode(e);return"on-the-ground"===i||c.enableEditing3D()&&"absolute-height"===i&&!s.hasGraphicFeatureExpressionInfo(e)?0:4}}.apply(null,i))||(e.exports=o)},1875:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(5),r(1),r(0),r(69),r(2),r(43),r(152),r(553),r(44),r(225)],void 0===(o=function(e,t,i,r,o,c,n,a,s,p,l,d){return h=n.declared(s),r(u,h),(v=u).prototype.normalizeCtorArgs=function(e,t){var r;if(e&&e.center)r=e;else{if(e&&e.rings)return this.inherited(arguments);r={center:e}}return i({},this.inherited(arguments,[]),r,t)},u.prototype.initialize=function(){var e=this.center,t=this.numberOfPoints;if(this.hasZ=e&&e.hasZ,0===this.rings.length&&e){var r,i=c.convertUnit(this.radius,this.radiusUnit,"meters"),o=e.spatialReference,n="geographic";if(o.isWebMercator?n="webMercator":(null!=d[o.wkid]||o.wkt&&0===o.wkt.indexOf("PROJCS"))&&(n="projected"),this.geodesic){var a=void 0;switch(n){case"webMercator":a=l.webMercatorToGeographic(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":a=e}r=this._createGeodesicCircle(a,i,t),"webMercator"===n&&(r=l.geographicToWebMercator(r))}else{var s=void 0;"webMercator"===n||"projected"===n?s=i/this._convert2Meters(1,e.spatialReference):"geographic"===n&&(s=c.lengthToDegrees(i,"meters")),r=this._createPlanarCircle(e,s,t)}this.spatialReference=r.spatialReference,this.addRing(r.rings[0])}},u.prototype.clone=function(){var e=this,t=e.center,r=e.numberOfPoints,i=e.radius,o=e.radiusUnit,n=e.geodesic;return new v({center:t.clone(),numberOfPoints:r,radius:i,radiusUnit:o,geodesic:n})},u.prototype._createGeodesicCircle=function(e,t,r){for(var i=0,o=[];i<360;){var n=[0,0],a=[e.x,e.y];p.directGeodeticSolver(n,a,i,t),this.hasZ&&n.push(e.z),o.push(n),i+=360/r}return o.push(o[0]),new s(o)},u.prototype._createPlanarCircle=function(e,t,r){for(var i=0,o=[];i<2*Math.PI;){var n=[e.x+Math.cos(-i)*t,e.y+Math.sin(-i)*t];this.hasZ&&n.push(e.z),o.push(n),i+=Math.PI/(r/2)}return o.push(o[0]),new s({spatialReference:e.spatialReference,rings:[o]})},u.prototype._convert2Meters=function(e,t){var r;if(null!=d[t.wkid])r=d.values[d[t.wkid]];else{var i=t.wkt,o=i.lastIndexOf(",")+1,n=i.lastIndexOf("]]");r=parseFloat(i.substring(o,n))}return e*r},o([n.property({type:a})],u.prototype,"center",void 0),o([n.property()],u.prototype,"geodesic",void 0),o([n.property()],u.prototype,"numberOfPoints",void 0),o([n.property()],u.prototype,"radius",void 0),o([n.property()],u.prototype,"radiusUnit",void 0),v=o([n.subclass("esri.geometry.Circle")],u);function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=h.apply(this,e)||this;return r.center=null,r.geodesic=!1,r.numberOfPoints=60,r.radius=1e3,r.radiusUnit="meters",r}var h,v}.apply(null,i))||(e.exports=o)},1876:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(34),r(12),r(1668),r(504)],void 0===(o=function(e,t,o,n,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.isSupportedGraphic=function(e){if("graphics"!==e.layer.type)return 1;if(n.isNone(e.geometry))return 2;var t=e.geometry.type;switch(t){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return 3;default:return o.neverReached(t),3}var r=n.isSome(e.symbol)&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;if(!(r&&0<r.length&&r.some(function(e){return"object"===e.type})))return 5;var i=a.getGraphicEffectiveElevationMode(e);return"on-the-ground"===i||s.enableEditing3D()&&"absolute-height"===i&&!a.hasGraphicFeatureExpressionInfo(e)?0:4}}.apply(null,i))||(e.exports=o)},2167:function(e,t,q){var r,i;r=[q.dj.c(e.i),t,q(5),q(1),q(0),q(9),q(10),q(28),q(89),q(40),q(18),q(34),q(6),q(54),q(23),q(3),q(12),q(15),q(16),q(2),q(305),q(1871),q(132),q(77),q(167),q(1872),q(1873),q(1874),q(1876),q(2168),q(2174),q(1789),q(156),q(2175),q(47)],void 0===(i=function(e,t,y,r,i,f,m,T,I,o,n,a,s,c,p,l,_,w,d,u,h,v,g,x,E,G,P,b,S,V,U,O,M,C){function H(e,t){var o=e.history.undo.pop().updates,n=[];t.forEach(function(e,t){var r=o[t],i={};null!=r&&(_.isSome(r.geometry)&&(i.geometry=e.geometry,e.geometry=r.geometry),_.isSome(r.symbol)&&(i.symbol=e.symbol,e.symbol=r.symbol),n.push(i))}),e.history.redo.push({updates:n})}function A(e,t){var o=e.history.redo.pop().updates,n=[];t.forEach(function(e,t){var r=o[t],i={};null!=r&&(_.isSome(r.geometry)&&(i.geometry=e.geometry,e.geometry=r.geometry),_.isSome(r.symbol)&&(i.symbol=e.symbol,e.symbol=r.symbol),n.push(i))}),e.history.undo.push({updates:n})}function k(e){return{updates:e.map(function(e){return{geometry:e.geometry}})}}function L(e){return{updates:e.map(function(e){return{symbol:e.symbol}})}}function R(e){e.canUndo()?e.complete():e.cancel()}function D(e){return"requireError"in e&&"aborted"===e.requireError}var F,K=l.getLogger("esri.widgets.Sketch.SketchViewModel"),j={redoKey:"r",undoKey:"z",centerKey:"Alt",constraintKey:"Control",snappingKey:"Shift",cancelKey:"Escape",deleteKeys:["Backspace","Delete"]};return F=u.declared(c.EventedAccessor),r(W,F),W.prototype.initialize=function(){var o=this;this._handles.add([d.watch(this,"layer",function(){return o.cancel()}),d.on(this,"view.map.layers","change",function(e){0<=e.removed.indexOf(o.layer)&&o.cancel()}),d.on(this,"layer.graphics","change",function(e){if(_.isSome(o._operationHandle))for(var t=0,r=e.removed;t<r.length;t++){var i=r[t];o.updateGraphics.includes(i)&&(1<o.updateGraphics.length?o._operationHandle.removeFromSelection(i):R(o._operationHandle))}})].concat(this._generateSceneViewHighlightHandles()))},W.prototype.destroy=function(){this.cancel(),this._handles.removeAll(),this._handles=null,this._viewHandles.removeAll(),this._viewHandles=null,this._highlightHandlesByGraphic.removeAll(),this._highlightHandlesByGraphic=null,this._removeDefaultLayer(),this._draw&&this._draw.destroy(),this._set("view",null),this.emit("destroy")},Object.defineProperty(W.prototype,"_defaultUpdateTool",{get:function(){return"3d"===this.view.type?"move":"transform"},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"_draw",{get:function(){return"ready"===this.state||"active"===this.state?new V({view:this.view}):null},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"activeTool",{get:function(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"activeComponent",{get:function(){return this._operationHandle?this._operationHandle.activeComponent:null},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"state",{get:function(){var e=!(!this.get("view.ready")||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"view",{get:function(){return this._get("view")},set:function(t){var r=this,e=this._get("view");if(e){var i=e.container,o=e.map;i&&(e.cursor=null),o&&o.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel()}this._doUnnormalization=null!=t&&"3d"===t.type&&"global"===t.viewingMode,this._handles.remove("view-ready"),t&&this._handles.add(d.when(t,"ready",function(e){r._viewHandles.removeAll(),e&&r._viewHandles.add(r._generateViewHandles(t))},!0),"view-ready"),this._set("view",t)},enumerable:!0,configurable:!0}),W.prototype.cancel=function(){this._moduleLoaderAbortController&&(this._moduleLoaderAbortController.abort(),this._moduleLoaderAbortController=null),this._operationHandle&&this._operationHandle.cancel()},W.prototype.complete=function(){this._operationHandle&&this._operationHandle.complete()},W.prototype.delete=function(){var e=this.state,t=this.updateGraphics;if("active"===e&&t.length){var r=this.activeTool,i=this.layer,o=t.toArray();i.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:r})}},W.prototype.create=function(r,e){var i=this;if("disabled"===this.state)return this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),void(this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."));if(this.cancel(),r){var o=this._setupCreateOperation(r,e);if(!_.isNone(o)){function t(){if(o===i._operationHandle){var e=o.cancelled?"cancel":"complete",t=i.createGraphic;i._operationHandle.destroy(),i._operationHandle=null,i._set("createGraphic",null),i.view&&i.view.map&&i.view.map.remove(i._internalGraphicsLayer),o.cancelled||i.layer.add(t),i._emitCreateEvent({graphic:t,state:e,tool:r,toolEventInfo:null})}}O.addUniqueLayer(this.view,this._internalGraphicsLayer),o.on("complete",t),o.on("cancel",t),this._operationHandle=o}}else this._logError("sketch:missing-parameter","Missing parameter 'tool'.")},W.prototype.update=function(c,p){return m(this,void 0,void 0,function(){var t,r,i,o,n,a,s=this;return f(this,function(e){switch(e.label){case 0:return r=(t=this).layer,i=t.state,o=t.view,"disabled"===i?(r||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),o||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),[2]):(this.cancel(),(n=Array.isArray(c)?c:[c])&&n.length?n.some(function(e){return e.layer!==r?(s._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):_.isNone(e.geometry)?(s._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):"2d"===o.type&&!o.spatialReference.equals(e.geometry.spatialReference)&&(s._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with a spatial reference different from the supplied MapView."),!0)})?[2]:[4,this._setupUpdateOperation(n,p)]:(this._logError("sketch:missing-parameter","Missing parameter 'graphics'."),[2]));case 1:return a=e.sent(),_.isNone(a)||D(a)||(O.addUniqueLayer(this.view,this._internalGraphicsLayer),this._emitUpdateEvent({graphics:n,state:"start",tool:a.tool,toolEventInfo:null}),this._setUpdateOperationHandle(a)),[2]}})})},W.prototype.undo=function(){this.canUndo()&&this._operationHandle.undo()},W.prototype.redo=function(){this.canRedo()&&this._operationHandle.redo()},W.prototype.canUndo=function(){return!(!this._operationHandle||!this._operationHandle.canUndo())},W.prototype.canRedo=function(){return!(!this._operationHandle||!this._operationHandle.canRedo())},W.prototype.toggleUpdateTool=function(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()},W.prototype._getFirstHit=function(r){return m(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return[4,this.view.hitTest(r)];case 1:return 0<(t=e.sent()).results.length?[2,{screenPoint:r,results:[t.results[0]]}]:[2,{screenPoint:r,results:[]}]}})})},W.prototype._generateViewHandles=function(e){var c=this;return[e.on("immediate-click",function(r){var e=c._operationHandle,i=c.defaultUpdateOptions,o=c.layer,n=c.state,a=c.updateGraphics,t=c.updateOnGraphicClick,s="active"===n&&"create"===e.type;"disabled"!==n&&!s&&t&&c._getFirstHit(w.createScreenPointFromEvent(r)).then(function(e){var t=e.results;t.length?t.some(function(e){if(e.graphic){var t=e.graphic;if(-1<a.indexOf(t))return!0;if(t.layer===o)return c.update([t],y({},i)),!0}return!1})&&r.stopPropagation():"active"===n&&c.cancel()})},M.ViewEventPriorities.WIDGET)]},W.prototype._validateCreateOperation3D=function(e){var t=this.layer&&this.layer.elevationInfo&&this.layer.elevationInfo;return!t||!t.mode||!("relative-to-ground"!==t.mode||!_.isNone(t.offset)&&0!==t.offset||"point"!==e)||"on-the-ground"===t.mode},W.prototype._setupCreateOperation=function(e,t){if(!e)return null;var r,i=this.view,o=this.defaultCreateOptions,n=y({},o,t);if("3d"===i.type&&!this._validateCreateOperation3D(e))return this._logError("sketch:create-unsupported","Creating new graphics in SceneView is only supported for `on-the-ground` elevation modes."),null;switch(e){case"point":r=this._setupCreatePointOperation(e,null);break;case"multipoint":r=this._setupCreateMultipointOperation(e,null);break;case"polygon":case"polyline":r=this._setupCreatePolyOperation(e,n);break;case"rectangle":r=this._setupCreateRectangleOperation(e,n);break;case"circle":r=this._setupCreateCircleOperation(e,n)}return r},W.prototype._setupCreatePointOperation=function(e,t){var a=this,r=this._draw.create(e,t),i=[r.on("cursor-update",function(e){_.isSome(e.coordinates)?a._displayCrosshairCursor():a._displayDefaultCursor()}),r.on("draw-complete",function(e){var t=e.coordinates,r=t[0],i=t[1],o=new T.Point(r,i,a.view.spatialReference),n=new I(o,a.pointSymbol);a._set("createGraphic",n),s&&s.complete()})],o=[this.view.on("key-down",function(e){e.key===j.cancelKey&&s&&s.cancel()},M.ViewEventPriorities.WIDGET)],s=this._operationHandleForCreateAction(r,i.concat(o),e);return s},W.prototype._setupCreateMultipointOperation=function(n,e){var a=this,t=this._draw.create(n,e),s=null,r=[],i=this._operationHandleForCreateAction(t,r,n);return r.push(t.on("vertex-add",function(e){var t=e.type,r=e.vertexIndex,i=e.vertices,o=i[r];s=e,a._drawMultipointGraphic(i,!0),a._emitCreateEvent({graphic:a.createGraphic,state:1===i.length?"start":"active",tool:n,toolEventInfo:{added:o,type:t}})}),t.on("vertex-remove",function(e){var t=e.type,r=e.vertexIndex,i=e.vertices,o=i[r];s=e,a._drawMultipointGraphic(i,!0),a._emitCreateEvent({graphic:a.createGraphic,state:"active",tool:n,toolEventInfo:{removed:o,type:t}})}),t.on("vertex-update",function(e){var t=e.type,r=e.vertexIndex,i=e.vertices,o=i[r];s=e,a._drawMultipointGraphic(i,!0),a._emitCreateEvent({graphic:a.createGraphic,state:"active",tool:n,toolEventInfo:{type:t,updated:o}})}),t.on("cursor-update",function(e){s=e}),t.on("draw-complete",function(e){var t=e.vertices.slice(0),r=U.createMultipoint(t,a.view.spatialReference);r?(a.createGraphic&&(a.createGraphic.geometry=r),i&&i.complete()):i&&i.cancel()}),t.on("undo",function(e){var t=e.vertices,r=s&&"cursor-update"!==s.type;a._resetCreateOperationGraphics(),t.length&&a._drawMultipointGraphic(t,r)}),t.on("redo",function(e){var t=e.vertices,r=s&&"cursor-update"!==s.type;a._resetCreateOperationGraphics(),t.length&&a._drawMultipointGraphic(t,r)})),r.push(this.view.on("pointer-move",function(){return a._displayCrosshairCursor()},M.ViewEventPriorities.WIDGET),this.view.on("key-down",function(e){return a._getCommonUpdateOperationKeyDownHandlers(i,e)},M.ViewEventPriorities.WIDGET)),i},W.prototype._setupCreatePolyOperation=function(n,e){var a=this,i=null;"polyline"===n?i=this._draw.create(n,e):"polygon"===n&&(i=this._draw.create(n,e));var o=new T.Point,s=null,c=!1,t=[i.on("vertex-add",function(e){var t=e.type,r=e.vertexIndex,i=e.vertices,o=i[r];a._snap(n,i,c),s=e,a._drawVertexGraphics(n,i,{userClicked:!0}),a._emitCreateEvent({graphic:a.createGraphic,state:1===i.length?"start":"active",tool:n,toolEventInfo:{added:o,type:t}})}),i.on("vertex-remove",function(e){var t=e.type,r=e.vertexIndex,i=e.vertices,o=i[r];a._snap(n,i,c),s=e,a._drawVertexGraphics(n,i,{userClicked:!0}),a._emitCreateEvent({graphic:a.createGraphic,state:"active",tool:n,toolEventInfo:{removed:o,type:t}})}),i.on("vertex-update",function(e){var t=e.type,r=e.vertexIndex,i=e.vertices,o=i[r];a._snap(n,i,c),s=e,a._drawVertexGraphics(n,i,{userClicked:!0}),a._emitCreateEvent({graphic:a.createGraphic,state:"active",tool:n,toolEventInfo:{type:t,updated:o}})}),i.on("cursor-update",function(e){var t=e.type,r=e.vertices;if(e.mapPoint&&(a._snap(n,r,c),o=(s=e).mapPoint,a._drawVertexGraphics(n,r,{userClicked:!1}),1<r.length)){var i=r[r.length-1];a._emitCreateEvent({graphic:a.createGraphic,state:"active",tool:n,toolEventInfo:{coordinates:i,type:t}})}}),i.on("draw-complete",function(e){var t=e.vertices.slice(0),r=null;"polyline"===n?r=U.createPolyline([t],a.view.spatialReference,a._doUnnormalization):"polygon"===n&&(r=U.createPolygon([t],a.view.spatialReference,a._doUnnormalization,!0)),r?(a.createGraphic.geometry=r,u&&u.complete()):u&&u.cancel()}),i.on("undo",function(e){var t=e.vertices,r=s&&"cursor-update"!==s.type;a._resetCreateOperationGraphics(),a._snap(n,t,c),t.length&&a._drawVertexGraphics(n,t,{userClicked:r})}),i.on("redo",function(e){var t=e.vertices,r=s&&"cursor-update"!==s.type;a._resetCreateOperationGraphics(),a._snap(n,t,c),t.length&&a._drawVertexGraphics(n,t,{userClicked:r})})],r=[this.view.on("pointer-move",function(e){a.view.toMap(w.createScreenPoint(e.x,e.y))?a._displayCrosshairCursor():a._displayDefaultCursor()},M.ViewEventPriorities.WIDGET),this.view.on("key-down",function(e){var t=i.vertices.slice(0),r=s&&"cursor-update"!==s.type;e.key!==j.constraintKey||c||"2d"!==a.view.type?e.key===j.undoKey&&u&&u.canUndo()?(e.stopPropagation(),u.undo()):e.key===j.redoKey&&u&&u.canRedo()?(e.stopPropagation(),u.redo()):e.key===j.cancelKey&&u&&u.cancel():(c=!0,a._snap(n,t,!r),a._drawVertexGraphics(n,t,{userClicked:r}))},M.ViewEventPriorities.WIDGET),this.view.on("key-up",function(e){var t=i.vertices.slice(0),r=s&&"cursor-update"!==s.type;e.key===j.constraintKey&&c&&(r||(t.pop(),t.push([o.x,o.y]),a._drawVertexGraphics(n,t,{userClicked:r})),c=!1)},M.ViewEventPriorities.WIDGET)];if("polygon"===n){function p(e,t,r){if(!e||!e.layer||!e.visible)return!1;var i=a.view.toScreen(e.geometry);return a._isWithinScreenDistance(i,t,r)}function l(e){if(!(a._vertexGraphics.length<=2))return p(a._vertexGraphics[0],e,a._getVertexIntersectDistance())}var d=!1;r.push(this.view.on("pointer-move",function(e){d=!1;var t=l(e);a._highlightHandlesByGraphic.forEach(function(e){return t?e.pause():e.resume()})},M.ViewEventPriorities.WIDGET),this.view.on("pointer-down",function(t){if(l(t))return d=!0,void t.stopPropagation();a._vertexGraphics.some(function(e){return p(e,t,a._getVertexIntersectDistance())})&&t.stopPropagation()},M.ViewEventPriorities.WIDGET),this.view.on("pointer-up",function(e){d&&(e.stopPropagation(),i.complete())}))}var u=this._operationHandleForCreateAction(i,t.concat(r),n);return u},W.prototype._setupCreateCircleOperation=function(n,e){var a=this,t=this._draw.create(n,e),s=!1,c=!0,r=[t.on("vertex-add",function(e){var t=e.type,r=e.vertexIndex,i=e.vertices,o=i[r];a._drawSegmentGraphic(n,i,{centered:c,constrained:s}),a._emitCreateEvent({graphic:a.createGraphic,state:1===i.length?"start":"active",tool:n,toolEventInfo:{added:o,type:t}})}),t.on("cursor-update",function(e){var t=e.type,r=e.vertices;if(a._drawSegmentGraphic(n,r,{centered:c,constrained:s}),2===r.length){var i=r[r.length-1];a._emitCreateEvent({graphic:a.createGraphic,state:"active",tool:n,toolEventInfo:{coordinates:i,type:t}})}}),t.on("draw-complete",function(e){var t=e.vertices.slice(0),r=null,i=U.createViewAlignedCoordinateSystem(a.view,t[0]);r=1===t.length?(t.push([t[0][0]+a._defaultSegmentOffset*a.view.resolution,t[0][1]]),U.createCircle(t,i,!0)):s?U.createEllipse(t,i,c):U.createCircle(t,i,c),a.createGraphic?a.createGraphic.geometry=r:(a._removeCreateGraphic(),a._set("createGraphic",new I(r,a.polygonSymbol))),o&&o.complete()})],i=[this.view.on("pointer-move",function(e){a.view.toMap(w.createScreenPoint(e.x,e.y))?a._displayCrosshairCursor():a._displayDefaultCursor()},M.ViewEventPriorities.WIDGET),this.view.on("key-down",function(e){e.key!==j.constraintKey||s?e.key===j.centerKey&&c?(c=!1,a._drawSegmentGraphic(n,t.vertices,{centered:c,constrained:s})):e.key===j.cancelKey&&o&&o.cancel():(s=!0,a._drawSegmentGraphic(n,t.vertices,{centered:c,constrained:s}))},M.ViewEventPriorities.WIDGET),this.view.on("key-up",function(e){e.key===j.constraintKey?(s=!1,a._drawSegmentGraphic(n,t.vertices,{centered:c,constrained:s})):e.key===j.centerKey&&(c=!0,a._drawSegmentGraphic(n,t.vertices,{centered:c,constrained:s}))},M.ViewEventPriorities.WIDGET)],o=this._operationHandleForCreateAction(t,r.concat(i),n);return o},W.prototype._setupCreateRectangleOperation=function(n,e){var a=this,t=this._draw.create(n,e),s=!1,c=!1,r=[t.on("vertex-add",function(e){var t=e.type,r=e.vertexIndex,i=e.vertices,o=i[r];a._drawSegmentGraphic(n,i,{centered:c,constrained:s}),a._emitCreateEvent({graphic:a.createGraphic,state:1===i.length?"start":"active",tool:n,toolEventInfo:{added:o,type:t}})}),t.on("cursor-update",function(e){var t=e.type,r=e.vertices;if(a._drawSegmentGraphic(n,r,{centered:c,constrained:s}),2===r.length){var i=r[r.length-1];a._emitCreateEvent({graphic:a.createGraphic,state:"active",tool:n,toolEventInfo:{coordinates:i,type:t}})}}),t.on("draw-complete",function(e){var t,r=e.vertices.slice(0),i=U.createViewAlignedCoordinateSystem(a.view,r[0]);1===r.length&&(c=s=!1),t=s?U.createSquare(r,i,c):U.createRectangle(r,i,c),a.createGraphic?a.createGraphic.geometry=t:(a._removeCreateGraphic(),a._set("createGraphic",new I(t,a.polygonSymbol))),o&&o.complete()})],i=[this.view.on("pointer-move",function(e){a.view.toMap(w.createScreenPoint(e.x,e.y))?a._displayCrosshairCursor():a._displayDefaultCursor()},M.ViewEventPriorities.WIDGET),this.view.on("key-down",function(e){e.key!==j.constraintKey||s?e.key!==j.centerKey||c?e.key===j.cancelKey&&o&&o.cancel():(c=!0,a._drawSegmentGraphic(n,t.vertices,{centered:c,constrained:s})):(s=!0,a._drawSegmentGraphic(n,t.vertices,{centered:c,constrained:s}))},M.ViewEventPriorities.WIDGET),this.view.on("key-up",function(e){e.key===j.constraintKey?(s=!1,a._drawSegmentGraphic(n,t.vertices,{centered:c,constrained:s})):e.key===j.centerKey&&(c=!1,a._drawSegmentGraphic(n,t.vertices,{centered:c,constrained:s}))},M.ViewEventPriorities.WIDGET)],o=this._operationHandleForCreateAction(t,r.concat(i),n);return o},W.prototype._setupUpdateOperation=function(h,v){return m(this,void 0,void 0,function(){var t,r,i,o,n,a,s,c,p,l,d,u;return f(this,function(e){for(r=(t=this)._defaultUpdateTool,i=t.defaultUpdateOptions,o=t.layer,n=t.view,a=y({},i,v),s=a.tool||r,c=0,p=h;c<p.length;c++)d=p[c],o.remove(d),o.add(d);if("3d"===n.type){if(0===h.length)return[2,null];switch(s){case"move":return[2,this._setupMove3DOperation(h,a,n,s)];case"reshape":return 1<h.length?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),[2,null]):0===(l=b.isSupportedGraphic(h[0]))?[2,this._setupReshape3DOperation(h[0],a,n)]:(this._logError("sketch:reshape","Reshape operation not supported for provided graphic(s) ("+G.isSupportedGraphicResultMessage(l)+")."),[2,null]);case"transform":return 1===h.length&&0===S.isSupportedGraphic(h[0])?[2,this._setupPointTransform3DOperation(h[0],a,n)]:[2,this._setupMove3DOperation(h,a,n,s)]}return[2,null]}if("move"===s)return[2,this._setupMoveOperation(h,a,n)];if(1<h.length)return"reshape"===s?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),[2,null]):[2,this._setupTransformOrReshapeOperation(h,s,a,n)];if(1===h.length){if(d=h[0],"point"===(u=_.get(d.geometry,"type"))||"multipoint"===u)return[2,this._setupMoveOperation(h,a,n)];if("transform"===s||"reshape"===s)return[2,this._setupTransformOrReshapeOperation(h,s,a,n)]}return[2,null]})})},W.prototype._setupMove3DOperation=function(l,d,u,h,v){return void 0===v&&(v=!1),m(this,void 0,void 0,function(){var t,r,i,o,n,a,s,c,p=this;return f(this,function(e){switch(e.label){case 0:for(t=0,r=l;t<r.length;t++)if(i=r[t],0!==(o=P.isSupportedGraphic(i)))return this._logError("sketch:move","Move operation not supported for provided graphic(s) ("+G.isSupportedGraphicResultMessage(o)+")."),[2,null];return[4,this._requireModule(new Promise(function(t,e){Promise.all([q.e(6),q.e(7),q.e(9)]).then(function(){var e=[q(1851)];t.apply(null,e)}.bind(this)).catch(e.bind(this))}))];case 1:return D(n=e.sent())?[2,n]:(a=new n.module.GraphicMove3DTool({view:u}),this.view.tools.add(a),a.graphics.addMany(l),v||this.updateGraphics.addMany(l),s=[],c=new C.OperationHandle({activeComponent:a,tool:h,type:"update",onEnd:function(){s.forEach(function(e){return e.remove()}),s.length=0,p.view.tools.remove(a),a.destroy()},undo:function(){H(c,p.updateGraphics.toArray()),p._emitUndoEvent({graphics:p.updateGraphics.toArray(),tool:h})},redo:function(){A(c,p.updateGraphics.toArray()),p._emitRedoEvent({graphics:p.updateGraphics.toArray(),tool:h})},addToSelection:function(e){p.updateGraphics.push(e),a.graphics.push(e),p._emitUpdateEvent({graphics:p.updateGraphics.toArray(),state:"active",tool:p.activeTool,toolEventInfo:{added:[e],type:"selection-change"}})},removeFromSelection:function(e){var t=p.updateGraphics.indexOf(e);c.history.undo.forEach(function(e){return e.updates.splice(t,1)}),c.history.redo.forEach(function(e){return e.updates.splice(t,1)}),p.updateGraphics.remove(e),0!==p.updateGraphics.length?a.graphics.remove(e):R(c)},toggleTool:function(){return m(p,void 0,void 0,function(){var t,r;return f(this,function(e){switch(e.label){case 0:return 1!==this.updateGraphics.length||!1===d.toggleToolOnClick||"transform"!==h?[2]:(t=this.updateGraphics.getItemAt(0),0!==b.isSupportedGraphic(t)?[2]:[4,this._setupReshape3DOperation(t,d,u,!0)]);case 1:return D(r=e.sent())||(c.onEnd(),c.destroy(),this._setUpdateOperationHandle(r)),[2]}})})}}),s.push.apply(s,this._getHandlesForComponent(c,d).concat([this.view.on("immediate-click",function(e){return p._getCommonUpdateOperationClickHandlers(c,e)},M.ViewEventPriorities.WIDGET),this.view.on("key-down",function(e){return p._getCommonUpdateOperationKeyDownHandlers(c,e)},M.ViewEventPriorities.WIDGET)])),[2,c])}})})},W.prototype._setupPointTransform3DOperation=function(p,l,d){return m(this,void 0,void 0,function(){var t,r,i,o,n,a,s,c=this;return f(this,function(e){switch(e.label){case 0:return t="transform",r=l.enableRotation,i=l.enableScaling,[4,this._requireModule(new Promise(function(t,e){Promise.all([q.e(6),q.e(7),q.e(9)]).then(function(){var e=[q(1851)];t.apply(null,e)}.bind(this)).catch(e.bind(this))}))];case 1:return D(o=e.sent())?[2,o]:(n=new o.module.GraphicTransform3DTool({graphic:p,view:d,enableRotation:r,enableScaling:i}),this.view.tools.add(n),this.updateGraphics.add(p),a=[],s=new C.OperationHandle({activeComponent:n,tool:t,type:"update",onEnd:function(){a.forEach(function(e){return e.remove()}),a.length=0,c.view.tools.remove(n),n.destroy()},undo:function(){H(s,c.updateGraphics.toArray()),c._emitUndoEvent({graphics:c.updateGraphics.toArray(),tool:t})},redo:function(){A(s,c.updateGraphics.toArray()),c._emitRedoEvent({graphics:c.updateGraphics.toArray(),tool:t})},addToSelection:function(r){return m(c,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return this.updateGraphics.add(r),[4,this._setupMove3DOperation(this.updateGraphics.toArray(),l,d,"transform",!0)];case 1:return D(t=e.sent())||(s.onEnd(),s.destroy(),this._setUpdateOperationHandle(t)),[2]}})})}}),a.push.apply(a,this._getHandlesForComponent(s,l).concat([this.view.on("immediate-click",function(e){return c._getCommonUpdateOperationClickHandlers(s,e)},M.ViewEventPriorities.WIDGET),this.view.on("key-down",function(e){return c._getCommonUpdateOperationKeyDownHandlers(s,e)},M.ViewEventPriorities.WIDGET)])),[2,s])}})})},W.prototype._setupMoveOperation=function(c,p,l){return m(this,void 0,void 0,function(){var i,t,o,n,r,a,s=this;return f(this,function(e){switch(e.label){case 0:return i=[],t="move",c.forEach(function(e){i.push(new I(e.geometry,e.symbol,e.attributes)),e.symbol=s._getUpdateSymbol(e.geometry)}),this.updateGraphics.addMany(c),[4,this._getGraphicMover(c,p,l)];case 1:return D(o=e.sent())?[2,o]:(n=new C.OperationHandle({activeComponent:o,tool:t,type:"update",onEnd:function(){a.forEach(function(e){return e.remove()}),r.forEach(function(e){return e.remove()}),a=[],r=[],o.destroy(),s._internalGraphicsLayer&&s._internalGraphicsLayer.removeMany(s.updateGraphics.toArray()),s.updateGraphics.forEach(function(e,t){e.symbol=i[t].symbol})},undo:function(){H(n,s.updateGraphics.toArray()),s._emitUndoEvent({graphics:s.updateGraphics.toArray(),tool:t})},redo:function(){A(n,s.updateGraphics.toArray()),s._emitRedoEvent({graphics:s.updateGraphics.toArray(),tool:t})},addToSelection:function(e){i.push(new I(e.geometry,e.symbol,e.attributes)),e.symbol=s._getUpdateSymbol(e.geometry),s.updateGraphics.push(e),o.graphics=s.updateGraphics.toArray(),s._emitUpdateEvent({graphics:s.updateGraphics.toArray(),state:"active",tool:s.activeTool,toolEventInfo:{added:[e],type:"selection-change"}})},removeFromSelection:function(e){var t=s.updateGraphics.indexOf(e);n.history.undo.forEach(function(e){return e.updates.splice(t,1)}),n.history.redo.forEach(function(e){return e.updates.splice(t,1)});var r=i.splice(t,1)[0];e.symbol=r.symbol,s.updateGraphics.remove(e),0!==s.updateGraphics.length?o.graphics=s.updateGraphics.toArray():R(n)}}),r=[l.on("immediate-click",function(e){return s._getCommonUpdateOperationClickHandlers(n,e,p)},M.ViewEventPriorities.WIDGET),l.on("key-down",function(e){s._getCommonUpdateOperationKeyDownHandlers(n,e),e.key!==j.constraintKey||e.repeat||(o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},M.ViewEventPriorities.WIDGET),l.on("key-up",function(e){e.key===j.constraintKey&&(o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},M.ViewEventPriorities.WIDGET)],a=this._getHandlesForComponent(n,p),[2,n])}})})},W.prototype._setupReshape3DOperation=function(s,c,p,l){return void 0===l&&(l=!1),m(this,void 0,void 0,function(){var t,r,i,o,n,a=this;return f(this,function(e){switch(e.label){case 0:return t="reshape",[4,this._requireModule(new Promise(function(t,e){Promise.all([q.e(6),q.e(7),q.e(9)]).then(function(){var e=[q(1851)];t.apply(null,e)}.bind(this)).catch(e.bind(this))}))];case 1:return D(r=e.sent())?[2,r]:(i=new r.module.GraphicReshape3DTool({view:p,graphic:s}),p.tools.add(i),l||this.updateGraphics.add(s),o=[],n=new C.OperationHandle({activeComponent:i,tool:t,type:"update",onEnd:function(){o.forEach(function(e){return e.remove()}),o.length=0,p.tools.remove(i),i.destroy()},undo:function(){H(n,a.updateGraphics.toArray()),a._emitUndoEvent({graphics:a.updateGraphics.toArray(),tool:t})},redo:function(){A(n,a.updateGraphics.toArray()),a._emitRedoEvent({graphics:a.updateGraphics.toArray(),tool:t})},addToSelection:function(r){return m(a,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return this.updateGraphics.add(r),[4,this._setupMove3DOperation(this.updateGraphics.toArray(),c,p,"transform",!0)];case 1:return D(t=e.sent())||(n.onEnd(),n.destroy(),this._setUpdateOperationHandle(t)),[2]}})})},toggleTool:function(){return m(a,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return!1===c.toggleToolOnClick?[2]:[4,this._setupMove3DOperation(this.updateGraphics.toArray(),c,p,"transform",!0)];case 1:return D(t=e.sent())||(n.onEnd(),n.destroy(),this._setUpdateOperationHandle(t)),[2]}})})}}),o.push.apply(o,this._getHandlesForComponent(n,c).concat([p.on("immediate-click",function(e){return a._getCommonUpdateOperationClickHandlers(n,e)},M.ViewEventPriorities.WIDGET),p.on("key-down",function(e){return a._getCommonUpdateOperationKeyDownHandlers(n,e)},M.ViewEventPriorities.WIDGET)])),[2,n])}})})},W.prototype._setupTransformOrReshapeOperation=function(u,h,v,y){return m(this,void 0,void 0,function(){var t,n,r,a,o,i,s,c,p,l,d=this;return f(this,function(e){switch(e.label){case 0:return t=v.multipleSelectionEnabled,n=void 0===t||t,r=v.toggleToolOnClick,a=void 0===r||r,o=[],u.forEach(function(e){o.push(new I(e.geometry,e.symbol,e.attributes)),e.symbol=d._getUpdateSymbol(e.geometry)}),this.updateGraphics.addMany(u),"transform"!==h?[3,2]:[4,this._getBox(u,v,y)];case 1:return s=e.sent(),[3,4];case 2:return[4,this._getReshape(u,v,y)];case 3:s=e.sent(),e.label=4;case 4:return D(i=s)?[2,i]:(c=new C.OperationHandle({activeComponent:i,type:"update",onEnd:function(){l.forEach(function(e){return e.remove()}),p.forEach(function(e){return e.remove()}),l=[],p=[],c.activeComponent&&!c.activeComponent.destroyed&&c.activeComponent.destroy(),d._internalGraphicsLayer.removeMany(d.updateGraphics.toArray()),d.updateGraphics.forEach(function(e,t){o[t]&&o[t].symbol&&(e.symbol=o[t].symbol)})},undo:function(){H(c,d.updateGraphics.toArray()),c.refreshComponent(),d._emitUndoEvent({graphics:d.updateGraphics.toArray(),tool:c.tool})},redo:function(){A(c,d.updateGraphics.toArray()),c.refreshComponent(),d._emitRedoEvent({graphics:d.updateGraphics.toArray(),tool:c.tool})},addToSelection:function(e){var t=c.activeComponent;o.push(new I(e.geometry,e.symbol,e.attributes)),e.symbol=d._getUpdateSymbol(e.geometry),d.updateGraphics.add(e),t.graphics=d.updateGraphics.toArray(),t.refresh(),c.resetHistory(),d._emitUpdateEvent({graphics:d.updateGraphics.toArray(),state:"active",tool:d.activeTool,toolEventInfo:{added:[e],type:"selection-change"}})},removeFromSelection:function(e){var t=c.activeComponent,r=d.updateGraphics.indexOf(e);c.history.undo.forEach(function(e){return e.updates.splice(r,1)}),c.history.redo.forEach(function(e){return e.updates.splice(r,1)});var i=o.splice(r,1)[0];e.symbol=i.symbol,d.updateGraphics.remove(e),0!==d.updateGraphics.length?t.graphics=d.updateGraphics.toArray():R(c)},toggleTool:function(){return m(d,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return 1<this.updateGraphics.length?[2]:(t=null,"transform"!==c.tool?[3,2]:[4,this._getReshape(u,v,y)]);case 1:return t=e.sent(),[3,4];case 2:return"reshape"!==c.tool?[3,4]:[4,this._getBox(u,v,y)];case 3:t=e.sent(),e.label=4;case 4:return D(t)||(c.activeComponent.destroy(),c.activeComponent=t,c.activeComponent&&(l.forEach(function(e){return e.remove()}),l=this._getHandlesForComponent(c,v))),[2]}})})}}),p=[y.on("immediate-click",function(r){d._getFirstHit(w.createScreenPointFromEvent(r)).then(function(e){if(c){var t=e.results;if(!t.length)return void R(c);var i=c.activeComponent,o=r.native&&r.native.shiftKey;t.some(function(e){if(e.graphic){var t=e.graphic;if(n&&o&&i&&"box"===i.type&&!i.isUIGraphic(t))return c.addToSelection(t),!0;if(i&&"box"===i.type&&i.isUIGraphic(t)){if(!1!==a&&1===d.updateGraphics.length){var r=d.updateGraphics.getItemAt(0).geometry;"extent"===_.get(r,"type")?d._logError("sketch:reshape-extent","Reshape operation does not support graphics with geometry of type 'extent'."):c.toggleTool()}return!0}if(i&&"reshape"===i.type){if(t===i.graphic)return!1!==a&&c.toggleTool(),!0;if(i.isUIGraphic(t))return!0;if(t.layer===d._internalGraphicsLayer)return!0}else t.layer===d.layer&&R(c)}return!1})&&r.stopPropagation()}})},M.ViewEventPriorities.WIDGET),y.on("key-down",function(e){if(d._getCommonUpdateOperationKeyDownHandlers(c,e),e.key===j.constraintKey&&!e.repeat&&c){var t=c.activeComponent;t&&"box"===t.type&&(t.preserveAspectRatio=!t.preserveAspectRatio)}},M.ViewEventPriorities.WIDGET),y.on("key-up",function(e){if(e.key===j.constraintKey&&c){var t=c.activeComponent;t&&"box"===t.type&&(t.preserveAspectRatio=!t.preserveAspectRatio)}},M.ViewEventPriorities.WIDGET)],l=this._getHandlesForComponent(c,v),[2,c])}})})},W.prototype._getGraphicMover=function(n,a,s){return m(this,void 0,void 0,function(){var t,r,i,o=this;return f(this,function(e){switch(e.label){case 0:return t=a.enableMoveAllGraphics,r=void 0===t||t,[4,this._requireModule(new Promise(function(t,e){q.e(78).then(function(){var e=[q(1746)];t.apply(null,e)}.bind(this)).catch(e.bind(this))}))];case 1:return D(i=e.sent())?[2,i]:[2,new i.module({enableMoveAllGraphics:r,graphics:n,view:s,callbacks:{onGraphicMoveStart:function(e){var t=e.dx,r=e.dy,i=e.graphic;return o._emitUpdateEvent({graphics:o.updateGraphics.toArray(),state:"active",tool:o.activeTool,toolEventInfo:{dx:t,dy:r,mover:i,type:"move-start"}})},onGraphicMove:function(e){var t=e.dx,r=e.dy,i=e.graphic;return o._emitUpdateEvent({graphics:o.updateGraphics.toArray(),state:"active",tool:o.activeTool,toolEventInfo:{dx:t,dy:r,mover:i,type:"move"}})},onGraphicMoveStop:function(e){var t=e.dx,r=e.dy,i=e.graphic;return o._emitUpdateEvent({graphics:o.updateGraphics.toArray(),state:"active",tool:o.activeTool,toolEventInfo:{dx:t,dy:r,mover:i,type:"move-stop"}})},onGraphicPointerOver:function(){return o._displayDefaultCursor()},onGraphicPointerOut:function(){return o._displayDefaultCursor()}}})]}})})},W.prototype._getBox=function(p,l,d){return m(this,void 0,void 0,function(){var t,r,i,o,n,a,s,c=this;return f(this,function(e){switch(e.label){case 0:return t=l.enableRotation,r=void 0===t||t,i=l.enableScaling,o=void 0===i||i,n=l.preserveAspectRatio,a=void 0!==n&&n,[4,this._requireModule(new Promise(function(t,e){q.e(72).then(function(){var e=[q(2761)];t.apply(null,e)}.bind(this)).catch(e.bind(this))}))];case 1:return D(s=e.sent())?[2,s]:[2,new s.module({graphics:p,enableRotation:r,enableScaling:o,preserveAspectRatio:a,layer:this._internalGraphicsLayer,view:d,callbacks:{onMoveStart:function(e){return c._emitUpdateEvent({graphics:c.updateGraphics.toArray(),state:"active",tool:c.activeTool,toolEventInfo:y({},e)})},onMove:function(e){return c._emitUpdateEvent({graphics:c.updateGraphics.toArray(),state:"active",tool:c.activeTool,toolEventInfo:y({},e)})},onMoveStop:function(e){return c._emitUpdateEvent({graphics:c.updateGraphics.toArray(),state:"active",tool:c.activeTool,toolEventInfo:y({},e)})},onScaleStart:function(e){return c._emitUpdateEvent({graphics:c.updateGraphics.toArray(),state:"active",tool:c.activeTool,toolEventInfo:y({},e)})},onScale:function(e){return c._emitUpdateEvent({graphics:c.updateGraphics.toArray(),state:"active",tool:c.activeTool,toolEventInfo:y({},e)})},onScaleStop:function(e){return c._emitUpdateEvent({graphics:c.updateGraphics.toArray(),state:"active",tool:c.activeTool,toolEventInfo:y({},e)})},onRotateStart:function(e){return c._emitUpdateEvent({graphics:c.updateGraphics.toArray(),state:"active",tool:c.activeTool,toolEventInfo:y({},e)})},onRotate:function(e){return c._emitUpdateEvent({graphics:c.updateGraphics.toArray(),state:"active",tool:c.activeTool,toolEventInfo:y({},e)})},onRotateStop:function(e){return c._emitUpdateEvent({graphics:c.updateGraphics.toArray(),state:"active",tool:c.activeTool,toolEventInfo:y({},e)})}}})]}})})},W.prototype._getReshape=function(o,a,s){return m(this,void 0,void 0,function(){var t,r,i,n=this;return f(this,function(e){switch(e.label){case 0:return t=a.enableMidpoints,r=void 0===t||t,[4,this._requireModule(new Promise(function(t,e){q.e(73).then(function(){var e=[q(2762)];t.apply(null,e)}.bind(this)).catch(e.bind(this))}))];case 1:return D(i=e.sent())?[2,i]:[2,new i.module({enableMidpoints:r,graphic:o[0],layer:this._internalGraphicsLayer,view:s,callbacks:{onReshapeStart:function(e){return n._emitUpdateEvent({graphics:n.updateGraphics.toArray(),state:"active",tool:n.activeTool,toolEventInfo:y({},e)})},onReshape:function(e){return n._emitUpdateEvent({graphics:n.updateGraphics.toArray(),state:"active",tool:n.activeTool,toolEventInfo:y({},e)})},onReshapeStop:function(e){var t=e.mover,r=e.type;return n._emitUpdateEvent({graphics:n.updateGraphics.toArray(),state:"active",tool:n.activeTool,toolEventInfo:{mover:t,type:r}})},onMoveStart:function(e){var t=e.dx,r=e.dy,i=e.mover,o=e.type;return n._emitUpdateEvent({graphics:n.updateGraphics.toArray(),state:"active",tool:n.activeTool,toolEventInfo:{dx:t,dy:r,mover:i,type:o}})},onMove:function(e){var t=e.dx,r=e.dy,i=e.mover,o=e.type;return n._emitUpdateEvent({graphics:n.updateGraphics.toArray(),state:"active",tool:n.activeTool,toolEventInfo:{dx:t,dy:r,mover:i,type:o}})},onMoveStop:function(e){var t=e.dx,r=e.dy,i=e.mover,o=e.type;return n._emitUpdateEvent({graphics:n.updateGraphics.toArray(),state:"active",tool:n.activeTool,toolEventInfo:{dx:t,dy:r,mover:i,type:o}})},onVertexAdd:function(e){var t=e.added,r=e.type,i=t.map(function(e){return h.geometryToCoordinates(e.geometry)});n._emitUpdateEvent({graphics:n.updateGraphics.toArray(),state:"active",tool:n.activeTool,toolEventInfo:{added:i,type:r}})},onVertexRemove:function(e){var t=e.removed,r=e.type,i=t.map(function(e){return h.geometryToCoordinates(e.geometry)});n._emitUpdateEvent({graphics:n.updateGraphics.toArray(),state:"active",tool:n.activeTool,toolEventInfo:{removed:i,type:r}})}}})]}})})},W.prototype._getHandlesForComponent=function(t,r){var i=this,e=t.activeComponent;switch(e.type){case"graphic-mover":return[e.on("graphic-move-start",function(e){return t.addToHistory(k(e.allGraphics))})];case"box":return[e.on("move-start",function(e){return t.addToHistory(k(e.graphics))}),e.on("rotate-start",function(e){return t.addToHistory(k(e.graphics))}),e.on("scale-start",function(e){return t.addToHistory(k(e.graphics))})];case"reshape":return[e.on("move-start",function(e){return t.addToHistory(k([e.mover]))}),e.on("reshape-start",function(e){return t.addToHistory(k([e.graphic]))}),e.on("vertex-add",function(e){return t.addToHistory(k([e.oldGraphic]))}),e.on("vertex-remove",function(e){return t.addToHistory(k([e.oldGraphic]))})];case"move-3d":return[e.on("graphic-move-start",function(e){t.addToHistory(k(e.allGraphics)),i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:{dx:0,dy:0,mover:0<e.allGraphics.length?e.allGraphics[0]:null,type:"move-start"}})}),e.on("graphic-move",function(e){i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:0<e.allGraphics.length?e.allGraphics[0]:null,type:"move"}})}),e.on("graphic-move-stop",function(e){i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:{dx:0,dy:0,mover:0<e.allGraphics.length?e.allGraphics[0]:null,type:"move-stop"}})}),e.on("immediate-click",function(e){e.shiftKey?i._toggleSelection([e.graphic],t,r):t.toggleTool()})];case"transform-3d":return[e.on("graphic-translate-start",function(e){t.addToHistory(k([e.graphic])),i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:{mover:e.graphic,dx:0,dy:0,type:"move-start"}})}),e.on("graphic-translate-stop",function(e){i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:{mover:e.graphic,dx:0,dy:0,type:"move-stop"}})}),e.on("graphic-rotate-start",function(e){t.addToHistory(L([e.graphic])),i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:{mover:e.graphic,angle:0,type:"rotate-start"}})}),e.on("graphic-rotate-stop",function(e){i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:{mover:e.graphic,angle:0,type:"rotate-stop"}})}),e.on("graphic-scale-start",function(e){t.addToHistory(L([e.graphic])),i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:{mover:e.graphic,xScale:1,yScale:1,type:"scale-start"}})}),e.on("graphic-scale-stop",function(e){i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:{mover:e.graphic,xScale:1,yScale:1,type:"scale-stop"}})}),e.on("graphic-translate",function(e){i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dx,dy:e.dy,type:"move"}})}),e.on("graphic-rotate",function(e){i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate"}})}),e.on("graphic-scale",function(e){i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.scale,yScale:e.scale,type:"scale"}})})];case"reshape-3d":return[e.on("reshape",function(e){"reshape-start"===e.type&&t.addToHistory(k([e.mover])),i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:e})}),e.on("move",function(e){"move-start"===e.type&&t.addToHistory(k([e.mover])),i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:e})}),e.on("vertex-add",function(e){i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:e})}),e.on("vertex-remove",function(e){i._emitUpdateEvent({graphics:i.updateGraphics.toArray(),state:"active",tool:i.activeTool,toolEventInfo:e})}),e.on("immediate-click",function(){return t.toggleTool()})];case"draw":return null;default:return void a.neverReached(e)}},W.prototype._setUpdateOperationHandle=function(i){var o=this;this._operationHandle=i;var e=this.view,n=e.map,a=e.popup,s=!0;function t(){if(i===o._operationHandle){var e=i.cancelled?"cancel":"complete",t=o.updateGraphics.toArray(),r=o._operationHandle.tool;o._operationHandle.destroy(),o._operationHandle=null,o._internalGraphicsLayer.removeMany(o.updateGraphics.toArray()),o.updateGraphics.removeAll(),n&&n.remove(o._internalGraphicsLayer),a&&(a.autoOpenEnabled=s),o._emitUpdateEvent({graphics:t,state:e,tool:r,toolEventInfo:null})}}a&&(s=a.autoOpenEnabled,a.autoOpenEnabled=!1),i.on("complete",t),i.on("cancel",t)},W.prototype._getCommonUpdateOperationClickHandlers=function(r,i,o){var n=this,e=w.createScreenPointFromEvent(i);this._getFirstHit(e).then(function(e){var t=e.results;return t.length?i.native.shiftKey&&n._toggleSelection(t.map(function(e){return e.graphic}),r,o)?void i.stopPropagation():void(t.some(function(e){return e.graphic&&-1<n.updateGraphics.indexOf(e.graphic)})?i.stopPropagation():R(r)):void R(r)})},W.prototype._toggleSelection=function(e,t,r){var i=this,o=!r||!!r.multipleSelectionEnabled;return e.some(function(e){return!(null==e||!o||e.layer!==i.layer||(-1===i.updateGraphics.indexOf(e)?t.addToSelection(e):t.removeFromSelection(e),0))})},W.prototype._getCommonUpdateOperationKeyDownHandlers=function(e,t){if(e){var r=t.key;r===j.undoKey&&e.canUndo()?(t.stopPropagation(),e.undo()):r===j.redoKey&&e.canRedo()?(t.stopPropagation(),e.redo()):r===j.cancelKey?R(e):0<=j.deleteKeys.indexOf(r)&&this._onDeleteKey()}},W.prototype._onDeleteKey=function(){if(this._operationHandle&&"update"===this._operationHandle.type){var e=this.activeComponent;if(e&&"reshape"!==e.type&&"reshape-3d"!==e.type){var t=this.updateGraphics.toArray();this.layer.removeMany(t),this._emitDeleteEvent({graphics:t,tool:this.activeTool})}}},W.prototype._getCreateSymbol=function(e,t){void 0===t&&(t=!1);var r="3d"!==this.view.type&&t;switch(e.type){case"point":case"multipoint":return r?this.activePointSymbol:this.pointSymbol;case"polyline":return r?this.activeLineSymbol:this.polylineSymbol;case"polygon":return r?this.activeFillSymbol:this.polygonSymbol}return null},W.prototype._getUpdateSymbol=function(e){if(_.isNone(e))return null;switch(e.type){case"point":case"multipoint":return this.updatePointSymbol;case"polyline":return this.updatePolylineSymbol;case"polygon":case"extent":return this.updatePolygonSymbol}return null},W.prototype._drawMultipointGraphic=function(e,t){var r=null;if(!t&&1<e.length){var i=e.slice(0);i.pop(),r=U.createMultipoint(i,this.view.spatialReference)}else r=U.createMultipoint(e,this.view.spatialReference);this.createGraphic?this.createGraphic.geometry=r:this._set("createGraphic",new I(r,this.pointSymbol)),t&&1===e.length&&this._internalGraphicsLayer.add(this.createGraphic)},W.prototype._drawVertexGraphics=function(e,t,r){var i=!(!r||!r.userClicked),o="polygon"===e,n=o?this.polygonSymbol:this.polylineSymbol;if(1===t.length){this._removeLineGraphic(),this._removeActiveLineGraphic();var a=t[0],s=a[0],c=a[1],p=new T.Point(s,c,this.view.spatialReference),l=o?U.createPolygon([t],this.view.spatialReference,this._doUnnormalization,!0):U.createPolyline([t],this.view.spatialReference,this._doUnnormalization);this._vertexGraphics.length?this._vertexGraphics[0].geometry=p:this._vertexGraphics.push(new I(p,this.activeVertexSymbol)),this.createGraphic?this.createGraphic.geometry=l:this._set("createGraphic",new I(l,n)),i&&this._internalGraphicsLayer.add(this._vertexGraphics[0])}else if(2===t.length){var d=t[1],u=(s=d[0],c=d[1],new T.Point(s,c,this.view.spatialReference)),h=this.vertexSymbol,v=U.createPolyline([t],this.view.spatialReference,this._doUnnormalization);if(l=o?U.createPolygon([t],this.view.spatialReference,this._doUnnormalization,!0):U.createPolyline([t],this.view.spatialReference,this._doUnnormalization),!this._vertexGraphics.length){var y=t[0],f=y[0],m=y[1],_=(p=new T.Point(f,m,this.view.spatialReference),new I(p,h));this._vertexGraphics.push(_)}if(1===this._vertexGraphics.length){var w=this._vertexGraphics[0],g=new I(u,h);this._removeLineGraphic(),this._removeActiveFillGraphic(),this._vertexGraphics.push(g),this._internalGraphicsLayer.remove(w),this._internalGraphicsLayer.add(w)}else this._vertexGraphics[1].geometry=u;this._showActiveLineGraphic(v);var x=this._vertexGraphics[0];i&&(this._activeLineGraphic.symbol=this.polylineSymbol,x.symbol=this.vertexSymbol,this._internalGraphicsLayer.add(this._vertexGraphics[1])),this.createGraphic?this.createGraphic.geometry=l:this._set("createGraphic",new I(l,this.polygonSymbol)),this._internalGraphicsLayer.remove(x),this._internalGraphicsLayer.add(x)}else if(2<t.length){l=o?U.createPolygon([t],this.view.spatialReference,this._doUnnormalization,!0):U.createPolyline([t],this.view.spatialReference,this._doUnnormalization),"polygon"===e&&this._showFillGraphic(l);var E=t.map(function(e){return[e[0],e[1]]}),G=E.pop(),P=[E[E.length-1],G],b=U.createPolyline([E],this.view.spatialReference,this._doUnnormalization),S=U.createPolyline([P],this.view.spatialReference,this._doUnnormalization);this._showLineGraphic(b),this._showActiveLineGraphic(S);for(var V=0;V<E.length;V++){var O=this._vertexGraphics[V];if(O)i||V!==this._vertexGraphics.length-1?O.symbol=this.vertexSymbol:O.symbol=this.activeVertexSymbol;else{var M=t[V];s=M[0],c=M[1],this._showVertexGraphic(new T.Point(s,c,this.view.spatialReference))}}if(i){this._activeLineGraphic.symbol=this.polylineSymbol;var C=t[t.length-1];s=C[0],c=C[1],this._showVertexGraphic(new T.Point(s,c,this.view.spatialReference))}else this._activeLineGraphic.symbol=this.activeLineSymbol;this.createGraphic?this.createGraphic.geometry=l:(this._removeCreateGraphic(),this._set("createGraphic",new I(l,n)));for(var H=0,A=this._vertexGraphics;H<A.length;H++)_=A[H],this._internalGraphicsLayer.remove(_),this._internalGraphicsLayer.add(_)}},W.prototype._drawSegmentGraphic=function(e,t,r){if(t.length){var i=U.createViewAlignedCoordinateSystem(this.view,t[0]),o=!(!r||!r.centered),n=!(!r||!r.constrained),a=null;if(1===t.length?this._removeCenterIndicatorGraphic():("rectangle"===e?a=n?U.createSquare(t,i,o):U.createRectangle(t,i,o):"circle"===e&&(a=n?U.createEllipse(t,i,o):U.createCircle(t,i,o)),a.extent&&a.extent.center&&this._showCenterIndicatorGraphic(a.extent.center)),!a)return void this._removeCreateGraphic();this.createGraphic?this.createGraphic.geometry=a:(this._removeCreateGraphic(),this._set("createGraphic",new I(a,this.polygonSymbol)),this._internalGraphicsLayer.add(this.createGraphic))}},W.prototype._showCenterIndicatorGraphic=function(e){this._centerIndicatorGraphic?this._centerIndicatorGraphic.geometry=e:(this._centerIndicatorGraphic=new I(e,this._centerSymbol),this._internalGraphicsLayer.add(this._centerIndicatorGraphic))},W.prototype._removeCenterIndicatorGraphic=function(){this._centerIndicatorGraphic&&(this._internalGraphicsLayer.remove(this._centerIndicatorGraphic),this._centerIndicatorGraphic.destroy(),this._centerIndicatorGraphic=null)},W.prototype._showActiveLineGraphic=function(e){this._activeLineGraphic?this._activeLineGraphic.geometry=e:(this._activeLineGraphic=new I(e,this.activeLineSymbol),this._internalGraphicsLayer.graphics.add(this._activeLineGraphic,0))},W.prototype._showFillGraphic=function(e){this._activeFillGraphic?this._activeFillGraphic.geometry=e:(this._activeFillGraphic=new I(e,this._getCreateSymbol(e,!0)),this._internalGraphicsLayer.add(this._activeFillGraphic))},W.prototype._showLineGraphic=function(e){this._lineGraphic?this._lineGraphic.geometry=e:(this._lineGraphic=new I(e,this.polylineSymbol),this._internalGraphicsLayer.graphics.add(this._lineGraphic,0))},W.prototype._showVertexGraphic=function(e,t){var r=t?this.activeVertexSymbol:this.vertexSymbol,i=new I(e,r);this._vertexGraphics.push(i),this._internalGraphicsLayer.add(i)},W.prototype._resetCreateOperationGraphics=function(){this._removeActiveFillGraphic(),this._removeLineGraphic(),this._removeActiveLineGraphic(),this._removeVertexGraphics()},W.prototype._removeCreateGraphic=function(){this.createGraphic&&(this._internalGraphicsLayer.remove(this.createGraphic),this._set("createGraphic",null))},W.prototype._removeCreateOperationGraphics=function(){this._removeCenterIndicatorGraphic(),this._removeActiveLineGraphic(),this._removeActiveFillGraphic(),this._removeLineGraphic(),this._removeVertexGraphics()},W.prototype._removeActiveLineGraphic=function(){this._activeLineGraphic&&(this._internalGraphicsLayer.remove(this._activeLineGraphic),this._activeLineGraphic.destroy(),this._activeLineGraphic=null)},W.prototype._removeActiveFillGraphic=function(){this._activeFillGraphic&&(this._internalGraphicsLayer.remove(this._activeFillGraphic),this._activeFillGraphic.destroy(),this._activeFillGraphic=null)},W.prototype._removeLineGraphic=function(){this._lineGraphic&&(this._internalGraphicsLayer.remove(this._lineGraphic),this._lineGraphic.destroy(),this._lineGraphic=null)},W.prototype._removeVertexGraphics=function(){this._vertexGraphics.length&&(this._internalGraphicsLayer.removeMany(this._vertexGraphics),this._vertexGraphics.forEach(function(e){return e.destroy()}),this._vertexGraphics=[])},W.prototype._removeDefaultLayer=function(){this._internalGraphicsLayer&&(this.view&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer.destroy(),this._internalGraphicsLayer=null)},W.prototype._operationHandleForCreateAction=function(e,t,r){var i=this;return new C.OperationHandle({activeComponent:this._draw,tool:r,type:"create",onEnd:function(){t.forEach(function(e){return e.remove()}),t.length=0,i._removeCreateOperationGraphics(),i._internalGraphicsLayer&&i._internalGraphicsLayer.remove(i.createGraphic),i._displayDefaultCursor()},undo:function(){e.undo(),i._emitUndoEvent({graphics:[i.createGraphic],tool:r})},redo:function(){e.redo(),i._emitRedoEvent({graphics:[i.createGraphic],tool:r})},canUndo:function(){return e&&e.canUndo()},canRedo:function(){return e&&e.canRedo()}})},W.prototype._snap=function(e,t,r){r&&this._snapLastVertexToAxis(t),"polygon"===e&&this._snapLastPolygonVertexToFirst(t)},W.prototype._snapLastPolygonVertexToFirst=function(e){if(!(e.length<=2)){var t=e[0],r=e[e.length-1],i=this.view.toScreen(new T.Point(t[0],t[1],this.view.spatialReference)),o=this.view.toScreen(new T.Point(r[0],r[1],this.view.spatialReference));this._isWithinScreenDistance(i,o,this._getVertexIntersectDistance())&&(r[0]=t[0],r[1]=t[1])}},W.prototype._getVertexIntersectDistance=function(){return this.vertexSymbol&&"simple-marker"===this.vertexSymbol.type?w.pt2px(this.vertexSymbol.size)/2+3:3},W.prototype._isWithinScreenDistance=function(e,t,r){var i=e.x-t.x,o=e.y-t.y;return Math.sqrt(i*i+o*o)<=r},W.prototype._snapLastVertexToAxis=function(e){if(!(e.length<2)){var t=e.pop(),r=e[e.length-1],i=U.createViewAlignedCoordinateSystem(this.view,r),o=i.mapToLocal(r),n=i.mapToLocal(t),a=Math.abs(n.x-o.x),s=Math.abs(n.y-o.y),c=i.localToMap(U.makeSurfacePoint(s<a?n.x:o.x,s<a?o.y:n.y));e.push(c)}},W.prototype._displayCrosshairCursor=function(){this.view&&this.view.container&&"crosshair"!==this.view.cursor&&(this.view.cursor="crosshair")},W.prototype._displayDefaultCursor=function(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null)},W.prototype._logError=function(e,t,r){K.error(new s(e,t,r))},W.prototype._generateSceneViewHighlightHandles=function(){function o(e,t){var r=n.view;if(r&&"2d"!==r.type){var i=r.allLayerViews.find(function(e){return e.layer.uid===t.uid});i&&(e.added&&e.added.forEach(function(e){n._highlightHandlesByGraphic.add(i.highlight(e),e.uid)}),e.removed&&e.removed.forEach(function(e){n._highlightHandlesByGraphic.remove(e.uid)}))}}var n=this;return[this.updateGraphics.on("after-add",function(e){o({added:[e.item]},n.layer)}),this.updateGraphics.on("after-remove",function(e){o({removed:[e.item]},n.layer)}),this._internalGraphicsLayer.graphics.on("after-add",function(e){o({added:[e.item]},n._internalGraphicsLayer)}),this._internalGraphicsLayer.graphics.on("after-remove",function(e){o({removed:[e.item]},n._internalGraphicsLayer)}),d.on(this,"view.allLayerViews","change",function(e){if(e.added)for(var t=0,r=e.added;t<r.length;t++){var i=r[t];i.layer===n.layer?o({added:n.updateGraphics.toArray(),removed:[]},i.layer):i.layer===n._internalGraphicsLayer&&o({added:n._internalGraphicsLayer.graphics.toArray(),removed:[]},i.layer)}})]},W.prototype._requireModule=function(i){return m(this,void 0,void 0,function(){var t,r;return f(this,function(e){switch(e.label){case 0:return t=new AbortController,this._moduleLoaderAbortController=t,[4,i];case 1:return r=e.sent(),this._moduleLoaderAbortController!==t||t.signal.aborted?[2,{requireError:"aborted"}]:[2,{module:r}]}})})},W.prototype._emitCreateEvent=function(e){this.emit("create",y({},e,{type:"create"}))},W.prototype._emitUpdateEvent=function(e){this.emit("update",y({},e,{type:"update"}))},W.prototype._emitUndoEvent=function(e){this.emit("undo",y({},e,{type:"undo"}))},W.prototype._emitRedoEvent=function(e){this.emit("redo",y({},e,{type:"redo"}))},W.prototype._emitDeleteEvent=function(e){this.emit("delete",y({},e,{type:"delete"}))},i([u.property({dependsOn:["state"],readOnly:!0})],W.prototype,"_draw",null),i([u.property()],W.prototype,"_operationHandle",void 0),i([u.property({dependsOn:["_operationHandle","_operationHandle.tool"],readOnly:!0})],W.prototype,"activeTool",null),i([u.property()],W.prototype,"activeFillSymbol",void 0),i([u.property()],W.prototype,"activeLineSymbol",void 0),i([u.property()],W.prototype,"activePointSymbol",void 0),i([u.property()],W.prototype,"activeVertexSymbol",void 0),i([u.property({readOnly:!0})],W.prototype,"createGraphic",void 0),i([u.property()],W.prototype,"defaultCreateOptions",void 0),i([u.property()],W.prototype,"defaultUpdateOptions",void 0),i([u.property()],W.prototype,"layer",void 0),i([u.property({types:o.symbolTypes})],W.prototype,"pointSymbol",void 0),i([u.property({types:o.symbolTypes})],W.prototype,"polygonSymbol",void 0),i([u.property({types:o.symbolTypes})],W.prototype,"polylineSymbol",void 0),i([u.property({dependsOn:["view.ready","layer","_operationHandle"],readOnly:!0})],W.prototype,"state",null),i([u.property({readOnly:!0})],W.prototype,"updateGraphics",void 0),i([u.property()],W.prototype,"updateOnGraphicClick",void 0),i([u.property({types:o.symbolTypes})],W.prototype,"updatePointSymbol",void 0),i([u.property({types:o.symbolTypes})],W.prototype,"updatePolygonSymbol",void 0),i([u.property({types:o.symbolTypes})],W.prototype,"updatePolylineSymbol",void 0),i([u.property({types:o.symbolTypes})],W.prototype,"vertexSymbol",void 0),i([u.property({value:null})],W.prototype,"view",null),i([u.property()],W.prototype,"cancel",null),i([u.property()],W.prototype,"complete",null),i([u.property()],W.prototype,"delete",null),i([u.property()],W.prototype,"create",null),i([u.property()],W.prototype,"update",null),i([u.property()],W.prototype,"undo",null),i([u.property()],W.prototype,"redo",null),i([u.property()],W.prototype,"canUndo",null),i([u.property()],W.prototype,"canRedo",null),i([u.property()],W.prototype,"toggleUpdateTool",null),i([u.subclass("esri.widgets.Sketch.SketchViewModel")],W);function W(e){var t=F.call(this,e)||this;return t._activeFillGraphic=null,t._activeLineGraphic=null,t._centerIndicatorGraphic=null,t._centerSymbol=new E({style:"cross",size:6,color:[255,255,255]}),t._defaultSegmentOffset=48,t._handles=new p,t._internalGraphicsLayer=new v({listMode:"hide"}),t._lineGraphic=null,t._operationHandle=null,t._vertexGraphics=[],t._viewHandles=new p,t._highlightHandlesByGraphic=new p,t._doUnnormalization=!1,t.activeFillSymbol=new g({style:"solid",color:[150,150,150,.2],outline:{color:[0,0,0,0]}}),t.activeLineSymbol=new x({color:[12,207,255,1],width:2,style:"dash"}),t.activePointSymbol=new E({style:"circle",size:6,color:[12,207,255],outline:{color:[50,50,50],width:1}}),t.activeVertexSymbol=new E({style:"circle",size:6,color:[12,207,255],outline:{color:[50,50,50],width:1}}),t.createGraphic=null,t.defaultCreateOptions={mode:"hybrid"},t.defaultUpdateOptions={enableMidpoints:!0,enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,tool:"transform"},t.layer=null,t.pointSymbol=new E({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),t.polygonSymbol=new g({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),t.polylineSymbol=new x({color:[130,130,130,1],width:2}),t.updateGraphics=new n,t.updateOnGraphicClick=!0,t.updatePointSymbol=new E({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}}),t.updatePolygonSymbol=new g({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}}),t.updatePolylineSymbol=new x({color:[12,207,255],width:2}),t.vertexSymbol=new E({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),t}}.apply(null,r))||(e.exports=i)},2168:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(1),r(0),r(5),r(13),r(2),r(2169),r(2170),r(2171),r(2172),r(2173)],void 0===(o=function(e,t,r,i,o,n,a,s,c,p,l,d){return h=a.declared(n),r(u,h),u.prototype.destroy=function(){this.activeAction&&(this.activeAction.destroy(),this.activeAction=null)},u.prototype.create=function(e,t){this.reset();var r=o({view:this.view},t);switch(e){case"point":this.activeAction=new c(r);break;case"polygon":this.activeAction=new p(r);break;case"polyline":this.activeAction=new l(r);break;case"multipoint":this.activeAction=new s(r);break;case"rectangle":case"circle":case"ellipse":case"triangle":this.activeAction=new d(r)}return this.activeAction},u.prototype.complete=function(){this.activeAction&&this.activeAction.complete(),this.activeAction=null},u.prototype.reset=function(){this.activeAction&&this.activeAction.destroy(),this.activeAction=null},i([a.property()],u.prototype,"activeAction",void 0),i([a.property({readOnly:!0})],u.prototype,"type",void 0),i([a.property()],u.prototype,"view",void 0),i([a.subclass("esri.views.draw.Draw")],u);function u(){var e=null!==h&&h.apply(this,arguments)||this;return e.activeAction=null,e.type="draw",e.view=null,e}var h}.apply(null,i))||(e.exports=o)},2169:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(1),r(0),r(23),r(12),r(15),r(2),r(1705),r(1749),r(1706),r(156)],void 0===(o=function(e,t,r,i,o,n,a,s,c,p,l,d){return h=s.declared(c),r(u,h),u.prototype.initialize=function(){this._addViewHandles()},u.prototype.destroy=function(){this._removeViewHandles(),this._viewHandles.destroy(),this.emit("destroy")},u.prototype.addVertex=function(e,t){var r=this;isNaN(t)?(t=this.vertices.length,this.vertices.push(e)):this.vertices.splice(t,0,e);var i={vertex:e,vertexIndex:t,undo:function(){return r._undoVertexAdd(null,t)},redo:function(){return r._redoVertexAdd(null,e,t)}};this.history.push(i),this._set("redoHistory",[]);var o=new p.VertexAddEvent(this.view,null,t,this.vertices);this.emit("vertex-add",o),o.defaultPrevented&&(this._cursorMoved=!0,this.history.pop())},u.prototype.removeVertex=function(e){var t=this,r=this.vertices.splice(e,1)[0],i={vertex:r,vertexIndex:e,undo:function(){return t._undoVertexRemove(null,r,e)},redo:function(){return t._redoVertexRemove(null,e)}};this.history.push(i),this._set("redoHistory",[]),this.emit("vertex-remove",new p.VertexRemoveEvent(this.view,null,e,this.vertices))},u.prototype.updateVertex=function(e,t){var r=this,i=this.vertices[t],o={vertex:this.vertices[t]=e,vertexIndex:t,undo:function(){return r._undoVertexUpdate(null,i,t)},redo:function(){return r._redoVertexUpdate(null,e,t)}};this.history.push(o),this._set("redoHistory",[]),this.emit("vertex-update",new p.VertexUpdateEvent(this.view,null,t,this.vertices))},u.prototype.complete=function(){this._completeDrawing()},u.prototype._addViewHandles=function(){var t=this;this._removeViewHandles(),this._viewHandles.add([this.view.on("click",function(e){e.stopPropagation()},d.ViewEventPriorities.TOOL),this.view.on("pointer-down",function(e){t._cursorMoved&&t.vertices.pop(),t._pointerDownEvent=e,t._cursorMoved=!1,t._cursorScreenPoint=a.createScreenPointFromEvent(e)},d.ViewEventPriorities.TOOL),this.view.on("pointer-move",function(e){t._cursorMoved&&t.vertices.pop(),t._cursorMoved=!0,t._cursorScreenPoint=a.createScreenPointFromEvent(e),t._cursorUpdateHandler(e)},d.ViewEventPriorities.TOOL),this.view.on("pointer-up",function(e){if(t._pointerDownEvent){if(t._cursorMoved)return t.vertices.pop(),void(t._cursorMoved=!1);t._pointerDownEvent=null,t._vertexAddHandler(e)}},d.ViewEventPriorities.TOOL),this.view.on("drag",function(e){t._dragEnabled&&t._pointerDownEvent&&e.stopPropagation()},d.ViewEventPriorities.TOOL),this.view.on("drag",["Shift"],function(e){e.stopPropagation()},d.ViewEventPriorities.TOOL),this.view.on("double-click",function(e){e.stopPropagation(),t._drawCompleteHandler(e)},d.ViewEventPriorities.TOOL),this.view.on("double-click",["Control"],function(e){e.stopPropagation(),t._drawCompleteHandler(e)},d.ViewEventPriorities.TOOL),this.view.on("key-down",function(e){e.key===l.KEYS.vertexAddKey&&!e.repeat&&t._cursorScreenPoint?(t._cursorMoved&&(t.vertices.pop(),t._cursorMoved=!1),t._vertexAddHandler(e)):e.key===l.KEYS.drawCompleteKey&&!e.repeat&&t._cursorScreenPoint?(t._cursorMoved&&(t.vertices.pop(),t._cursorMoved=!1),t._vertexAddHandler(e),t._drawCompleteHandler(e)):e.key!==l.KEYS.undoKey||e.repeat?e.key!==l.KEYS.redoKey||e.repeat||t.redo():t.undo()},d.ViewEventPriorities.TOOL)])},u.prototype._removeViewHandles=function(){this._viewHandles.removeAll()},u.prototype._addVertex=function(e,t){var r=this;this.vertices.push(e);var i=this.vertices.indexOf(e),o={vertex:e,vertexIndex:i,undo:function(){return r._undoVertexAdd(t,i)},redo:function(){return r._redoVertexAdd(t,e,i)}};this.history.push(o),this._set("redoHistory",[]);var n=new p.VertexAddEvent(this.view,t,i,this.vertices);this.emit("vertex-add",n),n.defaultPrevented&&(this._cursorMoved=!0,this.history.pop())},u.prototype._updateCursor=function(e,t){this.vertices.push(e);var r=this.vertices.indexOf(e),i=new p.CursorUpdateEvent(this.view,t,r,this.vertices);this.emit("cursor-update",i)},u.prototype._completeDrawing=function(e){if(this._cursorMoved=!1,this._pointerDownEvent=null,!(this.vertices.length<1)){var t=new p.DrawCompleteEvent(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented?this._cursorMoved=!0:this._removeViewHandles()}},u.prototype._undoVertexAdd=function(e,t){this.vertices.splice(t,1),this.emit("undo",new p.VertexRemoveEvent(this.view,e,t,this.vertices))},u.prototype._redoVertexAdd=function(e,t,r){this.vertices.splice(r,0,t),this.emit("redo",new p.VertexAddEvent(this.view,e,r,this.vertices))},u.prototype._undoVertexRemove=function(e,t,r){this.vertices.splice(r,0,t),this.emit("undo",new p.VertexAddEvent(this.view,e,r,this.vertices))},u.prototype._redoVertexRemove=function(e,t){this.vertices.splice(t,1),this.emit("redo",new p.VertexRemoveEvent(this.view,e,t,this.vertices))},u.prototype._undoVertexUpdate=function(e,t,r){this.vertices[r]=t,this.emit("undo",new p.VertexUpdateEvent(this.view,e,r,this.vertices))},u.prototype._redoVertexUpdate=function(e,t,r){this.vertices[r]=t,this.emit("redo",new p.VertexUpdateEvent(this.view,e,r,this.vertices))},u.prototype._vertexAddHandler=function(e){var t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);n.isSome(t)&&this._addVertex(t,e.native)},u.prototype._cursorUpdateHandler=function(e){var t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);n.isSome(t)&&this._updateCursor(t,e.native)},u.prototype._drawCompleteHandler=function(e){this._completeDrawing(e.native)},i([s.property({readOnly:!0})],u.prototype,"vertices",void 0),i([s.property()],u.prototype,"view",void 0),i([s.subclass("esri.views.draw.MultipointDrawAction")],u);function u(e){var t=h.call(this,e)||this;return t._cursorMoved=!1,t._cursorScreenPoint=null,t._dragEnabled=!0,t._pointerDownEvent=null,t._viewHandles=new o,t.vertices=[],t.view=null,t}var h}.apply(null,i))||(e.exports=o)},2170:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(1),r(0),r(23),r(12),r(15),r(2),r(1705),r(1706),r(156),r(539)],void 0===(o=function(e,t,r,i,o,n,a,s,c,p,l,d){var u,h=(f.prototype.preventDefault=function(){this.defaultPrevented=!0},f),v=(y.prototype.preventDefault=function(){this.defaultPrevented=!0},y);function y(e,t){this.native=e,this.coordinates=t,this.defaultPrevented=!1,this.type="draw-complete"}function f(e,t,r){this.view=e,this.native=t,this.coordinates=r,this.defaultPrevented=!1,this.type="cursor-update"}return u=s.declared(c),r(m,u),m.prototype.initialize=function(){this._addViewHandles()},m.prototype.destroy=function(){this._removeViewHandles(),this._viewHandles.destroy(),this.emit("destroy")},m.prototype.complete=function(){if(this._cursorScreenPoint){var e=this.getCoordsFromScreenPoint(this._cursorScreenPoint);n.isSome(e)&&(this._set("coordinates",e),this._completeDrawing())}},m.prototype._addViewHandles=function(){var r=this;this._removeViewHandles(),this._viewHandles.add([this.view.on("click",function(e){e.stopPropagation();var t=r.getCoordsFromScreenPoint(e.screenPoint);n.isSome(t)&&(r._set("coordinates",t),r._drawCompleteHandler(e))},l.ViewEventPriorities.TOOL),this.view.on("pointer-down",function(e){r._pointerDownEvent=e,r._cursorMoved=!1},l.ViewEventPriorities.TOOL),this.view.on("pointer-move",function(e){r._cursorMoved=!0,r._cursorScreenPoint=a.createScreenPointFromEvent(e),r._cursorUpdateHandler(e)},l.ViewEventPriorities.TOOL),this.view.on("pointer-up",function(e){if(r._pointerDownEvent&&!r._cursorMoved&&e.timestamp-r._pointerDownEvent.timestamp>r._clickDelay){r._cursorScreenPoint=a.createScreenPointFromEvent(e);var t=r.getCoordsFromScreenPoint(r._cursorScreenPoint);n.isSome(t)&&(r._set("coordinates",t),r._drawCompleteHandler(e))}},l.ViewEventPriorities.TOOL),this.view.on("key-down",function(e){if(e.key===p.KEYS.drawCompleteKey&&r._cursorScreenPoint){var t=r.getCoordsFromScreenPoint(r._cursorScreenPoint);n.isSome(t)&&(r._set("coordinates",t),r._drawCompleteHandler(e))}},l.ViewEventPriorities.TOOL)])},m.prototype._removeViewHandles=function(){this._viewHandles.removeAll()},m.prototype._updateCursor=function(e,t){this.emit("cursor-update",new h(this.view,t,e))},m.prototype._completeDrawing=function(e){this._cursorMoved=!1,this._pointerDownEvent=null;var t=new v(e,this.coordinates);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()},m.prototype._cursorUpdateHandler=function(e){this._updateCursor(this.getCoordsFromScreenPoint(this._cursorScreenPoint),e.native)},m.prototype._drawCompleteHandler=function(e){this._completeDrawing(e.native)},i([s.property({readOnly:!0})],m.prototype,"coordinates",void 0),i([s.property()],m.prototype,"view",void 0),i([s.subclass("esri.views.draw.PointDrawAction")],m);function m(e){var t=u.call(this,e)||this;return t._clickDelay=d.DefaultParameters.maximumClickDelay,t._cursorMoved=!1,t._cursorScreenPoint=null,t._pointerDownEvent=null,t._viewHandles=new o,t.coordinates=[],t.view=null,t}}.apply(null,i))||(e.exports=o)},2171:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(1),r(0),r(23),r(12),r(15),r(2),r(1705),r(1749),r(1706),r(156)],void 0===(o=function(e,t,r,i,o,n,a,s,c,p,l,d){return h=s.declared(c),r(u,h),u.prototype.initialize=function(){this._addViewHandles()},u.prototype.destroy=function(){this._removeViewHandles(),this._viewHandles.destroy(),this.emit("destroy")},Object.defineProperty(u.prototype,"_clickEnabled",{get:function(){return-1!==["hybrid","click"].indexOf(this.mode)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"_dragEnabled",{get:function(){return-1!==["hybrid","freehand"].indexOf(this.mode)},enumerable:!0,configurable:!0}),u.prototype.addVertex=function(e,t){var r=this;this.vertices.splice(t,0,e);var i={vertex:e,vertexIndex:t,undo:function(){return r._undoVertexAdd(null,t)},redo:function(){return r._redoVertexAdd(null,e,t)}};this.history.push(i),this._set("redoHistory",[]);var o=new p.VertexAddEvent(this.view,null,t,this.vertices);this.emit("vertex-add",o),o.defaultPrevented&&(this._popVertexOnPointerMove=!0,this.history.pop())},u.prototype.removeVertex=function(e){var t=this,r=this.vertices.splice(e,1)[0],i={vertex:r,vertexIndex:e,undo:function(){return t._undoVertexRemove(null,r,e)},redo:function(){return t._redoVertexRemove(null,e)}};this.history.push(i),this._set("redoHistory",[]),this.emit("vertex-remove",new p.VertexRemoveEvent(this.view,null,e,this.vertices))},u.prototype.updateVertex=function(e,t){var r=this,i=this.vertices[t],o={vertex:this.vertices[t]=e,vertexIndex:t,undo:function(){return r._undoVertexUpdate(null,i,t)},redo:function(){return r._redoVertexUpdate(null,e,t)}};this.history.push(o),this._set("redoHistory",[]),this.emit("vertex-update",new p.VertexUpdateEvent(this.view,null,t,this.vertices))},u.prototype.complete=function(){this._completeDrawing()},u.prototype._addViewHandles=function(){var i=this;this._removeViewHandles(),this._viewHandles.add([this.view.on("click",function(e){e.stopPropagation()},d.ViewEventPriorities.TOOL),this.view.on("pointer-down",function(e){i._shouldHandlePointerEvent(e)&&(i._panEnabled||(i._activePointerId=e.pointerId,i._addVertexOnPointerUp=!0,i._cursorScreenPoint=a.createScreenPointFromEvent(e),"touch"===e.pointerType&&i._updateCursor(e.native)))},d.ViewEventPriorities.TOOL),this.view.on("pointer-move",function(e){i._popVertexOnPointerMove&&(i.vertices.pop(),i._popVertexOnPointerMove=!1),i._cursorScreenPoint=a.createScreenPointFromEvent(e),"touch"!==e.pointerType&&i._updateCursor(e.native)},d.ViewEventPriorities.TOOL),this.view.on("pointer-drag",function(e){i._shouldHandlePointerEvent(e)&&(i._cursorScreenPoint=a.createScreenPointFromEvent(e),i._dragEnabled&&!i._panEnabled?i._vertexAddHandler(e):i._addVertexOnPointerUp=!1)},d.ViewEventPriorities.TOOL),this.view.on("pointer-up",function(e){if(i._shouldHandlePointerEvent(e)){if(i._activePointerId=null,!i._addVertexOnPointerUp){var t="touch"===e.pointerType;return void i._updateCursor(e.native,t)}if(!i._clickEnabled)return 1===i.vertices.length&&i.vertices.pop(),void i._drawCompleteHandler(e);i._vertexAddHandler(e)}},d.ViewEventPriorities.TOOL),this.view.on("drag",function(e){i._dragEnabled&&n.isSome(i._activePointerId)&&!i._panEnabled&&e.stopPropagation()},d.ViewEventPriorities.TOOL),this.view.on("drag",["Shift"],function(e){e.stopPropagation()},d.ViewEventPriorities.TOOL),this.view.on("double-click",function(e){e.stopPropagation(),i._drawCompleteHandler(e)},d.ViewEventPriorities.TOOL),this.view.on("double-click",["Control"],function(e){e.stopPropagation(),i._drawCompleteHandler(e)},d.ViewEventPriorities.TOOL),this.view.on("key-down",function(e){var t=e.key,r=e.repeat;t===l.KEYS.vertexAddKey&&!r&&i._cursorScreenPoint?i._vertexAddHandler(e):t===l.KEYS.drawCompleteKey&&!r&&i._cursorScreenPoint&&2<i.vertices.length?(i._vertexAddHandler(e),i._drawCompleteHandler(e)):t!==l.KEYS.undoKey||r?t!==l.KEYS.redoKey||r?t!==l.KEYS.panKey||r||(i._panEnabled=!0):i.redo():i.undo()},d.ViewEventPriorities.TOOL),this.view.on("key-up",function(e){e.key===l.KEYS.panKey&&(i._panEnabled=!1)},d.ViewEventPriorities.TOOL)])},u.prototype._removeViewHandles=function(){this._viewHandles.removeAll()},u.prototype._addVertex=function(e,t){var r=this;if(this._popCursorVertex(),!this.isDuplicateVertex(this.vertices,e)){var i=this.vertices.length;this.vertices.push(e);var o={vertex:e,vertexIndex:i,undo:function(){return r._undoVertexAdd(t,i)},redo:function(){return r._redoVertexAdd(t,e,i)}};this.history.push(o),this._set("redoHistory",[]);var n=new p.VertexAddEvent(this.view,t,i,this.vertices);this.emit("vertex-add",n),n.defaultPrevented&&this.history.pop()}},u.prototype._updateCursor=function(e,t){if(void 0===t&&(t=!1),this._popCursorVertex(),this._cursorScreenPoint){var r=this.view.toMap(this._cursorScreenPoint),i=null;r&&!t&&(i=this._pushCursorVertex([r.x,r.y]));var o=new p.CursorUpdateEvent(this.view,e,i,this.vertices,r);this.emit("cursor-update",o)}},u.prototype._completeDrawing=function(e){if(this._activePointerId=null,this._popCursorVertex(),!(this.vertices.length<3)){var t=new p.DrawCompleteEvent(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}},u.prototype._undoVertexAdd=function(e,t){this.vertices.splice(t,1),this.emit("undo",new p.VertexRemoveEvent(this.view,e,t,this.vertices))},u.prototype._redoVertexAdd=function(e,t,r){this.vertices.splice(r,0,t),this.emit("redo",new p.VertexAddEvent(this.view,e,r,this.vertices))},u.prototype._undoVertexRemove=function(e,t,r){this.vertices.splice(r,0,t),this.emit("undo",new p.VertexAddEvent(this.view,e,r,this.vertices))},u.prototype._redoVertexRemove=function(e,t){this.vertices.splice(t,1),this.emit("redo",new p.VertexRemoveEvent(this.view,e,t,this.vertices))},u.prototype._undoVertexUpdate=function(e,t,r){this.vertices[r]=t,this.emit("undo",new p.VertexUpdateEvent(this.view,e,r,this.vertices))},u.prototype._redoVertexUpdate=function(e,t,r){this.vertices[r]=t,this.emit("redo",new p.VertexUpdateEvent(this.view,e,r,this.vertices))},u.prototype._pushCursorVertex=function(e){return this._popCursorVertex(),this.vertices.push(e),this._cursorVertexAdded=!0,this.vertices.length-1},u.prototype._popCursorVertex=function(){this._cursorVertexAdded&&(this.vertices.pop(),this._cursorVertexAdded=!1)},u.prototype._shouldHandlePointerEvent=function(e){return("mouse"!==(t=e).pointerType||0===t.button)&&(n.isNone(this._activePointerId)||this._activePointerId===e.pointerId);var t},u.prototype._vertexAddHandler=function(e){if(this._cursorVertexAdded){var t=this.vertices[this.vertices.length-1];this._addVertex(t,e.native)}else{var r=this.getCoordsFromScreenPoint(this._cursorScreenPoint);n.isSome(r)&&this._addVertex(r,e.native)}},u.prototype._drawCompleteHandler=function(e){this._completeDrawing(e.native)},i([s.property({dependsOn:["mode"]})],u.prototype,"_clickEnabled",null),i([s.property({dependsOn:["mode"]})],u.prototype,"_dragEnabled",null),i([s.property({cast:function(e){return-1===["hybrid","freehand","click"].indexOf(e)?"hybrid":e}})],u.prototype,"mode",void 0),i([s.property({readOnly:!0})],u.prototype,"vertices",void 0),i([s.property()],u.prototype,"view",void 0),i([s.subclass("esri.views.draw.PolygonDrawAction")],u);function u(e){var t=h.call(this,e)||this;return t._cursorScreenPoint=null,t._panEnabled=!1,t._cursorVertexAdded=!1,t._popVertexOnPointerMove=!1,t._addVertexOnPointerUp=!1,t._activePointerId=null,t._viewHandles=new o,t.mode="hybrid",t.vertices=[],t.view=null,t}var h}.apply(null,i))||(e.exports=o)},2172:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(1),r(0),r(23),r(12),r(15),r(2),r(1705),r(1749),r(1706),r(156)],void 0===(o=function(e,t,r,i,o,n,a,s,c,p,l,d){return h=s.declared(c),r(u,h),u.prototype.initialize=function(){this._addViewHandles()},u.prototype.destroy=function(){this._removeViewHandles(),this._viewHandles.destroy(),this.emit("destroy")},Object.defineProperty(u.prototype,"_clickEnabled",{get:function(){return-1!==["hybrid","click"].indexOf(this.mode)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"_dragEnabled",{get:function(){return-1!==["hybrid","freehand"].indexOf(this.mode)},enumerable:!0,configurable:!0}),u.prototype.addVertex=function(e,t){var r=this;this.vertices.splice(t,0,e);var i={vertex:e,vertexIndex:t,undo:function(){return r._undoVertexAdd(null,t)},redo:function(){return r._redoVertexAdd(null,e,t)}};this.history.push(i),this._set("redoHistory",[]);var o=new p.VertexAddEvent(this.view,null,t,this.vertices);this.emit("vertex-add",o),o.defaultPrevented&&(this._popVertexOnPointerMove=!0,this.history.pop())},u.prototype.removeVertex=function(e){var t=this,r=this.vertices.splice(e,1)[0],i={vertex:r,vertexIndex:e,undo:function(){return t._undoVertexRemove(null,r,e)},redo:function(){return t._redoVertexRemove(null,e)}};this.history.push(i),this._set("redoHistory",[]),this.emit("vertex-remove",new p.VertexRemoveEvent(this.view,null,e,this.vertices))},u.prototype.updateVertex=function(e,t){var r=this,i=this.vertices[t],o={vertex:this.vertices[t]=e,vertexIndex:t,undo:function(){return r._undoVertexUpdate(null,i,t)},redo:function(){return r._redoVertexUpdate(null,e,t)}};this.history.push(o),this._set("redoHistory",[]),this.emit("vertex-update",new p.VertexUpdateEvent(this.view,null,t,this.vertices))},u.prototype.complete=function(){this._completeDrawing()},u.prototype._addViewHandles=function(){var i=this;this._removeViewHandles(),this._viewHandles.add([this.view.on("click",function(e){e.stopPropagation()},d.ViewEventPriorities.TOOL),this.view.on("pointer-down",function(e){i._shouldHandlePointerEvent(e)&&(i._panEnabled||(i._activePointerId=e.pointerId,i._addVertexOnPointerUp=!0,i._cursorScreenPoint=a.createScreenPointFromEvent(e),"touch"===e.pointerType&&i._updateCursor(e.native)))},d.ViewEventPriorities.TOOL),this.view.on("pointer-move",function(e){i._popVertexOnPointerMove&&(i.vertices.pop(),i._popVertexOnPointerMove=!1),i._cursorScreenPoint=a.createScreenPointFromEvent(e),"touch"!==e.pointerType&&i._updateCursor(e.native)},d.ViewEventPriorities.TOOL),this.view.on("pointer-drag",function(e){i._shouldHandlePointerEvent(e)&&(i._cursorScreenPoint=a.createScreenPointFromEvent(e),i._dragEnabled&&!i._panEnabled?i._vertexAddHandler(e):i._addVertexOnPointerUp=!1)},d.ViewEventPriorities.TOOL),this.view.on("pointer-up",function(e){if(i._shouldHandlePointerEvent(e)){if(i._activePointerId=null,!i._addVertexOnPointerUp){var t="touch"===e.pointerType;return void i._updateCursor(e.native,t)}if(!i._clickEnabled)return 1===i.vertices.length&&i.vertices.pop(),void i._drawCompleteHandler(e);i._vertexAddHandler(e)}},d.ViewEventPriorities.TOOL),this.view.on("drag",function(e){i._dragEnabled&&n.isSome(i._activePointerId)&&!i._panEnabled&&e.stopPropagation()},d.ViewEventPriorities.TOOL),this.view.on("drag",["Shift"],function(e){e.stopPropagation()},d.ViewEventPriorities.TOOL),this.view.on("double-click",function(e){e.stopPropagation(),i._drawCompleteHandler(e)},d.ViewEventPriorities.TOOL),this.view.on("double-click",["Control"],function(e){e.stopPropagation(),i._drawCompleteHandler(e)},d.ViewEventPriorities.TOOL),this.view.on("key-down",function(e){var t=e.key,r=e.repeat;t===l.KEYS.vertexAddKey&&!r&&i._cursorScreenPoint?i._vertexAddHandler(e):t===l.KEYS.drawCompleteKey&&!r&&i._cursorScreenPoint&&1<i.vertices.length?(i._vertexAddHandler(e),i._drawCompleteHandler(e)):t!==l.KEYS.undoKey||r?t!==l.KEYS.redoKey||r?t!==l.KEYS.panKey||r||(i._panEnabled=!0):i.redo():i.undo()},d.ViewEventPriorities.TOOL),this.view.on("key-up",function(e){e.key===l.KEYS.panKey&&(i._panEnabled=!1)},d.ViewEventPriorities.TOOL)])},u.prototype._removeViewHandles=function(){this._viewHandles.removeAll()},u.prototype._addVertex=function(e,t){var r=this;if(this._popCursorVertex(),!this.isDuplicateVertex(this.vertices,e)){this.vertices.push(e);var i=this.vertices.length-1,o={vertex:e,vertexIndex:i,undo:function(){return r._undoVertexAdd(t,i)},redo:function(){return r._redoVertexAdd(t,e,i)}};this.history.push(o),this._set("redoHistory",[]);var n=new p.VertexAddEvent(this.view,t,i,this.vertices);this.emit("vertex-add",n),n.defaultPrevented&&this.history.pop()}},u.prototype._updateCursor=function(e,t){if(void 0===t&&(t=!1),this._popCursorVertex(),this._cursorScreenPoint){var r=this.view.toMap(this._cursorScreenPoint),i=null;r&&!t&&(i=this._pushCursorVertex([r.x,r.y]));var o=new p.CursorUpdateEvent(this.view,e,i,this.vertices,r);this.emit("cursor-update",o)}},u.prototype._completeDrawing=function(e){if(this._activePointerId=null,this._popCursorVertex(),!(this.vertices.length<2)){var t=new p.DrawCompleteEvent(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}},u.prototype._undoVertexAdd=function(e,t){this.vertices.splice(t,1),this.emit("undo",new p.VertexRemoveEvent(this.view,e,t,this.vertices))},u.prototype._redoVertexAdd=function(e,t,r){this.vertices.splice(r,0,t),this.emit("redo",new p.VertexAddEvent(this.view,e,r,this.vertices))},u.prototype._undoVertexRemove=function(e,t,r){this.vertices.splice(r,0,t),this.emit("undo",new p.VertexAddEvent(this.view,e,r,this.vertices))},u.prototype._redoVertexRemove=function(e,t){this.vertices.splice(t,1),this.emit("redo",new p.VertexRemoveEvent(this.view,e,t,this.vertices))},u.prototype._undoVertexUpdate=function(e,t,r){this.vertices[r]=t,this.emit("undo",new p.VertexUpdateEvent(this.view,e,r,this.vertices))},u.prototype._redoVertexUpdate=function(e,t,r){this.vertices[r]=t,this.emit("redo",new p.VertexUpdateEvent(this.view,e,r,this.vertices))},u.prototype._pushCursorVertex=function(e){return this._popCursorVertex(),this.vertices.push(e),this._cursorVertexAdded=!0,this.vertices.length-1},u.prototype._popCursorVertex=function(){this._cursorVertexAdded&&(this.vertices.pop(),this._cursorVertexAdded=!1)},u.prototype._shouldHandlePointerEvent=function(e){return("mouse"!==(t=e).pointerType||0===t.button)&&(n.isNone(this._activePointerId)||this._activePointerId===e.pointerId);var t},u.prototype._vertexAddHandler=function(e){if(this._cursorVertexAdded){var t=this.vertices[this.vertices.length-1];this._addVertex(t,e.native)}else{var r=this.getCoordsFromScreenPoint(this._cursorScreenPoint);n.isSome(r)&&this._addVertex(r,e.native)}},u.prototype._drawCompleteHandler=function(e){this._completeDrawing(e.native)},i([s.property({dependsOn:["mode"]})],u.prototype,"_clickEnabled",null),i([s.property({dependsOn:["mode"]})],u.prototype,"_dragEnabled",null),i([s.property({cast:function(e){return-1===["hybrid","freehand","click"].indexOf(e)?"hybrid":e}})],u.prototype,"mode",void 0),i([s.property({readOnly:!0})],u.prototype,"vertices",void 0),i([s.property()],u.prototype,"view",void 0),i([s.subclass("esri.views.draw.PolylineDrawAction")],u);function u(e){var t=h.call(this,e)||this;return t._cursorScreenPoint=null,t._panEnabled=!1,t._cursorVertexAdded=!1,t._popVertexOnPointerMove=!1,t._addVertexOnPointerUp=!1,t._activePointerId=null,t._viewHandles=new o,t.mode="hybrid",t.vertices=[],t.view=null,t}var h}.apply(null,i))||(e.exports=o)},2173:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(1),r(0),r(23),r(12),r(15),r(2),r(1705),r(1749),r(1706),r(156)],void 0===(o=function(e,t,r,i,o,n,a,s,c,p,l,d){return h=s.declared(c),r(u,h),u.prototype.initialize=function(){this._addViewHandles()},u.prototype.destroy=function(){this._removeViewHandles(),this._viewHandles.destroy(),this.emit("destroy")},u.prototype.complete=function(){this._completeDrawing()},u.prototype._addViewHandles=function(){this._removeViewHandles(),"click"===this.mode?this._viewHandles.add(this._getClickModeViewHandles()):this._viewHandles.add(this._getDragModeViewHandles())},u.prototype._getDragModeViewHandles=function(){var t=this;return[this.view.on("click",function(e){e.stopPropagation(),e.mapPoint&&!t._panEnabled&&(t._set("vertices",[[e.mapPoint.x,e.mapPoint.y]]),t._drawCompleteHandler(e))},d.ViewEventPriorities.TOOL),this.view.on("pointer-down",function(e){t._shouldHandlePointerEvent(e)&&(t._panEnabled||(t._cursorScreenPoint=a.createScreenPointFromEvent(e),t._set("vertices",[]),t._activePointerId=e.pointerId,t._vertexAddHandler(e),t._isDragging=!1,"touch"===e.pointerType&&t._cursorUpdateHandler(e)))},d.ViewEventPriorities.TOOL),this.view.on("pointer-move",function(e){t._cursorScreenPoint=a.createScreenPointFromEvent(e),n.isNone(t._activePointerId)&&"touch"!==e.pointerType&&0===t.vertices.length&&t._cursorUpdateHandler(e)},d.ViewEventPriorities.TOOL),this.view.on("pointer-drag",function(e){t._shouldHandlePointerEvent(e)&&(t._isDragging=!0,t._cursorScreenPoint=a.createScreenPointFromEvent(e),t._cursorUpdateHandler(e))},d.ViewEventPriorities.TOOL),this.view.on("pointer-up",function(e){t._shouldHandlePointerEvent(e)&&(t._activePointerId=null,t._popCursorVertex(),t._isDragging&&!t._panEnabled&&(t._vertexAddHandler(e),t._drawCompleteHandler(e)),t._isDragging=!1)},d.ViewEventPriorities.TOOL),this.view.on("key-down",function(e){e.key===l.KEYS.drawCompleteKey&&t._cursorScreenPoint?t._drawCompleteHandler(e):e.key===l.KEYS.panKey&&(t._panEnabled=!0)},d.ViewEventPriorities.TOOL),this.view.on("key-up",function(e){e.key===l.KEYS.panKey&&(t._panEnabled=!1)},d.ViewEventPriorities.TOOL),this.view.on("drag",function(e){n.isSome(t._activePointerId)&&e.stopPropagation()},d.ViewEventPriorities.TOOL),this.view.on("drag",["Shift"],function(e){e.stopPropagation()},d.ViewEventPriorities.TOOL)]},u.prototype._getClickModeViewHandles=function(){var t=this;return[this.view.on("click",function(e){e.stopPropagation()},d.ViewEventPriorities.TOOL),this.view.on("pointer-down",function(e){t._cursorScreenPoint=a.createScreenPointFromEvent(e),t._activePointerId=e.pointerId,t._isDragging=!1,"touch"===e.pointerType&&t._cursorUpdateHandler(e)},d.ViewEventPriorities.TOOL),this.view.on("pointer-move",function(e){t._cursorScreenPoint=a.createScreenPointFromEvent(e),n.isNone(t._activePointerId)&&"touch"!==e.pointerType&&t._cursorUpdateHandler(e)},d.ViewEventPriorities.TOOL),this.view.on("pointer-drag",function(e){t._shouldHandlePointerEvent(e)&&(t._isDragging=!0)},d.ViewEventPriorities.TOOL),this.view.on("pointer-up",function(e){t._shouldHandlePointerEvent(e)&&(t._activePointerId=null,t._isDragging||t._vertexAddHandler(e),2!==t.vertices.length||t._isDragging||t._drawCompleteHandler(e),t._isDragging=!1)},d.ViewEventPriorities.TOOL),this.view.on("key-down",function(e){e.key===l.KEYS.vertexAddKey&&t._cursorScreenPoint&&(t._vertexAddHandler(e),2===t.vertices.length&&t._drawCompleteHandler(e)),e.key===l.KEYS.drawCompleteKey&&t._cursorScreenPoint&&2===t.vertices.length&&t._drawCompleteHandler(e)},d.ViewEventPriorities.TOOL)]},u.prototype._removeViewHandles=function(){this._viewHandles.removeAll()},u.prototype._addVertex=function(e,t){if(this._popCursorVertex(),!this.isDuplicateVertex(this.vertices,e)){this.vertices.push(e);var r=this.vertices.indexOf(e),i=new p.VertexAddEvent(this.view,t,r,this.vertices);this.emit("vertex-add",i)}},u.prototype._updateCursor=function(e,t){var r=null;n.isSome(e)&&(r=this._pushCursorVertex(e));var i=new p.CursorUpdateEvent(this.view,t,r,this.vertices);this.emit("cursor-update",i)},u.prototype._completeDrawing=function(e){if(this._activePointerId=null,this._popCursorVertex(),this._isDragging=!1,this._cursorScreenPoint=null,!(this.vertices.length<1)){var t=new p.DrawCompleteEvent(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}},u.prototype._pushCursorVertex=function(e){return this._popCursorVertex(),this.vertices.push(e),this._cursorVertexAdded=!0,this.vertices.length-1},u.prototype._popCursorVertex=function(){this._cursorVertexAdded&&(this.vertices.pop(),this._cursorVertexAdded=!1)},u.prototype._shouldHandlePointerEvent=function(e){return("mouse"!==(t=e).pointerType||0===t.button)&&(n.isNone(this._activePointerId)||this._activePointerId===e.pointerId);var t},u.prototype._vertexAddHandler=function(e){var t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);n.isSome(t)&&this._addVertex(t,e.native)},u.prototype._cursorUpdateHandler=function(e){var t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);this._updateCursor(t,e.native)},u.prototype._drawCompleteHandler=function(e){this._completeDrawing(e.native)},i([s.property({cast:function(e){return-1===["freehand","click"].indexOf(e)?"freehand":e}})],u.prototype,"mode",void 0),i([s.property({readOnly:!0})],u.prototype,"vertices",void 0),i([s.property()],u.prototype,"view",void 0),i([s.subclass("esri/views/2d/engine/markup/SegmentDrawAction")],u);function u(e){var t=h.call(this,e)||this;return t._isDragging=!1,t._panEnabled=!1,t._cursorScreenPoint=null,t._viewHandles=new o,t._cursorVertexAdded=!1,t._activePointerId=null,t.mode="freehand",t.vertices=[],t.view=null,t}var h}.apply(null,i))||(e.exports=o)},2174:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(11),r(0),r(28),r(69),r(78),r(237),r(1669),r(1708),r(118),r(150),r(1875),r(1571),r(305),r(55)],void 0===(o=function(e,t,r,i,m,_,o,n,a,s,c,p,w,g,x,l){function d(e,t){return[e,t]}function E(e,t){return{x:e,y:t}}function G(e,t,r,i){void 0===i&&(i=!0);var o=e.map(function(e){return Array.apply([],e)});o.forEach(function(e){e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]||e.push(e[0])});var n=new m.Polygon({rings:o,spatialReference:t});return n.rings.forEach(function(e){n.isClockwise(e)||e.reverse()}),r&&x.unnormalizeGeometryOnDatelineCrossing(n),i&&n.isSelfIntersecting&&l.isValid(t)&&(n=g.simplify(n)),n}Object.defineProperty(t,"__esModule",{value:!0}),t.makeMapPoint=d,t.makeSurfacePoint=E;var u,y=.8660254037844386,h=(P.prototype.mapToLocalMultiple=function(e){var t=this;return e.map(function(e){return t.mapToLocal(e)})},Object.defineProperty(P.prototype,"doUnnormalization",{get:function(){return!1},enumerable:!0,configurable:!0}),P),v=(r(f,u=h),f.prototype.mapToLocal=function(e){return E(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])},f.prototype.localToMap=function(e){return d(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5])},f);function f(e,t){var r=u.call(this,t)||this;return r.transform=n.mat2df64.create(),r.transformInv=n.mat2df64.create(),r.transform=n.mat2df64.clone(e),o.mat2d.invert(r.transformInv,r.transform),r}function P(e){this.spatialReference=e}t.AffineCoordinateSystem=v;var b,S=(r(V,b=h),Object.defineProperty(V.prototype,"doUnnormalization",{get:function(){return"global"===this.view.viewingMode},enumerable:!0,configurable:!0}),V.prototype.mapToLocal=function(e){var t=p.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(new m.Point({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),c.vec3.transformQuat(t,t,this.worldToLocalTransform);var r=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return E(r.x/this.scale,r.y/this.scale)},V.prototype.localToMap=function(e){var t=p.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(new m.Point({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),c.vec3.transformQuat(t,t,this.localToWorldTransform);var r=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return d(r.x,r.y)},V);function V(e,t){var r=b.call(this,e.spatialReference)||this;r.view=e,r.pWS=p.vec3f64.create(),r.tangentFrameUpWS=p.vec3f64.create(),r.tangentFrameRightWS=p.vec3f64.create(),r.tangentFrameForwardWS=p.vec3f64.create(),r.localFrameRightWS=p.vec3f64.create(),r.localFrameUpWS=p.vec3f64.create(),r.worldToLocalTransform=s.quatf64.create(),r.localToWorldTransform=s.quatf64.create(),r.scale=1,r.scale=e.resolution,r.pMS=t;var i=e.state.camera.viewRight;r.view.renderCoordsHelper.toRenderCoords(r.pMS,r.pWS),r.view.renderCoordsHelper.worldBasisAtPosition(r.pWS,0,r.tangentFrameRightWS),r.view.renderCoordsHelper.worldBasisAtPosition(r.pWS,1,r.tangentFrameUpWS),r.view.renderCoordsHelper.worldBasisAtPosition(r.pWS,2,r.tangentFrameForwardWS);var o=p.vec3f64.create();return c.vec3.scale(o,r.tangentFrameForwardWS,c.vec3.dot(i,r.tangentFrameForwardWS)),c.vec3.subtract(r.localFrameRightWS,i,o),c.vec3.normalize(r.localFrameRightWS,r.localFrameRightWS),c.vec3.cross(r.localFrameUpWS,r.tangentFrameForwardWS,r.localFrameRightWS),a.quat.rotationTo(r.worldToLocalTransform,r.localFrameRightWS,r.tangentFrameRightWS),a.quat.invert(r.localToWorldTransform,r.worldToLocalTransform),r}t.SceneViewCoordinateSystem=S,t.createViewAlignedCoordinateSystem=function(e,t){return"2d"===e.type?new v(e.state.transform,e.spatialReference):"3d"===e.type?new S(e,new m.Point({x:t[0],y:t[1],spatialReference:e.spatialReference})):null},t.createPoint=function(e,t){return new m.Point({x:e[0],y:e[1],spatialReference:t})},t.createMultipoint=function(e,t){return new m.Multipoint({points:e,spatialReference:t})},t.createPolyline=function(e,t,r){var i=new m.Polyline({paths:e,spatialReference:t});return r&&x.unnormalizeGeometryOnDatelineCrossing(i),i},t.createPolygon=G,t.createTriangleMS=function(e,t,r,i){var o=t.mapToLocalMultiple(e),n=o[0],a=o[1],s=Math.round(a.x-n.x),c=Math.round(a.y-n.y),p=null,l=null,d=null;if(r&&i){var u=Math.sqrt(s*s+c*c);p=E(-y*u+n.x,.5*u+n.y),l=E(y*u+n.x,.5*u+n.y),d=E(n.x,n.y-u)}else if(r)p=E(0<c?a.x:n.x,n.y+c),l=E(n.x-s,0<c?a.y:n.y-c),d=E(0<c?n.x:a.x,n.y-c);else if(i){var h=Math.max(Math.abs(s),Math.abs(c)),v=h*Math.sqrt(3)/2;p=E(n.x,0<c?n.y+h:n.y),l=E(0<s?n.x+h:n.x-h,0<c?n.y+h:n.y),d=E(0<s?n.x+h/2:n.x-h/2,0<c?n.y+h-v:n.y-v)}else p=E(0<c?n.x+s/2:a.x,n.y),l=E(0<c?n.x:n.x+s/2,a.y),d=E(0<c?a.x:n.x,0<c?a.y:n.y);return G([[p,d,l].map(function(e){return t.localToMap(e)})],t.spatialReference,t.doUnnormalization,!0)},t.createSquare=function(e,t,r){var i=t.mapToLocalMultiple(e),o=[],n={x:i[0].x,y:i[0].y},a=i[1].x,s=i[1].y,c=Math.round(a-n.x),p=Math.round(s-n.y),l=Math.max(Math.abs(c),Math.abs(p));if(r){var d={x:n.x+l,y:n.y+l},u={x:n.x-l,y:n.y-l};o.push(E(d.x,u.y),E(u.x,u.y),E(u.x,d.y),E(d.x,d.y))}else{var h={x:0<c?n.x+l:n.x-l,y:0<p?n.y+l:n.y-l};o.push(E(n.x,n.y),E(h.x,n.y),E(h.x,h.y),E(n.x,h.y))}return G([o.map(function(e){return t.localToMap(e)})],t.spatialReference,t.doUnnormalization,!0)},t.createRectangle=function(e,t,r){var i=t.mapToLocalMultiple(e);if(1===i.length){var o=i[0];i=[E(o.x-48,o.y+48),E(o.x+48,o.y-48),E(o.x+48,o.y-48),E(o.x-48,o.y+48)]}var n=[],a={x:i[0].x,y:i[0].y},s={x:i[1].x,y:i[1].y};if(r){var c=Math.round(s.x-a.x),p=Math.round(s.y-a.y);n.push(E(a.x-c,a.y-p),E(s.x,a.y-p),E(s.x,s.y),E(a.x-c,s.y))}else n.push(E(a.x,a.y),E(s.x,a.y),E(s.x,s.y),E(a.x,s.y));return G([n.map(function(e){return t.localToMap(e)})],t.spatialReference,t.doUnnormalization,!0)},t.createCircle=function(e,t,r){var i=t.mapToLocalMultiple(e),o=null,n=null;if(r)o=i[0],n=i[1];else{var a=i[0],s=i[1],c=Math.round(s.x-a.x),p=Math.round(s.y-a.y),l=Math.max(Math.abs(c),Math.abs(p));o=E(0<c?a.x+l/2:a.x-l/2,0<p?a.y+l/2:a.y-l/2),n=E(Math.abs(c)>Math.abs(p)?o.x-l/2:o.x,Math.abs(c)>Math.abs(p)?o.y:o.y-l/2)}var d=t.localToMap(o),u=t.localToMap(n);t.doUnnormalization&&x.unnormalizeVerticesOnDatelineCrossing([[d,u]],t.spatialReference);var h=new m.Point({x:d[0],y:d[1],spatialReference:t.spatialReference}),v=new m.Point({x:u[0],y:u[1],spatialReference:t.spatialReference}),y=_.getMetersPerUnitForSR(t.spatialReference)*g.distance(h,v,null),f=new w({center:h,radius:y,radiusUnit:"meters",spatialReference:t.spatialReference});return G(f.rings,f.spatialReference,!1)},t.createEllipse=function(e,t,r){for(var i=t.mapToLocalMultiple(e),o=i[0],n=i[1],a=Math.round(n.x-o.x),s=Math.round(n.y-o.y),c=E(r?o.x:o.x+a/2,r?o.y:o.y+s/2),p=r?a:a/2,l=r?s:s/2,d=[],u=2*Math.PI/60,h=0;h<60;h++){var v=Math.cos(h*u),y=Math.sin(h*u),f=E(p*v+c.x,l*y+c.y);d.push(f)}return d.push(d[0]),G([d.map(function(e){return t.localToMap(e)})],t.spatialReference,t.doUnnormalization,!1)}}.apply(null,i))||(e.exports=o)},2175:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(1),r(0),r(34),r(54),r(2)],void 0===(o=function(e,t,r,i,o,n,a){Object.defineProperty(t,"__esModule",{value:!0});var s,c=(s=a.declared(n.EventedAccessor),r(p,s),Object.defineProperty(p.prototype,"tool",{get:function(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw":return null;default:o.neverReached(this.activeComponent)}return null},enumerable:!0,configurable:!0}),p.prototype.addToHistory=function(e){this.history.redo=[],this.history.undo.push(e)},p.prototype.resetHistory=function(){this.history.redo=[],this.history.undo=[]},p.prototype.canUndo=function(){return 0<this.history.undo.length},p.prototype.canRedo=function(){return 0<this.history.redo.length},p.prototype.complete=function(){this.reset(),this.onEnd(),this.emit("complete")},p.prototype.cancel=function(){this._set("cancelled",!0),this.reset(),this.onEnd(),this.emit("cancel")},p.prototype.reset=function(){this.activeComponent.reset()},p.prototype.refreshComponent=function(){var e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type||e.refresh())},Object.defineProperty(p.prototype,"undo",{set:function(e){var t=this;this._set("undo",function(){t.canUndo()&&e()})},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"redo",{set:function(e){var t=this;this._set("redo",function(){t.canRedo()&&e()})},enumerable:!0,configurable:!0}),i([a.property()],p.prototype,"activeComponent",void 0),i([a.property()],p.prototype,"cancelled",void 0),i([a.property()],p.prototype,"history",void 0),i([a.property({dependsOn:["activeComponent"]})],p.prototype,"tool",null),i([a.property()],p.prototype,"type",void 0),i([a.property()],p.prototype,"canUndo",null),i([a.property()],p.prototype,"canRedo",null),i([a.property()],p.prototype,"onEnd",void 0),i([a.property()],p.prototype,"undo",null),i([a.property()],p.prototype,"redo",null),i([a.property()],p.prototype,"toggleTool",void 0),i([a.property()],p.prototype,"addToSelection",void 0),i([a.property()],p.prototype,"removeFromSelection",void 0),i([a.subclass("esri.widgets.Sketch.support.OperationHandle")],p));function p(){var e=null!==s&&s.apply(this,arguments)||this;return e.cancelled=!1,e.history={undo:[],redo:[]},e.type=null,e}t.OperationHandle=c}.apply(null,i))||(e.exports=o)}}]);